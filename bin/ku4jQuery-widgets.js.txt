(function(Y){$=Y;var ae=$.hash({1:"MOUSE_LEFT",2:"",3:"MOUSE_RIGHT",4:"",5:"",6:"",7:"",8:"BACKSPACE",9:"TAB",10:"",11:"",12:"",13:"ENTER",14:"",15:"",16:"SHIFT",17:"CTRL",18:"ALT",19:"",20:"CAPS",21:"",22:"",23:"",24:"",25:"",26:"",27:"ESC",28:"",29:"",30:"",31:"",32:"SPACE",33:"PAGEUP",34:"PAGEDOWN",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",41:")",42:"*",43:"+",44:",",45:"-",46:".",47:"/",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:":",59:";",60:"<",61:"=",62:">",63:"?",64:"@",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"[",92:"\\",93:"]",94:"^",95:"_",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"=",108:"l",109:"-",110:"n",111:"o",112:"p",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"|",125:"}",126:"~",127:"",128:"",129:"",130:"",131:"",132:"",133:"",134:"",135:"",136:"",137:"",138:"",139:"",140:"",141:"",142:"",143:"",144:"",145:"",146:"",147:"",148:"",149:"",150:"",151:"",152:"",153:"",154:"",155:"",156:"",157:"",158:"",159:"",160:"",161:"",162:"",163:"",164:"",165:"",166:"",167:"",168:"",169:"",170:"",171:"",172:"",173:"",174:"",175:"",176:"",177:"",178:"",179:"",180:"",181:"",182:"",183:"",184:"",185:"",186:"",187:"",188:",",189:"",190:".",191:"/",192:"`",193:"",194:"",195:"",196:"",197:"",198:"",199:"",200:"",201:"",202:"",203:"",204:"",205:"",206:"",207:"",208:"",209:"",210:"",211:"",212:"",213:"",214:"",215:"",216:"",217:"",218:"",219:"[",220:"\\",221:"]",222:"",223:"",224:"",225:"",226:"",227:"",228:"",229:"",230:"",231:"",232:"",233:"",234:"",235:"",236:"",237:"",238:"",239:"",240:"",241:"",242:"",243:"",244:"",245:"",246:"",247:"",248:"",249:"",250:"",251:"",252:"",253:"",254:"",255:""});function ap(a7,a9,a8,l){if(!$.isNumber(a7)){throw $.ku4exception("$.key",$.str.format("Invalid parameter: code {0}",a7))}this._code=a7;this.alt(a9||false).ctrl(a8||false).shift(l||false)}ap.prototype={code:function(l){return this.property("code",l)},alt:function(l){return this.property("alt",l)},ctrl:function(l){return this.property("ctrl",l)},shift:function(l){return this.property("shift",l)},equals:function(l){return this._code==l.code()&&this._alt==l.alt()&&this._ctrl==l.ctrl()&&this._shift==l.shift()},toString:function(){return $.str.parse(this._code)}};$.Class.extend(ap,$.Class);$.key=function(a7,a9,a8,l){return new ap(a7,a9,a8,l)};$.key.canParse=function(l){return $.isNumber(aB(l))};$.key.parse=function(a7){try{return new ap(aB(a7),a7.altKey,a7.ctrlKey,a7.shiftKey)}catch(l){throw $.ku4exception("$.key",$.str.format("Cannot parse object: {0}",a7))}};$.key.tryParse=function(l){return $.key.canParse(l)?$.key.parse(l):null};function aB(l){try{return($.exists(l.which))?l.which:event.keyCode}catch(l){return null}}function k(){this._hotKeys=$.hash();this._map=$.hash(ae)}k.prototype={map:function(l){return this.set("map",l);s},findCode:function(a8){var l=this._map.findKey(a8),a7=parseInt(l);return isNaN(a7)?null:a7},findKey:function(l){return this._map.findValue(l)}};$.Class.extend(k,$.Class);var U=new k();$.keyboard=function(){return U};function ad(){}ad.prototype={from:function(l){return($.exists(l.relatedTarget))?l.relatedTarget:l.fromElement},target:function(l){return(l.srcElement)?l.srcElement:l.target},clientCoord:function(l){if(!$.exists(l.clientX)){return null}return new $.coord(l.clientX,l.clientY)},documentCoord:function(l){if($.exists(this.pageCoord(l))){return this.pageCoord(l)}var a7=document.documentElement;return new $.coord(l.clientX+a7.scrollLeft,l.clientY+a7.scrollTop)},pageCoord:function(l){if(!$.exists(l.pageX)){return null}return new $.coord(l.pageX,l.pageY)},screenCoord:function(l){return new $.coord(l.screenX,l.screenY)},selection:function(){if($.exists(window.getSelection)){return window.getSelection()}if($.exists(document.getSelection)){return document.getSelection()}if($.exists(document.selection)&&$.exists(document.selection.createRange)){return document.selection.createRange().text}if($.exists(document.activeElement)&&$.exists(document.activeElement.selectionStart)){var a7=document.activeElement.selectionStart,l=document.activeElement.selectionEnd;return document.activeElement.value.substring(a7,l)}return null},clearSelection:function(){var l=this.selection();try{l.removeAllRanges()}catch(a7){l.empty()}return this}};$.Class.extend(ad,$.Class);var aN=new ad();$.mouse=function(){return aN};function aD(){}aD.prototype={canRead:function(l){return $.exists(l.touches)},from:function(a7){var l=a7.touches[0];return($.exists(l.relatedTarget))?l.relatedTarget:l.fromElement},target:function(a7){var l=a7.touches[0];return(l.srcElement)?l.srcElement:l.target},clientCoord:function(a7){var l=a7.touches[0];if(!$.exists(l.clientX)){return null}return new $.coord(l.clientX,l.clientY)},documentCoord:function(a7){var l=a7.touches[0];if($.exists(this.pageCoord(a7))){return this.pageCoord(a7)}var a8=document.documentElement;return new $.coord(l.clientX+a8.scrollLeft,l.clientY+a8.scrollTop)},pageCoord:function(a7){var l=a7.touches[0];if(!$.exists(l.pageX)){return null}return new $.coord(l.pageX,l.pageY)},screenCoord:function(a7){var l=a7.touches[0];return new $.coord(l.screenX,l.screenY)},selection:function(){if($.exists(window.getSelection)){return window.getSelection()}if($.exists(document.getSelection)){return document.getSelection()}if($.exists(document.selection)&&$.exists(document.selection.createRange)){return document.selection.createRange().text}if($.exists(document.activeElement)&&$.exists(document.activeElement.selectionStart)){var a7=document.activeElement.selectionStart,l=document.activeElement.selectionEnd;return document.activeElement.value.substring(a7,l)}return null},clearSelection:function(){var l=this.selection();try{l.removeAllRanges()}catch(a7){l.empty()}return this}};$.Class.extend(aD,$.Class);var aW=new aD();$.touch=function(){return aW};$.DomClass=function(l){$.DomClass.base.call(this);if(!$.exists(l)){$.ku4exception("$.dom","$.DomClass requires valid DOM node.")}this.dom(l)};$.DomClass.prototype={dom:function(l){return this.property("dom",l)}};$.Class.extend($.DomClass,$.Class);var aV={css:{addClass:function(a8,l){var a7=$.ele(a8),a9=a7.className;if($.ku.css.hasClass(a8,l)){return}a7.className+=(/^[^\s]/.test(a9))?(" "+l):l},hasClass:function(a7,l){if(!$.exists(l)){return false}return(new RegExp(l)).test(($.ele(a7)).className)},removeClass:function(a8,l){var a7=$.ele(a8),a9=a7.className;if(!$.ku.css.hasClass(a8,l)){return}a7.className=$.str.trim(a9.replace(new RegExp("(^|\\s)"+l+"(?![\\w\\-])"),""))}},getText:function(a7){var l=$.ele(a7);return l.textContent||l.innerText},quirks:{setOpacity:function(a8,a7){var l=a7/100;a8.style.opacity=l;a8.style["-moz-opacity"]=l;a8.style["-webkit-opacity"]=l;a8.style.filter=$.str.format("alpha(opacity={0})",a7)},clearOpacity:function(l){$.ku.style.set(l,{opacity:null,"-moz-opacity":null,"-webkit-opacity":null,filter:null})}},ready:function(a7,l){_funcs[_funcs.length]={f:a7,b:l||false}},redraw:function(a9){var a8=$.ele(a9)||document.documentElement,a7=a8.style.display||"";a8.style.display="none";var l=a8.offsetHeight;a8.style.display=a7},style:{set:function(bc,a8,a9){var bb=$.ele(bc);function l(be){return(/\-/.test(be))?be.replace(/\-\w/,be.charAt(be.indexOf("-")+1).toUpperCase()):be}if($.isString(a8)){try{bb.style[l(a8)]=a9}catch(ba){}}for(var bd in a8){var a7=l(bd);if(/opacity/i.test(a7)){$.ku.quirks.setOpacity(bc,a8[bd]);continue}try{bb.style[a7]=a8[bd]}catch(ba){continue}}},get:function(bc,a9){var bb=$.ele(bc);function l(bg,be){var bd=(/\-/.test(be))?be.replace(/\-\w/,be.charAt(be.indexOf("-")+1).toUpperCase()):be;try{return window.getComputedStyle(bg,null).getPropertyValue(be)}catch(bf){return($.exists(bg.currentStyle))?bg.currentStyle[be]:($.exists(bg.style))?bg.style[bd]:""}}if(/opacity/i.test(a9)){var a7=l(bb,a9);if($.exists(a7)){return parseFloat(a7)*100}else{var a8=/alpha\(opacity=\d+(\.\d+)?\)/i.exec(bb.style.filter);if(!$.exists(a8)){return 100}var ba=/\d+(\.\d+)?/i.exec(a8[0]);if(!$.exists(ba)){return 100}return parseFloat(ba[0])}}return l(bb,a9)},toNumber:function(l){return isNaN(l)?0:parseFloat(this.stripUnit(l))},stripUnit:function(l){return($.exists(l)&&$.exists(l.replace))?l.replace(/[^\-\.\d]/g,""):l},getUnit:function(l){return l.match(/[^\-\.\d]{2}/)[0]}},swapDom:function(a8,a7){var l=$.ele(a8);f=$.ele(a7);l.parentNode.replaceChild(f,l)}};$.ku=aV;$.clearNode=function(a7){var l=$.ele(a7);if(!l){return}while(l.hasChildNodes()){l.removeChild(l.firstChild)}};$.create=function(bd){if(!bd){return null}var a7=($.isString(bd))?{x:{}}:bd,bf,bb;for(var a8 in a7){if(a8=="content"){continue}bf=document.createElement(a8);attrs=a7[a8]}for(var a8 in attrs){var be=attrs[a8];if(/class/i.test(a8)){$.ku.css.addClass(bf,be);continue}if(/style/i.test(a8)){$.ku.style.set(bf,be);continue}bf.setAttribute(a8,be)}try{var bc=a7.content;if(!bc){return bf}var a9=(!bc)?1:bc.length;if($.exists(bc.nodeName)){bf.appendChild(bc);return bf}if(!$.isArray(bc)){bf.innerHTML+=bc;return bf}while(a9--){var l=bc[a9];if($.isString(l)||!isNaN(l)){bf.innerHTML+=l;continue}var a7=(l.hasOwnProperty("appendChild"))?l:$.create(l);bf.appendChild(a7)}}catch(ba){}finally{return bf}};$.ele=function(l){if(!l){return null}return($.isEvent(l))?$.evt.ele(l):($.isString(l))?document.getElementById(l):($.exists(l.dom))?l.dom:l};var N=function(ba,a7,a9,a8,l){this.dom=ba;this.evt=a7;this.action=a9;this.scope=a8;this.bubbles=l};$.evt={add:function(a7,bd,l,be,a8){if(!$.ele(a7)){$.ku4exception("$.evt",$.str.format("argument dom == {0} at $.evt.add",a7))}var ba=$.ele(a7),a9=bd,bf=be||ba,bb=a8||false,bc=function(){l.apply(bf,arguments)};if($.exists(ba.addEventListener)){ba.addEventListener(a9,bc,bb)}else{if($.exists(ba.attachEvent)){ba.attachEvent("on"+a9,bc)}else{ba["on"+a9]=bc}}return new N(ba,a9,bc,bf,bb)},remove:function(a9){var bb=a9.dom,ba=a9.evt,a8=a9.scope,l=a9.bubbles,a7=a9.action;if(bb.removeEventListener){bb.removeEventListener(ba,a7,l)}else{if(bb.detachEvent){bb.detachEvent("on"+ba,a7)}else{bb["on"+ba]=null}}return this},ele:function(l){try{return(l.srcElement)?l.srcElement:l.target}catch(l){return null}},mute:function(l){if($.exists(l.preventDefault)){l.preventDefault()}if($.exists(l.stopPropogation)){l.stopPropogation()}l.returnValue=false;l.cancelBubble=true;return this}};$.findOuterDims=function(a7){var l=$.ele(a7);if(!l){return{width:0,height:0}}return{width:l.offsetWidth,height:l.offsetHeight}},$.findInnerDims=function(a7){var l=$.ele(a7);if(!l){return{width:0,height:0}}return{width:l.clientWidth,height:l.clientHeight}},$.findOffset=function(a8){var a7=$.ele(a8),l=0,a9=0;if(!a7){return{left:0,top:0}}do{l+=a7.offsetLeft||0;a9+=a7.offsetTop||0}while((function(){try{a7=a7.offsetParent}catch(ba){a7=null}return $.exists(a7)})());return{left:l,top:a9}};$.findBoundedOffset=function(a7){var l=$.ele(a7);if(!l){return{left:0,top:0}}return{left:l.offsetLeft,top:l.offsetTop}},$.findScrollDims=function(a7){var l=$.ele(a7);if(!l){return{width:0,height:0}}return{width:l.scrollWidth,height:l.scrollHeight}};$.findScrollOffset=function(a8){var a7=$.ele(a8),l=0,a9=0;if(!a7){return{left:0,top:0}}do{l+=a7.scrollLeft||0;a9+=a7.scrollTop||0}while((function(){try{a7=a7.parentNode}catch(ba){a7=null}return $.exists(a7)})());return{left:l,top:a9}};var aP=function(a7){this._navigator=a7;agents={_isIE:"MSIE",_isNetscape:"Netscape",_isFirefox:"Firefox",_isOpera:"Opera",_isSafari:"Safari",_isChrome:"Chrome"};this._isIE=false;this._isNetscape=false;this._isFirefox=false;this._isOpera=false;this._isSafari=false;this._isChrome=false;this._isUnknown=true;this._version="";if(!$.isObject(a7)){return}var a7=this._navigator,a9=a7.userAgent;function bb(bd){return !$.isNullOrEmpty(a9)&&(new RegExp(bd,"i")).test(a9)}function a8(bh){try{var be=(new RegExp("Version\\/(\\d+\\.?){1,}","i")).exec(a9),bf=(new RegExp(bh+"\\/(\\d+\\.?){1,}","i")).exec(a9),bd=$.exists(be)?be:bf;return(new RegExp("(\\d+\\.?){1,}")).exec(bd[0])[0]}catch(bg){return""}}var bc,l,ba;for(bc in agents){ba=agents[bc];l=bb(ba);if(!l){continue}this[bc]=l;this._version=a8(ba);this._isUnknown=false}this._fullVersion=a7.appVersion;this._platform=a7.platform;this._allInfo=this._fullVersion+this._platform};aP.prototype={isIE:function(){return this._isIE},isNetscape:function(){return this._isNetscape},isFirefox:function(){return this._isFirefox},isOpera:function(){return this._isOpera},isSafari:function(){return this._isSafari&&!this._isChrome},isChrome:function(){return this._isChrome},isUnknown:function(){return this._isUnknown},platform:function(){return this._platform},fullVersion:function(){return this._fullVersion},version:function(){return this._version}};var aq;$.ku.browser=function(){if($.exists(aq)){return aq}aq=new aP(navigator);return aq};$.ku.browser.Class=aP;var H=function(l){H.base.call(this,$.ele(l));var a7=this.style("display")||"block";this._display=(/none/i.test(a7))?"block":a7;this._liveEvents=$.hash()};H.prototype={attribute:function(l,a7){var a8=this.dom();if($.isUndefined(a7)){return a8.getAttribute(l)}a8.setAttribute(l,a7);return this},addClass:function(l){$.ku.css.addClass(this.dom(),l);return this},removeClass:function(l){$.ku.css.removeClass(this.dom(),l);return this},hasClass:function(l){$.ku.css.hasClass(this.dom(),l);return this},style:function(a7,l){if($.isString(a7)&&!$.exists(l)){return $.ku.style.get(this.dom(),a7)}$.ku.style.set(this.dom(),a7,l);return this},value:function(l){if(!$.exists(l)){return this.dom().value}this.dom().value=l;return this},content:function(l){if(!$.exists(l)){return this}if($.isNumber(l)||$.isString(l)){return this.html(l)}return this.appendChild(l)},cloneNode:function(l){return this._dom.cloneNode(l||true)},html:function(l){if(!$.exists(l)){return this.dom().innerHTML}this.dom().innerHTML=l;return this},text:function(l){if(!$.exists(l)){return $.ku.getText(this.dom())}$.ku.setText(this.dom(),l);return this},prependChild:function(a7){var a8=this.dom(),l=a8.firstChild;if($.exists(l)){a8.insertBefore(a7,l)}else{a8.appendChild(a7)}return this},appendChild:function(l){this.dom().appendChild(l);return this},removeChild:function(l){this.dom().removeChild(l);return this},insertBefore:function(l){l.parentNode.insertBefore(this.dom(),l);return this},insertAfter:function(l){if($.exists(l.nextSibling)){l.parentNode.insertBefore(this.dom(),l.nextSibling)}else{l.parentNode.appendChild(this.dom())}return this},appendTo:function(l){l.appendChild(this.dom());return this},detach:function(){try{var a7=this.dom();a7.parentNode.removeChild(a7)}catch(l){}finally{return this}},innerDims:function(l){if(!$.exists(l)){return $.coord.parse($.findInnerDims(this.dom()))}var a7=l.toPixel();this.style({width:a7.x(),height:a7.y()});return this},outerDims:function(a7){if(!$.exists(a7)){return $.coord.parse($.findOuterDims(this.dom()))}var l=this.outerDims().subtract(this.innerDims());return this.innerDims(a7.subtract(l))},innerWidth:function(l){var a7=this.innerDims();if(!$.exists(l)){return $.coord(a7.x(),0)}return this.innerDims($.coord(l,a7.y()))},innerHeight:function(l){var a7=this.innerDims();if(!$.exists(l)){return $.coord(0,a7.y())}return this.innerDims($.coord(a7.x(),l))},outerWidth:function(l){var a7=this.outerDims();if(!$.exists(l)){return $.coord(a7.x(),0)}return this.outerDims($.coord(l,a7.y()))},outerHeight:function(l){var a7=this.outerDims();if(!$.exists(l)){return $.coord(0,a7.y())}return this.outerDims($.coord(a7.x(),l))},boundedOffset:function(){return $.coord.parse($.findBoundedOffset(this.dom()))},layoutDims:function(){var l=this.dom().parentNode;if(!$.exists(l)){return $.coord.zero()}var a7=$.dom(l);return a7.outerDims().subtract(a7.innerDims()).half()},offset:function(){return $.coord.parse($.findOffset(this.dom()))},center:function(){return this.offset().add(this.outerDims().half())},scrollDims:function(){return $.coord.parse($.findScrollDims(this.dom()))},scrollOffset:function(){return $.coord.parse($.findScrollOffset(this.dom()))},clear:function(){$.clearNode(this.dom());return this},redraw:function(){$.ku.redraw(this.dom());return this},swap:function(l){$.ku.swapDom(this.dom(),l.dom());return l},show:function(){this.style({display:this._display});return this},hide:function(){this.style({display:"none"});return this},isVisible:function(){var l=this.offset(),a7=this.offset().add(this.innerDims());return $.exists(this.dom().parentNode)&&!/NONE|^$/i.test(this.style("display"))&&$.window().scrollOffset().isLeftOf(a7)&&$.window().scrollOffset().isAbove(a7)&&$.window().scrollDims().isRightOf(l)&&$.window().scrollDims().isBelow(l)},onmouseover:function(l,a8,a7){return this._addEvent("mouseover",l,a8,a7)},onmouseout:function(l,a8,a7){return this._addEvent("mouseout",l,a8,a7)},onmousedown:function(l,a8,a7){return this._addEvent("mousedown",l,a8,a7)},onmouseup:function(l,a8,a7){return this._addEvent("mouseup",l,a8,a7)},onmousemove:function(l,a8,a7){return this._addEvent("mousemove",l,a8,a7)},onclick:function(l,a8,a7){return this._addEvent("click",l,a8,a7)},ondoubleclick:function(l,a8,a7){return this._addEvent("dblclick",l,a8,a7)},onkeydown:function(l,a8,a7){return this._addEvent("keydown",l,a8,a7)},onkeyup:function(l,a8,a7){return this._addEvent("keyup",l,a8,a7)},onkeypress:function(l,a8,a7){return this._addEvent("keypress",l,a8,a7)},onblur:function(l,a8,a7){return this._addEvent("blur",l,a8,a7)},onchange:function(l,a8,a7){return this._addEvent("change",l,a8,a7)},onerror:function(l,a8,a7){return this._addEvent("error",l,a8,a7)},onfocus:function(l,a8,a7){return this._addEvent("focus",l,a8,a7)},onload:function(l,a8,a7){return this._addEvent("load",l,a8,a7)},onresize:function(l,a8,a7){return this._addEvent("resize",l,a8,a7)},onscroll:function(l,a8,a7){return this._addEvent("scroll",l,a8,a7)},onselect:function(l,a8,a7){return this._addEvent("select",l,a8,a7)},onresize:function(l,a8,a7){return this._addEvent("resize",l,a8,a7)},onunload:function(l,a8,a7){return this._addEvent("unload",l,a8,a7)},onorientationchange:function(l,a8,a7){return this._addEvent("orientationchange",l,a8,a7)},ontouchstart:function(l,a8,a7){return this._addEvent("touchstart",l,a8,a7)},ontouchend:function(l,a8,a7){return this._addEvent("touchend",l,a8,a7)},ontouchmove:function(l,a8,a7){return this._addEvent("touchmove",l,a8,a7)},removeEvent:function(a7){var l=this._liveEvents.find(a7);if(!$.exists(l)){return this}return this._removeEvent(l,a7)},clearEvents:function(){$.list(this._liveEvents.values()).each(function(l){this._removeEvent(l)},this);return this},_addEvent:function(a8,a7,bb,ba){var l=ba||$.uid("evt"),a9=this._liveEvents;if(a9.containsKey(l)){return this}a9.add(l,$.evt.add(this.dom(),a8,a7,bb));return this},_removeEvent:function(l,a7){$.evt.remove(l);this._liveEvents.remove(a7);return this}};$.Class.extend(H,$.DomClass);$.dom=function(l){return new H(l)};$.dom.parseHtml=function(l){var a7=$.create({div:{},content:l});if(a7.childNodes.length!=1){return null}return $.dom(a7.firstChild)};$.dom.Class=H;function aZ(){aZ.base.call(this);this._body=$.dom(document.body)}aZ.prototype={isDisabled:function(){return this.get("disabled")},isPortrait:function(){return this.orientation.isLandscape()},isLandscape:function(){return Math.abs(window.orientation)==90},disable:function(){this._disabled=true;document.body.appendChild(an);return this},enable:function(){if(!this.isDisabled()){return this}document.body.removeChild(an);this._disabled=false;return this},dims:function(){var l=window.innerWidth||document.documentElement.clientWidth,a7=window.innerHeight||document.documentElement.clientHeight;return $.coord(l,a7)},center:function(){return this.dims().divide($.coord(2,2))},scrollOffset:function(){var a9=document.documentElement,a7=document.body,l=Math.max(a9.scrollLeft,a7.scrollLeft),a8=Math.max(a9.scrollTop,a7.scrollTop);return $.coord(l,a8)},scrollDims:function(){var a9=document.documentElement,a7=document.body,l=Math.max(a9.scrollWidth,a7.scrollWidth),a8=Math.max(a9.scrollHeight,a7.scrollHeight);return $.coord(l,a8)},scrollCenter:function(){return this.center().add(this.scrollOffset())},contains:function(l){var a8=this.scrollOffset(),a7=this.scrollDims();if(!l instanceof $.point.Class){$.ku4exception("$.window","contains method takes and argument type $.point")}return !(l.isAbove(a8)||l.isLeftOf(a8)||l.isRightOf(a7)||l.isBelow(a7))},redraw:function(){$.ku.redraw(document.body);$.ku.redraw(document.documentElement);return this},onmousedown:function(l,a8,a7){return this._body.onmousedown(l,a8,a7)},onmouseup:function(l,a8,a7){return this._body.onmouseup(l,a8,a7)},ontouchstart:function(l,a8,a7){return this._body.ontouchstart(l,a8,a7)},ontouchend:function(l,a8,a7){return this._body.ontouchend(l,a8,a7)},onclick:function(l,a8,a7){return this._body.onclick(l,a8,a7)},ondoubleclick:function(l,a8,a7){return this._body.ondoubleclick(l,a8,a7)},onkeydown:function(l,a8,a7){return this._body.onkeydown(l,a8,a7)},onkeyup:function(l,a8,a7){return this._body.onkeyup(l,a8,a7)},scrollTo:function(l){window.scrollTo(l.x(),l.y());return this},onresize:function(l,a8,a7){u.add(l,a8,a7);return this},onscroll:function(l,a8,a7){ay.add(l,a8,a7);return this},onspin:function(l,a8,a7){aC.add(l,a8,a7);return this},remove:function(l){u.remove(l);ay.remove(l);aC.remove(l);this._body.removeEvent(l);return this}};$.Class.extend(aZ,$.Class);var an=$.create({div:{"class":"ku-window-disabled"}}),u=$.observer(),ay=$.observer(),aC=$.observer(),b=function(){};b.prototype={uri:function(l){return this.property("uri",l)},offset:function(l){return this.property("offset",l)},dims:function(l){return this.property("dims",l)},channelmode:function(l){return this.property("channelmode",l)},directories:function(l){return this.property("directories",l)},fullscreen:function(l){return this.property("fullscreen",l)},location:function(l){return this.property("location",l)},menubar:function(l){return this.property("menubar",l)},scrollbars:function(l){return this.property("scrollbars",l)},titlebar:function(l){return this.property("titlebar",l)},toolbar:function(l){return this.property("toolbar",l)},open:function(){}};$.Class.extend(b,$.Class);var aI;$.window=function(){if($.exists(aI)){return aI}$.evt.add(window,"resize",function(){u.notify()});$.evt.add(window,"scroll",function(){ay.notify()});$.evt.add(window,"orientationchange",function(){aC.notify()});aI=new aZ();return aI};$.ku.localization={en:{day:{name:{0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"},abbr:{0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"}},month:{name:{1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},abbr:{1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"}}},sp:{day:{name:{0:"domingo",1:"lunes",2:"martes",3:"mi&#0233;rcoles",4:"jueves",5:"viernes",6:"sï¿½bado"},abbr:{0:"dom",1:"lun",2:"mar",3:"mi&#0233;",4:"jue",5:"vie",6:"s&#0225;b"}},month:{name:{1:"enero",2:"febrero",3:"marzo",4:"abril",5:"mayo",6:"junio",7:"julio",8:"agosto",9:"septiembre",10:"octubre",11:"noviembre",12:"diciembre"},abbr:{1:"ene",2:"feb",3:"mar",4:"abr",5:"may",6:"jun",7:"jul",8:"ago",9:"sep",10:"oct",11:"nov",12:"dic"}}}};$.ku.equations={cycle:function(a8,ba,a9,a7,l){return new $.coord(this.sin(a8.x,ba,a9),this.cos(a8.y,a7,l))},cos:function(a8,a7,l){return a8+Math.cos(a7)*l},cosH:function(a8,a7,l){return new $.coord(this.cos(a8.x,a7,l),a8.y)},cosV:function(a8,a7,l){return new $.coord(a8.x,this.cos(a8.y,a7,l))},sin:function(a8,a7,l){return a8+Math.sin(a7)*l},sinH:function(a8,a7,l){return new $.coord(this.sin(a8.x,a7,l),a8.y)},sinV:function(a8,a7,l){return new $.coord(a8.x,this.sin(a8.y,a7,l))}};$.anime={algorithms:{ease:{}}};var a1=function(l){this._ease=l||0.1};a1.prototype={calculate:function(a7,l){return(l-a7)*this._ease}};$.anime.algorithms.ease.linear=function(l){return new a1(l)};var aO=function(){};aO.prototype={calculate:function(a7,l){return l-a7}};$.anime.algorithms.jump=function(){return new aO()};var o=function(a7,l){this._spring=a7||0.4;this._mu=l||0.6};o.prototype={calculate:function(bc,a8,bb){var a7=this._spring,a9=bb,l=this._mu,bd=a8-bc,ba=bd*a7;a9+=ba;a9*=l;return a9}};$.anime.algorithms.spring=function(a7,l){return new o(a7,l)};function a4(l){this._context=l}a4.prototype={findCoord:function(a8){var l=this._context,a7=$.touch().canRead(a8)?$.touch():$.mouse();return a7.documentCoord(a8).subtract(l.hitCoord()).subtract(l.hitOffset()).add(l.hitBoundedOffet())}};function y(l){this._context=l}y.prototype={findCoord:function(a8){var l=this._context,a7=$.touch().canRead(a8)?$.touch():$.mouse();return l.hitSize().add(a7.documentCoord(a8).subtract(l.hitCoord()).subtract(l.hitOffset()))}};function aK(l){this._context=l}aK.prototype={findCoord:function(a8){var l=this._context,a7=$.touch().canRead(a8)?$.touch():$.mouse();return l.hitCoord().add(l.hitOffset()).subtract(a7.documentCoord(a8)).add(l.hitScrollOffset())}};var ax={};function aj(l){aj.base.call(this,l);this._mouseEvt=$.uid("dragger");this._touchEvt=$.uid("toucher");this._documentBody=$.dom(document.body);this._onGrab=$.observer();this._onDrag=$.observer();this._onDrop=$.observer();this._constrainX=false;this._constrainY=false;this._boundX=0;this._boundY=0;this._lastPoint=$.coord.zero();this._bearing=$.vector.zero();this._document=$.dom(document);this.state(new ax.dropped()).dragger().dragOffset($.coord.zero()).ontouchstart(this.grab,this,this._touchEvt).onmousedown(this.grab,this,this._mouseEvt)}aj.prototype={document:function(){return this._document},hitSize:function(l){return this.property("hitSize",l)},hitCoord:function(l){return this.property("hitCoord",l)},hitOffset:function(l){return this.property("hitOffset",l)},dragOffset:function(l){return this.property("dragOffset",l)},hitScrollOffset:function(l){return this.property("hitScrollOffset",l)},hitBoundedOffet:function(l){return this.property("hitBoundedOffet",l)},actor:function(){return this.get("actor")},strategy:function(){return this.get("strategy")},bearing:function(){return this.get("bearing")},bearingUp:function(){return this.bearing().y()<0},bearingDown:function(){return this.bearing().y()>0},bearingLeft:function(){return this.bearing().x()<0},bearingRight:function(){return this.bearing().x()>0},constrainX:function(){if(this._constrainX){return this}this._constrainX=true;this._boundX=this.boundedOffset().x();return this},unconstrainX:function(){this._constrainX=false},constrainY:function(){if(this._constrainY){return this}this._constrainY=true;this._boundY=this.boundedOffset().y();return this},unconstrainY:function(){this._constrainY=false},state:function(l){return this.set("state",l.context(this))},dragCoord:function(a9){var bb=this.strategy().findCoord(a9),a8=this.dragOffset(),a7=(this._constrainX)?this._boundX:bb.x()+a8.x(),ba=(this._constrainY)?this._boundY:bb.y()+a8.y(),l=$.point(a7,ba);this._bearing=l.distanceFrom(this._lastPoint);this._lastPoint=l;return l},dragger:function(){return this.set("actor",$.pinner(this.dom())).set("strategy",new a4(this))._setType("dragger")},sizer:function(){return this.set("actor",$.sizer(this.dom())).set("strategy",new y(this))._setType("sizer")},scroller:function(){return this.set("actor",$.scroller(this.dom())).set("strategy",new aK(this))._setType("scroller")},grab:function(l){this._onGrab.notify(l);this._state.grab(l);return this},drag:function(l){this._onDrag.notify(l);this._state.drag(l);return this},drop:function(l){this._onDrop.notify(l);this._state.drop(l);this._bearing=$.vector.zero();return this},onGrab:function(a7,l,a8){this._onGrab.add(a7,l,a8);return this},onDrag:function(a7,l,a8){this._onDrag.add(a7,l,a8);return this},onDrop:function(a7,l,a8){this._onDrop.add(a7,l,a8);return this},destroy:function(){this._onGrab.clear();this._onDrag.clear();this._onDrop.clear();this.removeEvent(this._mouseEvt).removeEvent(this._touchEvt)},disableSelect:function(a7){document.onselectstart=function(){return false};if(!$.exists(window.getSelection)){return this}this._mouseDisableId=$.uid("disable");this._touchDisableId=$.uid("disable");function l(){window.getSelection().removeAllRanges()}this._documentBody.onmousemove(l,null,this._mouseDisableId).ontouchmove(l,null,this._touchDisableId);return this},enableSelect:function(){document.onselectstart=null;var l=this._mouseDisableId,a7=this._touchDisableId,a8=this._documentBody;if($.exists(l)){a8.removeEvent(l)}if($.exists(a7)){a8.removeEvent(a7)}this._mouseDisableId=null;this._touchDisableId=null;return this},_setType:function(l){this._clearType().addClass($.str.format("ku-dragger-{0}",l));return this},_clearType:function(){this.removeClass("ku-dragger-dragger").removeClass("ku-dragger-sizer").removeClass("ku-dragger-scoller");return this}};$.Class.extend(aj,$.dom.Class);$.dnd=function(l){return new aj(l)};ax.dropped=function(){ax.dropped.base.call(this,ax)};ax.dropped.prototype={grab:function(a9){$.evt.mute(a9);var l=this.context(),a8=$.touch().canRead(a9)?$.touch():$.mouse(),a7=a8.documentCoord(a9).subtract(l.offset());l.document().ontouchmove(l.drag,l,$.uid()).ontouchend(l.drop,l,$.uid()).onmousemove(l.drag,l,$.uid()).onmouseup(l.drop,l,$.uid());l.disableSelect().addClass("ku-dragger-grabbed").hitSize(l.outerDims()).hitCoord(a7).hitOffset(l.offset()).hitScrollOffset(l.scrollOffset()).hitBoundedOffet(l.boundedOffset()).actor().to(l.dragCoord(a9));this.state("grabbed")},drag:function(){return},drop:function(){return}};$.Class.extend(ax.dropped,$.abstractState);ax.grabbed=function(){ax.grabbed.base.call(this,ax)};ax.grabbed.prototype={grab:function(){return},drag:function(a7){$.evt.mute(a7);var l=this.context();l.actor().to(l.dragCoord(a7));this.context().redraw()},drop:function(l){this.context().enableSelect().removeClass("ku-dragger-grabbed").document().clearEvents();this.state("dropped")}};$.Class.extend(ax.grabbed,$.abstractState);function g(l){g.base.call(this,l);this._onEnd=$.observer();this.linear()}g.prototype={$to:function(l){return},$moveTo:function(l){return},$done:function(){this._onEnd.notify();return this},algorithm:function(l){this.$algorithm=l;return this},linear:function(l){return this.algorithm($.anime.algorithms.ease.linear(l))},spring:function(a7,l){this.algorithm($.anime.algorithms.spring(a7,l))},stop:function(){if(!$.exists(this.$tween)){return this}this.$tween.stop();return this},to:function(l){this.stop().$to(l).$done();return this},moveTo:function(l){this.stop().$moveTo(l);return this},onEnd:function(a7,l){if(!$.exists(a7)){return this}this._onEnd.add(a7,l);return this}};$.Class.extend(g,$.dom.Class);function x(l){$.dom(l).addClass("ku-fader");x.base.call(this,l)}x.prototype={$to:function(l){var a8=this.dom(),a7=$.dom(a8);a7.style("opacity",l*0.01);return this},$moveTo:function(l){var a8=this.dom(),a7=$.dom(a8),a9=a7.style("opacity")||1;this.$tween=$.tween(function(ba){a7.style("opacity",ba*0.01)},a9,l,this.$algorithm).onEnd(this.$done,this).start(a8)}};$.Class.extend(x,g);$.fader=function(l){return new x(l)};function ag(l){$.dom(l).addClass("ku-fitter");ag.base.call(this,l)}ag.prototype={$to:function(l){var a8=this.dom(),a7=$.dom(a8);a7.style("width",l.x()+"px");a7.style("height",l.y()+"px");return this},$moveTo:function(a9){var a7=this.dom(),l=$.dom(a7),a8=l.outerDims();this.$tween=$.tween(function(ba){l.style("width",ba.x()+"px");l.style("height",ba.y()+"px")},a8,au(this,a9),this.$algorithm).onEnd(this.$done,this).start(a7)}};$.Class.extend(ag,g);function au(l,a8){var a9=a8.y()/a8.x(),a7=$.dom(l.dom()),bd=a7.outerDims(),ba=bd.y()/bd.x(),be=isNaN(ba)?1:ba,bc=bd.x(),bb=bd.y();if((be<a9)||(be==a9)){bc=a8.x();bb=a8.x()*ba}if(be>a9){bc=a8.y()/ba;bb=a8.y()}return $.coord(bc,bb)}$.fitter=function(l){return new ag(l)};function n(l){$.dom(l).addClass("ku-pinner");n.base.call(this,l)}n.prototype={$to:function(l){var a8=this.dom(),a7=$.dom(a8);a7.style("left",l.x()+"px");a7.style("top",l.y()+"px");return this},$moveTo:function(bc){var ba=this.dom(),a9=$.dom(ba),a8=a9.offset(),a7=$.findOffset(ba.parentNode),l=($.coord.canParse(a7))?$.coord.parse(a7):$.coord.zero(),bb=a8.subtract(l);this.$tween=$.tween(function(bd){a9.style("left",bd.x()+"px");a9.style("top",bd.y()+"px")},bb,bc,this.$algorithm).onEnd(this.$done,this).start(ba)}};$.Class.extend(n,g);$.pinner=function(l){return new n(l)};function P(l){$.dom(l).addClass("ku-scoller");P.base.call(this,l)}P.prototype={$to:function(l){var a8=this.dom(),a7=$.dom(a8);a7.style("scrollLeft",l.x());a7.style("scrollTop",l.y());return this},$moveTo:function(bc){var ba=this.dom(),a9=$.dom(ba),a8=a9.scrollOffset(),a7=$.findOffset(ba.parentNode),l=($.coord.canParse(a7))?$.coord.parse(a7):$.coord.zero(),bb=a8.subtract(l);this.$tween=$.tween(function(bd){a9.style("scrollLeft",bd.x());a9.style("scrollTop",bd.y())},bb,bc,this.$algorithm).onEnd(this.$done,this).start(ba)}};$.Class.extend(P,g);$.scroller=function(l){return new P(l)};function F(l){$.dom(l).addClass("ku-sizer");F.base.call(this,l)}F.prototype={$to:function(l){var a8=this.dom(),a7=$.dom(a8);a7.style("width",l.x()+"px");a7.style("height",l.y()+"px");return this},$moveTo:function(a9){var a7=this.dom(),l=$.dom(a7),a8=l.outerDims();this.$tween=$.tween(function(ba){l.style("width",ba.x()+"px");l.style("height",ba.y()+"px")},a8,a9,this.$algorithm).onEnd(this.$done,this).start(a7)}};$.Class.extend(F,g);$.sizer=function(a8,a7,l){return new F(a8,a7,l)};function aS(l,a7){$.dom(l).addClass("ku-styler");aS.base.call(this,l);this._prop=a7}aS.prototype={$moveTo:function(a8){var bc=this.dom(),bb=$.dom(bc),a9=this._prop,ba=bb.style(a9),l=$.ku.style,a7=l.getUnit(ba)||"",bd=l.toNumber(ba);this.$tween=$.tween(function(be){bb.style(a9,be+a7)},bd,a8,this.$algorithm).onEnd(this.$done,this).start(bc)}};$.Class.extend(aS,g);$.styler=function(l,a7){return new aS(l,a7)};function aa(a7,l){aa.base.call(this,l);this._listeners=$.observer();this._ticks=0;this.fps(a7||30)}aa.prototype={fps:function(l){this._interval=1000/l;return this.property("fps",l)},interval:function(){return this.get("interval")},listeners:function(){return this.get("listeners")},ticks:function(){return this.get("ticks")},start:function(){this._state.start();return this},stop:function(){this._state.stop();return this},add:function(a7,be,l,a8){var bb=this,bd=a8||1,bc=l||$.uid("timeline"),ba=function(){if(!bb._ticks%bd==0){return}a7();a9=a7},a9=(!a8)?a7:ba;this._listeners.add(a9,be,bc);return this},remove:function(l){this._listeners.remove(l);return this},clear:function(){this._listeners.clear();return this},tick:function(){this._ticks++;return this}};$.Class.extend(aa,$.abstractContext);$.timeline=function(){return G};aa.started=function(){aa.started.base.call(this,aa)};aa.started.prototype={start:function(){return},stop:function(){clearTimeout(ku_timeline);ku_timeline=null;this.state("stopped")}};$.Class.extend(aa.started,$.abstractState);aa.stopped=function(){aa.stopped.base.call(this,aa)};aa.stopped.prototype={start:function(){var a8=this.context(),a7=a8.interval(),l=function(){a8.tick().listeners().notify();ku_timeline=setTimeout(l,a7)};l();this.state("started")},stop:function(){return}};$.Class.extend(aa.stopped,$.abstractState);var G=new aa(30,new aa.stopped()).start();var ai=function(a9,a8,l,a7){this.$method=a9;this.$current=a8;this.$end=l;this.$algorithm=a7;this.$value=0;this._onEnd=$.observer();this._id=$.uid("tween")};ai.prototype={$exec:function(){return},$done:function(){this._onEnd.notify()},start:function(){$.timeline().add(this.$exec,this,this._id);return this},stop:function(){$.timeline().remove(this._id);return this},onEnd:function(a7,l){this._onEnd.add(a7,l);return this},clear:function(){this._onEnd.clear();return this}};$.Class.extend(ai,$.Class);var ak=function(a9,a8,l,a7){ak.base.call(this,a9,a8,l,a7);this.$value=$.coord.zero()};ak.prototype={$exec:function(){var bc=this.$method,bb=this.$current,l=this.$end;var a9=this.$algorithm.calculate(bb.x(),l.x(),this.$value.x());var a7=this.$algorithm.calculate(bb.y(),l.y(),this.$value.y()),a8=$.coord(a9,a7),ba=l.abs().subtract(bb.abs());if((Math.abs(a9)<0.1)&&(ba.x()<1)&&(Math.abs(a7)<0.1)&&(ba.y()<1)){bc(l);this.stop()._onEnd.notify();return}this.$current=bb.add(a8);this.$value=a8;bc(this.$current)}};$.Class.extend(ak,ai);var a=function(a9,a8,l,a7){a.base.call(this,a9,a8,l,a7)};a.prototype={$exec:function(){var a9=this.$method,a8=this.$current,l=this.$end,a7=this.$algorithm.calculate(a8,l,this.$value);if((Math.abs(a7)<0.1)&&(Math.abs(l-a8)<1)){a9(l);this.stop().$done();return}this.$current=a8+a7;this.$value=a7;a9(this.$current)}};$.Class.extend(a,ai);$.tween=function(a9,a8,l,a7){return($.isNumber(a8)&&$.isNumber(l))?new a(a9,a8,l,a7):new ak(a9,a8,l,a7)};function O(ba,a9,l,a7,bb,a8){O.base.call(this,ba);this.id($.uid("jsx-cell")).cIdx(a9).cKey(l).rIdx(a7).rKey(bb).value(a8)}O.prototype={id:function(l){return this.property("id",l)},value:function(l){return this.property("value",l)},cIdx:function(l){if($.exists(l)){this.dom().cIdx=l}return this.property("cIdx",l)},rIdx:function(l){if($.exists(l)){this.dom().rIdx=l}return this.property("rIdx",l)},cKey:function(l){if($.exists(l)){this.dom().cKey=l}return this.property("cKey",l)},rKey:function(l){if($.exists(l)){this.dom().rKey=l}return this.property("rKey",l)}};$.Class.extend(O,$.dom.Class);$.cell=function(ba,a9,l,a7,bb,a8){return new O(ba,a9,l,a7,bb,a8)};$.cell.Class=O;function T(ba,a7,l,a8,a9){T.base.call(this,ba);this.id($.uid()).col(a7).index(l).key(a8).value(a9);this._cells=$.hash()}T.prototype={id:function(l){return this.property("id",l)},col:function(l){return this.property("col",l)},value:function(l){if($.exists(l)){this.content(l)}return this.property("value",l)},index:function(l){if($.exists(l)){this.dom().cIdx=l}return this.property("index",l)},key:function(l){if($.exists(l)){this.dom().cKey=l}return this.property("key",l)},findCell:function(l){return this._cells.find(l)},listCells:function(){return $.list(this._cells.values())},addCell:function(l){this._cells.add(l.rKey(),l);return this},removeCell:function(l){var a7=this._cells;a7.remove(l.rKey());if(a7.isEmpty()){$.dom(this._col).detach();this.detach()}return this},};$.Class.extend(T,$.dom.Class);$.column=function(ba,a7,l,a8,a9){return new T(ba,a7,l,a8,a9)};$.column.Class=T;function am(a7){$.cast(this,a7);this._dri=new $.iterator(this.rows.values());this.helper=$.create({tr:{"class":"ku-table-dragRow-helper"}});$.slider(this.helper,null,null,null,null,null,"dragger","vertical");this._isMoving=false;this._hitPoint;this._moveDom;function l(a8){return $.cast($.coord.parse($.findOffset(this.dom)),$.point)}this._dri.foreach(function(a8){$.evt.add(a8.dom,"mouseover",function(){if(!this._isMoving){return}var bd=a8.dom,a9=this.body,ba=this.helper,bb=this._hitPoint,bc=l(bd);if(!bd.nextSibling){a9.appendChild(ba)}else{if(bc.isAbove(bb)){a9.insertBefore(ba,bd)}else{a9.insertBefore(ba,bd.nextSibling)}}this._hitPoint=bc},this);$.dnd(a8.dom,function(){this.helper=a8.dom;this._isMoving=true;this._hitPoint=l(a8.dom);this._moveDom=a8.dom;this.body.insertBefore(this.helper,a8.dom);$.ku.css.addClass(this.body,"ku-table-draggableRow-dragging");$.ku.css.addClass(this._moveDom,"ku-table-draggableRow-moveDom")},null,function(){$.ku.css.removeClass(this.body,"ku-table-draggableRow-dragging");$.ku.css.removeClass(this._moveDom,"ku-table-draggableRow-moveDom");$.ku.swapDom(this.helper,this._moveDom);this._isMoving=false;this._moveDom=null;this.format()},this)},this)}$.draggableRowDecorator=function(l){return new am(l)};function aF(l){$.cast(this,l);this._sci=new $.iterator(this.columns.values());this._sci.foreach(function(a9){var a8=a9.dom,a7=$.create({a:{"class":"ku-table-col-sizer"}});new $.slider(a8,a7,null,null,null,null,"sizer","horizontal");a8.appendChild(a7)})}function aJ(l){$.cast(this,l);this._isAsc=false;this._asc=new $.sorter(sorter.strategy.asc);this._des=new $.sorter(sorter.strategy.des);this._sortci=new $.iterator(this.columns.values());this._sortci.foreach(function(a9){var a7=new $.iterator(a9.cells.values()),a8=$.create({a:{"class":"ku-table-col-sorter"}});a9.dom.appendChild(a8);$.evt.add(a8,"click",function(){var bi=[],ba=this._isAsc,bj=(ba)?this._asc:this._des,bc="ku-table-col-sorter-{0}",bf=$.str.format(bc,"asc"),bd=$.str.format(bc,"dec"),bh=(ba)?bf:bd;a7.foreach(function(bk){bi[bi.length]=bk.dom});this._isAsc=!this._isAsc;var bg=bj.sort(bi),bb=bg.length,be=this.body;$.clearNode(be);while(bb--){be.appendChild(this.rows.find(bg[i].rIdx).dom)}$.ku.css.removeClass(a8,bf);$.ku.css.removeClass(a8,bd);$.ku.css.addClass(a8,bh);this.format()},this)},this)}function R(){R.base.call(this)}R.prototype={table:function(l){return this.set("table",l)},createColumn:function(a7,a8,a9){var l=$.create({col:{}}),ba=$.create({th:{"ku-key":a8},content:$.create({span:{"class":"ku-table-head-content"},content:a9})});return $.column(ba,l,a7,a8,a9)},createRow:function(l,a7){var a8=$.create({tr:{"class":"ku-table-row"}});return $.row(a8,l,a7)},createCell:function(bb,ba,a7,a9,bd){var a8=this._table,bc=$.create({td:{"class":"ku-table-cell"},content:bb}),l=$.cell(bc,ba,a7,a9,bd,bb).onclick(function(){a8.selectCell(l)},this);return l}};$.Class.extend(R,$.Class);function aG(a8,l,a7){aG.base.call(this,a8);this.id($.uid()).index(l).key(a7);this._cells=$.hash()}aG.prototype={id:function(l){return this.property("id",l)},index:function(l){if($.exists(l)){this.dom().rIdx=l}return this.property("index",l)},key:function(l){if($.exists(l)){this.dom().rKey=l}return this.property("key",l)},findCell:function(l){return this._cells.find(l)},listCells:function(){return $.list(this._cells.values())},addCell:function(l){this._dom.appendChild(l.dom());this._cells.add(l.cKey(),l);return this},removeCell:function(l){this._dom.removeChild(l.dom());this._cells.remove(l.cKey());return this}};$.Class.extend(aG,$.dom.Class);$.row=function(a9,l,a7,a8){return new aG(a9,l,a7,a8)};$.row.Class=aG;function al(a9){var bd=$.create({table:{"class":"ku-table",cellspacing:0}});al.base.call(this,bd);var a8=$.create({colgroup:{"class":"ku-table-colgroup"}}),a7=$.create({caption:{"class":"ku-table-caption"}}),bb=$.create({thead:{"class":"ku-table-head"}}),bc=$.create({tr:{"class":"ku-table-head-row"}}),l=$.create({tbody:{"class":"ku-table-body"}}),ba=$.create({tfoot:{"class":"ku-table-foot"}});this._columns=new $.hash();this._rows=new $.hash();this._cells=new $.hash();this._onCellSelect=$.observer();this.appendChild(a8).colgroup(a8).appendChild(a7).caption(a7).appendChild(bb).head(bb).appendChild(bc).headRow(bc).appendChild(l).body(l).appendChild(ba).foot(ba).factory(a9||new R()).head().appendChild(this.headRow())}al.prototype={title:function(l){if($.isString(l)){this.caption().innerHTML=l}else{if($.exists(l)){this.caption().appendChild(l)}}return this.property("title",l)},factory:function(l){return this.property("factory",l.table(this))},caption:function(l){return this.property("caption",l)},colgroup:function(l){return this.property("colgroup",l)},head:function(l){return this.property("head",l)},headRow:function(l){return this.property("headRow",l)},body:function(l){return this.property("body",l)},foot:function(l){return this.property("foot",l)},listColumns:function(){return $.list(this._columns.values())},listRows:function(){return $.list(this._rows.values())},listCells:function(){return $.list(this._cells.values())},selectCell:function(l){this._onCellSelect.notify(l);return this},onCellSelect:function(a7,l){this._onCellSelect.add(a7,l);return this},addColumn:function(a7,ba,a9){var l=this._columns,a8=this._rows;if(l.containsKey(a7)){return this._updateColumn(a7,ba,a9)}else{return this._addColumn(a7,ba,a9)}},_addColumn:function(l,a9,a8){var a7=this._factory.createColumn($.uid(),l,a8);this._columns.add(a7.key(),a7);$.list(this._rows.values()).each(function(ba){this.addCell(ba,a7,a9[ba.key()])},this);this._colgroup.appendChild(a7.col());this._headRow.appendChild(a7.dom());return this},_updateColumn:function(l,a9,a8){var a7=this._columns.find(l);$.list(his._rows.values()).each(function(ba){this.findCell(ba.key(),a7.key()).value(a9[ba.key()])},this);if($.exists(a8)){a7.value(a8)}return this},findColumn:function(l){return this._columns.find(l)},removeColumn:function(l){var a8=this._rows,a7=this.findColumn(l);if(!$.exists(a7)){return this}$.list(a8.values()).each(function(a9){this.removeCell(a7.findCell(a9.key()))},this);this._columns.remove(a7.key());return this},addRow:function(a7,a9){var a8=this._rows,l=this._columns;if(a8.containsKey(a7)){return this._updateRow(a7,a9)}else{return this._addRow(a7,a9)}},_addRow:function(l,a7){var a8=this._factory.createRow($.uid(),l);this._rows.add(a8.key(),a8);$.list(this._columns.values()).each(function(a9){this.addCell(a8,a9,a7[a9.key()])},this);this.body().appendChild(a8.dom());return this},_updateRow:function(l,a7){var a8=this._rows.find(l);$.list(this._columns.values()).each(function(a9){this.findCell(a8.key(),a9.key()).value(a7[a9.key()])},this);return this},findRow:function(l){return this._rows.find(l)},removeRow:function(a7){var l=this._columns,a8=this.findRow(a7);if(!$.exists(a8)){return this}$.list(l.values()).each(function(a9){this.removeCell(a8.findCell(a9.key()))},this);this._rows.remove(a8.key());return this},addCell:function(a9,a7,a8){var l=this._factory.createCell(a8,a7.index(),a7.key(),a9.index(),a9.key());a7.addCell(l);a9.addCell(l);this._cells.add(l.id(),l);return this},findCellById:function(l){return this._cells.find(l)},findCell:function(a9,a7){var l=$.list(this._cells.values()),a8;l.each(function(ba){if((ba.rKey()==a9)&&(ba.cKey()==a7)){a8=ba;l.quit()}});return a8},removeCell:function(l){this._cells.remove(l.id());this._columns.find(l.cKey()).removeCell(l);this._rows.find(l.rKey()).removeCell(l);return this},format:function(){var l=0,a7="ku-table-row-even",a8="ku-table-row-odd",a9=function(){(l%2==0)?a7:a8};this._rows.each(function(ba){ba.removeClass(a7).removeClass(a8).addClass(a9());l++})},toObject:function(){return{title:this.title(),columns:this._columns.toObject(),rows:this._rows.toObject()}}};$.Class.extend(al,$.dom.Class);$.table=function(l){return new al(l)};$.table.Class=al;al.parseDom=function(bb){var a7=function(be,bd){return be.getElementsByTagName(bd)};al=$.ele(bb),cols=a7(a7((a7(al,"thead")[0]),"tr")[0],"th"),rows=a7((a7(al,"tbody")[0]),"tr"),caption=a7(al,"caption")[0],title=(!caption)?"":caption.innerHTML,t=new $.table(title),Y=cols.length,m=rows.length,c=[];while(i--){var ba=cols[i],l=$.ku.getText(ba)||$.uid("table-column");c[c.length]=l;t.addColumn(l,ba.innerHTML)}while(m--){var a8=a7(rows[j],"td"),bc=a8.length,a9={};while(bc--){a9[c[l]]=a8[l].innerHTML}t.addRow(a9)}return t};al.parseObject=function(a8){var l=new $.table(a8.title),ba=a8.columns,a7=a8.rows;for(var a9 in ba){l.addColumn(a9,ba[a9])}for(var a9 in a7){l.addRow(a7[a9])}return l};var r=function(){r.base.call(this,$.create({div:{"class":"ku-calendar"}}));var l=$.create({div:{"class":"ku-sheet"}});this._sheetContainer=$.dom(l);this._onShowDates=$.observer();this._onShowMonths=$.observer();this._onShowYears=$.observer();this._onSelect=$.observer();this._sheet;this.dayPoint($.dayPoint.today()).localization($.ku.localization.en).sheetFactory($.clickableSheetFactory()).dom().appendChild(l)};r.prototype={dayPoint:function(l){return this.property("dayPoint",l)},localization:function(l){return this.property("localization",l)},sheetFactory:function(l){return this.set("sheetFactory",l)},isShowingDates:function(){return this._isShowingDates},isShowingMonths:function(){return this._isShowingMonths},isShowingYears:function(){return this._isShowingYears},nextDay:function(){this.dayPoint(this.dayPoint().nextDay());return this},prevDay:function(){this.dayPoint(this.dayPoint().prevDay());return this},nextMonth:function(){this.dayPoint(this.dayPoint().nextMonth());return this},prevMonth:function(){this.dayPoint(this.dayPoint().prevMonth());return this},nextYear:function(){this.dayPoint(this.dayPoint().nextYear());return this},prevYear:function(){this.dayPoint(this.dayPoint().prevYear());return this},showDates:function(){return this._showSheet("createDatesheet")._currentView(false,false,true)},showMonths:function(){return this._showSheet("createMonthsheet")._currentView(false,true,false)},showYears:function(){return this._showSheet("createYearsheet")._currentView(true,false,false)},findCell:function(l){return this._sheet.findCell(l)},each:function(a7,l){this._sheet.each(a7,l);return this},select:function(l){this._sheet.select(l);return this},onSelect:function(a7,l){this._onSelect.add(a7,l);return this},onShowDates:function(a7,l){this._onShowDates.add(a7,l);return this},onShowMonths:function(a7,l){this._onShowMonths.add(a7,l);return this},onShowYears:function(a7,l){this._onShowYears.add(a7,l);return this},_currentView:function(a7,l,a8){this._isShowingYears=a7;this._isShowingMonths=l;this._isShowingDates=a8;if(a7){this._onShowYears.notify()}if(l){this._onShowYears.notify()}if(a8){this._onShowDates.notify()}return this},_showSheet:function(a8){var l=this._sheet;if($.exists(l)){l.destroy()}var a7=this._sheetFactory[a8](this.dayPoint(),this._localization).onSelect(this._onSelect.notify,this._onSelect);this._sheetContainer.clear().appendChild(a7.dom());this._sheet=a7;return this}};$.Class.extend(r,$.dom.Class);$.calendar=function(){return new r()};var a2=function(a9){a2.base.call(this,$.create({div:{"class":"ku-calendar-controls"}}));this._calendar=a9;var bb=$.dom($.create({div:{"class":"ku-calendar-title"}})),a8=$.dom($.create({button:{"class":"ku-calendar-month"}})).onclick(this.showMonths,this),a7=$.dom($.create({button:{"class":"ku-calendar-year"}})).onclick(this.showYears,this),l=$.dom($.create({button:{"class":"ku-calendar-prevButton"}})).onclick(function(){this._prevAction()},this),ba=$.dom($.create({button:{"class":"ku-calendar-nextButton"}})).onclick(function(){this._nextAction()},this);$.dom(this.dom()).appendChild(bb.appendChild(a8.dom()).appendChild(a7.dom()).dom()).appendChild(l.dom()).appendChild(ba.dom()).appendChild(a9.dom());this._title=bb;this._month=a8;this._year=a7;this._prevButton=l;this._nextButton=ba;this.onSelect(this._displayDates,this)};a2.prototype={dayPoint:function(l){var a7=this._calendar;if(!$.exists(l)){return a7.dayPoint()}a7.dayPoint(l);return this},localization:function(a7){var l=this._calendar;if(!$.exists(a7)){return l.localization()}l.localization(a7);return this},sheetFactory:function(l){this._calendar.sheetFactory(l);return this},nextDay:function(){this._calendar.nextDay();return this},prevDay:function(){this._calendar.prevDay();return this},nextMonth:function(){this._calendar.nextMonth();return this},prevMonth:function(){this._calendar.prevMonth();return this},nextYear:function(){this._calendar.nextYear();return this},prevYear:function(){this._calendar.prevYear();return this},showDates:function(){var a8=this._calendar,l=a8.localization().month.name,a7=a8.dayPoint();a8.showDates();this._month.html(l[a7.month()]);this._year.html(a7.year());this._prevAction=this._prevMonth;this._nextAction=this._nextMonth;return this},showMonths:function(){this._calendar.showMonths();var l=function(){return};this._prevAction=l;this._nextAction=l;return this},showYears:function(){this._calendar.showYears();this._prevAction=this._prevYears;this._nextAction=this._nextYears;return this},findCell:function(l){return this._calendar.findCell(l)},each:function(a7,l){this._calendar.each(a7,l);return this},select:function(l){this._calendar.select(l);return this},onSelect:function(a7,l){this._calendar.onSelect(a7,l);return this},onShowDates:function(a7,l){this._calendar.onShowDates(a7,l);return this},onShowMonths:function(a7,l){this._calendar.onShowMonths(a7,l);return this},onShowYears:function(a7,l){this._calendar.onShowYears(a7,l);return this},_prevMonth:function(){this.prevMonth().showDates()},_nextMonth:function(){this.nextMonth().showDates()},_prevYears:function(){this.dayPoint(this.dayPoint().add(-12,0,0)).showYears()},_nextYears:function(){this.dayPoint(this.dayPoint().add(12,0,0)).showYears()},_displayDates:function(l){var bd=this._calendar,a7=bd.isShowingDates(),bc=bd.isShowingMonths(),bb=bd.isShowingYears(),a8=bd.dayPoint(),a9=l.value(),ba;if(bb){ba=$.dayPoint(a9.year(),a8.month(),a8.date())}if(bc){ba=$.dayPoint(a8.year(),a9.month(),a8.date())}if(a7){ba=a9}this.dayPoint(ba);if(bb||bc||(a8.month()!=a9.month())){this.showDates()}}};$.Class.extend(a2,$.dom.Class);$.calendarControlsDecorator=function(l){return new a2(l)};function a6(){}a6.prototype={createDatesheet:function(l,a7){return $.datesheet(l,a7,$.table($.clickableDateSheetTableFactory(l,a7)))},createMonthsheet:function(l,a7){return $.monthsheet(l,a7,$.table($.clickableMonthSheetTableFactory(l,a7)))},createYearsheet:function(l,a7){return $.yearsheet(l,a7,$.table($.clickableYearSheetTableFactory(l,a7)))}};$.clickableSheetFactory=function(){return new a6()};function X(l,a7){X.base.call(this);this._dayPoint=l;this._localization=a7}X.prototype={$setCellAction:function(l){return l},table:function(l){this.$table=l;return this.set("table",l)},createColumn:function(a7,a8,a9){var a7=this._table.listColumns().count(),l=$.create({col:{}}),ba=$.create({th:{"ku-key":a8},content:$.create({span:{"class":"ku-table-head-content"},content:a9})});return $.column(ba,l,a7,a8,a9)},createRow:function(a7,a8){var a7=this._table.listRows().count(),l=(a7%2==0)?"ku-table-row ku-table-row-even":"ku-table-row ku-table-row-odd",a9=$.create({tr:{"class":l}});return $.row(a9,a7,a8)},createCell:function(bc,l,a7,a8,a9){var be=this._table,bb=$.dayPoint.today(),ba=$.create({td:{"class":$.str.format("ku-date-day-{0} ku-date-week-{1}",l,a8)},content:$.str.format("<span class='ku-datesheet-cell-date'>{0}</span>",bc.date())}),bd=$.cell(ba,l,a7,a8,a9,bc).addClass("ku-sheet-date").id(bc.toString());if(bc.isBefore(bb)){bd.addClass("ku-datesheet-past")}if(bc.equals(bb)){bd.addClass("ku-datesheet-present")}if(bc.isAfter(bb)){bd.addClass("ku-datesheet-future")}if(bc.isWeekday()){bd.addClass("ku-datesheet-weekday")}if(bc.isWeekend()){bd.addClass("ku-datesheet-weekend")}if((bc.month()<this._dayPoint.month())||((bc.month()==12)&&(this._dayPoint.month()==1))){bd.addClass("ku-datesheet-lastMonth")}if(bc.month()==this._dayPoint.month()){bd.addClass("ku-datesheet-thisMonth")}if((bc.month()>this._dayPoint.month())||((bc.month()==1)&&(this._dayPoint.month()==12))){bd.addClass("ku-datesheet-nextMonth")}return this.$setCellAction(bd)}};$.Class.extend(X,$.Class);function ac(l,a7){ac.base.call(this);this._dayPoint=l;this._localization=a7}ac.prototype={$setCellAction:function(l){return l},table:function(l){this.$table=l;return this.set("table",l)},createColumn:function(a7,a8,a9){var a7=this._table.listColumns().count(),l=$.create({col:{}}),ba=$.create({th:{"ku-key":a8},content:$.create({span:{"class":"ku-table-head-content"},content:a9})});return $.column(ba,l,a7,a8,a9)},createRow:function(a7,a8){var a7=this._table.listRows().count(),l=(a7%2==0)?"ku-table-row ku-table-row-even":"ku-table-row ku-table-row-odd",a9=$.create({tr:{"class":l}});return $.row(a9,a7,a8)},createCell:function(ba,a9,a7,a8,bc){var bb=$.create({td:{"class":$.str.format("ku-month",a9,a8)},content:this._localization.month.abbr[ba.month()]}),l=$.cell(bb,a9,a7,a8,bc,ba).addClass("ku-sheet-month").id(ba.month().toString());return this.$setCellAction(l)}};$.Class.extend(ac,$.Class);function d(l,a7){d.base.call(this);this._dayPoint=l;this._localization=a7}d.prototype={$setCellAction:function(l){return l},table:function(l){this.$table=l;return this.set("table",l)},createColumn:function(a7,a8,a9){var a7=this._table.listColumns().count(),l=$.create({col:{}}),ba=$.create({th:{"ku-key":a8},content:$.create({span:{"class":"ku-table-head-content"},content:a9})});return $.column(ba,l,a7,a8,a9)},createRow:function(a7,a8){var a7=this._table.listRows().count(),l=(a7%2==0)?"ku-table-row ku-table-row-even":"ku-table-row ku-table-row-odd",a9=$.create({tr:{"class":l}});return $.row(a9,a7,a8)},createCell:function(ba,a9,a7,a8,bc){var bb=$.create({td:{"class":$.str.format("ku-year",a9,a8)},content:ba.year()}),l=$.cell(bb,a9,a7,a8,bc,ba).addClass("ku-sheet-year").id(ba.year().toString());return this.$setCellAction(l)}};$.Class.extend(d,$.Class);function aE(l,a7){aE.base.call(this,l,a7)}aE.prototype={$setCellAction:function(l){return l.onclick(function(){this.$table.selectCell(l)},this)}};$.Class.extend(aE,X);$.clickableDateSheetTableFactory=function(l,a7){return new aE(l,a7)};function Q(l,a7){Q.base.call(this,l,a7)}Q.prototype={$setCellAction:function(l){return l.onclick(function(){this.$table.selectCell(l)},this)}};$.Class.extend(Q,ac);$.clickableMonthSheetTableFactory=function(l,a7){return new Q(l,a7)};function W(l,a7){W.base.call(this,l,a7)}W.prototype={$setCellAction:function(l){return l.onclick(function(){this.$table.selectCell(l)},this)}};$.Class.extend(W,d);$.clickableYearSheetTableFactory=function(l,a7){return new W(l,a7)};var K=function(l,a7){K.base.call(this,l);this.localization(a7);this._onSelect=$.observer()};K.prototype={$findCell:function(l){return null},localization:function(l){return this.property("localization",l)},each:function(a7,l){this.$sheet.listCells().each(a7,l);return this},findCell:function(l){return this.$findCell(l)},selectCell:function(l){if(!$.exists(l)){return this}this._onSelect.notify(l);return this},select:function(l){return this.selectCell(this.findCell(l))},onSelect:function(a7,l){this._onSelect.add(a7,l);return this},destroy:function(){this.$sheet.listCells().each(function(l){if($.exists(l.deallocate)){l.deallocate()}l.clearEvents();return this})}};$.Class.extend(K,$.dom.Class);var h=function(l,a8,a7){this._firstDateOfSheet=A(l);this.$sheet=a7.onCellSelect(this.selectCell,this);h.base.call(this,this.$sheet.dom(),a8);aL(this);ah(this)};h.prototype={$findCell:function(l){return this.$sheet.findCellById(l.toString())}};$.Class.extend(h,K);$.datesheet=function(l,a8,a7){return(new h(l,a8,a7))};function A(l){var a8=l.firstDayOfMonth(),a9=l.firstDayOfMonth(),a7=false;while(a9.day()>0||!a7){if(a9.day()==0){a7=true}a9=a9.prevDay()}return a9}function aL(a8){var bb=a8.localization().day.abbr,ba=a8.$sheet,a9=7,a7=0;while(a7<a9){var l=bb[a7];ba.addColumn(l,{},l);a7++}}function ah(a9){var ba=a9.$sheet,l=a9._firstDateOfSheet,a8=0;while(a8<7){var a7=aw(a9,l);l=l.add(0,0,7);ba.addRow($.uid(),a7);a8++}}function aw(a7,l){var a8=l,a9={};a7.$sheet.listColumns().each(function(ba){a9[ba.key()]=a8;a8=a8.nextDay()});return a9}var S=function(l,a8,a7){this._firstDateOfSheet=aQ(l);this.$sheet=a7.onCellSelect(this.selectCell,this);S.base.call(this,this.$sheet.dom(),a8);e(this);ab(this)};S.prototype={$findCell:function(l){return this.$sheet.findCellById(l.month())}};$.Class.extend(S,K);$.monthsheet=function(l,a8,a7){return(new S(l,a8,a7))};function aQ(l){return $.dayPoint(l.year(),1,l.date())}function e(a9){var a7=a9.localization().month.abbr,ba=a9.$sheet,l=4,a8=1;while(a8<=l){ba.addColumn(a8,null,"");a8++}}function ab(a9){var ba=a9.$sheet,a7=a9._firstDateOfSheet,a8=1;while(a8<=3){var l=M(a9,a7);a7=a7.add(0,4,0);ba.addRow($.uid(),l);a8++}}function M(a7,l){var a8=l,a9={};a7.$sheet.listColumns().each(function(ba){a9[ba.key()]=a8;a8=a8.nextMonth()});return a9}var C=function(l,a8,a7){this._firstDateOfSheet=ao(l);this.$sheet=a7.onCellSelect(this.selectCell,this);C.base.call(this,this.$sheet.dom(),a8);V(this);J(this)};C.prototype={$findCell:function(l){return this.$sheet.findCellById(l.year())}};$.Class.extend(C,K);$.yearsheet=function(l,a8,a7){return(new C(l,a8,a7))};function ao(l){return l.add(-12,0,0)}function V(a9){var l=a9.localization().month.abbr,ba=a9.$sheet,a7=5,a8=0;while(a8<a7){ba.addColumn(a8,null,"");a8++}}function J(a9){var ba=a9.$sheet,l=a9._firstDateOfSheet,a8=0;while(a8<5){var a7=at(a9,l);l=l.add(5,0,0);ba.addRow($.uid(),a7);a8++}}function at(a7,l){var a8=l,a9={};a7.$sheet.listColumns().each(function(ba){a9[ba.key()]=a8;a8=a8.nextYear()});return a9}function q(l){q.base.call(this,l);this._id=$.uid("dropper");this._handle=this}q.prototype={id:function(l){return this.get("id")},value:function(l){return this.property("value",l)},handle:function(l){var a7;if($.exists(l)){a7=$.dom(l)}return this.property("handle",a7)},mouseEventId:function(l){return this.property("mouseEventId",l)},touchEventId:function(l){return this.property("touchEventId",l)},};$.Class.extend(q,$.dom.Class);$.dndScreenDropper=function(l){return new q(l)};var af=function(){this._targets=$.hash();this._droppers=$.hash();this._onHit=$.observer();this._lastKnownCoord;this._helper=$.sprite($.create({div:{"class":"ku-dndScreen-helper"}})).onGrab(function(a7){var l=$.touch().canRead(a7)?$.touch():$.mouse();this._lastKnownCoord=l.documentCoord(a7)},this).onDrag(function(a7){var l=$.touch().canRead(a7)?$.touch():$.mouse();this._lastKnownCoord=l.documentCoord(a7)},this).onDrop(function(l){this._drop(l)},this);this._currentDropper};af.prototype={addTarget:function(l){this._targets.add(l.id(),l);return this},removeTarget:function(l){this._targets.remove(l.id(),l);return this},addDropper:function(a8){var a9=$.uid("dropperEvent"),l=$.uid("dropperEvent");function a7(ba){this._currentDropper=a8;this.activateHelper(ba,a8)}a8.mouseEventId(a9).touchEventId(l).handle().onmousedown(a7,this,a9).ontouchstart(a7,this,l);this._droppers.add(a8.id(),a8)},removeDropper:function(l){l.handle().removeEvent(l.touchEventId()).removeEvent(l.mouseEventId());this._droppers.remove(l.id())},activateHelper:function(a7,l){this._helper.appendTo(document.body).pinTo(l.offset().subtract(l.scrollOffset()).add($.window().scrollOffset())).content(l.cloneNode()).grab(a7)},deactivateHelper:function(){this._helper.html("").detach();this._currentDropper=undefined},clearTargets:function(){this._targets.clear();return this},clearDroppers:function(){var l=this._droppers;$.list(l.values()).each(function(a7){this.removeDropper(a7)},this);return this},clearAll:function(){this.clearTargets().clearDroppers();return this},clearListeners:function(){this._onHit.clear();return this},onHit:function(a7,l){this._onHit.add(a7,l);return this},_drop:function(a8){var l=this._findHitTarget(a8),a7=this._currentDropper;if($.exists(l)&&$.exists(a7)){this._onHit.notify(l,a7)}this.deactivateHelper()},_findHitTarget:function(a9){var l=$.list(this._targets.values()),a8=$.touch().canRead(a9)?$.touch():$.mouse(),a7=null,ba;try{ba=a8.documentCoord(a9)}catch(a9){ba=this._lastKnownCoord}l.each(function(bb){if(!bb.contains(ba)){return}a7=bb;l.quit()});return a7}};$.dndScreen=function(){return new af()};function av(l){av.base.call(this,l);this._id=$.uid("target")}av.prototype={id:function(l){return this.get("id")},value:function(l){return this.property("value",l)},contains:function(a8){var a7=this.offset(),l=a7.add(this.outerDims());return $.rectangle(a7,l).contains(a8)}};$.Class.extend(av,$.dom.Class);$.dndScreenTarget=function(l){return new av(l)};function aA(l){aA.base.call(this,l);this._isinvalid=false;this._keyup=$.uid();this._$dom=$.dom(this.dom());this.onInvalid(this.invalidate,this).onIsValid(this.validate,this)}aA.prototype={$clear:function(){return this.value("").validate()},tooltip:function(l){return this.set("tooltip",l)},invalidate:function(){if(this._isinvalid){return this}this._isinvalid=true;this._$dom.addClass("ku-field-error").onchange(this.isValid,this,this._keyup);var l=this._tooltip;if($.exists(l)){l.show().rightOf(this.dom())}return this},validate:function(){if(!this._isinvalid){return this}this._isinvalid=false;this._$dom.removeClass("ku-field-error").removeEvent(this._keyup);var l=this._tooltip;if($.exists(l)){l.hide()}return this}};$.Class.extend(aA,$.checkbox.Class);function az(l){az.base.call(this,l);this._isinvalid=false;this._keyupid=$.uid();this._$dom=$.dom(this.dom());this.onInvalid(this.invalidate,this).onIsValid(this.validate,this)}az.prototype={$clear:function(){return this.value("").validate()},tooltip:function(l){return this.set("tooltip",l)},watermark:function(l){return this.set("watermark",l)},invalidate:function(){if(this._isinvalid){return this}this._isinvalid=true;this._$dom.addClass("ku-field-error").onkeyup(this.isValid,this,this._keyupid);var l=this._tooltip;if($.exists(l)){l.show().rightOf(this.dom())}return this},validate:function(){if(!this._isinvalid){return this}this._isinvalid=false;this._$dom.removeClass("ku-field-error").removeEvent(this._keyupid);var l=this._tooltip;if($.exists(l)){l.hide()}return this}};$.Class.extend(az,$.field.Class);function aT(l){aT.base.call(this,l);this._isinvalid=false;this._keyup=$.uid();this._$dom=$.dom(this.dom());this.onInvalid(this.invalidate,this).onIsValid(this.validate,this)}aT.prototype={$clear:function(){return this.value("").validate()},tooltip:function(l){return this.set("tooltip",l)},invalidate:function(){if(this._isinvalid){return this}this._isinvalid=true;this._$dom.addClass("ku-field-error").onchange(this.isValid,this,this._keyup);var l=this._tooltip;if($.exists(l)){l.show().rightOf(this.dom())}return this},validate:function(){if(!this._isinvalid){return this}this._isinvalid=false;this._$dom.removeClass("ku-field-error").removeEvent(this._keyup);var l=this._tooltip;if($.exists(l)){l.hide()}return this}};$.Class.extend(aT,$.select.Class);function p(l){p.base.call(this,l);this.tooltip($.tooltip().message("Invalid"))}$.Class.extend(p,aA);$.fields.checkbox=function(l){return new p(l)};function Z(l){Z.base.call(this,l);this._id=$.uid("field");this._isShow=false;this._calendar=$.calendarControlsDecorator($.calendar()).onSelect(function(a7){this.value(a7.value().toString()).validate();this.hideCalendar()},this).showDates();this._calContainer=$.tooltip().pointer($.sprite($.create({div:{"class":"ku-dayPointField-tooltip-pointer"}})).hide().dragOff()).tooltip($.sprite($.create({div:{"class":"ku-dayPointField-tooltip"}})).hide().dragOff()).message(this._calendar.dom());this._$dom=$.dom(this.dom()).onfocus(this._focusAction,this).onkeyup(this._keyupAction,this).onkeydown(this._keydownAction,this);this.spec($.fields.specs.date).tooltip($.tooltip().message("Enter a valid date."))}Z.prototype={$read:function(){return($.dayPoint.tryParse(this.dom().value)||"").toString()},$write:function(l){this.dom().value=($.dayPoint.tryParse(l)||l).toString()},showCalendar:function(){if(this._isShow){return}this._isShow=true;this._calContainer.show().at(this.dom(),["below","above"]);$.window().onmouseup(this._hideCalendar,this,this._id);return this},hideCalendar:function(l){this._calContainer.hide();this._calendar.detach();$.window().remove(this._id);this._isShow=false;return this},_hideCalendar:function(bb){var l=this._calendar,a9=l.offset(),a8=a9.add(l.outerDims()),bc=this._$dom,bf=bc.offset(),be=bf.add(bc.outerDims()),a7=$.rectangle(a9,a8),bd=$.rectangle(bf,be),ba=$.mouse().documentCoord(bb);if(a7.contains(ba)||bd.contains(ba)){return this}this.hideCalendar();return this},_focusAction:function(l){this.showCalendar();return this},_keyupAction:function(l){this.showCalendar();return this},_keydownAction:function(a8){var l=$.key.parse(a8),a7=$.key(9),a9=$.key(9,false,false,true);if(l.equals(a7)||l.equals(a9)){this.hideCalendar()}return this}};$.Class.extend(Z,az);$.fields.dayPoint=function(l){return new Z(l)};function B(l){B.base.call(this,l);this.spec($.fields.specs.email).tooltip($.tooltip().message("Enter a valid email address."))}B.prototype={$read:function(){return this.dom().value},$write:function(l){this.dom().value=l}};$.Class.extend(B,az);$.fields.email=function(l){return new B(l)};function L(l){L.base.call(this,l);this.tooltip($.tooltip().message("Invalid"))}$.Class.extend(L,az);$.fields.field=function(l){return new L(l)};function v(l){v.base.call(this,l);this.spec($.fields.specs.currency).tooltip($.tooltip().message("Enter a valid money amount."));$.dom(this.dom()).onblur(function(){this.$write(this.value())},this);$.dom(this.dom()).onfocus(function(){var a7=this.value();if(!$.money.canParse(a7)){return}this.dom().value=$.money.parse(a7).value()},this)}v.prototype={$read:function(){var l=this.dom().value;return($.money.canParse(l))?$.money.parse(l).value():l},$write:function(l){this.dom().value=$.money.tryParse(l)||l}};$.Class.extend(v,az);$.fields.money=function(l){return new v(l)};function z(l){z.base.call(this,l);this.spec($.fields.specs.phone).tooltip($.tooltip().message("Enter a valid phone number including area code."));$.dom(this.dom()).onblur(function(){this.value(this.value())},this)}z.prototype={$read:function(){return this.dom().value.replace(/[^\d]/g,"")},$write:function(l){this.dom().value=(function(a9,bb){var a8=a9.replace(/[^\d]/g,"").split(/\B/),ba=0,a7=a8.length,bc=(a7<11)?bb.replace(/^#\s/,""):bb;while(ba<a7){bc=bc.replace("#",a8[ba]);ba++}return(/#/.test(bc))?l:bc})(l,"# (###) ###-####")}};$.Class.extend(z,az);$.fields.phone=function(a7,l){return new z(a7,l)};function I(l){I.base.call(this,l);this.tooltip($.tooltip().message("Invalid"))}$.Class.extend(I,aT);$.fields.select=function(l){return new I(l)};function aR(){this._onKeyPressed=$.observer();k.base.call(this,$.create({div:{"class":"ku-keyboard"}}))}aR.prototype={addKey:function(l){$.onScreenKey(l).addClass($.str.format("ku-keyboard-key ku-key-{0}",l)).onPress(this._onKeyPressed.notify,this._onKeyPressed).appendTo(this.dom());return this},onKeyPressed:function(a7,l){this._onKeyPressed.add(a7,l);return this}};$.Class.extend(aR,$.dom.Class);$.onScreenKeyboard=function(){return new aR()};function aX(l){if(!$.isNumber(l)){$.ku4exception("onScreenKey",$.str.format("Invalid argument code:{0}",l))}this._value=$.key(l);this._onPress=$.observer();this._onRelease=$.observer();ap.base.call(this,$.create({button:{"class":"ku-keyboard-key"},content:this._value.toString()}));this.onmousedown(function(){this._onPress.notify(this._value)},this).ontouchstart(function(){this._onPress.notify(this._value)},this).onmouseup(function(){this._onRelease.notify(this._value)},this).ontouchend(function(){this._onRelease.notify(this._value)},this)}aX.prototype={onPress:function(a7,l){this._onPress.add(a7,l);return this},onRelease:function(a7,l){this._onRelease.add(a7,l);return this}};$.Class.extend(ap,$.dom.Class);$.onScreenKey=function(l){return new ap(l)};function w(a7){var l=a7||$.create({div:{"class":"ku-sprite"}});w.base.call(this,l);this.to().dragOn().force(0.4).mu(0.8)}w.prototype={force:function(l){return this.property("force",l)},mu:function(l){return this.property("mu",l)},algorithm:function(l){return this.set("algorithm",l)},to:function(){this._isTo=true;return this.algorithm($.anime.algorithms.jump())},spring:function(){this._isTo=false;return this.algorithm($.anime.algorithms.spring(this._force,this._mu))},ease:function(){this._isTo=false;return this.algorithm($.anime.algorithms.ease.linear(this._force,this._mu))},fitTo:function(a8,a7,l){return this._act("fitter",a8,a7,l)},sizeTo:function(a8,a7,l){return this._act("sizer",a8,a7,l)},pinTo:function(a8,a7,l){return this._act("pinner",a8,a7,l)},scrollTo:function(a8,a7,l){return this._act("scroller",a8,a7,l)},fadeTo:function(l,a8,a7){return this._act("fader",l,a8,a7)},growTo:function(a8,a7,l){return this.sizeTo(a8).pinTo(this.boundedOffset().subtract(a8.subtract(this.outerDims()).half()),a7,l)},_act:function(bc,bb,ba,a9){var a7=$[bc](this.dom()).algorithm(this._algorithm),l="_"+bc,a8=this[l];if($.exists(a8)){a8.stop()}if($.exists(ba)){a7.onEnd(ba,a9)}if(this._isTo){this[l]=a7.to(bb)}else{this[l]=a7.moveTo(bb)}return this},tween:function(a7,l){this._styler=$.styler(this.dom(),a7).algorithm(this._algorithm).moveTo(l);return this},clear:function(){if($.exists(this._fader)){this._fader.stop()}if($.exists(this._sizer)){this._sizer.stop()}if($.exists(this._fitter)){this._fitter.stop()}if($.exists(this._pinner)){this._pinner.stop()}if($.exists(this._scroller)){this._scroller.stop()}if($.exists(this._styler)){this._styler.stop()}return this},dragHandle:function(l){return this.property("dragHandle",l)},dragType:function(l){return this.set("dragType",l)},dragOffset:function(l){this._dnd.dragOffset(l);return this},dragger:function(){this._dnd.dragger();return this},sizer:function(){this._dnd.sizer();return this},scroller:function(){this._dnd.scroller();return this},dragOn:function(){this._dnd=$.dnd(this.dom()).onGrab(this.clear,this);return this},dragOff:function(){this._dnd.destroy();return this},onGrab:function(a7,l,a8){this._dnd.onGrab(a7,l,a8);return this},onDrag:function(a7,l,a8){this._dnd.onDrag(a7,l,a8);return this},onDrop:function(a7,l,a8){this._dnd.onDrop(a7,l,a8);return this},bearingUp:function(){return this._dnd.bearingUp()},bearingDown:function(){return this._dnd.bearingDown()},bearingLeft:function(){return this._dnd.bearingLeft()},bearingRight:function(){return this._dnd.bearingRight()},grab:function(l){this._dnd.grab(l);return this},drag:function(l){this._dnd.drag(l);return this},drop:function(l){this._dnd.drop(l);return this},constrainX:function(){this._dnd.constrainX();return this},unconstrainX:function(){this._dnd.unconstrainX();return this},constrainY:function(){this._dnd.constrainY();return this},unconstrainY:function(){this._dnd.unconstrainY();return this}};$.Class.extend(w,$.dom.Class);$.sprite=function(l){return new w(l)};$.sprite.Class=w;var aY=function(l,a7){this.$offset=0;this.$multiplier=a7;this._tooltip=l;this.overlap(0)};aY.prototype={$above:function(l,a8,a7){return},$below:function(l,a8,a7){return},$leftOf:function(l,a8,a7){return},$rightOf:function(l,a8,a7){return},overlap:function(l){return this.set("overlap",l)},above:function(ba){var a8=this._tooltip,l=a8.context(ba).context(),a9=a8.pointer(),a7=a8.tooltip();this.$offset=this._overlap;this.$above(l,a9,a7);return this},below:function(ba){var a8=this._tooltip,l=a8.context(ba).context(),a9=a8.pointer(),a7=a8.tooltip();this.$offset=this._overlap;this.$below(l,a9,a7);return this},leftOf:function(ba){var a8=this._tooltip,l=a8.context(ba).context(),a9=a8.pointer(),a7=a8.tooltip();this.$offset=this._overlap;this.$leftOf(l,a9,a7);return this},rightOf:function(ba){var a8=this._tooltip,l=a8.context(ba).context(),a9=a8.pointer(),a7=a8.tooltip();this.$offset=this._overlap;this.$rightOf(l,a9,a7);return this}};$.Class.extend(aY,$.Class);var a5=function(l,a7){a5.base.call(this,l,0.5)};a5.prototype={$above:function(l,a8,a7){a8.pinTo(l.offset().subtract(a8.outerHeight()).add($.coord(l.outerDims().subtract(a8.outerDims()).x()*this.$multiplier,0)));a7.pinTo(a8.offset().subtract(a7.outerHeight()).add($.coord(0,this.$offset)).add($.coord(a8.outerDims().subtract(a7.outerDims()).x()*this.$multiplier,0)));a8.fadeTo(100);a7.fadeTo(100);return this},$below:function(l,a8,a7){a8.pinTo(l.offset().add(l.outerHeight()).add($.coord(l.outerDims().subtract(a8.outerDims()).x()*this.$multiplier,0)));a7.pinTo(a8.offset().add(a8.outerHeight()).subtract($.coord(0,this.$offset)).add($.coord(a8.outerDims().subtract(a7.outerDims()).x()*this.$multiplier,0)));a8.fadeTo(100);a7.fadeTo(100);return this},$leftOf:function(l,a8,a7){a8.pinTo(l.offset().subtract(a8.outerWidth()).add($.coord(0,l.outerDims().subtract(a8.outerDims()).y()*this.$multiplier)));a7.pinTo(a8.offset().subtract(a7.outerWidth()).add($.coord(this.$offset,0)).add($.coord(0,a8.outerDims().subtract(a7.outerDims()).y()*this.$multiplier)));a8.fadeTo(100);a7.fadeTo(100);return this},$rightOf:function(l,a8,a7){a8.pinTo(l.offset().add(l.outerWidth()).add($.coord(0,l.outerDims().subtract(a8.outerDims()).y()*this.$multiplier)));a7.pinTo(a8.offset().add(a8.outerWidth()).subtract($.coord(this.$offset,0)).add($.coord(0,a8.outerDims().subtract(a7.outerDims()).y()*this.$multiplier)));a8.fadeTo(100);a7.fadeTo(100);return this}};$.Class.extend(a5,aY);var aH=function(l,a7){aH.base.call(this,l,0)};aH.prototype={$above:function(l,a8,a7){a8.pinTo(l.offset().subtract(a8.outerHeight()).add($.coord(this.$offset,0)).add($.coord(l.outerDims().subtract(a8.outerDims()).x()*this.$multiplier,0)));a7.pinTo(a8.offset().subtract(a7.outerHeight()).add($.coord(-this.$offset,this.$offset)).add($.coord(a8.outerDims().subtract(a7.outerDims()).x()*this.$multiplier,0)));a8.fadeTo(100);a7.fadeTo(100);return this},$below:function(l,a8,a7){a8.pinTo(l.offset().add(l.outerHeight()).add($.coord(this.$offset,0)).add($.coord(l.outerDims().subtract(a8.outerDims()).x()*this.$multiplier,0)));a7.pinTo(a8.offset().add(a8.outerHeight()).subtract($.coord(this.$offset,this.$offset)).add($.coord(a8.outerDims().subtract(a7.outerDims()).x()*this.$multiplier,0)));a8.fadeTo(100);a7.fadeTo(100);return this},$leftOf:function(l,a8,a7){a8.pinTo(l.offset().subtract(a8.outerWidth()).add($.coord(0,this.$offset)).add($.coord(0,l.outerDims().subtract(a8.outerDims()).y()*this.$multiplier)));a7.pinTo(a8.offset().subtract(a7.outerWidth()).add($.coord(this.$offset,-this.$offset)).add($.coord(0,a8.outerDims().subtract(a7.outerDims()).y()*this.$multiplier)));a8.fadeTo(100);a7.fadeTo(100);return this},$rightOf:function(l,a8,a7){a8.pinTo(l.offset().add(l.outerWidth()).add($.coord(0,this.$offset)).add($.coord(0,l.outerDims().subtract(a8.outerDims()).y()*this.$multiplier)));a7.pinTo(a8.offset().add(a8.outerWidth()).subtract($.coord(this.$offset,this.$offset)).add($.coord(0,a8.outerDims().subtract(a7.outerDims()).y()*this.$multiplier)));a8.fadeTo(100);a7.fadeTo(100);return this}};$.Class.extend(aH,aY);var ar=function(l,a7){ar.base.call(this,l,1)};ar.prototype={$above:function(l,a8,a7){a8.pinTo(l.offset().subtract(a8.outerHeight()).add($.coord(-this.$offset,0)).add($.coord(l.outerDims().subtract(a8.outerDims()).x()*this.$multiplier,0)));a7.pinTo(a8.offset().subtract(a7.outerHeight()).add($.coord(this.$offset,this.$offset)).add($.coord(a8.outerDims().subtract(a7.outerDims()).x()*this.$multiplier,0)));a8.fadeTo(100);a7.fadeTo(100);return this},$below:function(l,a8,a7){a8.pinTo(l.offset().add(l.outerHeight()).add($.coord(-this.$offset,0)).add($.coord(l.outerDims().subtract(a8.outerDims()).x()*this.$multiplier,0)));a7.pinTo(a8.offset().add(a8.outerHeight()).add($.coord(this.$offset,-this.$offset)).add($.coord(a8.outerDims().subtract(a7.outerDims()).x()*this.$multiplier,0)));a8.fadeTo(100);a7.fadeTo(100);return this},$leftOf:function(l,a8,a7){a8.pinTo(l.offset().subtract(a8.outerWidth()).add($.coord(0,-this.$offset)).add($.coord(0,l.outerDims().subtract(a8.outerDims()).y()*this.$multiplier)));a7.pinTo(a8.offset().subtract(a7.outerWidth()).add($.coord(this.$offset,this.$offset)).add($.coord(0,a8.outerDims().subtract(a7.outerDims()).y()*this.$multiplier)));a8.fadeTo(100);a7.fadeTo(100);return this},$rightOf:function(l,a8,a7){a8.pinTo(l.offset().add(l.outerWidth()).add($.coord(0,-this.$offset)).add($.coord(0,l.outerDims().subtract(a8.outerDims()).y()*this.$multiplier)));a7.pinTo(a8.offset().add(a8.outerWidth()).add($.coord(-this.$offset,this.$offset)).add($.coord(0,a8.outerDims().subtract(a7.outerDims()).y()*this.$multiplier)));a8.fadeTo(100);a7.fadeTo(100);return this}};$.Class.extend(ar,aY);var E=function(){E.base.call(this);this.pointer($.sprite($.create({div:{"class":"ku-tooltip-pointer"}})).hide().dragOff().to()).tooltip($.sprite($.create({div:{"class":"ku-tooltip"}})).hide().dragOff().to()).leftJustify();this._id=$.uid("tip");this._onShow=$.observer();this._onHide=$.observer()};E.prototype={calibrate:function(l){return this.property("calibrate",l)},pointer:function(l){return this.property("pointer",l)},tooltip:function(l){return this.property("tooltip",l)},strategy:function(l){return this.property("strategy",l)},message:function(l){return this.property("message",l)},context:function(a7){var l=($.exists(a7))?$.dom(a7):a7;return this.property("context",l)},center:function(){return this.strategy(new a5(this))},leftJustify:function(){return this.strategy(new aH(this))},rightJustify:function(){return this.strategy(new ar(this))},onShow:function(a7,l){this._onShow.add(a7,l);return this},onHide:function(a7,l){this._onHide.add(a7,l);return this},show:function(a8){var l=a8||this._message,a7=l||"";this._pointer.fadeTo(0).appendTo(document.body).show();this._tooltip.fadeTo(0).appendTo(document.body).html("").content(a7).show();this._onShow.notify();return this},hide:function(){this._pointer.hide().detach();this._tooltip.hide().detach();this._onHide.notify();return this},at:function(bc,bl){var bj=$.window(),be=$.dom(bc),ba=$.point.zero(),a8=bj.dims(),bh=be.offset(),bg=bh.add(be.outerDims()),a7=this._tooltip.outerDims(),bd=$.point.parse(bg.add(a7)),bk=$.point.parse(bh.subtract(a7)),bb=!bd.isRightOf(a8),bi=!bd.isBelow(a8),l=!bk.isLeftOf(ba),bf=!bk.isAbove(ba),a9={rightOf:bb,below:bi,leftOf:l,above:bf};if(a9[bl[0]]){return this[bl[0]](bc)}if(a9[bl[1]]){return this[bl[1]](bc)}if(a9[bl[2]]){return this[bl[2]](bc)}if(a9[bl[3]]){return this[bl[3]](bc)}return this.rightOf(bc)},above:function(l){return this._locate(l,"bottom","above")},below:function(l){return this._locate(l,"top","below")},leftOf:function(l){return this._locate(l,"right","leftOf")},rightOf:function(l){return this._locate(l,"left","rightOf")},_locate:function(a8,a7,l){this.strategy().overlap(a3(this,a7))[l](a8);a0(this,l);this._pointer.fadeTo(100);this._tooltip.fadeTo(100);return this}};$.Class.extend(E,$.Class);$.tooltip=function(){return new E()};function a3(a8,a7){var l=a8.tooltip().style($.str.format("border-{0}-width",a7));return $.ku.style.toNumber(l)}function a0(a8,l){var a9="ku-{0}",a7=["above","below","leftOf","rightOf"],ba=a8.pointer();for(var bb in a7){ba.removeClass($.str.format(a9,a7[bb]))}ba.addClass($.str.format(a9,l))}function D(){var a7=$.create({div:{"class":"ku-responsebox"}}),l=$.uid("responsebox");D.base.call(this,a7);this._contentDom=$.sprite($.create({div:{"class":"ku-responsebox-content"}})).fadeTo(0).dragOff().force(0.4).ease();this._onOpen=$.observer();this._onClose=$.observer();this._onCalibrate=$.observer();this._onWindowResize=$.observer();this._onContentChanged=$.observer();this._closeSize=$.coord.zero();this._isOpen=false;this.force(0.8).mu(0.5).appendChild(this._contentDom.dom()).positionStrategy(function(){return $.window().scrollCenter()}).bounds(document.body).to();$.window().onresize(function(){this._onWindowResize.notify()},this,l)}D.prototype={content:function(l){this._contentDom.content(l);this._onContentChanged.notify();return this},disableWindow:function(){$.window().disable();return this},enableWindow:function(){$.window().enable();return this},positionStrategy:function(l){return this.property("positionStrategy",l)},openSize:function(l){return this.property("openSize",l)},bounds:function(l){return this.property("bounds",l)},onOpen:function(a7,l,a8){this._onOpen.add(a7,l,a8);return this},onClose:function(a7,l,a8){this._onClose.add(a7,l,a8);return this},onCalibrate:function(a7,l,a8){this._onCalibrate.add(a7,l,a8);return this},onWindowResize:function(a7,l,a8){this._onWindowResize.add(a7,l,a8);return this},onContentChanged:function(a7,l,a8){this._onContentChanged.add(a7,l,a8);return this},removeListener:function(l){this._onOpen.remove(l);this._onClose.remove(l);this._onCalibrate.remove(l);this._onContentChanged.remove(l)},calibrate:function(){return this.pinTo(aM(this),function(){this._onCalibrate.notify()},this)},recalibrate:function(){this.clear().ease();var l=this.openSize()||this._contentDom.outerDims();return this.growTo(l,this.calibrate,this)},transition:function(l){this._contentDom.clear().fadeTo(0,function(){this.clear().ease().content(l);var a7=this.openSize()||this._contentDom.outerDims();this.growTo(a7,function(){this.pinTo(aM(this),function(){this._contentDom.fadeTo(100,function(){this.redraw()},this)},this)},this)},this);return this},open:function(a7){this.clear().to().fadeTo(100,function(){this._contentDom.fadeTo(0)},this).appendTo(this.bounds());this._onOpen.notify();var l=this;if(a7){setTimeout(function(){aU(l)},a7)}else{aU(l)}},close:function(){this._contentDom.ease().fadeTo(0,function(){this.ease().growTo(this._closeSize,function(){this.detach();this._onClose.notify()},this)},this);return this}};$.Class.extend(D,$.sprite.Class);$.responsebox=function(){return new D()};function aM(a7){var ba=$.point.parse(a7._positionStrategy().subtract(a7.outerDims().half())),a9=$.point.parse($.window().scrollOffset()),l=(ba.isLeftOf(a9))?a9.x():ba.x(),a8=(ba.isAbove(a9))?a9.y():ba.y();return $.point(l,a8)}function aU(a8){var a7=a8._contentDom,l=a8.openSize()||a7.outerDims();a8.growTo(l,function(){this.pinTo(aM(this),function(){a7.fadeTo(100)},a8)},a8)}})(jQuery);