(function(R){$=R;var W=$.hash({1:"MOUSE_LEFT",2:"",3:"MOUSE_RIGHT",4:"",5:"",6:"",7:"",8:"BACKSPACE",9:"TAB",10:"",11:"",12:"",13:"ENTER",14:"",15:"",16:"SHIFT",17:"CTRL",18:"ALT",19:"",20:"CAPS",21:"",22:"",23:"",24:"",25:"",26:"",27:"ESC",28:"",29:"",30:"",31:"",32:"SPACE",33:"PAGEUP",34:"PAGEDOWN",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",41:")",42:"*",43:"+",44:",",45:"-",46:".",47:"/",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:":",59:";",60:"<",61:"=",62:">",63:"?",64:"@",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"[",92:"\\",93:"]",94:"^",95:"_",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"=",108:"l",109:"-",110:"n",111:"o",112:"p",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"|",125:"}",126:"~",127:"",128:"",129:"",130:"",131:"",132:"",133:"",134:"",135:"",136:"",137:"",138:"",139:"",140:"",141:"",142:"",143:"",144:"",145:"",146:"",147:"",148:"",149:"",150:"",151:"",152:"",153:"",154:"",155:"",156:"",157:"",158:"",159:"",160:"",161:"",162:"",163:"",164:"",165:"",166:"",167:"",168:"",169:"",170:"",171:"",172:"",173:"",174:"",175:"",176:"",177:"",178:"",179:"",180:"",181:"",182:"",183:"",184:"",185:"",186:"",187:"",188:",",189:"",190:".",191:"/",192:"`",193:"",194:"",195:"",196:"",197:"",198:"",199:"",200:"",201:"",202:"",203:"",204:"",205:"",206:"",207:"",208:"",209:"",210:"",211:"",212:"",213:"",214:"",215:"",216:"",217:"",218:"",219:"[",220:"\\",221:"]",222:"",223:"",224:"",225:"",226:"",227:"",228:"",229:"",230:"",231:"",232:"",233:"",234:"",235:"",236:"",237:"",238:"",239:"",240:"",241:"",242:"",243:"",244:"",245:"",246:"",247:"",248:"",249:"",250:"",251:"",252:"",253:"",254:"",255:""});function k(){this._hotKeys=$.hash();this._map=$.hash(W)}k.prototype={map:function(l){return this.set("map",l);s},findCode:function(aT){var l=this._map.findKey(aT),aS=parseInt(l);return isNaN(aS)?null:aS},findKey:function(l){return this._map.findValue(l)}};$.Class.extend(k,$.Class);var N=new k();$.keyboard=function(){return N};function V(){}V.prototype={from:function(l){return($.exists(l.relatedTarget))?l.relatedTarget:l.fromElement},target:function(l){return(l.srcElement)?l.srcElement:l.target},clientCoord:function(l){if(!$.exists(l.clientX)){return null}return new $.coord(l.clientX,l.clientY)},documentCoord:function(l){if($.exists(this.pageCoord(l))){return this.pageCoord(l)}var aS=document.documentElement;return new $.coord(l.clientX+aS.scrollLeft,l.clientY+aS.scrollTop)},pageCoord:function(l){if(!$.exists(l.pageX)){return null}return new $.coord(l.pageX,l.pageY)},screenCoord:function(l){return new $.coord(l.screenX,l.screenY)},selection:function(){if($.exists(window.getSelection)){return window.getSelection()}if($.exists(document.getSelection)){return document.getSelection()}if($.exists(document.selection)&&$.exists(document.selection.createRange)){return document.selection.createRange().text}if($.exists(document.activeElement)&&$.exists(document.activeElement.selectionStart)){var aS=document.activeElement.selectionStart,l=document.activeElement.selectionEnd;return document.activeElement.value.substring(aS,l)}return null},clearSelection:function(){var l=this.selection();try{l.removeAllRanges()}catch(aS){l.empty()}return this}};$.Class.extend(V,$.Class);var aB=new V();$.mouse=function(){return aB};function ar(){}ar.prototype={canRead:function(l){return $.exists(l.touches)},from:function(aS){var l=aS.touches[0];return($.exists(l.relatedTarget))?l.relatedTarget:l.fromElement},target:function(aS){var l=aS.touches[0];return(l.srcElement)?l.srcElement:l.target},clientCoord:function(aS){var l=aS.touches[0];if(!$.exists(l.clientX)){return null}return new $.coord(l.clientX,l.clientY)},documentCoord:function(aS){var l=aS.touches[0];if($.exists(this.pageCoord(aS))){return this.pageCoord(aS)}var aT=document.documentElement;return new $.coord(l.clientX+aT.scrollLeft,l.clientY+aT.scrollTop)},pageCoord:function(aS){var l=aS.touches[0];if(!$.exists(l.pageX)){return null}return new $.coord(l.pageX,l.pageY)},screenCoord:function(aS){var l=aS.touches[0];return new $.coord(l.screenX,l.screenY)},selection:function(){if($.exists(window.getSelection)){return window.getSelection()}if($.exists(document.getSelection)){return document.getSelection()}if($.exists(document.selection)&&$.exists(document.selection.createRange)){return document.selection.createRange().text}if($.exists(document.activeElement)&&$.exists(document.activeElement.selectionStart)){var aS=document.activeElement.selectionStart,l=document.activeElement.selectionEnd;return document.activeElement.value.substring(aS,l)}return null},clearSelection:function(){var l=this.selection();try{l.removeAllRanges()}catch(aS){l.empty()}return this}};$.Class.extend(ar,$.Class);var aI=new ar();$.touch=function(){return aI};$.DomClass=function(l){$.DomClass.base.call(this);if(!$.exists(l)){$.ku4exception("$.dom","$.DomClass requires valid DOM node.")}this.dom(l)};$.DomClass.prototype={dom:function(l){return this.property("dom",l)}};$.Class.extend($.DomClass,$.Class);var aH={css:{addClass:function(aT,l){var aS=$.ele(aT),aU=aS.className;if($.ku.css.hasClass(aT,l)){return}aS.className+=(/^[^\s]/.test(aU))?(" "+l):l},hasClass:function(aS,l){if(!$.exists(l)){return false}return(new RegExp(l)).test(($.ele(aS)).className)},removeClass:function(aT,l){var aS=$.ele(aT),aU=aS.className;if(!$.ku.css.hasClass(aT,l)){return}aS.className=$.str.trim(aU.replace(new RegExp("(^|\\s)"+l+"(?![\\w\\-])"),""))}},getText:function(aS){var l=$.ele(aS);return l.textContent||l.innerText},quirks:{setOpacity:function(aT,aS){var l=aS/100;aT.style.opacity=l;aT.style["-moz-opacity"]=l;aT.style["-webkit-opacity"]=l;aT.style.filter=$.str.format("alpha(opacity={0})",aS)},clearOpacity:function(l){$.ku.style.set(l,{opacity:null,"-moz-opacity":null,"-webkit-opacity":null,filter:null})}},ready:function(aS,l){_funcs[_funcs.length]={f:aS,b:l||false}},redraw:function(aU){var aT=$.ele(aU)||document.documentElement,aS=aT.style.display||"";aT.style.display="none";var l=aT.offsetHeight;aT.style.display=aS},style:{set:function(aX,aT,aU){var aW=$.ele(aX);function l(aZ){return(/\-/.test(aZ))?aZ.replace(/\-\w/,aZ.charAt(aZ.indexOf("-")+1).toUpperCase()):aZ}if($.isString(aT)){try{aW.style[l(aT)]=aU}catch(aV){}}for(var aY in aT){var aS=l(aY);if(/opacity/i.test(aS)){$.ku.quirks.setOpacity(aX,aT[aY]);continue}try{aW.style[aS]=aT[aY]}catch(aV){continue}}},get:function(aX,aU){var aW=$.ele(aX);function l(a1,aZ){var aY=(/\-/.test(aZ))?aZ.replace(/\-\w/,aZ.charAt(aZ.indexOf("-")+1).toUpperCase()):aZ;try{return window.getComputedStyle(a1,null).getPropertyValue(aZ)}catch(a0){return($.exists(a1.currentStyle))?a1.currentStyle[aZ]:($.exists(a1.style))?a1.style[aY]:""}}if(/opacity/i.test(aU)){var aS=l(aW,aU);if($.exists(aS)){return parseFloat(aS)*100}else{var aT=/alpha\(opacity=\d+(\.\d+)?\)/i.exec(aW.style.filter);if(!$.exists(aT)){return 100}var aV=/\d+(\.\d+)?/i.exec(aT[0]);if(!$.exists(aV)){return 100}return parseFloat(aV[0])}}return l(aW,aU)},toNumber:function(l){return isNaN(l)?0:parseFloat(this.stripUnit(l))},stripUnit:function(l){return($.exists(l)&&$.exists(l.replace))?l.replace(/[^\-\.\d]/g,""):l},getUnit:function(l){return l.match(/[^\-\.\d]{2}/)[0]}},swapDom:function(aT,aS){var l=$.ele(aT);f=$.ele(aS);l.parentNode.replaceChild(f,l)}};$.ku=aH;$.clearNode=function(aS){var l=$.ele(aS);if(!l){return}while(l.hasChildNodes()){l.removeChild(l.firstChild)}};$.create=function(aY){if(!aY){return null}var aS=($.isString(aY))?{x:{}}:aY,a0,aW;for(var aT in aS){if(aT=="content"){continue}a0=document.createElement(aT);attrs=aS[aT]}for(var aT in attrs){var aZ=attrs[aT];if(/class/i.test(aT)){$.ku.css.addClass(a0,aZ);continue}if(/style/i.test(aT)){$.ku.style.set(a0,aZ);continue}a0.setAttribute(aT,aZ)}try{var aX=aS.content;if(!aX){return a0}var aU=(!aX)?1:aX.length;if($.exists(aX.nodeName)){a0.appendChild(aX);return a0}if(!$.isArray(aX)){a0.innerHTML+=aX;return a0}while(aU--){var l=aX[aU];if($.isString(l)||!isNaN(l)){a0.innerHTML+=l;continue}var aS=(l.hasOwnProperty("appendChild"))?l:$.create(l);a0.appendChild(aS)}}catch(aV){}finally{return a0}};$.ele=function(l){if(!l){return null}return($.isEvent(l))?$.evt.ele(l):($.isString(l))?document.getElementById(l):($.exists(l.dom))?l.dom:l};var G=function(aV,aS,aU,aT,l){this.dom=aV;this.evt=aS;this.action=aU;this.scope=aT;this.bubbles=l};$.evt={add:function(aS,aY,l,aZ,aT){if(!$.ele(aS)){$.ku4exception("$.evt",$.str.format("argument dom == {0} at $.evt.add",aS))}var aV=$.ele(aS),aU=aY,a0=aZ||aV,aW=aT||false,aX=function(){l.apply(a0,arguments)};if($.exists(aV.addEventListener)){aV.addEventListener(aU,aX,aW)}else{if($.exists(aV.attachEvent)){aV.attachEvent("on"+aU,aX)}else{aV["on"+aU]=aX}}return new G(aV,aU,aX,a0,aW)},remove:function(aU){var aW=aU.dom,aV=aU.evt,aT=aU.scope,l=aU.bubbles,aS=aU.action;if(aW.removeEventListener){aW.removeEventListener(aV,aS,l)}else{if(aW.detachEvent){aW.detachEvent("on"+aV,aS)}else{aW["on"+aV]=null}}return this},ele:function(l){try{return(l.srcElement)?l.srcElement:l.target}catch(l){return null}},mute:function(l){if($.exists(l.preventDefault)){l.preventDefault()}if($.exists(l.stopPropogation)){l.stopPropogation()}l.returnValue=false;l.cancelBubble=true;return this}};$.findOuterDims=function(aS){var l=$.ele(aS);return{width:l.offsetWidth,height:l.offsetHeight}},$.findInnerDims=function(aS){var l=$.ele(aS);return{width:l.clientWidth,height:l.clientHeight}},$.findOffset=function(aT){var aS=$.ele(aT),l=0,aU=0;if(!aS){return null}do{l+=aS.offsetLeft;aU+=aS.offsetTop}while((function(){try{aS=aS.offsetParent}catch(aV){aS=null}return $.exists(aS)})());return{left:l,top:aU}};$.findBoundedOffset=function(aS){var l=$.ele(aS);if(!l){return null}return{left:l.offsetLeft,top:l.offsetTop}},$.findScrollDims=function(aS){var l=$.ele(aS);return{width:l.scrollWidth,height:l.scrollHeight}};$.findScrollOffset=function(aT){var aS=$.ele(aT),l=0,aU=0;if(!aS){return null}do{l+=aS.scrollLeft||0;aU+=aS.scrollTop||0}while((function(){try{aS=aS.parentNode}catch(aV){aS=null}return $.exists(aS)})());return{left:l,top:aU}};var aD=function(aS){this._navigator=aS;agents={_isIE:"MSIE",_isNetscape:"Netscape",_isFirefox:"Firefox",_isOpera:"Opera",_isSafari:"Safari",_isChrome:"Chrome"};this._isIE=false;this._isNetscape=false;this._isFirefox=false;this._isOpera=false;this._isSafari=false;this._isChrome=false;this._isUnknown=true;this._version="";if(!$.isObject(aS)){return}var aS=this._navigator,aU=aS.userAgent;function aW(aY){return !$.isNullOrEmpty(aU)&&(new RegExp(aY,"i")).test(aU)}function aT(a2){try{var aZ=(new RegExp("Version\\/(\\d+\\.?){1,}","i")).exec(aU),a0=(new RegExp(a2+"\\/(\\d+\\.?){1,}","i")).exec(aU),aY=$.exists(aZ)?aZ:a0;return(new RegExp("(\\d+\\.?){1,}")).exec(aY[0])[0]}catch(a1){return""}}var aX,l,aV;for(aX in agents){aV=agents[aX];l=aW(aV);if(!l){continue}this[aX]=l;this._version=aT(aV);this._isUnknown=false}this._fullVersion=aS.appVersion;this._platform=aS.platform;this._allInfo=this._fullVersion+this._platform};aD.prototype={isIE:function(){return this._isIE},isNetscape:function(){return this._isNetscape},isFirefox:function(){return this._isFirefox},isOpera:function(){return this._isOpera},isSafari:function(){return this._isSafari&&!this._isChrome},isChrome:function(){return this._isChrome},isUnknown:function(){return this._isUnknown},platform:function(){return this._platform},fullVersion:function(){return this._fullVersion},version:function(){return this._version}};var ai;$.ku.browser=function(){if($.exists(ai)){return ai}ai=new aD(navigator);return ai};$.ku.browser.Class=aD;var C=function(l){C.base.call(this,$.ele(l));var aS=this.style("display")||"block";this._display=(/none/i.test(aS))?"block":aS;this._liveEvents=$.hash()};C.prototype={attribute:function(l,aS){var aT=this.dom();if($.isUndefined(aS)){return aT.getAttribute(l)}aT.setAttribute(l,aS);return this},addClass:function(l){$.ku.css.addClass(this.dom(),l);return this},removeClass:function(l){$.ku.css.removeClass(this.dom(),l);return this},hasClass:function(l){$.ku.css.hasClass(this.dom(),l);return this},style:function(aS,l){if($.isString(aS)&&!$.exists(l)){return $.ku.style.get(this.dom(),aS)}$.ku.style.set(this.dom(),aS,l);return this},value:function(l){if(!$.exists(l)){return this.dom().value}this.dom().value=l;return this},content:function(l){if(!$.exists(l)){return this}if($.isNumber(l)||$.isString(l)){return this.html(l)}return this.appendChild(l)},cloneNode:function(l){return this._dom.cloneNode(l||true)},html:function(l){if(!$.exists(l)){return this.dom().innerHTML}this.dom().innerHTML=l;return this},text:function(l){if(!$.exists(l)){return $.ku.getText(this.dom())}$.ku.setText(this.dom(),l);return this},prependChild:function(aS){var aT=this.dom(),l=aT.firstChild;if($.exists(l)){aT.insertBefore(aS,l)}else{aT.appendChild(aS)}return this},appendChild:function(l){this.dom().appendChild(l);return this},removeChild:function(l){this.dom().removeChild(l);return this},insertBefore:function(l){l.parentNode.insertBefore(this.dom(),l);return this},insertAfter:function(l){if($.exists(l.nextSibling)){l.parentNode.insertBefore(this.dom(),l.nextSibling)}else{l.parentNode.appendChild(this.dom())}return this},appendTo:function(l){l.appendChild(this.dom());return this},detach:function(){try{var aS=this.dom();aS.parentNode.removeChild(aS)}catch(l){}finally{return this}},innerDims:function(l){if(!$.exists(l)){return $.coord.parse($.findInnerDims(this.dom()))}var aS=l.toPixel();this.style({width:aS.x(),height:aS.y()});return this},outerDims:function(aS){if(!$.exists(aS)){return $.coord.parse($.findOuterDims(this.dom()))}var l=this.outerDims().subtract(this.innerDims());return this.innerDims(aS.subtract(l))},innerWidth:function(l){var aS=this.innerDims();if(!$.exists(l)){return $.coord(aS.x(),0)}return this.innerDims($.coord(l,aS.y()))},innerHeight:function(l){var aS=this.innerDims();if(!$.exists(l)){return $.coord(0,aS.y())}return this.innerDims($.coord(aS.x(),l))},outerWidth:function(l){var aS=this.outerDims();if(!$.exists(l)){return $.coord(aS.x(),0)}return this.outerDims($.coord(l,aS.y()))},outerHeight:function(l){var aS=this.outerDims();if(!$.exists(l)){return $.coord(0,aS.y())}return this.outerDims($.coord(aS.x(),l))},boundedOffset:function(){return $.coord.parse($.findBoundedOffset(this.dom()))},layoutDims:function(){var l=this.dom().parentNode;if(!$.exists(l)){return $.coord.zero()}var aS=$.dom(l);return aS.outerDims().subtract(aS.innerDims()).half()},offset:function(){return $.coord.parse($.findOffset(this.dom()))},center:function(){return this.offset().add(this.outerDims().half())},scrollDims:function(){return $.coord.parse($.findScrollDims(this.dom()))},scrollOffset:function(){return $.coord.parse($.findScrollOffset(this.dom()))},clear:function(){$.clearNode(this.dom());return this},redraw:function(){$.ku.redraw(this.dom());return this},swap:function(l){$.ku.swapDom(this.dom(),l.dom());return l},show:function(){this.style({display:this._display});return this},hide:function(){this.style({display:"none"});return this},isVisible:function(){var l=this.offset(),aS=this.offset().add(this.innerDims());return $.exists(this.dom().parentNode)&&!/NONE|^$/i.test(this.style("display"))&&$.window().scrollOffset().isLeftOf(aS)&&$.window().scrollOffset().isAbove(aS)&&$.window().scrollDims().isRightOf(l)&&$.window().scrollDims().isBelow(l)},onmouseover:function(l,aT,aS){return this._addEvent("mouseover",l,aT,aS)},onmouseout:function(l,aT,aS){return this._addEvent("mouseout",l,aT,aS)},onmousedown:function(l,aT,aS){return this._addEvent("mousedown",l,aT,aS)},onmouseup:function(l,aT,aS){return this._addEvent("mouseup",l,aT,aS)},onmousemove:function(l,aT,aS){return this._addEvent("mousemove",l,aT,aS)},onclick:function(l,aT,aS){return this._addEvent("click",l,aT,aS)},ondoubleclick:function(l,aT,aS){return this._addEvent("dblclick",l,aT,aS)},onkeydown:function(l,aT,aS){return this._addEvent("keydown",l,aT,aS)},onkeyup:function(l,aT,aS){return this._addEvent("keyup",l,aT,aS)},onkeypress:function(l,aT,aS){return this._addEvent("keypress",l,aT,aS)},onblur:function(l,aT,aS){return this._addEvent("blur",l,aT,aS)},onchange:function(l,aT,aS){return this._addEvent("change",l,aT,aS)},onerror:function(l,aT,aS){return this._addEvent("error",l,aT,aS)},onfocus:function(l,aT,aS){return this._addEvent("focus",l,aT,aS)},onload:function(l,aT,aS){return this._addEvent("load",l,aT,aS)},onresize:function(l,aT,aS){return this._addEvent("resize",l,aT,aS)},onscroll:function(l,aT,aS){return this._addEvent("scroll",l,aT,aS)},onselect:function(l,aT,aS){return this._addEvent("select",l,aT,aS)},onresize:function(l,aT,aS){return this._addEvent("resize",l,aT,aS)},onunload:function(l,aT,aS){return this._addEvent("unload",l,aT,aS)},onorientationchange:function(l,aT,aS){return this._addEvent("orientationchange",l,aT,aS)},ontouchstart:function(l,aT,aS){return this._addEvent("touchstart",l,aT,aS)},ontouchend:function(l,aT,aS){return this._addEvent("touchend",l,aT,aS)},ontouchmove:function(l,aT,aS){return this._addEvent("touchmove",l,aT,aS)},removeEvent:function(aS){var l=this._liveEvents.find(aS);if(!$.exists(l)){return this}return this._removeEvent(l,aS)},clearEvents:function(){$.list(this._liveEvents.values()).each(function(l){this._removeEvent(l)},this);return this},_addEvent:function(aT,aS,aW,aV){var l=aV||$.uid("evt"),aU=this._liveEvents;if(aU.containsKey(l)){return this}aU.add(l,$.evt.add(this.dom(),aT,aS,aW));return this},_removeEvent:function(l,aS){$.evt.remove(l);this._liveEvents.remove(aS);return this}};$.Class.extend(C,$.DomClass);$.dom=function(l){return new C(l)};$.dom.parseHtml=function(l){var aS=$.create({div:{},content:l});if(aS.childNodes.length!=1){return null}return $.dom(aS.firstChild)};$.dom.Class=C;function aK(){aK.base.call(this);this._body=$.dom(document.body)}aK.prototype={isDisabled:function(){return this.get("disabled")},isPortrait:function(){return this.orientation.isLandscape()},isLandscape:function(){return Math.abs(window.orientation)==90},disable:function(){this._disabled=true;document.body.appendChild(af);return this},enable:function(){if(!this.isDisabled()){return this}document.body.removeChild(af);this._disabled=false;return this},dims:function(){var l=window.innerWidth||document.documentElement.clientWidth,aS=window.innerHeight||document.documentElement.clientHeight;return $.coord(l,aS)},center:function(){return this.dims().divide($.coord(2,2))},scrollOffset:function(){var aU=document.documentElement,aS=document.body,l=Math.max(aU.scrollLeft,aS.scrollLeft),aT=Math.max(aU.scrollTop,aS.scrollTop);return $.coord(l,aT)},scrollDims:function(){var aU=document.documentElement,aS=document.body,l=Math.max(aU.scrollWidth,aS.scrollWidth),aT=Math.max(aU.scrollHeight,aS.scrollHeight);return $.coord(l,aT)},scrollCenter:function(){return this.center().add(this.scrollOffset())},contains:function(l){var aT=this.scrollOffset(),aS=this.scrollDims();if(!l instanceof $.point.Class){$.ku4exception("$.window","contains method takes and argument type $.point")}return !(l.isAbove(aT)||l.isLeftOf(aT)||l.isRightOf(aS)||l.isBelow(aS))},redraw:function(){$.ku.redraw(document.body);$.ku.redraw(document.documentElement);return this},onmousedown:function(l,aT,aS){return this._body.onmousedown(l,aT,aS)},onmouseup:function(l,aT,aS){return this._body.onmouseup(l,aT,aS)},ontouchstart:function(l,aT,aS){return this._body.ontouchstart(l,aT,aS)},ontouchend:function(l,aT,aS){return this._body.ontouchend(l,aT,aS)},onclick:function(l,aT,aS){return this._body.onclick(l,aT,aS)},ondoubleclick:function(l,aT,aS){return this._body.ondoubleclick(l,aT,aS)},onkeydown:function(l,aT,aS){return this._body.onkeydown(l,aT,aS)},onkeyup:function(l,aT,aS){return this._body.onkeyup(l,aT,aS)},scrollTo:function(l){window.scrollTo(l.x(),l.y());return this},onresize:function(l,aT,aS){r.add(l,aT,aS);return this},onscroll:function(l,aT,aS){ap.add(l,aT,aS);return this},onspin:function(l,aT,aS){aq.add(l,aT,aS);return this},remove:function(l){r.remove(l);ap.remove(l);aq.remove(l);this._body.removeEvent(l);return this}};$.Class.extend(aK,$.Class);var af=$.create({div:{"class":"ku-window-disabled"}}),r=$.observer(),ap=$.observer(),aq=$.observer(),b=function(){};b.prototype={uri:function(l){return this.property("uri",l)},offset:function(l){return this.property("offset",l)},dims:function(l){return this.property("dims",l)},channelmode:function(l){return this.property("channelmode",l)},directories:function(l){return this.property("directories",l)},fullscreen:function(l){return this.property("fullscreen",l)},location:function(l){return this.property("location",l)},menubar:function(l){return this.property("menubar",l)},scrollbars:function(l){return this.property("scrollbars",l)},titlebar:function(l){return this.property("titlebar",l)},toolbar:function(l){return this.property("toolbar",l)},open:function(){}};$.Class.extend(b,$.Class);var ax;$.window=function(){if($.exists(ax)){return ax}$.evt.add(window,"resize",function(){r.notify()});$.evt.add(window,"scroll",function(){ap.notify()});$.evt.add(window,"orientationchange",function(){aq.notify()});ax=new aK();return ax};$.ku.localization={en:{day:{name:{0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"},abbr:{0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"}},month:{name:{1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},abbr:{1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"}}},sp:{day:{name:{0:"domingo",1:"lunes",2:"martes",3:"mi&#0233;rcoles",4:"jueves",5:"viernes",6:"s�bado"},abbr:{0:"dom",1:"lun",2:"mar",3:"mi&#0233;",4:"jue",5:"vie",6:"s&#0225;b"}},month:{name:{1:"enero",2:"febrero",3:"marzo",4:"abril",5:"mayo",6:"junio",7:"julio",8:"agosto",9:"septiembre",10:"octubre",11:"noviembre",12:"diciembre"},abbr:{1:"ene",2:"feb",3:"mar",4:"abr",5:"may",6:"jun",7:"jul",8:"ago",9:"sep",10:"oct",11:"nov",12:"dic"}}}};$.ku.equations={cycle:function(aT,aV,aU,aS,l){return new $.coord(this.sin(aT.x,aV,aU),this.cos(aT.y,aS,l))},cos:function(aT,aS,l){return aT+Math.cos(aS)*l},cosH:function(aT,aS,l){return new $.coord(this.cos(aT.x,aS,l),aT.y)},cosV:function(aT,aS,l){return new $.coord(aT.x,this.cos(aT.y,aS,l))},sin:function(aT,aS,l){return aT+Math.sin(aS)*l},sinH:function(aT,aS,l){return new $.coord(this.sin(aT.x,aS,l),aT.y)},sinV:function(aT,aS,l){return new $.coord(aT.x,this.sin(aT.y,aS,l))}};$.anime={algorithms:{ease:{}}};var aM=function(l){this._ease=l||0.1};aM.prototype={calculate:function(aS,l){return(l-aS)*this._ease}};$.anime.algorithms.ease.linear=function(l){return new aM(l)};var aC=function(){};aC.prototype={calculate:function(aS,l){return l-aS}};$.anime.algorithms.jump=function(){return new aC()};var o=function(aS,l){this._spring=aS||0.4;this._mu=l||0.6};o.prototype={calculate:function(aX,aT,aW){var aS=this._spring,aU=aW,l=this._mu,aY=aT-aX,aV=aY*aS;aU+=aV;aU*=l;return aU}};$.anime.algorithms.spring=function(aS,l){return new o(aS,l)};function aP(l){this._context=l}aP.prototype={findCoord:function(aT){var l=this._context,aS=$.touch().canRead(aT)?$.touch():$.mouse();return aS.documentCoord(aT).subtract(l.hitCoord()).subtract(l.hitOffset()).add(l.hitBoundedOffet())}};function w(l){this._context=l}w.prototype={findCoord:function(aT){var l=this._context,aS=$.touch().canRead(aT)?$.touch():$.mouse();return l.hitSize().add(aS.documentCoord(aT).subtract(l.hitCoord()).subtract(l.hitOffset()))}};function az(l){this._context=l}az.prototype={findCoord:function(aT){var l=this._context,aS=$.touch().canRead(aT)?$.touch():$.mouse();return l.hitCoord().add(l.hitOffset()).subtract(aS.documentCoord(aT)).add(l.hitScrollOffset())}};var ao={};function ab(l){ab.base.call(this,l);this._mouseEvt=$.uid("dragger");this._touchEvt=$.uid("toucher");this._documentBody=$.dom(document.body);this._onGrab=$.observer();this._onDrag=$.observer();this._onDrop=$.observer();this._constrainX=false;this._constrainY=false;this._boundX=0;this._boundY=0;this._lastPoint=$.coord.zero();this._bearing=$.vector.zero();this._document=$.dom(document);this.state(new ao.dropped()).dragger().dragOffset($.coord.zero()).ontouchstart(this.grab,this,this._touchEvt).onmousedown(this.grab,this,this._mouseEvt)}ab.prototype={document:function(){return this._document},hitSize:function(l){return this.property("hitSize",l)},hitCoord:function(l){return this.property("hitCoord",l)},hitOffset:function(l){return this.property("hitOffset",l)},dragOffset:function(l){return this.property("dragOffset",l)},hitScrollOffset:function(l){return this.property("hitScrollOffset",l)},hitBoundedOffet:function(l){return this.property("hitBoundedOffet",l)},actor:function(){return this.get("actor")},strategy:function(){return this.get("strategy")},bearing:function(){return this.get("bearing")},bearingUp:function(){return this.bearing().y()<0},bearingDown:function(){return this.bearing().y()>0},bearingLeft:function(){return this.bearing().x()<0},bearingRight:function(){return this.bearing().x()>0},constrainX:function(){if(this._constrainX){return this}this._constrainX=true;this._boundX=this.boundedOffset().x();return this},unconstrainX:function(){this._constrainX=false},constrainY:function(){if(this._constrainY){return this}this._constrainY=true;this._boundY=this.boundedOffset().y();return this},unconstrainY:function(){this._constrainY=false},state:function(l){return this.set("state",l.context(this))},dragCoord:function(aU){var aW=this.strategy().findCoord(aU),aT=this.dragOffset(),aS=(this._constrainX)?this._boundX:aW.x()+aT.x(),aV=(this._constrainY)?this._boundY:aW.y()+aT.y(),l=$.point(aS,aV);this._bearing=l.distanceFrom(this._lastPoint);this._lastPoint=l;return l},dragger:function(){return this.set("actor",$.pinner(this.dom())).set("strategy",new aP(this))._setType("dragger")},sizer:function(){return this.set("actor",$.sizer(this.dom())).set("strategy",new w(this))._setType("sizer")},scroller:function(){return this.set("actor",$.scroller(this.dom())).set("strategy",new az(this))._setType("scroller")},grab:function(l){this._onGrab.notify(l);this._state.grab(l);return this},drag:function(l){this._onDrag.notify(l);this._state.drag(l);return this},drop:function(l){this._onDrop.notify(l);this._state.drop(l);this._bearing=$.vector.zero();return this},onGrab:function(aS,l,aT){this._onGrab.add(aS,l,aT);return this},onDrag:function(aS,l,aT){this._onDrag.add(aS,l,aT);return this},onDrop:function(aS,l,aT){this._onDrop.add(aS,l,aT);return this},destroy:function(){this._onGrab.clear();this._onDrag.clear();this._onDrop.clear();this.removeEvent(this._mouseEvt).removeEvent(this._touchEvt)},disableSelect:function(aS){document.onselectstart=function(){return false};if(!$.exists(window.getSelection)){return this}this._mouseDisableId=$.uid("disable");this._touchDisableId=$.uid("disable");function l(){window.getSelection().removeAllRanges()}this._documentBody.onmousemove(l,null,this._mouseDisableId).ontouchmove(l,null,this._touchDisableId);return this},enableSelect:function(){document.onselectstart=null;var l=this._mouseDisableId,aS=this._touchDisableId,aT=this._documentBody;if($.exists(l)){aT.removeEvent(l)}if($.exists(aS)){aT.removeEvent(aS)}this._mouseDisableId=null;this._touchDisableId=null;return this},_setType:function(l){this._clearType().addClass($.str.format("ku-dragger-{0}",l));return this},_clearType:function(){this.removeClass("ku-dragger-dragger").removeClass("ku-dragger-sizer").removeClass("ku-dragger-scoller");return this}};$.Class.extend(ab,$.dom.Class);$.dnd=function(l){return new ab(l)};ao.dropped=function(){ao.dropped.base.call(this,ao)};ao.dropped.prototype={grab:function(aU){$.evt.mute(aU);var l=this.context(),aT=$.touch().canRead(aU)?$.touch():$.mouse(),aS=aT.documentCoord(aU).subtract(l.offset());l.document().ontouchmove(l.drag,l,$.uid()).ontouchend(l.drop,l,$.uid()).onmousemove(l.drag,l,$.uid()).onmouseup(l.drop,l,$.uid());l.disableSelect().addClass("ku-dragger-grabbed").hitSize(l.outerDims()).hitCoord(aS).hitOffset(l.offset()).hitScrollOffset(l.scrollOffset()).hitBoundedOffet(l.boundedOffset()).actor().to(l.dragCoord(aU));this.state("grabbed")},drag:function(){return},drop:function(){return}};$.Class.extend(ao.dropped,$.abstractState);ao.grabbed=function(){ao.grabbed.base.call(this,ao)};ao.grabbed.prototype={grab:function(){return},drag:function(aS){$.evt.mute(aS);var l=this.context();l.actor().to(l.dragCoord(aS));this.context().redraw()},drop:function(l){this.context().enableSelect().removeClass("ku-dragger-grabbed").document().clearEvents();this.state("dropped")}};$.Class.extend(ao.grabbed,$.abstractState);function g(l){g.base.call(this,l);this._onEnd=$.observer();this.linear()}g.prototype={$to:function(l){return},$moveTo:function(l){return},$done:function(){this._onEnd.notify();return this},algorithm:function(l){this.$algorithm=l;return this},linear:function(l){return this.algorithm($.anime.algorithms.ease.linear(l))},spring:function(aS,l){this.algorithm($.anime.algorithms.spring(aS,l))},stop:function(){if(!$.exists(this.$tween)){return this}this.$tween.stop();return this},to:function(l){this.stop().$to(l).$done();return this},moveTo:function(l){this.stop().$moveTo(l);return this},onEnd:function(aS,l){if(!$.exists(aS)){return this}this._onEnd.add(aS,l);return this}};$.Class.extend(g,$.dom.Class);function v(l){$.dom(l).addClass("ku-fader");v.base.call(this,l)}v.prototype={$to:function(l){var aT=this.dom(),aS=$.dom(aT);aS.style("opacity",l*0.01);return this},$moveTo:function(l){var aT=this.dom(),aS=$.dom(aT),aU=aS.style("opacity")||1;this.$tween=$.tween(function(aV){aS.style("opacity",aV*0.01)},aU,l,this.$algorithm).onEnd(this.$done,this).start(aT)}};$.Class.extend(v,g);$.fader=function(l){return new v(l)};function Y(l){$.dom(l).addClass("ku-fitter");Y.base.call(this,l)}Y.prototype={$to:function(l){var aT=this.dom(),aS=$.dom(aT);aS.style("width",l.x()+"px");aS.style("height",l.y()+"px");return this},$moveTo:function(aU){var aS=this.dom(),l=$.dom(aS),aT=l.outerDims();this.$tween=$.tween(function(aV){l.style("width",aV.x()+"px");l.style("height",aV.y()+"px")},aT,al(this,aU),this.$algorithm).onEnd(this.$done,this).start(aS)}};$.Class.extend(Y,g);function al(l,aT){var aU=aT.y()/aT.x(),aS=$.dom(l.dom()),aY=aS.outerDims(),aV=aY.y()/aY.x(),aZ=isNaN(aV)?1:aV,aX=aY.x(),aW=aY.y();if((aZ<aU)||(aZ==aU)){aX=aT.x();aW=aT.x()*aV}if(aZ>aU){aX=aT.y()/aV;aW=aT.y()}return $.coord(aX,aW)}$.fitter=function(l){return new Y(l)};function n(l){$.dom(l).addClass("ku-pinner");n.base.call(this,l)}n.prototype={$to:function(l){var aT=this.dom(),aS=$.dom(aT);aS.style("left",l.x()+"px");aS.style("top",l.y()+"px");return this},$moveTo:function(aX){var aV=this.dom(),aU=$.dom(aV),aT=aU.offset(),aS=$.findOffset(aV.parentNode),l=($.coord.canParse(aS))?$.coord.parse(aS):$.coord.zero(),aW=aT.subtract(l);this.$tween=$.tween(function(aY){aU.style("left",aY.x()+"px");aU.style("top",aY.y()+"px")},aW,aX,this.$algorithm).onEnd(this.$done,this).start(aV)}};$.Class.extend(n,g);$.pinner=function(l){return new n(l)};function I(l){$.dom(l).addClass("ku-scoller");I.base.call(this,l)}I.prototype={$to:function(l){var aT=this.dom(),aS=$.dom(aT);aS.style("scrollLeft",l.x());aS.style("scrollTop",l.y());return this},$moveTo:function(aX){var aV=this.dom(),aU=$.dom(aV),aT=aU.scrollOffset(),aS=$.findOffset(aV.parentNode),l=($.coord.canParse(aS))?$.coord.parse(aS):$.coord.zero(),aW=aT.subtract(l);this.$tween=$.tween(function(aY){aU.style("scrollLeft",aY.x());aU.style("scrollTop",aY.y())},aW,aX,this.$algorithm).onEnd(this.$done,this).start(aV)}};$.Class.extend(I,g);$.scroller=function(l){return new I(l)};function A(l){$.dom(l).addClass("ku-sizer");A.base.call(this,l)}A.prototype={$to:function(l){var aT=this.dom(),aS=$.dom(aT);aS.style("width",l.x()+"px");aS.style("height",l.y()+"px");return this},$moveTo:function(aU){var aS=this.dom(),l=$.dom(aS),aT=l.outerDims();this.$tween=$.tween(function(aV){l.style("width",aV.x()+"px");l.style("height",aV.y()+"px")},aT,aU,this.$algorithm).onEnd(this.$done,this).start(aS)}};$.Class.extend(A,g);$.sizer=function(aT,aS,l){return new A(aT,aS,l)};function aG(l,aS){$.dom(l).addClass("ku-styler");aG.base.call(this,l);this._prop=aS}aG.prototype={$moveTo:function(aT){var aX=this.dom(),aW=$.dom(aX),aU=this._prop,aV=aW.style(aU),l=$.ku.style,aS=l.getUnit(aV)||"",aY=l.toNumber(aV);this.$tween=$.tween(function(aZ){aW.style(aU,aZ+aS)},aY,aT,this.$algorithm).onEnd(this.$done,this).start(aX)}};$.Class.extend(aG,g);$.styler=function(l,aS){return new aG(l,aS)};function S(aS,l){S.base.call(this,l);this._listeners=$.observer();this._ticks=0;this.fps(aS||30)}S.prototype={fps:function(l){this._interval=1000/l;return this.property("fps",l)},interval:function(){return this.get("interval")},listeners:function(){return this.get("listeners")},ticks:function(){return this.get("ticks")},start:function(){this._state.start();return this},stop:function(){this._state.stop();return this},add:function(aS,aZ,l,aT){var aW=this,aY=aT||1,aX=l||$.uid("timeline"),aV=function(){if(!aW._ticks%aY==0){return}aS();aU=aS},aU=(!aT)?aS:aV;this._listeners.add(aU,aZ,aX);return this},remove:function(l){this._listeners.remove(l);return this},clear:function(){this._listeners.clear();return this},tick:function(){this._ticks++;return this}};$.Class.extend(S,$.abstractContext);$.timeline=function(){return B};S.started=function(){S.started.base.call(this,S)};S.started.prototype={start:function(){return},stop:function(){clearTimeout(ku_timeline);ku_timeline=null;this.state("stopped")}};$.Class.extend(S.started,$.abstractState);S.stopped=function(){S.stopped.base.call(this,S)};S.stopped.prototype={start:function(){var aT=this.context(),aS=aT.interval(),l=function(){aT.tick().listeners().notify();ku_timeline=setTimeout(l,aS)};l();this.state("started")},stop:function(){return}};$.Class.extend(S.stopped,$.abstractState);var B=new S(30,new S.stopped()).start();var aa=function(aU,aT,l,aS){this.$method=aU;this.$current=aT;this.$end=l;this.$algorithm=aS;this.$value=0;this._onEnd=$.observer();this._id=$.uid("tween")};aa.prototype={$exec:function(){return},$done:function(){this._onEnd.notify()},start:function(){$.timeline().add(this.$exec,this,this._id);return this},stop:function(){$.timeline().remove(this._id);return this},onEnd:function(aS,l){this._onEnd.add(aS,l);return this},clear:function(){this._onEnd.clear();return this}};$.Class.extend(aa,$.Class);var ac=function(aU,aT,l,aS){ac.base.call(this,aU,aT,l,aS);this.$value=$.coord.zero()};ac.prototype={$exec:function(){var aX=this.$method,aW=this.$current,l=this.$end;var aU=this.$algorithm.calculate(aW.x(),l.x(),this.$value.x());var aS=this.$algorithm.calculate(aW.y(),l.y(),this.$value.y()),aT=$.coord(aU,aS),aV=l.abs().subtract(aW.abs());if((Math.abs(aU)<0.1)&&(aV.x()<1)&&(Math.abs(aS)<0.1)&&(aV.y()<1)){aX(l);this.stop()._onEnd.notify();return}this.$current=aW.add(aT);this.$value=aT;aX(this.$current)}};$.Class.extend(ac,aa);var a=function(aU,aT,l,aS){a.base.call(this,aU,aT,l,aS)};a.prototype={$exec:function(){var aU=this.$method,aT=this.$current,l=this.$end,aS=this.$algorithm.calculate(aT,l,this.$value);if((Math.abs(aS)<0.1)&&(Math.abs(l-aT)<1)){aU(l);this.stop().$done();return}this.$current=aT+aS;this.$value=aS;aU(this.$current)}};$.Class.extend(a,aa);$.tween=function(aU,aT,l,aS){return($.isNumber(aT)&&$.isNumber(l))?new a(aU,aT,l,aS):new ac(aU,aT,l,aS)};function H(aV,aU,l,aS,aW,aT){H.base.call(this,aV);this.id($.uid("jsx-cell")).cIdx(aU).cKey(l).rIdx(aS).rKey(aW).value(aT)}H.prototype={id:function(l){return this.property("id",l)},value:function(l){return this.property("value",l)},cIdx:function(l){if($.exists(l)){this.dom().cIdx=l}return this.property("cIdx",l)},rIdx:function(l){if($.exists(l)){this.dom().rIdx=l}return this.property("rIdx",l)},cKey:function(l){if($.exists(l)){this.dom().cKey=l}return this.property("cKey",l)},rKey:function(l){if($.exists(l)){this.dom().rKey=l}return this.property("rKey",l)}};$.Class.extend(H,$.dom.Class);$.cell=function(aV,aU,l,aS,aW,aT){return new H(aV,aU,l,aS,aW,aT)};$.cell.Class=H;function M(aV,aS,l,aT,aU){M.base.call(this,aV);this.id($.uid()).col(aS).index(l).key(aT).value(aU);this._cells=$.hash()}M.prototype={id:function(l){return this.property("id",l)},col:function(l){return this.property("col",l)},value:function(l){if($.exists(l)){this.content(l)}return this.property("value",l)},index:function(l){if($.exists(l)){this.dom().cIdx=l}return this.property("index",l)},key:function(l){if($.exists(l)){this.dom().cKey=l}return this.property("key",l)},findCell:function(l){return this._cells.find(l)},listCells:function(){return $.list(this._cells.values())},addCell:function(l){this._cells.add(l.rKey(),l);return this},removeCell:function(l){var aS=this._cells;aS.remove(l.rKey());if(aS.isEmpty()){$.dom(this._col).detach();this.detach()}return this},};$.Class.extend(M,$.dom.Class);$.column=function(aV,aS,l,aT,aU){return new M(aV,aS,l,aT,aU)};$.column.Class=M;function ae(aS){$.cast(this,aS);this._dri=new $.iterator(this.rows.values());this.helper=$.create({tr:{"class":"ku-table-dragRow-helper"}});$.slider(this.helper,null,null,null,null,null,"dragger","vertical");this._isMoving=false;this._hitPoint;this._moveDom;function l(aT){return $.cast($.coord.parse($.findOffset(this.dom)),$.point)}this._dri.foreach(function(aT){$.evt.add(aT.dom,"mouseover",function(){if(!this._isMoving){return}var aY=aT.dom,aU=this.body,aV=this.helper,aW=this._hitPoint,aX=l(aY);if(!aY.nextSibling){aU.appendChild(aV)}else{if(aX.isAbove(aW)){aU.insertBefore(aV,aY)}else{aU.insertBefore(aV,aY.nextSibling)}}this._hitPoint=aX},this);$.dnd(aT.dom,function(){this.helper=aT.dom;this._isMoving=true;this._hitPoint=l(aT.dom);this._moveDom=aT.dom;this.body.insertBefore(this.helper,aT.dom);$.ku.css.addClass(this.body,"ku-table-draggableRow-dragging");$.ku.css.addClass(this._moveDom,"ku-table-draggableRow-moveDom")},null,function(){$.ku.css.removeClass(this.body,"ku-table-draggableRow-dragging");$.ku.css.removeClass(this._moveDom,"ku-table-draggableRow-moveDom");$.ku.swapDom(this.helper,this._moveDom);this._isMoving=false;this._moveDom=null;this.format()},this)},this)}$.draggableRowDecorator=function(l){return new ae(l)};function au(l){$.cast(this,l);this._sci=new $.iterator(this.columns.values());this._sci.foreach(function(aU){var aT=aU.dom,aS=$.create({a:{"class":"ku-table-col-sizer"}});new $.slider(aT,aS,null,null,null,null,"sizer","horizontal");aT.appendChild(aS)})}function ay(l){$.cast(this,l);this._isAsc=false;this._asc=new $.sorter(sorter.strategy.asc);this._des=new $.sorter(sorter.strategy.des);this._sortci=new $.iterator(this.columns.values());this._sortci.foreach(function(aU){var aS=new $.iterator(aU.cells.values()),aT=$.create({a:{"class":"ku-table-col-sorter"}});aU.dom.appendChild(aT);$.evt.add(aT,"click",function(){var a3=[],aV=this._isAsc,a4=(aV)?this._asc:this._des,aX="ku-table-col-sorter-{0}",a0=$.str.format(aX,"asc"),aY=$.str.format(aX,"dec"),a2=(aV)?a0:aY;aS.foreach(function(a5){a3[a3.length]=a5.dom});this._isAsc=!this._isAsc;var a1=a4.sort(a3),aW=a1.length,aZ=this.body;$.clearNode(aZ);while(aW--){aZ.appendChild(this.rows.find(a1[i].rIdx).dom)}$.ku.css.removeClass(aT,a0);$.ku.css.removeClass(aT,aY);$.ku.css.addClass(aT,a2);this.format()},this)},this)}function K(){K.base.call(this)}K.prototype={table:function(l){return this.set("table",l)},createColumn:function(aS,aT,aU){var l=$.create({col:{}}),aV=$.create({th:{"ku-key":aT},content:$.create({span:{"class":"ku-table-head-content"},content:aU})});return $.column(aV,l,aS,aT,aU)},createRow:function(l,aS){var aT=$.create({tr:{"class":"ku-table-row"}});return $.row(aT,l,aS)},createCell:function(aW,aV,aS,aU,aY){var aT=this._table,aX=$.create({td:{"class":"ku-table-cell"},content:aW}),l=$.cell(aX,aV,aS,aU,aY,aW).onclick(function(){aT.selectCell(l)},this);return l}};$.Class.extend(K,$.Class);function av(aT,l,aS){av.base.call(this,aT);this.id($.uid()).index(l).key(aS);this._cells=$.hash()}av.prototype={id:function(l){return this.property("id",l)},index:function(l){if($.exists(l)){this.dom().rIdx=l}return this.property("index",l)},key:function(l){if($.exists(l)){this.dom().rKey=l}return this.property("key",l)},findCell:function(l){return this._cells.find(l)},listCells:function(){return $.list(this._cells.values())},addCell:function(l){this._dom.appendChild(l.dom());this._cells.add(l.cKey(),l);return this},removeCell:function(l){this._dom.removeChild(l.dom());this._cells.remove(l.cKey());return this}};$.Class.extend(av,$.dom.Class);$.row=function(aU,l,aS,aT){return new av(aU,l,aS,aT)};$.row.Class=av;function ad(aU){var aY=$.create({table:{"class":"ku-table",cellspacing:0}});ad.base.call(this,aY);var aT=$.create({colgroup:{"class":"ku-table-colgroup"}}),aS=$.create({caption:{"class":"ku-table-caption"}}),aW=$.create({thead:{"class":"ku-table-head"}}),aX=$.create({tr:{"class":"ku-table-head-row"}}),l=$.create({tbody:{"class":"ku-table-body"}}),aV=$.create({tfoot:{"class":"ku-table-foot"}});this._columns=new $.hash();this._rows=new $.hash();this._cells=new $.hash();this._onCellSelect=$.observer();this.appendChild(aT).colgroup(aT).appendChild(aS).caption(aS).appendChild(aW).head(aW).appendChild(aX).headRow(aX).appendChild(l).body(l).appendChild(aV).foot(aV).factory(aU||new K()).head().appendChild(this.headRow())}ad.prototype={title:function(l){if($.isString(l)){this.caption().innerHTML=l}else{if($.exists(l)){this.caption().appendChild(l)}}return this.property("title",l)},factory:function(l){return this.property("factory",l.table(this))},caption:function(l){return this.property("caption",l)},colgroup:function(l){return this.property("colgroup",l)},head:function(l){return this.property("head",l)},headRow:function(l){return this.property("headRow",l)},body:function(l){return this.property("body",l)},foot:function(l){return this.property("foot",l)},listColumns:function(){return $.list(this._columns.values())},listRows:function(){return $.list(this._rows.values())},listCells:function(){return $.list(this._cells.values())},selectCell:function(l){this._onCellSelect.notify(l);return this},onCellSelect:function(aS,l){this._onCellSelect.add(aS,l);return this},addColumn:function(aS,aV,aU){var l=this._columns,aT=this._rows;if(l.containsKey(aS)){return this._updateColumn(aS,aV,aU)}else{return this._addColumn(aS,aV,aU)}},_addColumn:function(l,aU,aT){var aS=this._factory.createColumn($.uid(),l,aT);this._columns.add(aS.key(),aS);$.list(this._rows.values()).each(function(aV){this.addCell(aV,aS,aU[aV.key()])},this);this._colgroup.appendChild(aS.col());this._headRow.appendChild(aS.dom());return this},_updateColumn:function(l,aU,aT){var aS=this._columns.find(l);$.list(his._rows.values()).each(function(aV){this.findCell(aV.key(),aS.key()).value(aU[aV.key()])},this);if($.exists(aT)){aS.value(aT)}return this},findColumn:function(l){return this._columns.find(l)},removeColumn:function(l){var aT=this._rows,aS=this.findColumn(l);if(!$.exists(aS)){return this}$.list(aT.values()).each(function(aU){this.removeCell(aS.findCell(aU.key()))},this);this._columns.remove(aS.key());return this},addRow:function(aS,aU){var aT=this._rows,l=this._columns;if(aT.containsKey(aS)){return this._updateRow(aS,aU)}else{return this._addRow(aS,aU)}},_addRow:function(l,aS){var aT=this._factory.createRow($.uid(),l);this._rows.add(aT.key(),aT);$.list(this._columns.values()).each(function(aU){this.addCell(aT,aU,aS[aU.key()])},this);this.body().appendChild(aT.dom());return this},_updateRow:function(l,aS){var aT=this._rows.find(l);$.list(this._columns.values()).each(function(aU){this.findCell(aT.key(),aU.key()).value(aS[aU.key()])},this);return this},findRow:function(l){return this._rows.find(l)},removeRow:function(aS){var l=this._columns,aT=this.findRow(aS);if(!$.exists(aT)){return this}$.list(l.values()).each(function(aU){this.removeCell(aT.findCell(aU.key()))},this);this._rows.remove(aT.key());return this},addCell:function(aU,aS,aT){var l=this._factory.createCell(aT,aS.index(),aS.key(),aU.index(),aU.key());aS.addCell(l);aU.addCell(l);this._cells.add(l.id(),l);return this},findCellById:function(l){return this._cells.find(l)},findCell:function(aU,aS){var l=$.list(this._cells.values()),aT;l.each(function(aV){if((aV.rKey()==aU)&&(aV.cKey()==aS)){aT=aV;l.quit()}});return aT},removeCell:function(l){this._cells.remove(l.id());this._columns.find(l.cKey()).removeCell(l);this._rows.find(l.rKey()).removeCell(l);return this},format:function(){var l=0,aS="ku-table-row-even",aT="ku-table-row-odd",aU=function(){(l%2==0)?aS:aT};this._rows.each(function(aV){aV.removeClass(aS).removeClass(aT).addClass(aU());l++})},toObject:function(){return{title:this.title(),columns:this._columns.toObject(),rows:this._rows.toObject()}}};$.Class.extend(ad,$.dom.Class);$.table=function(l){return new ad(l)};$.table.Class=ad;ad.parseDom=function(aW){var aS=function(aZ,aY){return aZ.getElementsByTagName(aY)};ad=$.ele(aW),cols=aS(aS((aS(ad,"thead")[0]),"tr")[0],"th"),rows=aS((aS(ad,"tbody")[0]),"tr"),caption=aS(ad,"caption")[0],title=(!caption)?"":caption.innerHTML,t=new $.table(title),R=cols.length,m=rows.length,c=[];while(i--){var aV=cols[i],l=$.ku.getText(aV)||$.uid("table-column");c[c.length]=l;t.addColumn(l,aV.innerHTML)}while(m--){var aT=aS(rows[j],"td"),aX=aT.length,aU={};while(aX--){aU[c[l]]=aT[l].innerHTML}t.addRow(aU)}return t};ad.parseObject=function(aT){var l=new $.table(aT.title),aV=aT.columns,aS=aT.rows;for(var aU in aV){l.addColumn(aU,aV[aU])}for(var aU in aS){l.addRow(aS[aU])}return l};var q=function(){q.base.call(this,$.create({div:{"class":"ku-calendar"}}));var l=$.create({div:{"class":"ku-sheet"}});this._sheetContainer=$.dom(l);this._onShowDates=$.observer();this._onShowMonths=$.observer();this._onShowYears=$.observer();this._onSelect=$.observer();this._sheet;this.dayPoint($.dayPoint.today()).localization($.ku.localization.en).sheetFactory($.clickableSheetFactory()).dom().appendChild(l)};q.prototype={dayPoint:function(l){return this.property("dayPoint",l)},localization:function(l){return this.property("localization",l)},sheetFactory:function(l){return this.set("sheetFactory",l)},isShowingDates:function(){return this._isShowingDates},isShowingMonths:function(){return this._isShowingMonths},isShowingYears:function(){return this._isShowingYears},nextDay:function(){this.dayPoint(this.dayPoint().nextDay());return this},prevDay:function(){this.dayPoint(this.dayPoint().prevDay());return this},nextMonth:function(){this.dayPoint(this.dayPoint().nextMonth());return this},prevMonth:function(){this.dayPoint(this.dayPoint().prevMonth());return this},nextYear:function(){this.dayPoint(this.dayPoint().nextYear());return this},prevYear:function(){this.dayPoint(this.dayPoint().prevYear());return this},showDates:function(){return this._showSheet("createDatesheet")._currentView(false,false,true)},showMonths:function(){return this._showSheet("createMonthsheet")._currentView(false,true,false)},showYears:function(){return this._showSheet("createYearsheet")._currentView(true,false,false)},findCell:function(l){return this._sheet.findCell(l)},each:function(aS,l){this._sheet.each(aS,l);return this},select:function(l){this._sheet.select(l);return this},onSelect:function(aS,l){this._onSelect.add(aS,l);return this},onShowDates:function(aS,l){this._onShowDates.add(aS,l);return this},onShowMonths:function(aS,l){this._onShowMonths.add(aS,l);return this},onShowYears:function(aS,l){this._onShowYears.add(aS,l);return this},_currentView:function(aS,l,aT){this._isShowingYears=aS;this._isShowingMonths=l;this._isShowingDates=aT;if(aS){this._onShowYears.notify()}if(l){this._onShowYears.notify()}if(aT){this._onShowDates.notify()}return this},_showSheet:function(aT){var l=this._sheet;if($.exists(l)){l.destroy()}var aS=this._sheetFactory[aT](this.dayPoint(),this._localization).onSelect(this._onSelect.notify,this._onSelect);this._sheetContainer.clear().appendChild(aS.dom());this._sheet=aS;return this}};$.Class.extend(q,$.dom.Class);$.calendar=function(){return new q()};var aN=function(aU){aN.base.call(this,$.create({div:{"class":"ku-calendar-controls"}}));this._calendar=aU;var aW=$.dom($.create({div:{"class":"ku-calendar-title"}})),aT=$.dom($.create({button:{"class":"ku-calendar-month"}})).onclick(this.showMonths,this),aS=$.dom($.create({button:{"class":"ku-calendar-year"}})).onclick(this.showYears,this),l=$.dom($.create({button:{"class":"ku-calendar-prevButton"}})).onclick(function(){this._prevAction()},this),aV=$.dom($.create({button:{"class":"ku-calendar-nextButton"}})).onclick(function(){this._nextAction()},this);$.dom(this.dom()).appendChild(aW.appendChild(aT.dom()).appendChild(aS.dom()).dom()).appendChild(l.dom()).appendChild(aV.dom()).appendChild(aU.dom());this._title=aW;this._month=aT;this._year=aS;this._prevButton=l;this._nextButton=aV;this.onSelect(this._displayDates,this)};aN.prototype={dayPoint:function(l){var aS=this._calendar;if(!$.exists(l)){return aS.dayPoint()}aS.dayPoint(l);return this},localization:function(aS){var l=this._calendar;if(!$.exists(aS)){return l.localization()}l.localization(aS);return this},sheetFactory:function(l){this._calendar.sheetFactory(l);return this},nextDay:function(){this._calendar.nextDay();return this},prevDay:function(){this._calendar.prevDay();return this},nextMonth:function(){this._calendar.nextMonth();return this},prevMonth:function(){this._calendar.prevMonth();return this},nextYear:function(){this._calendar.nextYear();return this},prevYear:function(){this._calendar.prevYear();return this},showDates:function(){var aT=this._calendar,l=aT.localization().month.name,aS=aT.dayPoint();aT.showDates();this._month.html(l[aS.month()]);this._year.html(aS.year());this._prevAction=this._prevMonth;this._nextAction=this._nextMonth;return this},showMonths:function(){this._calendar.showMonths();var l=function(){return};this._prevAction=l;this._nextAction=l;return this},showYears:function(){this._calendar.showYears();this._prevAction=this._prevYears;this._nextAction=this._nextYears;return this},findCell:function(l){return this._calendar.findCell(l)},each:function(aS,l){this._calendar.each(aS,l);return this},select:function(l){this._calendar.select(l);return this},onSelect:function(aS,l){this._calendar.onSelect(aS,l);return this},onShowDates:function(aS,l){this._calendar.onShowDates(aS,l);return this},onShowMonths:function(aS,l){this._calendar.onShowMonths(aS,l);return this},onShowYears:function(aS,l){this._calendar.onShowYears(aS,l);return this},_prevMonth:function(){this.prevMonth().showDates()},_nextMonth:function(){this.nextMonth().showDates()},_prevYears:function(){this.dayPoint(this.dayPoint().add(-12,0,0)).showYears()},_nextYears:function(){this.dayPoint(this.dayPoint().add(12,0,0)).showYears()},_displayDates:function(l){var aY=this._calendar,aS=aY.isShowingDates(),aX=aY.isShowingMonths(),aW=aY.isShowingYears(),aT=aY.dayPoint(),aU=l.value(),aV;if(aW){aV=$.dayPoint(aU.year(),aT.month(),aT.date())}if(aX){aV=$.dayPoint(aT.year(),aU.month(),aT.date())}if(aS){aV=aU}this.dayPoint(aV);if(aW||aX||(aT.month()!=aU.month())){this.showDates()}}};$.Class.extend(aN,$.dom.Class);$.calendarControlsDecorator=function(l){return new aN(l)};function aR(){}aR.prototype={createDatesheet:function(l,aS){return $.datesheet(l,aS,$.table($.clickableDateSheetTableFactory(l,aS)))},createMonthsheet:function(l,aS){return $.monthsheet(l,aS,$.table($.clickableMonthSheetTableFactory(l,aS)))},createYearsheet:function(l,aS){return $.yearsheet(l,aS,$.table($.clickableYearSheetTableFactory(l,aS)))}};$.clickableSheetFactory=function(){return new aR()};function Q(l,aS){Q.base.call(this);this._dayPoint=l;this._localization=aS}Q.prototype={$setCellAction:function(l){return l},table:function(l){this.$table=l;return this.set("table",l)},createColumn:function(aS,aT,aU){var aS=this._table.listColumns().count(),l=$.create({col:{}}),aV=$.create({th:{"ku-key":aT},content:$.create({span:{"class":"ku-table-head-content"},content:aU})});return $.column(aV,l,aS,aT,aU)},createRow:function(aS,aT){var aS=this._table.listRows().count(),l=(aS%2==0)?"ku-table-row ku-table-row-even":"ku-table-row ku-table-row-odd",aU=$.create({tr:{"class":l}});return $.row(aU,aS,aT)},createCell:function(aX,l,aS,aT,aU){var aZ=this._table,aW=$.dayPoint.today(),aV=$.create({td:{"class":$.str.format("ku-date-day-{0} ku-date-week-{1}",l,aT)},content:$.str.format("<span class='ku-datesheet-cell-date'>{0}</span>",aX.date())}),aY=$.cell(aV,l,aS,aT,aU,aX).addClass("ku-sheet-date").id(aX.toString());if(aX.isBefore(aW)){aY.addClass("ku-datesheet-past")}if(aX.equals(aW)){aY.addClass("ku-datesheet-present")}if(aX.isAfter(aW)){aY.addClass("ku-datesheet-future")}if(aX.isWeekday()){aY.addClass("ku-datesheet-weekday")}if(aX.isWeekend()){aY.addClass("ku-datesheet-weekend")}if((aX.month()<this._dayPoint.month())||((aX.month()==12)&&(this._dayPoint.month()==1))){aY.addClass("ku-datesheet-lastMonth")}if(aX.month()==this._dayPoint.month()){aY.addClass("ku-datesheet-thisMonth")}if((aX.month()>this._dayPoint.month())||((aX.month()==1)&&(this._dayPoint.month()==12))){aY.addClass("ku-datesheet-nextMonth")}return this.$setCellAction(aY)}};$.Class.extend(Q,$.Class);function U(l,aS){U.base.call(this);this._dayPoint=l;this._localization=aS}U.prototype={$setCellAction:function(l){return l},table:function(l){this.$table=l;return this.set("table",l)},createColumn:function(aS,aT,aU){var aS=this._table.listColumns().count(),l=$.create({col:{}}),aV=$.create({th:{"ku-key":aT},content:$.create({span:{"class":"ku-table-head-content"},content:aU})});return $.column(aV,l,aS,aT,aU)},createRow:function(aS,aT){var aS=this._table.listRows().count(),l=(aS%2==0)?"ku-table-row ku-table-row-even":"ku-table-row ku-table-row-odd",aU=$.create({tr:{"class":l}});return $.row(aU,aS,aT)},createCell:function(aV,aU,aS,aT,aX){var aW=$.create({td:{"class":$.str.format("ku-month",aU,aT)},content:this._localization.month.abbr[aV.month()]}),l=$.cell(aW,aU,aS,aT,aX,aV).addClass("ku-sheet-month").id(aV.month().toString());return this.$setCellAction(l)}};$.Class.extend(U,$.Class);function d(l,aS){d.base.call(this);this._dayPoint=l;this._localization=aS}d.prototype={$setCellAction:function(l){return l},table:function(l){this.$table=l;return this.set("table",l)},createColumn:function(aS,aT,aU){var aS=this._table.listColumns().count(),l=$.create({col:{}}),aV=$.create({th:{"ku-key":aT},content:$.create({span:{"class":"ku-table-head-content"},content:aU})});return $.column(aV,l,aS,aT,aU)},createRow:function(aS,aT){var aS=this._table.listRows().count(),l=(aS%2==0)?"ku-table-row ku-table-row-even":"ku-table-row ku-table-row-odd",aU=$.create({tr:{"class":l}});return $.row(aU,aS,aT)},createCell:function(aV,aU,aS,aT,aX){var aW=$.create({td:{"class":$.str.format("ku-year",aU,aT)},content:aV.year()}),l=$.cell(aW,aU,aS,aT,aX,aV).addClass("ku-sheet-year").id(aV.year().toString());return this.$setCellAction(l)}};$.Class.extend(d,$.Class);function at(l,aS){at.base.call(this,l,aS)}at.prototype={$setCellAction:function(l){return l.onclick(function(){this.$table.selectCell(l)},this)}};$.Class.extend(at,Q);$.clickableDateSheetTableFactory=function(l,aS){return new at(l,aS)};function J(l,aS){J.base.call(this,l,aS)}J.prototype={$setCellAction:function(l){return l.onclick(function(){this.$table.selectCell(l)},this)}};$.Class.extend(J,U);$.clickableMonthSheetTableFactory=function(l,aS){return new J(l,aS)};function P(l,aS){P.base.call(this,l,aS)}P.prototype={$setCellAction:function(l){return l.onclick(function(){this.$table.selectCell(l)},this)}};$.Class.extend(P,d);$.clickableYearSheetTableFactory=function(l,aS){return new P(l,aS)};var E=function(l,aS){E.base.call(this,l);this.localization(aS);this._onSelect=$.observer()};E.prototype={$findCell:function(l){return null},localization:function(l){return this.property("localization",l)},each:function(aS,l){this.$sheet.listCells().each(aS,l);return this},findCell:function(l){return this.$findCell(l)},selectCell:function(l){if(!$.exists(l)){return this}this._onSelect.notify(l);return this},select:function(l){return this.selectCell(this.findCell(l))},onSelect:function(aS,l){this._onSelect.add(aS,l);return this},destroy:function(){this.$sheet.listCells().each(function(l){if($.exists(l.deallocate)){l.deallocate()}l.clearEvents();return this})}};$.Class.extend(E,$.dom.Class);var h=function(l,aT,aS){this._firstDateOfSheet=x(l);this.$sheet=aS.onCellSelect(this.selectCell,this);h.base.call(this,this.$sheet.dom(),aT);aA(this);Z(this)};h.prototype={$findCell:function(l){return this.$sheet.findCellById(l.toString())}};$.Class.extend(h,E);$.datesheet=function(l,aT,aS){return(new h(l,aT,aS))};function x(l){var aT=l.firstDayOfMonth(),aU=l.firstDayOfMonth(),aS=false;while(aU.day()>0||!aS){if(aU.day()==0){aS=true}aU=aU.prevDay()}return aU}function aA(aT){var aW=aT.localization().day.abbr,aV=aT.$sheet,aU=7,aS=0;while(aS<aU){var l=aW[aS];aV.addColumn(l,{},l);aS++}}function Z(aU){var aV=aU.$sheet,l=aU._firstDateOfSheet,aT=0;while(aT<7){var aS=an(aU,l);l=l.add(0,0,7);aV.addRow($.uid(),aS);aT++}}function an(aS,l){var aT=l,aU={};aS.$sheet.listColumns().each(function(aV){aU[aV.key()]=aT;aT=aT.nextDay()});return aU}var L=function(l,aT,aS){this._firstDateOfSheet=aE(l);this.$sheet=aS.onCellSelect(this.selectCell,this);L.base.call(this,this.$sheet.dom(),aT);e(this);T(this)};L.prototype={$findCell:function(l){return this.$sheet.findCellById(l.month())}};$.Class.extend(L,E);$.monthsheet=function(l,aT,aS){return(new L(l,aT,aS))};function aE(l){return $.dayPoint(l.year(),1,l.date())}function e(aU){var aS=aU.localization().month.abbr,aV=aU.$sheet,l=4,aT=1;while(aT<=l){aV.addColumn(aT,null,"");aT++}}function T(aU){var aV=aU.$sheet,aS=aU._firstDateOfSheet,aT=1;while(aT<=3){var l=F(aU,aS);aS=aS.add(0,4,0);aV.addRow($.uid(),l);aT++}}function F(aS,l){var aT=l,aU={};aS.$sheet.listColumns().each(function(aV){aU[aV.key()]=aT;aT=aT.nextMonth()});return aU}var y=function(l,aT,aS){this._firstDateOfSheet=ah(l);this.$sheet=aS.onCellSelect(this.selectCell,this);y.base.call(this,this.$sheet.dom(),aT);O(this);D(this)};y.prototype={$findCell:function(l){return this.$sheet.findCellById(l.year())}};$.Class.extend(y,E);$.yearsheet=function(l,aT,aS){return(new y(l,aT,aS))};function ah(l){return l.add(-12,0,0)}function O(aU){var l=aU.localization().month.abbr,aV=aU.$sheet,aS=5,aT=0;while(aT<aS){aV.addColumn(aT,null,"");aT++}}function D(aU){var aV=aU.$sheet,l=aU._firstDateOfSheet,aT=0;while(aT<5){var aS=ak(aU,l);l=l.add(5,0,0);aV.addRow($.uid(),aS);aT++}}function ak(aS,l){var aT=l,aU={};aS.$sheet.listColumns().each(function(aV){aU[aV.key()]=aT;aT=aT.nextYear()});return aU}function p(l){p.base.call(this,l);this._id=$.uid("dropper");this._handle=this}p.prototype={id:function(l){return this.get("id")},value:function(l){return this.property("value",l)},handle:function(l){var aS;if($.exists(l)){aS=$.dom(l)}return this.property("handle",aS)},mouseEventId:function(l){return this.property("mouseEventId",l)},touchEventId:function(l){return this.property("touchEventId",l)},};$.Class.extend(p,$.dom.Class);$.dndScreenDropper=function(l){return new p(l)};var X=function(){this._targets=$.hash();this._droppers=$.hash();this._onHit=$.observer();this._lastKnownCoord;this._helper=$.sprite($.create({div:{"class":"ku-dndScreen-helper"}})).onGrab(function(aS){var l=$.touch().canRead(aS)?$.touch():$.mouse();this._lastKnownCoord=l.documentCoord(aS)},this).onDrag(function(aS){var l=$.touch().canRead(aS)?$.touch():$.mouse();this._lastKnownCoord=l.documentCoord(aS)},this).onDrop(function(l){this._drop(l)},this);this._currentDropper};X.prototype={addTarget:function(l){this._targets.add(l.id(),l);return this},removeTarget:function(l){this._targets.remove(l.id(),l);return this},addDropper:function(aT){var aU=$.uid("dropperEvent"),l=$.uid("dropperEvent");function aS(aV){this._currentDropper=aT;this.activateHelper(aV,aT)}aT.mouseEventId(aU).touchEventId(l).handle().onmousedown(aS,this,aU).ontouchstart(aS,this,l);this._droppers.add(aT.id(),aT)},removeDropper:function(l){l.handle().removeEvent(l.touchEventId()).removeEvent(l.mouseEventId());this._droppers.remove(l.id())},activateHelper:function(aS,l){this._helper.appendTo(document.body).pinTo(l.offset().subtract(l.scrollOffset()).add($.window().scrollOffset())).content(l.cloneNode()).grab(aS)},deactivateHelper:function(){this._helper.html("").detach();this._currentDropper=undefined},clearTargets:function(){this._targets.clear();return this},clearDroppers:function(){var l=this._droppers;$.list(l.values()).each(function(aS){this.removeDropper(aS)},this);return this},clearAll:function(){this.clearTargets().clearDroppers();return this},clearListeners:function(){this._onHit.clear();return this},onHit:function(aS,l){this._onHit.add(aS,l);return this},_drop:function(aT){var l=this._findHitTarget(aT),aS=this._currentDropper;if($.exists(l)&&$.exists(aS)){this._onHit.notify(l,aS)}this.deactivateHelper()},_findHitTarget:function(aU){var l=$.list(this._targets.values()),aT=$.touch().canRead(aU)?$.touch():$.mouse(),aS=null,aV;try{aV=aT.documentCoord(aU)}catch(aU){aV=this._lastKnownCoord}l.each(function(aW){if(!aW.contains(aV)){return}aS=aW;l.quit()});return aS}};$.dndScreen=function(){return new X()};function am(l){am.base.call(this,l);this._id=$.uid("target")}am.prototype={id:function(l){return this.get("id")},value:function(l){return this.property("value",l)},contains:function(aT){var aS=this.offset(),l=aS.add(this.outerDims());return $.rectangle(aS,l).contains(aT)}};$.Class.extend(am,$.dom.Class);$.dndScreenTarget=function(l){return new am(l)};function aF(){this._onKeyPressed=$.observer();k.base.call(this,$.create({div:{"class":"ku-keyboard"}}))}aF.prototype={addKey:function(l){$.onScreenKey(l).addClass($.str.format("ku-keyboard-key ku-key-{0}",l)).onPress(this._onKeyPressed.notify,this._onKeyPressed).appendTo(this.dom());return this},onKeyPressed:function(aS,l){this._onKeyPressed.add(aS,l);return this}};$.Class.extend(aF,$.dom.Class);$.onScreenKeyboard=function(){return new aF()};function ag(l){if(!$.isNumber(l)){$.exception("arg",$.str.format("Invalid argument code:{0}",l))}this._value=$.key(l);this._onPress=$.observer();this._onRelease=$.observer();ag.base.call(this,$.create({button:{"class":"ku-keyboard-key"},content:this._value.toString()}));this.onmousedown(function(){this._onPress.notify(this._value)},this).ontouchstart(function(){this._onPress.notify(this._value)},this).onmouseup(function(){this._onRelease.notify(this._value)},this).ontouchend(function(){this._onRelease.notify(this._value)},this)}ag.prototype={onPress:function(aS,l){this._onPress.add(aS,l);return this},onRelease:function(aS,l){this._onRelease.add(aS,l);return this}};$.Class.extend(ag,$.dom.Class);$.onScreenKey=function(l){return new ag(l)};function u(aS){var l=aS||$.create({div:{"class":"ku-sprite"}});u.base.call(this,l);this.to().dragOn().force(0.4).mu(0.8)}u.prototype={force:function(l){return this.property("force",l)},mu:function(l){return this.property("mu",l)},algorithm:function(l){return this.set("algorithm",l)},to:function(){this._isTo=true;return this.algorithm($.anime.algorithms.jump())},spring:function(){this._isTo=false;return this.algorithm($.anime.algorithms.spring(this._force,this._mu))},ease:function(){this._isTo=false;return this.algorithm($.anime.algorithms.ease.linear(this._force,this._mu))},fitTo:function(aT,aS,l){return this._act("fitter",aT,aS,l)},sizeTo:function(aT,aS,l){return this._act("sizer",aT,aS,l)},pinTo:function(aT,aS,l){return this._act("pinner",aT,aS,l)},scrollTo:function(aT,aS,l){return this._act("scroller",aT,aS,l)},fadeTo:function(l,aT,aS){return this._act("fader",l,aT,aS)},growTo:function(aT,aS,l){return this.sizeTo(aT).pinTo(this.boundedOffset().subtract(aT.subtract(this.outerDims()).half()),aS,l)},_act:function(aX,aW,aV,aU){var aS=$[aX](this.dom()).algorithm(this._algorithm),l="_"+aX,aT=this[l];if($.exists(aT)){aT.stop()}if($.exists(aV)){aS.onEnd(aV,aU)}if(this._isTo){this[l]=aS.to(aW)}else{this[l]=aS.moveTo(aW)}return this},tween:function(aS,l){this._styler=$.styler(this.dom(),aS).algorithm(this._algorithm).moveTo(l);return this},clear:function(){if($.exists(this._fader)){this._fader.stop()}if($.exists(this._sizer)){this._sizer.stop()}if($.exists(this._fitter)){this._fitter.stop()}if($.exists(this._pinner)){this._pinner.stop()}if($.exists(this._scroller)){this._scroller.stop()}if($.exists(this._styler)){this._styler.stop()}return this},dragHandle:function(l){return this.property("dragHandle",l)},dragType:function(l){return this.set("dragType",l)},dragOffset:function(l){this._dnd.dragOffset(l);return this},dragger:function(){this._dnd.dragger();return this},sizer:function(){this._dnd.sizer();return this},scroller:function(){this._dnd.scroller();return this},dragOn:function(){this._dnd=$.dnd(this.dom()).onGrab(this.clear,this);return this},dragOff:function(){this._dnd.destroy();return this},onGrab:function(aS,l,aT){this._dnd.onGrab(aS,l,aT);return this},onDrag:function(aS,l,aT){this._dnd.onDrag(aS,l,aT);return this},onDrop:function(aS,l,aT){this._dnd.onDrop(aS,l,aT);return this},bearingUp:function(){return this._dnd.bearingUp()},bearingDown:function(){return this._dnd.bearingDown()},bearingLeft:function(){return this._dnd.bearingLeft()},bearingRight:function(){return this._dnd.bearingRight()},grab:function(l){this._dnd.grab(l);return this},drag:function(l){this._dnd.drag(l);return this},drop:function(l){this._dnd.drop(l);return this},constrainX:function(){this._dnd.constrainX();return this},unconstrainX:function(){this._dnd.unconstrainX();return this},constrainY:function(){this._dnd.constrainY();return this},unconstrainY:function(){this._dnd.unconstrainY();return this}};$.Class.extend(u,$.dom.Class);$.sprite=function(l){return new u(l)};$.sprite.Class=u;var aJ=function(l,aS){this.$offset=0;this.$multiplier=aS;this._tooltip=l;this.overlap(0)};aJ.prototype={$above:function(l,aT,aS){return},$below:function(l,aT,aS){return},$leftOf:function(l,aT,aS){return},$rightOf:function(l,aT,aS){return},overlap:function(l){return this.set("overlap",l)},above:function(aV){var aT=this._tooltip,l=aT.context(aV).context(),aU=aT.pointer(),aS=aT.tooltip();this.$offset=this._overlap;this.$above(l,aU,aS);return this},below:function(aV){var aT=this._tooltip,l=aT.context(aV).context(),aU=aT.pointer(),aS=aT.tooltip();this.$offset=this._overlap;this.$below(l,aU,aS);return this},leftOf:function(aV){var aT=this._tooltip,l=aT.context(aV).context(),aU=aT.pointer(),aS=aT.tooltip();this.$offset=this._overlap;this.$leftOf(l,aU,aS);return this},rightOf:function(aV){var aT=this._tooltip,l=aT.context(aV).context(),aU=aT.pointer(),aS=aT.tooltip();this.$offset=this._overlap;this.$rightOf(l,aU,aS);return this}};$.Class.extend(aJ,$.Class);var aQ=function(l,aS){aQ.base.call(this,l,0.5)};aQ.prototype={$above:function(l,aT,aS){aT.pinTo(l.offset().subtract(aT.outerHeight()).add($.coord(l.outerDims().subtract(aT.outerDims()).x()*this.$multiplier,0)));aS.pinTo(aT.offset().subtract(aS.outerHeight()).add($.coord(0,this.$offset)).add($.coord(aT.outerDims().subtract(aS.outerDims()).x()*this.$multiplier,0)));aT.fadeTo(100);aS.fadeTo(100);return this},$below:function(l,aT,aS){aT.pinTo(l.offset().add(l.outerHeight()).add($.coord(l.outerDims().subtract(aT.outerDims()).x()*this.$multiplier,0)));aS.pinTo(aT.offset().add(aT.outerHeight()).subtract($.coord(0,this.$offset)).add($.coord(aT.outerDims().subtract(aS.outerDims()).x()*this.$multiplier,0)));aT.fadeTo(100);aS.fadeTo(100);return this},$leftOf:function(l,aT,aS){aT.pinTo(l.offset().subtract(aT.outerWidth()).add($.coord(0,l.outerDims().subtract(aT.outerDims()).y()*this.$multiplier)));aS.pinTo(aT.offset().subtract(aS.outerWidth()).add($.coord(this.$offset,0)).add($.coord(0,aT.outerDims().subtract(aS.outerDims()).y()*this.$multiplier)));aT.fadeTo(100);aS.fadeTo(100);return this},$rightOf:function(l,aT,aS){aT.pinTo(l.offset().add(l.outerWidth()).add($.coord(0,l.outerDims().subtract(aT.outerDims()).y()*this.$multiplier)));aS.pinTo(aT.offset().add(aT.outerWidth()).subtract($.coord(this.$offset,0)).add($.coord(0,aT.outerDims().subtract(aS.outerDims()).y()*this.$multiplier)));aT.fadeTo(100);aS.fadeTo(100);return this}};$.Class.extend(aQ,aJ);var aw=function(l,aS){aw.base.call(this,l,0)};aw.prototype={$above:function(l,aT,aS){aT.pinTo(l.offset().subtract(aT.outerHeight()).add($.coord(this.$offset,0)).add($.coord(l.outerDims().subtract(aT.outerDims()).x()*this.$multiplier,0)));aS.pinTo(aT.offset().subtract(aS.outerHeight()).add($.coord(-this.$offset,this.$offset)).add($.coord(aT.outerDims().subtract(aS.outerDims()).x()*this.$multiplier,0)));aT.fadeTo(100);aS.fadeTo(100);return this},$below:function(l,aT,aS){aT.pinTo(l.offset().add(l.outerHeight()).add($.coord(this.$offset,0)).add($.coord(l.outerDims().subtract(aT.outerDims()).x()*this.$multiplier,0)));aS.pinTo(aT.offset().add(aT.outerHeight()).subtract($.coord(this.$offset,this.$offset)).add($.coord(aT.outerDims().subtract(aS.outerDims()).x()*this.$multiplier,0)));aT.fadeTo(100);aS.fadeTo(100);return this},$leftOf:function(l,aT,aS){aT.pinTo(l.offset().subtract(aT.outerWidth()).add($.coord(0,this.$offset)).add($.coord(0,l.outerDims().subtract(aT.outerDims()).y()*this.$multiplier)));aS.pinTo(aT.offset().subtract(aS.outerWidth()).add($.coord(this.$offset,-this.$offset)).add($.coord(0,aT.outerDims().subtract(aS.outerDims()).y()*this.$multiplier)));aT.fadeTo(100);aS.fadeTo(100);return this},$rightOf:function(l,aT,aS){aT.pinTo(l.offset().add(l.outerWidth()).add($.coord(0,this.$offset)).add($.coord(0,l.outerDims().subtract(aT.outerDims()).y()*this.$multiplier)));aS.pinTo(aT.offset().add(aT.outerWidth()).subtract($.coord(this.$offset,this.$offset)).add($.coord(0,aT.outerDims().subtract(aS.outerDims()).y()*this.$multiplier)));aT.fadeTo(100);aS.fadeTo(100);return this}};$.Class.extend(aw,aJ);var aj=function(l,aS){aj.base.call(this,l,1)};aj.prototype={$above:function(l,aT,aS){aT.pinTo(l.offset().subtract(aT.outerHeight()).add($.coord(-this.$offset,0)).add($.coord(l.outerDims().subtract(aT.outerDims()).x()*this.$multiplier,0)));aS.pinTo(aT.offset().subtract(aS.outerHeight()).add($.coord(this.$offset,this.$offset)).add($.coord(aT.outerDims().subtract(aS.outerDims()).x()*this.$multiplier,0)));aT.fadeTo(100);aS.fadeTo(100);return this},$below:function(l,aT,aS){aT.pinTo(l.offset().add(l.outerHeight()).add($.coord(-this.$offset,0)).add($.coord(l.outerDims().subtract(aT.outerDims()).x()*this.$multiplier,0)));aS.pinTo(aT.offset().add(aT.outerHeight()).add($.coord(this.$offset,-this.$offset)).add($.coord(aT.outerDims().subtract(aS.outerDims()).x()*this.$multiplier,0)));aT.fadeTo(100);aS.fadeTo(100);return this},$leftOf:function(l,aT,aS){aT.pinTo(l.offset().subtract(aT.outerWidth()).add($.coord(0,-this.$offset)).add($.coord(0,l.outerDims().subtract(aT.outerDims()).y()*this.$multiplier)));aS.pinTo(aT.offset().subtract(aS.outerWidth()).add($.coord(this.$offset,this.$offset)).add($.coord(0,aT.outerDims().subtract(aS.outerDims()).y()*this.$multiplier)));aT.fadeTo(100);aS.fadeTo(100);return this},$rightOf:function(l,aT,aS){aT.pinTo(l.offset().add(l.outerWidth()).add($.coord(0,-this.$offset)).add($.coord(0,l.outerDims().subtract(aT.outerDims()).y()*this.$multiplier)));aS.pinTo(aT.offset().add(aT.outerWidth()).add($.coord(-this.$offset,this.$offset)).add($.coord(0,aT.outerDims().subtract(aS.outerDims()).y()*this.$multiplier)));aT.fadeTo(100);aS.fadeTo(100);return this}};$.Class.extend(aj,aJ);var z=function(){z.base.call(this);this.pointer($.sprite($.create({div:{"class":"ku-tooltip-pointer"}})).hide().dragOff().to()).tooltip($.sprite($.create({div:{"class":"ku-tooltip"}})).hide().dragOff().to()).leftJustify();this._id=$.uid("tip");this._onShow=$.observer();this._onHide=$.observer()};z.prototype={calibrate:function(l){return this.property("calibrate",l)},pointer:function(l){return this.property("pointer",l)},tooltip:function(l){return this.property("tooltip",l)},strategy:function(l){return this.property("strategy",l)},message:function(l){return this.property("message",l)},context:function(aS){var l=($.exists(aS))?$.dom(aS):aS;return this.property("context",l)},center:function(){return this.strategy(new aQ(this))},leftJustify:function(){return this.strategy(new aw(this))},rightJustify:function(){return this.strategy(new aj(this))},onShow:function(aS,l){this._onShow.add(aS,l);return this},onHide:function(aS,l){this._onHide.add(aS,l);return this},show:function(aT){var l=aT||this._message,aS=l||"";this._pointer.fadeTo(0).appendTo(document.body).show();this._tooltip.fadeTo(0).appendTo(document.body).html("").content(aS).show();this._onShow.notify();return this},hide:function(){this._pointer.hide().detach();this._tooltip.hide().detach();this._onHide.notify();return this},at:function(aX,a6){var a4=$.window(),aZ=$.dom(aX),aV=$.point.zero(),aT=a4.dims(),a2=aZ.offset(),a1=a2.add(aZ.outerDims()),aS=this._tooltip.outerDims(),aY=a1.add(aS),a5=a2.subtract(aS),aW=!aY.isRightOf(aT),a3=!aY.isBelow(aT),l=!a5.isLeftOf(aV),a0=!a5.isAbove(aV),aU={rightOf:aW,below:a3,leftOf:l,above:a0};if(aU[a6[0]]){return this[a6[0]](aX)}if(aU[a6[1]]){return this[a6[1]](aX)}if(aU[a6[2]]){return this[a6[2]](aX)}if(aU[a6[3]]){return this[a6[3]](aX)}return this.rightOf(aX)},above:function(l){return this._locate(l,"bottom","above")},below:function(l){return this._locate(l,"top","below")},leftOf:function(l){return this._locate(l,"right","leftOf")},rightOf:function(l){return this._locate(l,"left","rightOf")},_locate:function(aT,aS,l){this.strategy().overlap(aO(this,aS))[l](aT);aL(this,l);this._pointer.fadeTo(100);this._tooltip.fadeTo(100);return this}};$.Class.extend(z,$.Class);$.tooltip=function(){return new z()};function aO(aT,aS){var l=aT.tooltip().style($.str.format("border-{0}-width",aS));return $.ku.style.toNumber(l)}function aL(aT,l){var aU="ku-{0}",aS=["above","below","leftOf","rightOf"],aV=aT.pointer();for(var aW in aS){aV.removeClass($.str.format(aU,aS[aW]))}aV.addClass($.str.format(aU,l))}})(jQuery);