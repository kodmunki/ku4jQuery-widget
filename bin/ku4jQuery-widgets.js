(function(V){$=V;$.DomClass=function(l){$.DomClass.base.call(this);if(!$.exists(l)){$.ku4exception("$.dom","$.DomClass requires valid DOM node.")}this.dom(l)};$.DomClass.prototype={dom:function(l){return this.property("dom",l)}};$.Class.extend($.DomClass,$.Class);var P={css:{addClass:function(aa,l){var Z=$.ele(aa),ab=Z.className;if($.ku.css.hasClass(aa,l)){return}Z.className+=(/^[^\s]/.test(ab))?(" "+l):l},hasClass:function(Z,l){if(!$.exists(l)){return false}return(new RegExp(l)).test(($.ele(Z)).className)},removeClass:function(aa,l){var Z=$.ele(aa),ab=Z.className;if(!$.ku.css.hasClass(aa,l)){return}Z.className=$.str.trim(ab.replace(new RegExp("(^|\\s)"+l+"(?![\\w\\-])"),""))}},getText:function(Z){var l=$.ele(Z);return l.textContent||l.innerText},quirks:{setOpacity:function(aa,Z){var l=Z/100;aa.style.opacity=l;aa.style["-moz-opacity"]=l;aa.style["-webkit-opacity"]=l;aa.style.filter=$.str.format("alpha(opacity={0})",Z)},clearOpacity:function(l){$.ku.style.set(l,{opacity:null,"-moz-opacity":null,"-webkit-opacity":null,filter:null})}},ready:function(Z,l){_funcs[_funcs.length]={f:Z,b:l||false}},redraw:function(ab){var aa=$.ele(ab)||document.documentElement,Z=aa.style.display||"";aa.style.display="none";var l=aa.offsetHeight;aa.style.display=Z},style:{set:function(ae,aa,ab){var ad=$.ele(ae);function l(ag){return(/\-/.test(ag))?ag.replace(/\-\w/,ag.charAt(ag.indexOf("-")+1).toUpperCase()):ag}if($.isString(aa)){try{ad.style[l(aa)]=ab}catch(ac){}}for(var af in aa){var Z=l(af);if(/opacity/i.test(Z)){$.ku.quirks.setOpacity(ae,aa[af]);continue}try{ad.style[Z]=aa[af]}catch(ac){continue}}},get:function(ae,ab){var ad=$.ele(ae);function l(ai,ag){var af=(/\-/.test(ag))?ag.replace(/\-\w/,ag.charAt(ag.indexOf("-")+1).toUpperCase()):ag;try{return window.getComputedStyle(ai,null).getPropertyValue(ag)}catch(ah){return($.exists(ai.currentStyle))?ai.currentStyle[ag]:($.exists(ai.style))?ai.style[af]:""}}if(/opacity/i.test(ab)){var Z=l(ad,ab);if($.exists(Z)){return parseFloat(Z)*100}else{var aa=/alpha\(opacity=\d+(\.\d+)?\)/i.exec(ad.style.filter);if(!$.exists(aa)){return 100}var ac=/\d+(\.\d+)?/i.exec(aa[0]);if(!$.exists(ac)){return 100}return parseFloat(ac[0])}}return l(ad,ab)},toNumber:function(l){return isNaN(l)?0:parseFloat(this.stripUnit(l))},stripUnit:function(l){return($.exists(l)&&$.exists(l.replace))?l.replace(/[^\-\.\d]/g,""):l},getUnit:function(l){return l.match(/[^\-\.\d]{2}/)[0]}},swapDom:function(aa,Z){var l=$.ele(aa);f=$.ele(Z);l.parentNode.replaceChild(f,l)}};$.ku=P;$.clearNode=function(Z){var l=$.ele(Z);if(!l){return}while(l.hasChildNodes()){l.removeChild(l.firstChild)}};$.create=function(af){if(!af){return null}var Z=($.isString(af))?{x:{}}:af,ah,ad;for(var aa in Z){if(aa=="content"){continue}ah=document.createElement(aa);attrs=Z[aa]}for(var aa in attrs){var ag=attrs[aa];if(/class/i.test(aa)){$.ku.css.addClass(ah,ag);continue}if(/style/i.test(aa)){$.ku.style.set(ah,ag);continue}ah.setAttribute(aa,ag)}try{var ae=Z.content;if(!ae){return ah}var ab=(!ae)?1:ae.length;if($.exists(ae.nodeName)){ah.appendChild(ae);return ah}if(!$.isArray(ae)){ah.innerHTML+=ae;return ah}while(ab--){var l=ae[ab];if($.isString(l)||!isNaN(l)){ah.innerHTML+=l;continue}var Z=(l.hasOwnProperty("appendChild"))?l:$.create(l);ah.appendChild(Z)}}catch(ac){}finally{return ah}};$.ele=function(l){if(!l){return null}return($.isEvent(l))?$.evt.ele(l):($.isString(l))?document.getElementById(l):($.exists(l.dom))?l.dom:l};var g=function(ac,Z,ab,aa,l){this.dom=ac;this.evt=Z;this.action=ab;this.scope=aa;this.bubbles=l};$.evt={add:function(Z,af,l,ag,aa){if(!$.ele(Z)){$.ku4exception("$.evt",$.str.format("argument dom == {0} at $.evt.add",Z))}var ac=$.ele(Z),ab=af,ah=ag||ac,ad=aa||false,ae=function(){l.apply(ah,arguments)};if($.exists(ac.addEventListener)){ac.addEventListener(ab,ae,ad)}else{if($.exists(ac.attachEvent)){ac.attachEvent("on"+ab,ae)}else{ac["on"+ab]=ae}}return new g(ac,ab,ae,ah,ad)},remove:function(ab){var ad=ab.dom,ac=ab.evt,aa=ab.scope,l=ab.bubbles,Z=ab.action;if(ad.removeEventListener){ad.removeEventListener(ac,Z,l)}else{if(ad.detachEvent){ad.detachEvent("on"+ac,Z)}else{ad["on"+ac]=null}}return this},ele:function(l){try{return(l.srcElement)?l.srcElement:l.target}catch(l){return null}},mute:function(l){if($.exists(l.preventDefault)){l.preventDefault()}if($.exists(l.stopPropogation)){l.stopPropogation()}l.returnValue=false;l.cancelBubble=true;return this}};$.findOuterDims=function(Z){var l=$.ele(Z);return{width:l.offsetWidth,height:l.offsetHeight}},$.findInnerDims=function(Z){var l=$.ele(Z);return{width:l.clientWidth,height:l.clientHeight}},$.findOffset=function(aa){var Z=$.ele(aa),l=0,ab=0;if(!Z){return null}do{l+=Z.offsetLeft;ab+=Z.offsetTop}while((function(){try{Z=Z.offsetParent}catch(ac){Z=null}return $.exists(Z)})());return{left:l,top:ab}};$.findBoundedOffset=function(Z){var l=$.ele(Z);if(!l){return null}return{left:l.offsetLeft,top:l.offsetTop}},$.findScrollDims=function(Z){var l=$.ele(Z);return{width:l.scrollWidth,height:l.scrollHeight}};$.findScrollOffset=function(aa){var Z=$.ele(aa),l=0,ab=0;if(!Z){return null}do{l+=Z.scrollLeft||0;ab+=Z.scrollTop||0}while((function(){try{Z=Z.parentNode}catch(ac){Z=null}return $.exists(Z)})());return{left:l,top:ab}};var e=function(Z){this._navigator=Z;agents={_isIE:"MSIE",_isNetscape:"Netscape",_isFirefox:"Firefox",_isOpera:"Opera",_isSafari:"Safari",_isChrome:"Chrome"};this._isIE=false;this._isNetscape=false;this._isFirefox=false;this._isOpera=false;this._isSafari=false;this._isChrome=false;this._isUnknown=true;this._version="";if(!$.isObject(Z)){return}var Z=this._navigator,ab=Z.userAgent;function ad(af){return !$.isNullOrEmpty(ab)&&(new RegExp(af,"i")).test(ab)}function aa(aj){try{var ag=(new RegExp("Version\\/(\\d+\\.?){1,}","i")).exec(ab),ah=(new RegExp(aj+"\\/(\\d+\\.?){1,}","i")).exec(ab),af=$.exists(ag)?ag:ah;return(new RegExp("(\\d+\\.?){1,}")).exec(af[0])[0]}catch(ai){return""}}var ae,l,ac;for(ae in agents){ac=agents[ae];l=ad(ac);if(!l){continue}this[ae]=l;this._version=aa(ac);this._isUnknown=false}this._fullVersion=Z.appVersion;this._platform=Z.platform;this._allInfo=this._fullVersion+this._platform};e.prototype={isIE:function(){return this._isIE},isNetscape:function(){return this._isNetscape},isFirefox:function(){return this._isFirefox},isOpera:function(){return this._isOpera},isSafari:function(){return this._isSafari&&!this._isChrome},isChrome:function(){return this._isChrome},isUnknown:function(){return this._isUnknown},platform:function(){return this._platform},fullVersion:function(){return this._fullVersion},version:function(){return this._version}};var q;$.ku.browser=function(){if($.exists(q)){return q}q=new e(navigator);return q};$.ku.browser.Class=e;var c=function(l){c.base.call(this,$.ele(l));var Z=this.style("display")||"block";this._display=(/none/i.test(Z))?"block":Z;this._liveEvents=$.hash()};c.prototype={attribute:function(l,Z){var aa=this.dom();if($.isUndefined(Z)){return aa.getAttribute(l)}aa.setAttribute(l,Z);return this},addClass:function(l){$.ku.css.addClass(this.dom(),l);return this},removeClass:function(l){$.ku.css.removeClass(this.dom(),l);return this},hasClass:function(l){$.ku.css.hasClass(this.dom(),l);return this},style:function(Z,l){if($.isString(Z)&&!$.exists(l)){return $.ku.style.get(this.dom(),Z)}$.ku.style.set(this.dom(),Z,l);return this},value:function(l){if(!$.exists(l)){return this.dom().value}this.dom().value=l;return this},content:function(l){if(!$.exists(l)){return this}if($.isNumber(l)||$.isString(l)){return this.html(l)}return this.appendChild(l)},cloneNode:function(l){return this._dom.cloneNode(l||true)},html:function(l){if(!$.exists(l)){return this.dom().innerHTML}this.dom().innerHTML=l;return this},text:function(l){if(!$.exists(l)){return $.ku.getText(this.dom())}$.ku.setText(this.dom(),l);return this},prependChild:function(Z){var aa=this.dom(),l=aa.firstChild;if($.exists(l)){aa.insertBefore(Z,l)}else{aa.appendChild(Z)}return this},appendChild:function(l){this.dom().appendChild(l);return this},removeChild:function(l){this.dom().removeChild(l);return this},insertBefore:function(l){l.parentNode.insertBefore(this.dom(),l);return this},insertAfter:function(l){if($.exists(l.nextSibling)){l.parentNode.insertBefore(this.dom(),l.nextSibling)}else{l.parentNode.appendChild(this.dom())}return this},appendTo:function(l){l.appendChild(this.dom());return this},detach:function(){try{var Z=this.dom();Z.parentNode.removeChild(Z)}catch(l){}finally{return this}},innerDims:function(l){if(!$.exists(l)){return $.coord.parse($.findInnerDims(this.dom()))}var Z=l.toPixel();this.style({width:Z.x(),height:Z.y()});return this},outerDims:function(Z){if(!$.exists(Z)){return $.coord.parse($.findOuterDims(this.dom()))}var l=this.outerDims().subtract(this.innerDims());return this.innerDims(Z.subtract(l))},innerWidth:function(l){var Z=this.innerDims();if(!$.exists(l)){return $.coord(Z.x(),0)}return this.innerDims($.coord(l,Z.y()))},innerHeight:function(l){var Z=this.innerDims();if(!$.exists(l)){return $.coord(0,Z.y())}return this.innerDims($.coord(Z.x(),l))},outerWidth:function(l){var Z=this.outerDims();if(!$.exists(l)){return $.coord(Z.x(),0)}return this.outerDims($.coord(l,Z.y()))},outerHeight:function(l){var Z=this.outerDims();if(!$.exists(l)){return $.coord(0,Z.y())}return this.outerDims($.coord(Z.x(),l))},boundedOffset:function(){return $.coord.parse($.findBoundedOffset(this.dom()))},layoutDims:function(){var l=this.dom().parentNode;if(!$.exists(l)){return $.coord.zero()}var Z=$.dom(l);return Z.outerDims().subtract(Z.innerDims()).half()},offset:function(){return $.coord.parse($.findOffset(this.dom()))},center:function(){return this.offset().add(this.outerDims().half())},scrollDims:function(){return $.coord.parse($.findScrollDims(this.dom()))},scrollOffset:function(){return $.coord.parse($.findScrollOffset(this.dom()))},clear:function(){$.clearNode(this.dom());return this},redraw:function(){$.ku.redraw(this.dom());return this},swap:function(l){$.ku.swapDom(this.dom(),l.dom());return l},show:function(){this.style({display:this._display});return this},hide:function(){this.style({display:"none"});return this},isVisible:function(){var l=this.offset(),Z=this.offset().add(this.innerDims());return $.exists(this.dom().parentNode)&&!/NONE|^$/i.test(this.style("display"))&&$.window().scrollOffset().isLeftOf(Z)&&$.window().scrollOffset().isAbove(Z)&&$.window().scrollDims().isRightOf(l)&&$.window().scrollDims().isBelow(l)},onmouseover:function(l,aa,Z){return this._addEvent("mouseover",l,aa,Z)},onmouseout:function(l,aa,Z){return this._addEvent("mouseout",l,aa,Z)},onmousedown:function(l,aa,Z){return this._addEvent("mousedown",l,aa,Z)},onmouseup:function(l,aa,Z){return this._addEvent("mouseup",l,aa,Z)},onmousemove:function(l,aa,Z){return this._addEvent("mousemove",l,aa,Z)},onclick:function(l,aa,Z){return this._addEvent("click",l,aa,Z)},ondoubleclick:function(l,aa,Z){return this._addEvent("dblclick",l,aa,Z)},onkeydown:function(l,aa,Z){return this._addEvent("keydown",l,aa,Z)},onkeyup:function(l,aa,Z){return this._addEvent("keyup",l,aa,Z)},onkeypress:function(l,aa,Z){return this._addEvent("keypress",l,aa,Z)},onblur:function(l,aa,Z){return this._addEvent("blur",l,aa,Z)},onchange:function(l,aa,Z){return this._addEvent("change",l,aa,Z)},onerror:function(l,aa,Z){return this._addEvent("error",l,aa,Z)},onfocus:function(l,aa,Z){return this._addEvent("focus",l,aa,Z)},onload:function(l,aa,Z){return this._addEvent("load",l,aa,Z)},onresize:function(l,aa,Z){return this._addEvent("resize",l,aa,Z)},onscroll:function(l,aa,Z){return this._addEvent("scroll",l,aa,Z)},onselect:function(l,aa,Z){return this._addEvent("select",l,aa,Z)},onresize:function(l,aa,Z){return this._addEvent("resize",l,aa,Z)},onunload:function(l,aa,Z){return this._addEvent("unload",l,aa,Z)},onorientationchange:function(l,aa,Z){return this._addEvent("orientationchange",l,aa,Z)},ontouchstart:function(l,aa,Z){return this._addEvent("touchstart",l,aa,Z)},ontouchend:function(l,aa,Z){return this._addEvent("touchend",l,aa,Z)},ontouchmove:function(l,aa,Z){return this._addEvent("touchmove",l,aa,Z)},removeEvent:function(Z){var l=this._liveEvents.find(Z);if(!$.exists(l)){return this}return this._removeEvent(l,Z)},clearEvents:function(){this._liveEvents.listValues().each(function(l){this._removeEvent(l)},this);return this},_addEvent:function(aa,Z,ad,ac){var l=ac||$.uid("evt"),ab=this._liveEvents;if(ab.containsKey(l)){return this}ab.add(l,$.evt.add(this.dom(),aa,Z,ad));return this},_removeEvent:function(l,Z){$.evt.remove(l);this._liveEvents.remove(Z);return this}};$.Class.extend(c,$.DomClass);$.dom=function(l){return new c(l)};$.dom.parseHtml=function(l){var Z=$.create({div:{},content:l});if(Z.childNodes.length!=1){return null}return $.dom(Z.firstChild)};$.dom.Class=c;function Y(){Y.base.call(this);this._body=$.dom(document.body)}Y.prototype={isDisabled:function(){return this.get("disabled")},isPortrait:function(){return this.orientation.isLandscape()},isLandscape:function(){return Math.abs(window.orientation)==90},disable:function(){this._disabled=true;document.body.appendChild(u);return this},enable:function(){if(!this.isDisabled()){return this}document.body.removeChild(u);this._disabled=false;return this},dims:function(){var l=window.innerWidth||document.documentElement.clientWidth,Z=window.innerHeight||document.documentElement.clientHeight;return $.coord(l,Z)},center:function(){return this.dims().divide($.coord(2,2))},scrollOffset:function(){var ab=document.documentElement,Z=document.body,l=Math.max(ab.scrollLeft,Z.scrollLeft),aa=Math.max(ab.scrollTop,Z.scrollTop);return $.coord(l,aa)},scrollDims:function(){var ab=document.documentElement,Z=document.body,l=Math.max(ab.scrollWidth,Z.scrollWidth),aa=Math.max(ab.scrollHeight,Z.scrollHeight);return $.coord(l,aa)},scrollCenter:function(){return this.center().add(this.scrollOffset())},contains:function(aa){var Z=this.scrollOffset(),l=this.scrollDims();return !(aa.isAbove(Z)||aa.isLeftOf(Z)||aa.isRightOf(l)||aa.isBelow(l))},redraw:function(){$.ku.redraw(document.body);$.ku.redraw(document.documentElement);return this},onmousedown:function(l,aa,Z){return this._body.onmousedown(l,aa,Z)},onmouseup:function(l,aa,Z){return this._body.onmouseup(l,aa,Z)},ontouchstart:function(l,aa,Z){return this._body.ontouchstart(l,aa,Z)},ontouchend:function(l,aa,Z){return this._body.ontouchend(l,aa,Z)},onclick:function(l,aa,Z){return this._body.onclick(l,aa,Z)},ondoubleclick:function(l,aa,Z){return this._body.ondoubleclick(l,aa,Z)},onkeydown:function(l,aa,Z){return this._body.onkeydown(l,aa,Z)},onkeyup:function(l,aa,Z){return this._body.onkeyup(l,aa,Z)},scrollTo:function(l){window.scrollTo(l.x(),l.y());return this},onresize:function(l,aa,Z){z.add(l,aa,Z);return this},onscroll:function(l,aa,Z){T.add(l,aa,Z);return this},onspin:function(l,aa,Z){M.add(l,aa,Z);return this},remove:function(l){z.remove(l);T.remove(l);M.remove(l);this._body.removeEvent(l);return this}};$.Class.extend(Y,$.Class);var u=$.create({div:{"class":"ku-window-disabled"}}),z=$.observer(),T=$.observer(),M=$.observer(),a=function(){};a.prototype={uri:function(l){return this.property("uri",l)},offset:function(l){return this.property("offset",l)},dims:function(l){return this.property("dims",l)},channelmode:function(l){return this.property("channelmode",l)},directories:function(l){return this.property("directories",l)},fullscreen:function(l){return this.property("fullscreen",l)},location:function(l){return this.property("location",l)},menubar:function(l){return this.property("menubar",l)},scrollbars:function(l){return this.property("scrollbars",l)},titlebar:function(l){return this.property("titlebar",l)},toolbar:function(l){return this.property("toolbar",l)},open:function(){}};$.Class.extend(a,$.Class);var U;$.window=function(){if($.exists(U)){return U}$.evt.add(window,"resize",function(){z.notify()});$.evt.add(window,"scroll",function(){T.notify()});$.evt.add(window,"orientationchange",function(){M.notify()});U=new Y();return U};$.ku.equations={cycle:function(aa,ac,ab,Z,l){return new $.coord(this.sin(aa.x,ac,ab),this.cos(aa.y,Z,l))},cos:function(aa,Z,l){return aa+Math.cos(Z)*l},cosH:function(aa,Z,l){return new $.coord(this.cos(aa.x,Z,l),aa.y)},cosV:function(aa,Z,l){return new $.coord(aa.x,this.cos(aa.y,Z,l))},sin:function(aa,Z,l){return aa+Math.sin(Z)*l},sinH:function(aa,Z,l){return new $.coord(this.sin(aa.x,Z,l),aa.y)},sinV:function(aa,Z,l){return new $.coord(aa.x,this.sin(aa.y,Z,l))}};$.anime={algorithms:{ease:{}}};var N=function(l){this._ease=l||0.1};N.prototype={calculate:function(Z,l){return(l-Z)*this._ease}};$.anime.algorithms.ease.linear=function(l){return new N(l)};var m=function(){};m.prototype={calculate:function(Z,l){return l-Z}};$.anime.algorithms.jump=function(){return new m()};var A=function(Z,l){this._spring=Z||0.4;this._mu=l||0.6};A.prototype={calculate:function(ae,aa,ad){var Z=this._spring,ab=ad,l=this._mu,af=aa-ae,ac=af*Z;ab+=ac;ab*=l;return ab}};$.anime.algorithms.spring=function(Z,l){return new A(Z,l)};function E(l){this._context=l}E.prototype={findCoord:function(aa){var l=this._context,Z=$.touch().canRead(aa)?$.touch():$.mouse();return Z.documentCoord(aa).subtract(l.hitCoord()).subtract(l.hitOffset()).add(l.hitBoundedOffet())}};function F(l){this._context=l}F.prototype={findCoord:function(aa){var l=this._context,Z=$.touch().canRead(aa)?$.touch():$.mouse();return l.hitSize().add(Z.documentCoord(aa).subtract(l.hitCoord()).subtract(l.hitOffset()))}};function i(l){this._context=l}i.prototype={findCoord:function(aa){var l=this._context,Z=$.touch().canRead(aa)?$.touch():$.mouse();return l.hitCoord().add(l.hitOffset()).subtract(Z.documentCoord(aa)).add(l.hitScrollOffset())}};var I={};function x(l){x.base.call(this,l);this._mouseEvt=$.uid("dragger");this._touchEvt=$.uid("toucher");this._documentBody=$.dom(document.body);this._onGrab=$.observer();this._onDrag=$.observer();this._onDrop=$.observer();this._constrainX=false;this._constrainY=false;this._boundX=0;this._boundY=0;this._lastPoint=$.coord.zero();this._bearing=$.vector.zero();this._document=$.dom(document);this.state(new I.dropped()).dragger().dragOffset($.coord.zero()).ontouchstart(this.grab,this,this._touchEvt).onmousedown(this.grab,this,this._mouseEvt)}x.prototype={document:function(){return this._document},hitSize:function(l){return this.property("hitSize",l)},hitCoord:function(l){return this.property("hitCoord",l)},hitOffset:function(l){return this.property("hitOffset",l)},dragOffset:function(l){return this.property("dragOffset",l)},hitScrollOffset:function(l){return this.property("hitScrollOffset",l)},hitBoundedOffet:function(l){return this.property("hitBoundedOffet",l)},actor:function(){return this.get("actor")},strategy:function(){return this.get("strategy")},bearing:function(){return this.get("bearing")},bearingUp:function(){return this.bearing().y()<0},bearingDown:function(){return this.bearing().y()>0},bearingLeft:function(){return this.bearing().x()<0},bearingRight:function(){return this.bearing().x()>0},constrainX:function(){if(this._constrainX){return this}this._constrainX=true;this._boundX=this.boundedOffset().x();return this},unconstrainX:function(){this._constrainX=false},constrainY:function(){if(this._constrainY){return this}this._constrainY=true;this._boundY=this.boundedOffset().y();return this},unconstrainY:function(){this._constrainY=false},state:function(l){return this.set("state",l.context(this))},dragCoord:function(ab){var ad=this.strategy().findCoord(ab),aa=this.dragOffset(),Z=(this._constrainX)?this._boundX:ad.x()+aa.x(),ac=(this._constrainY)?this._boundY:ad.y()+aa.y(),l=$.point(Z,ac);this._bearing=l.distanceFrom(this._lastPoint);this._lastPoint=l;return l},dragger:function(){return this.set("actor",$.pinner(this.dom())).set("strategy",new E(this))._setType("dragger")},sizer:function(){return this.set("actor",$.sizer(this.dom())).set("strategy",new F(this))._setType("sizer")},scroller:function(){return this.set("actor",$.scroller(this.dom())).set("strategy",new i(this))._setType("scroller")},grab:function(l){this._onGrab.notify(l);this._state.grab(l);return this},drag:function(l){this._onDrag.notify(l);this._state.drag(l);return this},drop:function(l){this._onDrop.notify(l);this._state.drop(l);this._bearing=$.vector.zero();return this},onGrab:function(Z,l,aa){this._onGrab.add(Z,l,aa);return this},onDrag:function(Z,l,aa){this._onDrag.add(Z,l,aa);return this},onDrop:function(Z,l,aa){this._onDrop.add(Z,l,aa);return this},destroy:function(){this._onGrab.clear();this._onDrag.clear();this._onDrop.clear();this.removeEvent(this._mouseEvt).removeEvent(this._touchEvt)},disableSelect:function(Z){document.onselectstart=function(){return false};if(!$.exists(window.getSelection)){return this}this._mouseDisableId=$.uid("disable");this._touchDisableId=$.uid("disable");function l(){window.getSelection().removeAllRanges()}this._documentBody.onmousemove(l,null,this._mouseDisableId).ontouchmove(l,null,this._touchDisableId);return this},enableSelect:function(){document.onselectstart=null;var l=this._mouseDisableId,Z=this._touchDisableId,aa=this._documentBody;if($.exists(l)){aa.removeEvent(l)}if($.exists(Z)){aa.removeEvent(Z)}this._mouseDisableId=null;this._touchDisableId=null;return this},_setType:function(l){this._clearType().addClass($.str.format("ku-dragger-{0}",l));return this},_clearType:function(){this.removeClass("ku-dragger-dragger").removeClass("ku-dragger-sizer").removeClass("ku-dragger-scoller");return this}};$.Class.extend(x,$.dom.Class);$.dnd=function(l){return new x(l)};I.dropped=function(){I.dropped.base.call(this,I)};I.dropped.prototype={grab:function(ab){$.evt.mute(ab);var l=this.context(),aa=$.touch().canRead(ab)?$.touch():$.mouse(),Z=aa.documentCoord(ab).subtract(l.offset());l.document().ontouchmove(l.drag,l,$.uid()).ontouchend(l.drop,l,$.uid()).onmousemove(l.drag,l,$.uid()).onmouseup(l.drop,l,$.uid());l.disableSelect().addClass("ku-dragger-grabbed").hitSize(l.outerDims()).hitCoord(Z).hitOffset(l.offset()).hitScrollOffset(l.scrollOffset()).hitBoundedOffet(l.boundedOffset()).actor().to(l.dragCoord(ab));this.state("grabbed")},drag:function(){return},drop:function(){return}};$.Class.extend(I.dropped,$.abstractState);I.grabbed=function(){I.grabbed.base.call(this,I)};I.grabbed.prototype={grab:function(){return},drag:function(Z){$.evt.mute(Z);var l=this.context();l.actor().to(l.dragCoord(Z));this.context().redraw()},drop:function(l){this.context().enableSelect().removeClass("ku-dragger-grabbed").document().clearEvents();this.state("dropped")}};$.Class.extend(I.grabbed,$.abstractState);function d(l){d.base.call(this,l);this._onEnd=$.observer();this.linear()}d.prototype={$to:function(l){return},$moveTo:function(l){return},$done:function(){this._onEnd.notify();return this},algorithm:function(l){this.$algorithm=l;return this},linear:function(l){return this.algorithm($.anime.algorithms.ease.linear(l))},spring:function(Z,l){this.algorithm($.anime.algorithms.spring(Z,l))},stop:function(){if(!$.exists(this.$tween)){return this}this.$tween.stop();return this},to:function(l){this.stop().$to(l).$done();return this},moveTo:function(l){this.stop().$moveTo(l);return this},onEnd:function(Z,l){if(!$.exists(Z)){return this}this._onEnd.add(Z,l);return this}};$.Class.extend(d,$.dom.Class);function h(l){$.dom(l).addClass("ku-fader");h.base.call(this,l)}h.prototype={$to:function(l){var aa=this.dom(),Z=$.dom(aa);Z.style("opacity",l*0.01);return this},$moveTo:function(l){var aa=this.dom(),Z=$.dom(aa),ab=Z.style("opacity")||1;this.$tween=$.tween(function(ac){Z.style("opacity",ac*0.01)},ab,l,this.$algorithm).onEnd(this.$done,this).start(aa)}};$.Class.extend(h,d);$.fader=function(l){return new h(l)};function X(l){$.dom(l).addClass("ku-fitter");X.base.call(this,l)}X.prototype={$to:function(l){var aa=this.dom(),Z=$.dom(aa);Z.style("width",l.x()+"px");Z.style("height",l.y()+"px");return this},$moveTo:function(ab){var Z=this.dom(),l=$.dom(Z),aa=l.outerDims();this.$tween=$.tween(function(ac){l.style("width",ac.x()+"px");l.style("height",ac.y()+"px")},aa,o(this,ab),this.$algorithm).onEnd(this.$done,this).start(Z)}};$.Class.extend(X,d);function o(l,aa){var ab=aa.y()/aa.x(),Z=$.dom(l.dom()),af=Z.outerDims(),ac=af.y()/af.x(),ag=isNaN(ac)?1:ac,ae=af.x(),ad=af.y();if((ag<ab)||(ag==ab)){ae=aa.x();ad=aa.x()*ac}if(ag>ab){ae=aa.y()/ac;ad=aa.y()}return $.coord(ae,ad)}$.fitter=function(l){return new X(l)};function v(l){$.dom(l).addClass("ku-pinner");v.base.call(this,l)}v.prototype={$to:function(l){var aa=this.dom(),Z=$.dom(aa);Z.style("left",l.x()+"px");Z.style("top",l.y()+"px");return this},$moveTo:function(ae){var ac=this.dom(),ab=$.dom(ac),aa=ab.offset(),Z=$.findOffset(ac.parentNode),l=($.coord.canParse(Z))?$.coord.parse(Z):$.coord.zero(),ad=aa.subtract(l);this.$tween=$.tween(function(af){ab.style("left",af.x()+"px");ab.style("top",af.y()+"px")},ad,ae,this.$algorithm).onEnd(this.$done,this).start(ac)}};$.Class.extend(v,d);$.pinner=function(l){return new v(l)};function B(l){$.dom(l).addClass("ku-scoller");B.base.call(this,l)}B.prototype={$to:function(l){var aa=this.dom(),Z=$.dom(aa);Z.style("scrollLeft",l.x());Z.style("scrollTop",l.y());return this},$moveTo:function(ae){var ac=this.dom(),ab=$.dom(ac),aa=ab.scrollOffset(),Z=$.findOffset(ac.parentNode),l=($.coord.canParse(Z))?$.coord.parse(Z):$.coord.zero(),ad=aa.subtract(l);this.$tween=$.tween(function(af){ab.style("scrollLeft",af.x());ab.style("scrollTop",af.y())},ad,ae,this.$algorithm).onEnd(this.$done,this).start(ac)}};$.Class.extend(B,d);$.scroller=function(l){return new B(l)};function y(l){$.dom(l).addClass("ku-sizer");y.base.call(this,l)}y.prototype={$to:function(l){var aa=this.dom(),Z=$.dom(aa);Z.style("width",l.x()+"px");Z.style("height",l.y()+"px");return this},$moveTo:function(ab){var Z=this.dom(),l=$.dom(Z),aa=l.outerDims();this.$tween=$.tween(function(ac){l.style("width",ac.x()+"px");l.style("height",ac.y()+"px")},aa,ab,this.$algorithm).onEnd(this.$done,this).start(Z)}};$.Class.extend(y,d);$.sizer=function(aa,Z,l){return new y(aa,Z,l)};function L(l,Z){$.dom(l).addClass("ku-styler");L.base.call(this,l);this._prop=Z}L.prototype={$moveTo:function(aa){var ae=this.dom(),ad=$.dom(ae),ab=this._prop,ac=ad.style(ab),l=$.ku.style,Z=l.getUnit(ac)||"",af=l.toNumber(ac);this.$tween=$.tween(function(ag){ad.style(ab,ag+Z)},af,aa,this.$algorithm).onEnd(this.$done,this).start(ae)}};$.Class.extend(L,d);$.styler=function(l,Z){return new L(l,Z)};function k(Z,l){k.base.call(this,l);this._listeners=$.observer();this._ticks=0;this.fps(Z||30)}k.prototype={fps:function(l){this._interval=1000/l;return this.property("fps",l)},interval:function(){return this.get("interval")},listeners:function(){return this.get("listeners")},ticks:function(){return this.get("ticks")},start:function(){this._state.start();return this},stop:function(){this._state.stop();return this},add:function(Z,ag,l,aa){var ad=this,af=aa||1,ae=l||$.uid("timeline"),ac=function(){if(!ad._ticks%af==0){return}Z();ab=Z},ab=(!aa)?Z:ac;this._listeners.add(ab,ag,ae);return this},remove:function(l){this._listeners.remove(l);return this},clear:function(){this._listeners.clear();return this},tick:function(){this._ticks++;return this}};$.Class.extend(k,$.abstractContext);$.timeline=function(){return n};k.started=function(){k.started.base.call(this,k)};k.started.prototype={start:function(){return},stop:function(){clearTimeout(ku_timeline);ku_timeline=null;this.state("stopped")}};$.Class.extend(k.started,$.abstractState);k.stopped=function(){k.stopped.base.call(this,k)};k.stopped.prototype={start:function(){var aa=this.context(),Z=aa.interval(),l=function(){aa.tick().listeners().notify();ku_timeline=setTimeout(l,Z)};l();this.state("started")},stop:function(){return}};$.Class.extend(k.stopped,$.abstractState);var n=new k(30,new k.stopped()).start();var H=function(ab,aa,l,Z){this.$method=ab;this.$current=aa;this.$end=l;this.$algorithm=Z;this.$value=0;this._onEnd=$.observer();this._id=$.uid("tween")};H.prototype={$exec:function(){return},$done:function(){this._onEnd.notify()},start:function(){$.timeline().add(this.$exec,this,this._id);return this},stop:function(){$.timeline().remove(this._id);return this},onEnd:function(Z,l){this._onEnd.add(Z,l);return this},clear:function(){this._onEnd.clear();return this}};$.Class.extend(H,$.Class);var J=function(ab,aa,l,Z){J.base.call(this,ab,aa,l,Z);this.$value=$.coord.zero()};J.prototype={$exec:function(){var ae=this.$method,ad=this.$current,l=this.$end;var ab=this.$algorithm.calculate(ad.x(),l.x(),this.$value.x());var Z=this.$algorithm.calculate(ad.y(),l.y(),this.$value.y()),aa=$.coord(ab,Z),ac=l.abs().subtract(ad.abs());if((Math.abs(ab)<0.1)&&(ac.x()<1)&&(Math.abs(Z)<0.1)&&(ac.y()<1)){ae(l);this.stop()._onEnd.notify();return}this.$current=ad.add(aa);this.$value=aa;ae(this.$current)}};$.Class.extend(J,H);var K=function(ab,aa,l,Z){K.base.call(this,ab,aa,l,Z)};K.prototype={$exec:function(){var ab=this.$method,aa=this.$current,l=this.$end,Z=this.$algorithm.calculate(aa,l,this.$value);if((Math.abs(Z)<0.1)&&(Math.abs(l-aa)<1)){ab(l);this.stop().$done();return}this.$current=aa+Z;this.$value=Z;ab(this.$current)}};$.Class.extend(K,H);$.tween=function(ab,aa,l,Z){return($.isNumber(aa)&&$.isNumber(l))?new K(ab,aa,l,Z):new J(ab,aa,l,Z)};function Q(l){Q.base.call(this,l);this._id=$.uid("dropper");this._handle=this}Q.prototype={id:function(l){return this.get("id")},value:function(l){return this.property("value",l)},handle:function(l){var Z;if($.exists(l)){Z=$.dom(l)}return this.property("handle",Z)},mouseEventId:function(l){return this.property("mouseEventId",l)},touchEventId:function(l){return this.property("touchEventId",l)},};$.Class.extend(Q,$.dom.Class);$.dndScreenDropper=function(l){return new Q(l)};var j=function(){this._targets=$.hash();this._droppers=$.hash();this._onHit=$.observer();this._lastKnownCoord;this._helper=$.sprite($.create({div:{"class":"ku-dndScreen-helper"}})).onGrab(function(Z){var l=$.touch().canRead(Z)?$.touch():$.mouse();this._lastKnownCoord=l.documentCoord(Z)},this).onDrag(function(Z){var l=$.touch().canRead(Z)?$.touch():$.mouse();this._lastKnownCoord=l.documentCoord(Z)},this).onDrop(function(l){this._drop(l)},this);this._currentDropper};j.prototype={addTarget:function(l){this._targets.add(l.id(),l);return this},removeTarget:function(l){this._targets.remove(l.id(),l);return this},addDropper:function(aa){var ab=$.uid("dropperEvent"),l=$.uid("dropperEvent");function Z(ac){this._currentDropper=aa;this.activateHelper(ac,aa)}aa.mouseEventId(ab).touchEventId(l).handle().onmousedown(Z,this,ab).ontouchstart(Z,this,l);this._droppers.add(aa.id(),aa)},removeDropper:function(l){l.handle().removeEvent(l.touchEventId()).removeEvent(l.mouseEventId());this._droppers.remove(l.id())},activateHelper:function(Z,l){this._helper.appendTo(document.body).pinTo(l.offset().subtract(l.scrollOffset()).add($.window().scrollOffset())).content(l.cloneNode()).grab(Z)},deactivateHelper:function(){this._helper.html("").detach();this._currentDropper=undefined},clearTargets:function(){this._targets.clear();return this},clearDroppers:function(){var l=this._droppers;l.listValues().each(function(Z){this.removeDropper(Z)},this);return this},clearAll:function(){this.clearTargets().clearDroppers();return this},clearListeners:function(){this._onHit.clear();return this},onHit:function(Z,l){this._onHit.add(Z,l);return this},_drop:function(aa){var l=this._findHitTarget(aa),Z=this._currentDropper;if($.exists(l)&&$.exists(Z)){this._onHit.notify(l,Z)}this.deactivateHelper()},_findHitTarget:function(ab){var l=this._targets.listValues(),aa=$.touch().canRead(ab)?$.touch():$.mouse(),Z=null,ac;try{ac=aa.documentCoord(ab)}catch(ab){ac=this._lastKnownCoord}l.each(function(ad){if(!ad.contains(ac)){return}Z=ad;l.quit()});return Z}};$.dndScreen=function(){return new j()};function S(l){S.base.call(this,l);this._id=$.uid("target")}S.prototype={id:function(l){return this.get("id")},value:function(l){return this.property("value",l)},contains:function(aa){var Z=this.offset(),l=Z.add(this.outerDims());return $.rectangle(Z,l).contains(aa)}};$.Class.extend(S,$.dom.Class);$.dndScreenTarget=function(l){return new S(l)};function w(){this._onKeyPressed=$.observer();w.base.call(this,$.create({div:{"class":"ku-keyboard"}}))}w.prototype={addKey:function(l){$.onScreenKey(l).addClass($.str.format("ku-keyboard-key ku-key-{0}",l)).onPress(this._onKeyPressed.notify,this._onKeyPressed).appendTo(this.dom());return this},onKeyPressed:function(Z,l){this._onKeyPressed.add(Z,l);return this}};$.Class.extend(w,$.dom.Class);$.onScreenKeyboard=function(){return new w()};function D(l){if(!$.isNumber(l)){$.exception("arg",$.str.format("Invalid argument code:{0}",l))}this._value=$.key(l);this._onPress=$.observer();this._onRelease=$.observer();D.base.call(this,$.create({button:{"class":"ku-keyboard-key"},content:this._value.toString()}));this.onmousedown(function(){this._onPress.notify(this._value)},this).ontouchstart(function(){this._onPress.notify(this._value)},this).onmouseup(function(){this._onRelease.notify(this._value)},this).ontouchend(function(){this._onRelease.notify(this._value)},this)}D.prototype={onPress:function(Z,l){this._onPress.add(Z,l);return this},onRelease:function(Z,l){this._onRelease.add(Z,l);return this}};$.Class.extend(D,$.dom.Class);$.onScreenKey=function(l){return new D(l)};function G(Z){var l=Z||$.create({div:{"class":"ku-sprite"}});G.base.call(this,l);this.to().dragOn().force(0.4).mu(0.8);this._isTo}G.prototype={force:function(l){return this.property("force",l)},mu:function(l){return this.property("mu",l)},algorithm:function(l){return this.set("algorithm",l)},to:function(){this._isTo=true;return this.algorithm($.anime.algorithms.jump())},spring:function(){this._isTo=false;return this.algorithm($.anime.algorithms.spring(this._force,this._mu))},ease:function(){this._isTo=false;return this.algorithm($.anime.algorithms.ease.linear(this._force,this._mu))},fitTo:function(aa,Z,l){return this._act("fitter",aa,Z,l)},sizeTo:function(aa,Z,l){return this._act("sizer",aa,Z,l)},pinTo:function(aa,Z,l){return this._act("pinner",aa,Z,l)},scrollTo:function(aa,Z,l){return this._act("scroller",aa,Z,l)},fadeTo:function(l,aa,Z){return this._act("fader",l,aa,Z)},growTo:function(aa,Z,l){return this.sizeTo(aa).pinTo(this.boundedOffset().subtract(aa.subtract(this.outerDims()).half()),Z,l)},_act:function(ae,ad,ac,ab){var Z=$[ae](this.dom()).algorithm(this._algorithm),l="_"+ae,aa=this[l];if($.exists(aa)){aa.stop()}if($.exists(ac)){Z.onEnd(ac,ab)}if(this._isTo){this[l]=Z.to(ad)}else{this[l]=Z.moveTo(ad)}return this},tween:function(Z,l){this._styler=$.styler(this.dom(),Z).algorithm(this._algorithm).moveTo(l);return this},clear:function(){if($.exists(this._fader)){this._fader.stop()}if($.exists(this._sizer)){this._sizer.stop()}if($.exists(this._fitter)){this._fitter.stop()}if($.exists(this._pinner)){this._pinner.stop()}if($.exists(this._scroller)){this._scroller.stop()}if($.exists(this._styler)){this._styler.stop()}return this},dragHandle:function(l){return this.property("dragHandle",l)},dragType:function(l){return this.set("dragType",l)},dragOffset:function(l){this._dnd.dragOffset(l);return this},dragger:function(){this._dnd.dragger();return this},sizer:function(){this._dnd.sizer();return this},scroller:function(){this._dnd.scroller();return this},dragOn:function(){this._dnd=$.dnd(this.dom()).onGrab(this.clear,this);return this},dragOff:function(){this._dnd.destroy();return this},onGrab:function(Z,l,aa){this._dnd.onGrab(Z,l,aa);return this},onDrag:function(Z,l,aa){this._dnd.onDrag(Z,l,aa);return this},onDrop:function(Z,l,aa){this._dnd.onDrop(Z,l,aa);return this},bearingUp:function(){return this._dnd.bearingUp()},bearingDown:function(){return this._dnd.bearingDown()},bearingLeft:function(){return this._dnd.bearingLeft()},bearingRight:function(){return this._dnd.bearingRight()},grab:function(l){this._dnd.grab(l);return this},drag:function(l){this._dnd.drag(l);return this},drop:function(l){this._dnd.drop(l);return this},constrainX:function(){this._dnd.constrainX();return this},unconstrainX:function(){this._dnd.unconstrainX();return this},constrainY:function(){this._dnd.constrainY();return this},unconstrainY:function(){this._dnd.unconstrainY();return this}};$.Class.extend(G,$.dom.Class);$.sprite=function(l){return new G(l)};$.sprite.Class=G;var W=function(l,Z){this.$offset=0;this.$multiplier=Z;this._tooltip=l;this.overlap(0)};W.prototype={$above:function(l,aa,Z){return},$below:function(l,aa,Z){return},$leftOf:function(l,aa,Z){return},$rightOf:function(l,aa,Z){return},overlap:function(l){return this.set("overlap",l)},above:function(ac){var aa=this._tooltip,l=aa.context(ac).context(),ab=aa.pointer(),Z=aa.tooltip();this.$offset=this._overlap;this.$above(l,ab,Z);return this},below:function(ac){var aa=this._tooltip,l=aa.context(ac).context(),ab=aa.pointer(),Z=aa.tooltip();this.$offset=this._overlap;this.$below(l,ab,Z);return this},leftOf:function(ac){var aa=this._tooltip,l=aa.context(ac).context(),ab=aa.pointer(),Z=aa.tooltip();this.$offset=this._overlap;this.$leftOf(l,ab,Z);return this},rightOf:function(ac){var aa=this._tooltip,l=aa.context(ac).context(),ab=aa.pointer(),Z=aa.tooltip();this.$offset=this._overlap;this.$rightOf(l,ab,Z);return this}};$.Class.extend(W,$.Class);var t=function(l,Z){t.base.call(this,l,0.5)};t.prototype={$above:function(l,aa,Z){aa.pinTo(l.offset().subtract(aa.outerHeight()).add($.coord(l.outerDims().subtract(aa.outerDims()).x()*this.$multiplier,0)));Z.pinTo(aa.offset().subtract(Z.outerHeight()).add($.coord(0,this.$offset)).add($.coord(aa.outerDims().subtract(Z.outerDims()).x()*this.$multiplier,0)));aa.fadeTo(100);Z.fadeTo(100);return this},$below:function(l,aa,Z){aa.pinTo(l.offset().add(l.outerHeight()).add($.coord(l.outerDims().subtract(aa.outerDims()).x()*this.$multiplier,0)));Z.pinTo(aa.offset().add(aa.outerHeight()).subtract($.coord(0,this.$offset)).add($.coord(aa.outerDims().subtract(Z.outerDims()).x()*this.$multiplier,0)));aa.fadeTo(100);Z.fadeTo(100);return this},$leftOf:function(l,aa,Z){aa.pinTo(l.offset().subtract(aa.outerWidth()).add($.coord(0,l.outerDims().subtract(aa.outerDims()).y()*this.$multiplier)));Z.pinTo(aa.offset().subtract(Z.outerWidth()).add($.coord(this.$offset,0)).add($.coord(0,aa.outerDims().subtract(Z.outerDims()).y()*this.$multiplier)));aa.fadeTo(100);Z.fadeTo(100);return this},$rightOf:function(l,aa,Z){aa.pinTo(l.offset().add(l.outerWidth()).add($.coord(0,l.outerDims().subtract(aa.outerDims()).y()*this.$multiplier)));Z.pinTo(aa.offset().add(aa.outerWidth()).subtract($.coord(this.$offset,0)).add($.coord(0,aa.outerDims().subtract(Z.outerDims()).y()*this.$multiplier)));aa.fadeTo(100);Z.fadeTo(100);return this}};$.Class.extend(t,W);var R=function(l,Z){R.base.call(this,l,0)};R.prototype={$above:function(l,aa,Z){aa.pinTo(l.offset().subtract(aa.outerHeight()).add($.coord(this.$offset,0)).add($.coord(l.outerDims().subtract(aa.outerDims()).x()*this.$multiplier,0)));Z.pinTo(aa.offset().subtract(Z.outerHeight()).add($.coord(-this.$offset,this.$offset)).add($.coord(aa.outerDims().subtract(Z.outerDims()).x()*this.$multiplier,0)));aa.fadeTo(100);Z.fadeTo(100);return this},$below:function(l,aa,Z){aa.pinTo(l.offset().add(l.outerHeight()).add($.coord(this.$offset,0)).add($.coord(l.outerDims().subtract(aa.outerDims()).x()*this.$multiplier,0)));Z.pinTo(aa.offset().add(aa.outerHeight()).subtract($.coord(this.$offset,this.$offset)).add($.coord(aa.outerDims().subtract(Z.outerDims()).x()*this.$multiplier,0)));aa.fadeTo(100);Z.fadeTo(100);return this},$leftOf:function(l,aa,Z){aa.pinTo(l.offset().subtract(aa.outerWidth()).add($.coord(0,this.$offset)).add($.coord(0,l.outerDims().subtract(aa.outerDims()).y()*this.$multiplier)));Z.pinTo(aa.offset().subtract(Z.outerWidth()).add($.coord(this.$offset,-this.$offset)).add($.coord(0,aa.outerDims().subtract(Z.outerDims()).y()*this.$multiplier)));aa.fadeTo(100);Z.fadeTo(100);return this},$rightOf:function(l,aa,Z){aa.pinTo(l.offset().add(l.outerWidth()).add($.coord(0,this.$offset)).add($.coord(0,l.outerDims().subtract(aa.outerDims()).y()*this.$multiplier)));Z.pinTo(aa.offset().add(aa.outerWidth()).subtract($.coord(this.$offset,this.$offset)).add($.coord(0,aa.outerDims().subtract(Z.outerDims()).y()*this.$multiplier)));aa.fadeTo(100);Z.fadeTo(100);return this}};$.Class.extend(R,W);var s=function(l,Z){s.base.call(this,l,1)};s.prototype={$above:function(l,aa,Z){aa.pinTo(l.offset().subtract(aa.outerHeight()).add($.coord(-this.$offset,0)).add($.coord(l.outerDims().subtract(aa.outerDims()).x()*this.$multiplier,0)));Z.pinTo(aa.offset().subtract(Z.outerHeight()).add($.coord(this.$offset,this.$offset)).add($.coord(aa.outerDims().subtract(Z.outerDims()).x()*this.$multiplier,0)));aa.fadeTo(100);Z.fadeTo(100);return this},$below:function(l,aa,Z){aa.pinTo(l.offset().add(l.outerHeight()).add($.coord(-this.$offset,0)).add($.coord(l.outerDims().subtract(aa.outerDims()).x()*this.$multiplier,0)));Z.pinTo(aa.offset().add(aa.outerHeight()).add($.coord(this.$offset,-this.$offset)).add($.coord(aa.outerDims().subtract(Z.outerDims()).x()*this.$multiplier,0)));aa.fadeTo(100);Z.fadeTo(100);return this},$leftOf:function(l,aa,Z){aa.pinTo(l.offset().subtract(aa.outerWidth()).add($.coord(0,-this.$offset)).add($.coord(0,l.outerDims().subtract(aa.outerDims()).y()*this.$multiplier)));Z.pinTo(aa.offset().subtract(Z.outerWidth()).add($.coord(this.$offset,this.$offset)).add($.coord(0,aa.outerDims().subtract(Z.outerDims()).y()*this.$multiplier)));aa.fadeTo(100);Z.fadeTo(100);return this},$rightOf:function(l,aa,Z){aa.pinTo(l.offset().add(l.outerWidth()).add($.coord(0,-this.$offset)).add($.coord(0,l.outerDims().subtract(aa.outerDims()).y()*this.$multiplier)));Z.pinTo(aa.offset().add(aa.outerWidth()).add($.coord(-this.$offset,this.$offset)).add($.coord(0,aa.outerDims().subtract(Z.outerDims()).y()*this.$multiplier)));aa.fadeTo(100);Z.fadeTo(100);return this}};$.Class.extend(s,W);var O=function(){O.base.call(this);this.pointer($.sprite($.create({div:{"class":"ku-tooltip-pointer"}})).hide().dragOff().to()).tooltip($.sprite($.create({div:{"class":"ku-tooltip"}})).hide().dragOff().to()).leftJustify();this._id=$.uid("tip");this._onShow=$.observer();this._onHide=$.observer()};O.prototype={calibrate:function(l){return this.property("calibrate",l)},pointer:function(l){return this.property("pointer",l)},tooltip:function(l){return this.property("tooltip",l)},strategy:function(l){return this.property("strategy",l)},message:function(l){return this.property("message",l)},context:function(Z){var l=($.exists(Z))?$.dom(Z):Z;return this.property("context",l)},center:function(){return this.strategy(new t(this))},leftJustify:function(){return this.strategy(new R(this))},rightJustify:function(){return this.strategy(new s(this))},onShow:function(Z,l){this._onShow.add(Z,l);return this},onHide:function(Z,l){this._onHide.add(Z,l);return this},show:function(aa){var l=aa||this._message,Z=l||"";this._pointer.fadeTo(0).appendTo(document.body).show();this._tooltip.fadeTo(0).appendTo(document.body).html("").content(Z).show();this._onShow.notify();return this},hide:function(){this._pointer.hide().detach();this._tooltip.hide().detach();this._onHide.notify();return this},at:function(ad,Z){var ab=$.window(),ac=$.dom(ad),l=$.coord.zero(),ae=ab.dims(),aa=ac.offset();b=aa.add(ac.outerDims()),C=this._tooltip.outerDims(),bPlusC=b.add(C),aLessC=aa.subtract(C),rightOf=!bPlusC.isRightOf(ae),below=!bPlusC.isBelow(ae),leftOf=!aLessC.isLeftOf(l),above=!aLessC.isAbove(l),prefer={rightOf:rightOf,below:below,leftOf:leftOf,above:above};if(prefer[Z[0]]){return this[Z[0]](ad)}if(prefer[Z[1]]){return this[Z[1]](ad)}if(prefer[Z[2]]){return this[Z[2]](ad)}if(prefer[Z[3]]){return this[Z[3]](ad)}return this.rightOf(ad)},above:function(l){return this._locate(l,"bottom","above")},below:function(l){return this._locate(l,"top","below")},leftOf:function(l){return this._locate(l,"right","leftOf")},rightOf:function(l){return this._locate(l,"left","rightOf")},_locate:function(aa,Z,l){this.strategy().overlap(r(this,Z))[l](aa);p(this,l);this._pointer.fadeTo(100);this._tooltip.fadeTo(100);return this}};$.Class.extend(O,$.Class);$.tooltip=function(){return new O()};function r(aa,Z){var l=aa.tooltip().style($.str.format("border-{0}-width",Z));return $.ku.style.toNumber(l)}function p(aa,l){var ab="ku-{0}",Z=["above","below","leftOf","rightOf"],ac=aa.pointer();for(var ad in Z){ac.removeClass($.str.format(ab,Z[ad]))}ac.addClass($.str.format(ab,l))}})(jQuery);