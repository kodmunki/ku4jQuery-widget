(function(S){$=S;var X=$.hash({1:"MOUSE_LEFT",2:"",3:"MOUSE_RIGHT",4:"",5:"",6:"",7:"",8:"BACKSPACE",9:"TAB",10:"",11:"",12:"",13:"ENTER",14:"",15:"",16:"SHIFT",17:"CTRL",18:"ALT",19:"",20:"CAPS",21:"",22:"",23:"",24:"",25:"",26:"",27:"ESC",28:"",29:"",30:"",31:"",32:"SPACE",33:"PAGEUP",34:"PAGEDOWN",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",41:")",42:"*",43:"+",44:",",45:"-",46:".",47:"/",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:":",59:";",60:"<",61:"=",62:">",63:"?",64:"@",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"[",92:"\\",93:"]",94:"^",95:"_",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"=",108:"l",109:"-",110:"n",111:"o",112:"p",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"|",125:"}",126:"~",127:"",128:"",129:"",130:"",131:"",132:"",133:"",134:"",135:"",136:"",137:"",138:"",139:"",140:"",141:"",142:"",143:"",144:"",145:"",146:"",147:"",148:"",149:"",150:"",151:"",152:"",153:"",154:"",155:"",156:"",157:"",158:"",159:"",160:"",161:"",162:"",163:"",164:"",165:"",166:"",167:"",168:"",169:"",170:"",171:"",172:"",173:"",174:"",175:"",176:"",177:"",178:"",179:"",180:"",181:"",182:"",183:"",184:"",185:"",186:"",187:"",188:",",189:"",190:".",191:"/",192:"`",193:"",194:"",195:"",196:"",197:"",198:"",199:"",200:"",201:"",202:"",203:"",204:"",205:"",206:"",207:"",208:"",209:"",210:"",211:"",212:"",213:"",214:"",215:"",216:"",217:"",218:"",219:"[",220:"\\",221:"]",222:"",223:"",224:"",225:"",226:"",227:"",228:"",229:"",230:"",231:"",232:"",233:"",234:"",235:"",236:"",237:"",238:"",239:"",240:"",241:"",242:"",243:"",244:"",245:"",246:"",247:"",248:"",249:"",250:"",251:"",252:"",253:"",254:"",255:""});function ai(aX,aZ,aY,l){if(!$.isNumber(aX)){throw $.ku4exception("$.key",$.str.format("Invalid parameter: code {0}",aX))}this._code=aX;this.alt(aZ||false).ctrl(aY||false).shift(l||false)}ai.prototype={code:function(l){return this.property("code",l)},alt:function(l){return this.property("alt",l)},ctrl:function(l){return this.property("ctrl",l)},shift:function(l){return this.property("shift",l)},equals:function(l){return this._code==l.code()&&this._alt==l.alt()&&this._ctrl==l.ctrl()&&this._shift==l.shift()},toString:function(){return $.str.parse(this._code)}};$.Class.extend(ai,$.Class);$.key=function(aX,aZ,aY,l){return new ai(aX,aZ,aY,l)};$.key.canParse=function(l){return $.isNumber(ar(l))};$.key.parse=function(aX){try{return new ai(ar(aX),aX.altKey,aX.ctrlKey,aX.shiftKey)}catch(l){throw $.ku4exception("$.key",$.str.format("Cannot parse object: {0}",aX))}};$.key.tryParse=function(l){return $.key.canParse(l)?$.key.parse(l):null};function ar(l){try{return($.exists(l.which))?l.which:event.keyCode}catch(l){return null}}function k(){this._hotKeys=$.hash();this._map=$.hash(X)}k.prototype={map:function(l){return this.set("map",l);s},findCode:function(aY){var l=this._map.findKey(aY),aX=parseInt(l);return isNaN(aX)?null:aX},findKey:function(l){return this._map.findValue(l)}};$.Class.extend(k,$.Class);var O=new k();$.keyboard=function(){return O};function W(){}W.prototype={from:function(l){return($.exists(l.relatedTarget))?l.relatedTarget:l.fromElement},target:function(l){return(l.srcElement)?l.srcElement:l.target},clientCoord:function(l){if(!$.exists(l.clientX)){return null}return new $.coord(l.clientX,l.clientY)},documentCoord:function(l){if($.exists(this.pageCoord(l))){return this.pageCoord(l)}var aX=document.documentElement;return new $.coord(l.clientX+aX.scrollLeft,l.clientY+aX.scrollTop)},pageCoord:function(l){if(!$.exists(l.pageX)){return null}return new $.coord(l.pageX,l.pageY)},screenCoord:function(l){return new $.coord(l.screenX,l.screenY)},selection:function(){if($.exists(window.getSelection)){return window.getSelection()}if($.exists(document.getSelection)){return document.getSelection()}if($.exists(document.selection)&&$.exists(document.selection.createRange)){return document.selection.createRange().text}if($.exists(document.activeElement)&&$.exists(document.activeElement.selectionStart)){var aX=document.activeElement.selectionStart,l=document.activeElement.selectionEnd;return document.activeElement.value.substring(aX,l)}return null},clearSelection:function(){var l=this.selection();try{l.removeAllRanges()}catch(aX){l.empty()}return this}};$.Class.extend(W,$.Class);var aE=new W();$.mouse=function(){return aE};function au(){}au.prototype={canRead:function(l){return $.exists(l.touches)},from:function(aX){var l=aX.touches[0];return($.exists(l.relatedTarget))?l.relatedTarget:l.fromElement},target:function(aX){var l=aX.touches[0];return(l.srcElement)?l.srcElement:l.target},clientCoord:function(aX){var l=aX.touches[0];if(!$.exists(l.clientX)){return null}return new $.coord(l.clientX,l.clientY)},documentCoord:function(aX){var l=aX.touches[0];if($.exists(this.pageCoord(aX))){return this.pageCoord(aX)}var aY=document.documentElement;return new $.coord(l.clientX+aY.scrollLeft,l.clientY+aY.scrollTop)},pageCoord:function(aX){var l=aX.touches[0];if(!$.exists(l.pageX)){return null}return new $.coord(l.pageX,l.pageY)},screenCoord:function(aX){var l=aX.touches[0];return new $.coord(l.screenX,l.screenY)},selection:function(){if($.exists(window.getSelection)){return window.getSelection()}if($.exists(document.getSelection)){return document.getSelection()}if($.exists(document.selection)&&$.exists(document.selection.createRange)){return document.selection.createRange().text}if($.exists(document.activeElement)&&$.exists(document.activeElement.selectionStart)){var aX=document.activeElement.selectionStart,l=document.activeElement.selectionEnd;return document.activeElement.value.substring(aX,l)}return null},clearSelection:function(){var l=this.selection();try{l.removeAllRanges()}catch(aX){l.empty()}return this}};$.Class.extend(au,$.Class);var aM=new au();$.touch=function(){return aM};$.DomClass=function(l){$.DomClass.base.call(this);if(!$.exists(l)){$.ku4exception("$.dom","$.DomClass requires valid DOM node.")}this.dom(l)};$.DomClass.prototype={dom:function(l){return this.property("dom",l)}};$.Class.extend($.DomClass,$.Class);var aL={css:{addClass:function(aY,l){var aX=$.ele(aY),aZ=aX.className;if($.ku.css.hasClass(aY,l)){return}aX.className+=(/^[^\s]/.test(aZ))?(" "+l):l},hasClass:function(aX,l){if(!$.exists(l)){return false}return(new RegExp(l)).test(($.ele(aX)).className)},removeClass:function(aY,l){var aX=$.ele(aY),aZ=aX.className;if(!$.ku.css.hasClass(aY,l)){return}aX.className=$.str.trim(aZ.replace(new RegExp("(^|\\s)"+l+"(?![\\w\\-])"),""))}},getText:function(aX){var l=$.ele(aX);return l.textContent||l.innerText},quirks:{setOpacity:function(aY,aX){var l=aX/100;aY.style.opacity=l;aY.style["-moz-opacity"]=l;aY.style["-webkit-opacity"]=l;aY.style.filter=$.str.format("alpha(opacity={0})",aX)},clearOpacity:function(l){$.ku.style.set(l,{opacity:null,"-moz-opacity":null,"-webkit-opacity":null,filter:null})}},ready:function(aX,l){_funcs[_funcs.length]={f:aX,b:l||false}},redraw:function(aZ){var aY=$.ele(aZ)||document.documentElement,aX=aY.style.display||"";aY.style.display="none";var l=aY.offsetHeight;aY.style.display=aX},style:{set:function(a2,aY,aZ){var a1=$.ele(a2);function l(a4){return(/\-/.test(a4))?a4.replace(/\-\w/,a4.charAt(a4.indexOf("-")+1).toUpperCase()):a4}if($.isString(aY)){try{a1.style[l(aY)]=aZ}catch(a0){}}for(var a3 in aY){var aX=l(a3);if(/opacity/i.test(aX)){$.ku.quirks.setOpacity(a2,aY[a3]);continue}try{a1.style[aX]=aY[a3]}catch(a0){continue}}},get:function(a2,aZ){var a1=$.ele(a2);function l(a6,a4){var a3=(/\-/.test(a4))?a4.replace(/\-\w/,a4.charAt(a4.indexOf("-")+1).toUpperCase()):a4;try{return window.getComputedStyle(a6,null).getPropertyValue(a4)}catch(a5){return($.exists(a6.currentStyle))?a6.currentStyle[a4]:($.exists(a6.style))?a6.style[a3]:""}}if(/opacity/i.test(aZ)){var aX=l(a1,aZ);if($.exists(aX)){return parseFloat(aX)*100}else{var aY=/alpha\(opacity=\d+(\.\d+)?\)/i.exec(a1.style.filter);if(!$.exists(aY)){return 100}var a0=/\d+(\.\d+)?/i.exec(aY[0]);if(!$.exists(a0)){return 100}return parseFloat(a0[0])}}return l(a1,aZ)},toNumber:function(l){return isNaN(l)?0:parseFloat(this.stripUnit(l))},stripUnit:function(l){return($.exists(l)&&$.exists(l.replace))?l.replace(/[^\-\.\d]/g,""):l},getUnit:function(l){return l.match(/[^\-\.\d]{2}/)[0]}},swapDom:function(aY,aX){var l=$.ele(aY);f=$.ele(aX);l.parentNode.replaceChild(f,l)}};$.ku=aL;$.clearNode=function(aX){var l=$.ele(aX);if(!l){return}while(l.hasChildNodes()){l.removeChild(l.firstChild)}};$.create=function(a3){if(!a3){return null}var aX=($.isString(a3))?{x:{}}:a3,a5,a1;for(var aY in aX){if(aY=="content"){continue}a5=document.createElement(aY);attrs=aX[aY]}for(var aY in attrs){var a4=attrs[aY];if(/class/i.test(aY)){$.ku.css.addClass(a5,a4);continue}if(/style/i.test(aY)){$.ku.style.set(a5,a4);continue}a5.setAttribute(aY,a4)}try{var a2=aX.content;if(!a2){return a5}var aZ=(!a2)?1:a2.length;if($.exists(a2.nodeName)){a5.appendChild(a2);return a5}if(!$.isArray(a2)){a5.innerHTML+=a2;return a5}while(aZ--){var l=a2[aZ];if($.isString(l)||!isNaN(l)){a5.innerHTML+=l;continue}var aX=(l.hasOwnProperty("appendChild"))?l:$.create(l);a5.appendChild(aX)}}catch(a0){}finally{return a5}};$.ele=function(l){if(!l){return null}return($.isEvent(l))?$.evt.ele(l):($.isString(l))?document.getElementById(l):($.exists(l.dom))?l.dom:l};var H=function(a0,aX,aZ,aY,l){this.dom=a0;this.evt=aX;this.action=aZ;this.scope=aY;this.bubbles=l};$.evt={add:function(aX,a3,l,a4,aY){if(!$.ele(aX)){$.ku4exception("$.evt",$.str.format("argument dom == {0} at $.evt.add",aX))}var a0=$.ele(aX),aZ=a3,a5=a4||a0,a1=aY||false,a2=function(){l.apply(a5,arguments)};if($.exists(a0.addEventListener)){a0.addEventListener(aZ,a2,a1)}else{if($.exists(a0.attachEvent)){a0.attachEvent("on"+aZ,a2)}else{a0["on"+aZ]=a2}}return new H(a0,aZ,a2,a5,a1)},remove:function(aZ){var a1=aZ.dom,a0=aZ.evt,aY=aZ.scope,l=aZ.bubbles,aX=aZ.action;if(a1.removeEventListener){a1.removeEventListener(a0,aX,l)}else{if(a1.detachEvent){a1.detachEvent("on"+a0,aX)}else{a1["on"+a0]=null}}return this},ele:function(l){try{return(l.srcElement)?l.srcElement:l.target}catch(l){return null}},mute:function(l){if($.exists(l.preventDefault)){l.preventDefault()}if($.exists(l.stopPropogation)){l.stopPropogation()}l.returnValue=false;l.cancelBubble=true;return this}};$.findOuterDims=function(aX){var l=$.ele(aX);return{width:l.offsetWidth,height:l.offsetHeight}},$.findInnerDims=function(aX){var l=$.ele(aX);return{width:l.clientWidth,height:l.clientHeight}},$.findOffset=function(aY){var aX=$.ele(aY),l=0,aZ=0;if(!aX){return null}do{l+=aX.offsetLeft;aZ+=aX.offsetTop}while((function(){try{aX=aX.offsetParent}catch(a0){aX=null}return $.exists(aX)})());return{left:l,top:aZ}};$.findBoundedOffset=function(aX){var l=$.ele(aX);if(!l){return null}return{left:l.offsetLeft,top:l.offsetTop}},$.findScrollDims=function(aX){var l=$.ele(aX);return{width:l.scrollWidth,height:l.scrollHeight}};$.findScrollOffset=function(aY){var aX=$.ele(aY),l=0,aZ=0;if(!aX){return null}do{l+=aX.scrollLeft||0;aZ+=aX.scrollTop||0}while((function(){try{aX=aX.parentNode}catch(a0){aX=null}return $.exists(aX)})());return{left:l,top:aZ}};var aG=function(aX){this._navigator=aX;agents={_isIE:"MSIE",_isNetscape:"Netscape",_isFirefox:"Firefox",_isOpera:"Opera",_isSafari:"Safari",_isChrome:"Chrome"};this._isIE=false;this._isNetscape=false;this._isFirefox=false;this._isOpera=false;this._isSafari=false;this._isChrome=false;this._isUnknown=true;this._version="";if(!$.isObject(aX)){return}var aX=this._navigator,aZ=aX.userAgent;function a1(a3){return !$.isNullOrEmpty(aZ)&&(new RegExp(a3,"i")).test(aZ)}function aY(a7){try{var a4=(new RegExp("Version\\/(\\d+\\.?){1,}","i")).exec(aZ),a5=(new RegExp(a7+"\\/(\\d+\\.?){1,}","i")).exec(aZ),a3=$.exists(a4)?a4:a5;return(new RegExp("(\\d+\\.?){1,}")).exec(a3[0])[0]}catch(a6){return""}}var a2,l,a0;for(a2 in agents){a0=agents[a2];l=a1(a0);if(!l){continue}this[a2]=l;this._version=aY(a0);this._isUnknown=false}this._fullVersion=aX.appVersion;this._platform=aX.platform;this._allInfo=this._fullVersion+this._platform};aG.prototype={isIE:function(){return this._isIE},isNetscape:function(){return this._isNetscape},isFirefox:function(){return this._isFirefox},isOpera:function(){return this._isOpera},isSafari:function(){return this._isSafari&&!this._isChrome},isChrome:function(){return this._isChrome},isUnknown:function(){return this._isUnknown},platform:function(){return this._platform},fullVersion:function(){return this._fullVersion},version:function(){return this._version}};var aj;$.ku.browser=function(){if($.exists(aj)){return aj}aj=new aG(navigator);return aj};$.ku.browser.Class=aG;var D=function(l){D.base.call(this,$.ele(l));var aX=this.style("display")||"block";this._display=(/none/i.test(aX))?"block":aX;this._liveEvents=$.hash()};D.prototype={attribute:function(l,aX){var aY=this.dom();if($.isUndefined(aX)){return aY.getAttribute(l)}aY.setAttribute(l,aX);return this},addClass:function(l){$.ku.css.addClass(this.dom(),l);return this},removeClass:function(l){$.ku.css.removeClass(this.dom(),l);return this},hasClass:function(l){$.ku.css.hasClass(this.dom(),l);return this},style:function(aX,l){if($.isString(aX)&&!$.exists(l)){return $.ku.style.get(this.dom(),aX)}$.ku.style.set(this.dom(),aX,l);return this},value:function(l){if(!$.exists(l)){return this.dom().value}this.dom().value=l;return this},content:function(l){if(!$.exists(l)){return this}if($.isNumber(l)||$.isString(l)){return this.html(l)}return this.appendChild(l)},cloneNode:function(l){return this._dom.cloneNode(l||true)},html:function(l){if(!$.exists(l)){return this.dom().innerHTML}this.dom().innerHTML=l;return this},text:function(l){if(!$.exists(l)){return $.ku.getText(this.dom())}$.ku.setText(this.dom(),l);return this},prependChild:function(aX){var aY=this.dom(),l=aY.firstChild;if($.exists(l)){aY.insertBefore(aX,l)}else{aY.appendChild(aX)}return this},appendChild:function(l){this.dom().appendChild(l);return this},removeChild:function(l){this.dom().removeChild(l);return this},insertBefore:function(l){l.parentNode.insertBefore(this.dom(),l);return this},insertAfter:function(l){if($.exists(l.nextSibling)){l.parentNode.insertBefore(this.dom(),l.nextSibling)}else{l.parentNode.appendChild(this.dom())}return this},appendTo:function(l){l.appendChild(this.dom());return this},detach:function(){try{var aX=this.dom();aX.parentNode.removeChild(aX)}catch(l){}finally{return this}},innerDims:function(l){if(!$.exists(l)){return $.coord.parse($.findInnerDims(this.dom()))}var aX=l.toPixel();this.style({width:aX.x(),height:aX.y()});return this},outerDims:function(aX){if(!$.exists(aX)){return $.coord.parse($.findOuterDims(this.dom()))}var l=this.outerDims().subtract(this.innerDims());return this.innerDims(aX.subtract(l))},innerWidth:function(l){var aX=this.innerDims();if(!$.exists(l)){return $.coord(aX.x(),0)}return this.innerDims($.coord(l,aX.y()))},innerHeight:function(l){var aX=this.innerDims();if(!$.exists(l)){return $.coord(0,aX.y())}return this.innerDims($.coord(aX.x(),l))},outerWidth:function(l){var aX=this.outerDims();if(!$.exists(l)){return $.coord(aX.x(),0)}return this.outerDims($.coord(l,aX.y()))},outerHeight:function(l){var aX=this.outerDims();if(!$.exists(l)){return $.coord(0,aX.y())}return this.outerDims($.coord(aX.x(),l))},boundedOffset:function(){return $.coord.parse($.findBoundedOffset(this.dom()))},layoutDims:function(){var l=this.dom().parentNode;if(!$.exists(l)){return $.coord.zero()}var aX=$.dom(l);return aX.outerDims().subtract(aX.innerDims()).half()},offset:function(){return $.coord.parse($.findOffset(this.dom()))},center:function(){return this.offset().add(this.outerDims().half())},scrollDims:function(){return $.coord.parse($.findScrollDims(this.dom()))},scrollOffset:function(){return $.coord.parse($.findScrollOffset(this.dom()))},clear:function(){$.clearNode(this.dom());return this},redraw:function(){$.ku.redraw(this.dom());return this},swap:function(l){$.ku.swapDom(this.dom(),l.dom());return l},show:function(){this.style({display:this._display});return this},hide:function(){this.style({display:"none"});return this},isVisible:function(){var l=this.offset(),aX=this.offset().add(this.innerDims());return $.exists(this.dom().parentNode)&&!/NONE|^$/i.test(this.style("display"))&&$.window().scrollOffset().isLeftOf(aX)&&$.window().scrollOffset().isAbove(aX)&&$.window().scrollDims().isRightOf(l)&&$.window().scrollDims().isBelow(l)},onmouseover:function(l,aY,aX){return this._addEvent("mouseover",l,aY,aX)},onmouseout:function(l,aY,aX){return this._addEvent("mouseout",l,aY,aX)},onmousedown:function(l,aY,aX){return this._addEvent("mousedown",l,aY,aX)},onmouseup:function(l,aY,aX){return this._addEvent("mouseup",l,aY,aX)},onmousemove:function(l,aY,aX){return this._addEvent("mousemove",l,aY,aX)},onclick:function(l,aY,aX){return this._addEvent("click",l,aY,aX)},ondoubleclick:function(l,aY,aX){return this._addEvent("dblclick",l,aY,aX)},onkeydown:function(l,aY,aX){return this._addEvent("keydown",l,aY,aX)},onkeyup:function(l,aY,aX){return this._addEvent("keyup",l,aY,aX)},onkeypress:function(l,aY,aX){return this._addEvent("keypress",l,aY,aX)},onblur:function(l,aY,aX){return this._addEvent("blur",l,aY,aX)},onchange:function(l,aY,aX){return this._addEvent("change",l,aY,aX)},onerror:function(l,aY,aX){return this._addEvent("error",l,aY,aX)},onfocus:function(l,aY,aX){return this._addEvent("focus",l,aY,aX)},onload:function(l,aY,aX){return this._addEvent("load",l,aY,aX)},onresize:function(l,aY,aX){return this._addEvent("resize",l,aY,aX)},onscroll:function(l,aY,aX){return this._addEvent("scroll",l,aY,aX)},onselect:function(l,aY,aX){return this._addEvent("select",l,aY,aX)},onresize:function(l,aY,aX){return this._addEvent("resize",l,aY,aX)},onunload:function(l,aY,aX){return this._addEvent("unload",l,aY,aX)},onorientationchange:function(l,aY,aX){return this._addEvent("orientationchange",l,aY,aX)},ontouchstart:function(l,aY,aX){return this._addEvent("touchstart",l,aY,aX)},ontouchend:function(l,aY,aX){return this._addEvent("touchend",l,aY,aX)},ontouchmove:function(l,aY,aX){return this._addEvent("touchmove",l,aY,aX)},removeEvent:function(aX){var l=this._liveEvents.find(aX);if(!$.exists(l)){return this}return this._removeEvent(l,aX)},clearEvents:function(){$.list(this._liveEvents.values()).each(function(l){this._removeEvent(l)},this);return this},_addEvent:function(aY,aX,a1,a0){var l=a0||$.uid("evt"),aZ=this._liveEvents;if(aZ.containsKey(l)){return this}aZ.add(l,$.evt.add(this.dom(),aY,aX,a1));return this},_removeEvent:function(l,aX){$.evt.remove(l);this._liveEvents.remove(aX);return this}};$.Class.extend(D,$.DomClass);$.dom=function(l){return new D(l)};$.dom.parseHtml=function(l){var aX=$.create({div:{},content:l});if(aX.childNodes.length!=1){return null}return $.dom(aX.firstChild)};$.dom.Class=D;function aP(){aP.base.call(this);this._body=$.dom(document.body)}aP.prototype={isDisabled:function(){return this.get("disabled")},isPortrait:function(){return this.orientation.isLandscape()},isLandscape:function(){return Math.abs(window.orientation)==90},disable:function(){this._disabled=true;document.body.appendChild(ag);return this},enable:function(){if(!this.isDisabled()){return this}document.body.removeChild(ag);this._disabled=false;return this},dims:function(){var l=window.innerWidth||document.documentElement.clientWidth,aX=window.innerHeight||document.documentElement.clientHeight;return $.coord(l,aX)},center:function(){return this.dims().divide($.coord(2,2))},scrollOffset:function(){var aZ=document.documentElement,aX=document.body,l=Math.max(aZ.scrollLeft,aX.scrollLeft),aY=Math.max(aZ.scrollTop,aX.scrollTop);return $.coord(l,aY)},scrollDims:function(){var aZ=document.documentElement,aX=document.body,l=Math.max(aZ.scrollWidth,aX.scrollWidth),aY=Math.max(aZ.scrollHeight,aX.scrollHeight);return $.coord(l,aY)},scrollCenter:function(){return this.center().add(this.scrollOffset())},contains:function(l){var aY=this.scrollOffset(),aX=this.scrollDims();if(!l instanceof $.point.Class){$.ku4exception("$.window","contains method takes and argument type $.point")}return !(l.isAbove(aY)||l.isLeftOf(aY)||l.isRightOf(aX)||l.isBelow(aX))},redraw:function(){$.ku.redraw(document.body);$.ku.redraw(document.documentElement);return this},onmousedown:function(l,aY,aX){return this._body.onmousedown(l,aY,aX)},onmouseup:function(l,aY,aX){return this._body.onmouseup(l,aY,aX)},ontouchstart:function(l,aY,aX){return this._body.ontouchstart(l,aY,aX)},ontouchend:function(l,aY,aX){return this._body.ontouchend(l,aY,aX)},onclick:function(l,aY,aX){return this._body.onclick(l,aY,aX)},ondoubleclick:function(l,aY,aX){return this._body.ondoubleclick(l,aY,aX)},onkeydown:function(l,aY,aX){return this._body.onkeydown(l,aY,aX)},onkeyup:function(l,aY,aX){return this._body.onkeyup(l,aY,aX)},scrollTo:function(l){window.scrollTo(l.x(),l.y());return this},onresize:function(l,aY,aX){r.add(l,aY,aX);return this},onscroll:function(l,aY,aX){aq.add(l,aY,aX);return this},onspin:function(l,aY,aX){at.add(l,aY,aX);return this},remove:function(l){r.remove(l);aq.remove(l);at.remove(l);this._body.removeEvent(l);return this}};$.Class.extend(aP,$.Class);var ag=$.create({div:{"class":"ku-window-disabled"}}),r=$.observer(),aq=$.observer(),at=$.observer(),b=function(){};b.prototype={uri:function(l){return this.property("uri",l)},offset:function(l){return this.property("offset",l)},dims:function(l){return this.property("dims",l)},channelmode:function(l){return this.property("channelmode",l)},directories:function(l){return this.property("directories",l)},fullscreen:function(l){return this.property("fullscreen",l)},location:function(l){return this.property("location",l)},menubar:function(l){return this.property("menubar",l)},scrollbars:function(l){return this.property("scrollbars",l)},titlebar:function(l){return this.property("titlebar",l)},toolbar:function(l){return this.property("toolbar",l)},open:function(){}};$.Class.extend(b,$.Class);var az;$.window=function(){if($.exists(az)){return az}$.evt.add(window,"resize",function(){r.notify()});$.evt.add(window,"scroll",function(){aq.notify()});$.evt.add(window,"orientationchange",function(){at.notify()});az=new aP();return az};$.ku.localization={en:{day:{name:{0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"},abbr:{0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"}},month:{name:{1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},abbr:{1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"}}},sp:{day:{name:{0:"domingo",1:"lunes",2:"martes",3:"mi&#0233;rcoles",4:"jueves",5:"viernes",6:"sï¿½bado"},abbr:{0:"dom",1:"lun",2:"mar",3:"mi&#0233;",4:"jue",5:"vie",6:"s&#0225;b"}},month:{name:{1:"enero",2:"febrero",3:"marzo",4:"abril",5:"mayo",6:"junio",7:"julio",8:"agosto",9:"septiembre",10:"octubre",11:"noviembre",12:"diciembre"},abbr:{1:"ene",2:"feb",3:"mar",4:"abr",5:"may",6:"jun",7:"jul",8:"ago",9:"sep",10:"oct",11:"nov",12:"dic"}}}};$.ku.equations={cycle:function(aY,a0,aZ,aX,l){return new $.coord(this.sin(aY.x,a0,aZ),this.cos(aY.y,aX,l))},cos:function(aY,aX,l){return aY+Math.cos(aX)*l},cosH:function(aY,aX,l){return new $.coord(this.cos(aY.x,aX,l),aY.y)},cosV:function(aY,aX,l){return new $.coord(aY.x,this.cos(aY.y,aX,l))},sin:function(aY,aX,l){return aY+Math.sin(aX)*l},sinH:function(aY,aX,l){return new $.coord(this.sin(aY.x,aX,l),aY.y)},sinV:function(aY,aX,l){return new $.coord(aY.x,this.sin(aY.y,aX,l))}};$.anime={algorithms:{ease:{}}};var aR=function(l){this._ease=l||0.1};aR.prototype={calculate:function(aX,l){return(l-aX)*this._ease}};$.anime.algorithms.ease.linear=function(l){return new aR(l)};var aF=function(){};aF.prototype={calculate:function(aX,l){return l-aX}};$.anime.algorithms.jump=function(){return new aF()};var o=function(aX,l){this._spring=aX||0.4;this._mu=l||0.6};o.prototype={calculate:function(a2,aY,a1){var aX=this._spring,aZ=a1,l=this._mu,a3=aY-a2,a0=a3*aX;aZ+=a0;aZ*=l;return aZ}};$.anime.algorithms.spring=function(aX,l){return new o(aX,l)};function aU(l){this._context=l}aU.prototype={findCoord:function(aY){var l=this._context,aX=$.touch().canRead(aY)?$.touch():$.mouse();return aX.documentCoord(aY).subtract(l.hitCoord()).subtract(l.hitOffset()).add(l.hitBoundedOffet())}};function w(l){this._context=l}w.prototype={findCoord:function(aY){var l=this._context,aX=$.touch().canRead(aY)?$.touch():$.mouse();return l.hitSize().add(aX.documentCoord(aY).subtract(l.hitCoord()).subtract(l.hitOffset()))}};function aB(l){this._context=l}aB.prototype={findCoord:function(aY){var l=this._context,aX=$.touch().canRead(aY)?$.touch():$.mouse();return l.hitCoord().add(l.hitOffset()).subtract(aX.documentCoord(aY)).add(l.hitScrollOffset())}};var ap={};function ac(l){ac.base.call(this,l);this._mouseEvt=$.uid("dragger");this._touchEvt=$.uid("toucher");this._documentBody=$.dom(document.body);this._onGrab=$.observer();this._onDrag=$.observer();this._onDrop=$.observer();this._constrainX=false;this._constrainY=false;this._boundX=0;this._boundY=0;this._lastPoint=$.coord.zero();this._bearing=$.vector.zero();this._document=$.dom(document);this.state(new ap.dropped()).dragger().dragOffset($.coord.zero()).ontouchstart(this.grab,this,this._touchEvt).onmousedown(this.grab,this,this._mouseEvt)}ac.prototype={document:function(){return this._document},hitSize:function(l){return this.property("hitSize",l)},hitCoord:function(l){return this.property("hitCoord",l)},hitOffset:function(l){return this.property("hitOffset",l)},dragOffset:function(l){return this.property("dragOffset",l)},hitScrollOffset:function(l){return this.property("hitScrollOffset",l)},hitBoundedOffet:function(l){return this.property("hitBoundedOffet",l)},actor:function(){return this.get("actor")},strategy:function(){return this.get("strategy")},bearing:function(){return this.get("bearing")},bearingUp:function(){return this.bearing().y()<0},bearingDown:function(){return this.bearing().y()>0},bearingLeft:function(){return this.bearing().x()<0},bearingRight:function(){return this.bearing().x()>0},constrainX:function(){if(this._constrainX){return this}this._constrainX=true;this._boundX=this.boundedOffset().x();return this},unconstrainX:function(){this._constrainX=false},constrainY:function(){if(this._constrainY){return this}this._constrainY=true;this._boundY=this.boundedOffset().y();return this},unconstrainY:function(){this._constrainY=false},state:function(l){return this.set("state",l.context(this))},dragCoord:function(aZ){var a1=this.strategy().findCoord(aZ),aY=this.dragOffset(),aX=(this._constrainX)?this._boundX:a1.x()+aY.x(),a0=(this._constrainY)?this._boundY:a1.y()+aY.y(),l=$.point(aX,a0);this._bearing=l.distanceFrom(this._lastPoint);this._lastPoint=l;return l},dragger:function(){return this.set("actor",$.pinner(this.dom())).set("strategy",new aU(this))._setType("dragger")},sizer:function(){return this.set("actor",$.sizer(this.dom())).set("strategy",new w(this))._setType("sizer")},scroller:function(){return this.set("actor",$.scroller(this.dom())).set("strategy",new aB(this))._setType("scroller")},grab:function(l){this._onGrab.notify(l);this._state.grab(l);return this},drag:function(l){this._onDrag.notify(l);this._state.drag(l);return this},drop:function(l){this._onDrop.notify(l);this._state.drop(l);this._bearing=$.vector.zero();return this},onGrab:function(aX,l,aY){this._onGrab.add(aX,l,aY);return this},onDrag:function(aX,l,aY){this._onDrag.add(aX,l,aY);return this},onDrop:function(aX,l,aY){this._onDrop.add(aX,l,aY);return this},destroy:function(){this._onGrab.clear();this._onDrag.clear();this._onDrop.clear();this.removeEvent(this._mouseEvt).removeEvent(this._touchEvt)},disableSelect:function(aX){document.onselectstart=function(){return false};if(!$.exists(window.getSelection)){return this}this._mouseDisableId=$.uid("disable");this._touchDisableId=$.uid("disable");function l(){window.getSelection().removeAllRanges()}this._documentBody.onmousemove(l,null,this._mouseDisableId).ontouchmove(l,null,this._touchDisableId);return this},enableSelect:function(){document.onselectstart=null;var l=this._mouseDisableId,aX=this._touchDisableId,aY=this._documentBody;if($.exists(l)){aY.removeEvent(l)}if($.exists(aX)){aY.removeEvent(aX)}this._mouseDisableId=null;this._touchDisableId=null;return this},_setType:function(l){this._clearType().addClass($.str.format("ku-dragger-{0}",l));return this},_clearType:function(){this.removeClass("ku-dragger-dragger").removeClass("ku-dragger-sizer").removeClass("ku-dragger-scoller");return this}};$.Class.extend(ac,$.dom.Class);$.dnd=function(l){return new ac(l)};ap.dropped=function(){ap.dropped.base.call(this,ap)};ap.dropped.prototype={grab:function(aZ){$.evt.mute(aZ);var l=this.context(),aY=$.touch().canRead(aZ)?$.touch():$.mouse(),aX=aY.documentCoord(aZ).subtract(l.offset());l.document().ontouchmove(l.drag,l,$.uid()).ontouchend(l.drop,l,$.uid()).onmousemove(l.drag,l,$.uid()).onmouseup(l.drop,l,$.uid());l.disableSelect().addClass("ku-dragger-grabbed").hitSize(l.outerDims()).hitCoord(aX).hitOffset(l.offset()).hitScrollOffset(l.scrollOffset()).hitBoundedOffet(l.boundedOffset()).actor().to(l.dragCoord(aZ));this.state("grabbed")},drag:function(){return},drop:function(){return}};$.Class.extend(ap.dropped,$.abstractState);ap.grabbed=function(){ap.grabbed.base.call(this,ap)};ap.grabbed.prototype={grab:function(){return},drag:function(aX){$.evt.mute(aX);var l=this.context();l.actor().to(l.dragCoord(aX));this.context().redraw()},drop:function(l){this.context().enableSelect().removeClass("ku-dragger-grabbed").document().clearEvents();this.state("dropped")}};$.Class.extend(ap.grabbed,$.abstractState);function g(l){g.base.call(this,l);this._onEnd=$.observer();this.linear()}g.prototype={$to:function(l){return},$moveTo:function(l){return},$done:function(){this._onEnd.notify();return this},algorithm:function(l){this.$algorithm=l;return this},linear:function(l){return this.algorithm($.anime.algorithms.ease.linear(l))},spring:function(aX,l){this.algorithm($.anime.algorithms.spring(aX,l))},stop:function(){if(!$.exists(this.$tween)){return this}this.$tween.stop();return this},to:function(l){this.stop().$to(l).$done();return this},moveTo:function(l){this.stop().$moveTo(l);return this},onEnd:function(aX,l){if(!$.exists(aX)){return this}this._onEnd.add(aX,l);return this}};$.Class.extend(g,$.dom.Class);function v(l){$.dom(l).addClass("ku-fader");v.base.call(this,l)}v.prototype={$to:function(l){var aY=this.dom(),aX=$.dom(aY);aX.style("opacity",l*0.01);return this},$moveTo:function(l){var aY=this.dom(),aX=$.dom(aY),aZ=aX.style("opacity")||1;this.$tween=$.tween(function(a0){aX.style("opacity",a0*0.01)},aZ,l,this.$algorithm).onEnd(this.$done,this).start(aY)}};$.Class.extend(v,g);$.fader=function(l){return new v(l)};function Z(l){$.dom(l).addClass("ku-fitter");Z.base.call(this,l)}Z.prototype={$to:function(l){var aY=this.dom(),aX=$.dom(aY);aX.style("width",l.x()+"px");aX.style("height",l.y()+"px");return this},$moveTo:function(aZ){var aX=this.dom(),l=$.dom(aX),aY=l.outerDims();this.$tween=$.tween(function(a0){l.style("width",a0.x()+"px");l.style("height",a0.y()+"px")},aY,am(this,aZ),this.$algorithm).onEnd(this.$done,this).start(aX)}};$.Class.extend(Z,g);function am(l,aY){var aZ=aY.y()/aY.x(),aX=$.dom(l.dom()),a3=aX.outerDims(),a0=a3.y()/a3.x(),a4=isNaN(a0)?1:a0,a2=a3.x(),a1=a3.y();if((a4<aZ)||(a4==aZ)){a2=aY.x();a1=aY.x()*a0}if(a4>aZ){a2=aY.y()/a0;a1=aY.y()}return $.coord(a2,a1)}$.fitter=function(l){return new Z(l)};function n(l){$.dom(l).addClass("ku-pinner");n.base.call(this,l)}n.prototype={$to:function(l){var aY=this.dom(),aX=$.dom(aY);aX.style("left",l.x()+"px");aX.style("top",l.y()+"px");return this},$moveTo:function(a2){var a0=this.dom(),aZ=$.dom(a0),aY=aZ.offset(),aX=$.findOffset(a0.parentNode),l=($.coord.canParse(aX))?$.coord.parse(aX):$.coord.zero(),a1=aY.subtract(l);this.$tween=$.tween(function(a3){aZ.style("left",a3.x()+"px");aZ.style("top",a3.y()+"px")},a1,a2,this.$algorithm).onEnd(this.$done,this).start(a0)}};$.Class.extend(n,g);$.pinner=function(l){return new n(l)};function J(l){$.dom(l).addClass("ku-scoller");J.base.call(this,l)}J.prototype={$to:function(l){var aY=this.dom(),aX=$.dom(aY);aX.style("scrollLeft",l.x());aX.style("scrollTop",l.y());return this},$moveTo:function(a2){var a0=this.dom(),aZ=$.dom(a0),aY=aZ.scrollOffset(),aX=$.findOffset(a0.parentNode),l=($.coord.canParse(aX))?$.coord.parse(aX):$.coord.zero(),a1=aY.subtract(l);this.$tween=$.tween(function(a3){aZ.style("scrollLeft",a3.x());aZ.style("scrollTop",a3.y())},a1,a2,this.$algorithm).onEnd(this.$done,this).start(a0)}};$.Class.extend(J,g);$.scroller=function(l){return new J(l)};function B(l){$.dom(l).addClass("ku-sizer");B.base.call(this,l)}B.prototype={$to:function(l){var aY=this.dom(),aX=$.dom(aY);aX.style("width",l.x()+"px");aX.style("height",l.y()+"px");return this},$moveTo:function(aZ){var aX=this.dom(),l=$.dom(aX),aY=l.outerDims();this.$tween=$.tween(function(a0){l.style("width",a0.x()+"px");l.style("height",a0.y()+"px")},aY,aZ,this.$algorithm).onEnd(this.$done,this).start(aX)}};$.Class.extend(B,g);$.sizer=function(aY,aX,l){return new B(aY,aX,l)};function aJ(l,aX){$.dom(l).addClass("ku-styler");aJ.base.call(this,l);this._prop=aX}aJ.prototype={$moveTo:function(aY){var a2=this.dom(),a1=$.dom(a2),aZ=this._prop,a0=a1.style(aZ),l=$.ku.style,aX=l.getUnit(a0)||"",a3=l.toNumber(a0);this.$tween=$.tween(function(a4){a1.style(aZ,a4+aX)},a3,aY,this.$algorithm).onEnd(this.$done,this).start(a2)}};$.Class.extend(aJ,g);$.styler=function(l,aX){return new aJ(l,aX)};function T(aX,l){T.base.call(this,l);this._listeners=$.observer();this._ticks=0;this.fps(aX||30)}T.prototype={fps:function(l){this._interval=1000/l;return this.property("fps",l)},interval:function(){return this.get("interval")},listeners:function(){return this.get("listeners")},ticks:function(){return this.get("ticks")},start:function(){this._state.start();return this},stop:function(){this._state.stop();return this},add:function(aX,a4,l,aY){var a1=this,a3=aY||1,a2=l||$.uid("timeline"),a0=function(){if(!a1._ticks%a3==0){return}aX();aZ=aX},aZ=(!aY)?aX:a0;this._listeners.add(aZ,a4,a2);return this},remove:function(l){this._listeners.remove(l);return this},clear:function(){this._listeners.clear();return this},tick:function(){this._ticks++;return this}};$.Class.extend(T,$.abstractContext);$.timeline=function(){return C};T.started=function(){T.started.base.call(this,T)};T.started.prototype={start:function(){return},stop:function(){clearTimeout(ku_timeline);ku_timeline=null;this.state("stopped")}};$.Class.extend(T.started,$.abstractState);T.stopped=function(){T.stopped.base.call(this,T)};T.stopped.prototype={start:function(){var aY=this.context(),aX=aY.interval(),l=function(){aY.tick().listeners().notify();ku_timeline=setTimeout(l,aX)};l();this.state("started")},stop:function(){return}};$.Class.extend(T.stopped,$.abstractState);var C=new T(30,new T.stopped()).start();var ab=function(aZ,aY,l,aX){this.$method=aZ;this.$current=aY;this.$end=l;this.$algorithm=aX;this.$value=0;this._onEnd=$.observer();this._id=$.uid("tween")};ab.prototype={$exec:function(){return},$done:function(){this._onEnd.notify()},start:function(){$.timeline().add(this.$exec,this,this._id);return this},stop:function(){$.timeline().remove(this._id);return this},onEnd:function(aX,l){this._onEnd.add(aX,l);return this},clear:function(){this._onEnd.clear();return this}};$.Class.extend(ab,$.Class);var ad=function(aZ,aY,l,aX){ad.base.call(this,aZ,aY,l,aX);this.$value=$.coord.zero()};ad.prototype={$exec:function(){var a2=this.$method,a1=this.$current,l=this.$end;var aZ=this.$algorithm.calculate(a1.x(),l.x(),this.$value.x());var aX=this.$algorithm.calculate(a1.y(),l.y(),this.$value.y()),aY=$.coord(aZ,aX),a0=l.abs().subtract(a1.abs());if((Math.abs(aZ)<0.1)&&(a0.x()<1)&&(Math.abs(aX)<0.1)&&(a0.y()<1)){a2(l);this.stop()._onEnd.notify();return}this.$current=a1.add(aY);this.$value=aY;a2(this.$current)}};$.Class.extend(ad,ab);var a=function(aZ,aY,l,aX){a.base.call(this,aZ,aY,l,aX)};a.prototype={$exec:function(){var aZ=this.$method,aY=this.$current,l=this.$end,aX=this.$algorithm.calculate(aY,l,this.$value);if((Math.abs(aX)<0.1)&&(Math.abs(l-aY)<1)){aZ(l);this.stop().$done();return}this.$current=aY+aX;this.$value=aX;aZ(this.$current)}};$.Class.extend(a,ab);$.tween=function(aZ,aY,l,aX){return($.isNumber(aY)&&$.isNumber(l))?new a(aZ,aY,l,aX):new ad(aZ,aY,l,aX)};function I(a0,aZ,l,aX,a1,aY){I.base.call(this,a0);this.id($.uid("jsx-cell")).cIdx(aZ).cKey(l).rIdx(aX).rKey(a1).value(aY)}I.prototype={id:function(l){return this.property("id",l)},value:function(l){return this.property("value",l)},cIdx:function(l){if($.exists(l)){this.dom().cIdx=l}return this.property("cIdx",l)},rIdx:function(l){if($.exists(l)){this.dom().rIdx=l}return this.property("rIdx",l)},cKey:function(l){if($.exists(l)){this.dom().cKey=l}return this.property("cKey",l)},rKey:function(l){if($.exists(l)){this.dom().rKey=l}return this.property("rKey",l)}};$.Class.extend(I,$.dom.Class);$.cell=function(a0,aZ,l,aX,a1,aY){return new I(a0,aZ,l,aX,a1,aY)};$.cell.Class=I;function N(a0,aX,l,aY,aZ){N.base.call(this,a0);this.id($.uid()).col(aX).index(l).key(aY).value(aZ);this._cells=$.hash()}N.prototype={id:function(l){return this.property("id",l)},col:function(l){return this.property("col",l)},value:function(l){if($.exists(l)){this.content(l)}return this.property("value",l)},index:function(l){if($.exists(l)){this.dom().cIdx=l}return this.property("index",l)},key:function(l){if($.exists(l)){this.dom().cKey=l}return this.property("key",l)},findCell:function(l){return this._cells.find(l)},listCells:function(){return $.list(this._cells.values())},addCell:function(l){this._cells.add(l.rKey(),l);return this},removeCell:function(l){var aX=this._cells;aX.remove(l.rKey());if(aX.isEmpty()){$.dom(this._col).detach();this.detach()}return this},};$.Class.extend(N,$.dom.Class);$.column=function(a0,aX,l,aY,aZ){return new N(a0,aX,l,aY,aZ)};$.column.Class=N;function af(aX){$.cast(this,aX);this._dri=new $.iterator(this.rows.values());this.helper=$.create({tr:{"class":"ku-table-dragRow-helper"}});$.slider(this.helper,null,null,null,null,null,"dragger","vertical");this._isMoving=false;this._hitPoint;this._moveDom;function l(aY){return $.cast($.coord.parse($.findOffset(this.dom)),$.point)}this._dri.foreach(function(aY){$.evt.add(aY.dom,"mouseover",function(){if(!this._isMoving){return}var a3=aY.dom,aZ=this.body,a0=this.helper,a1=this._hitPoint,a2=l(a3);if(!a3.nextSibling){aZ.appendChild(a0)}else{if(a2.isAbove(a1)){aZ.insertBefore(a0,a3)}else{aZ.insertBefore(a0,a3.nextSibling)}}this._hitPoint=a2},this);$.dnd(aY.dom,function(){this.helper=aY.dom;this._isMoving=true;this._hitPoint=l(aY.dom);this._moveDom=aY.dom;this.body.insertBefore(this.helper,aY.dom);$.ku.css.addClass(this.body,"ku-table-draggableRow-dragging");$.ku.css.addClass(this._moveDom,"ku-table-draggableRow-moveDom")},null,function(){$.ku.css.removeClass(this.body,"ku-table-draggableRow-dragging");$.ku.css.removeClass(this._moveDom,"ku-table-draggableRow-moveDom");$.ku.swapDom(this.helper,this._moveDom);this._isMoving=false;this._moveDom=null;this.format()},this)},this)}$.draggableRowDecorator=function(l){return new af(l)};function aw(l){$.cast(this,l);this._sci=new $.iterator(this.columns.values());this._sci.foreach(function(aZ){var aY=aZ.dom,aX=$.create({a:{"class":"ku-table-col-sizer"}});new $.slider(aY,aX,null,null,null,null,"sizer","horizontal");aY.appendChild(aX)})}function aA(l){$.cast(this,l);this._isAsc=false;this._asc=new $.sorter(sorter.strategy.asc);this._des=new $.sorter(sorter.strategy.des);this._sortci=new $.iterator(this.columns.values());this._sortci.foreach(function(aZ){var aX=new $.iterator(aZ.cells.values()),aY=$.create({a:{"class":"ku-table-col-sorter"}});aZ.dom.appendChild(aY);$.evt.add(aY,"click",function(){var a8=[],a0=this._isAsc,a9=(a0)?this._asc:this._des,a2="ku-table-col-sorter-{0}",a5=$.str.format(a2,"asc"),a3=$.str.format(a2,"dec"),a7=(a0)?a5:a3;aX.foreach(function(ba){a8[a8.length]=ba.dom});this._isAsc=!this._isAsc;var a6=a9.sort(a8),a1=a6.length,a4=this.body;$.clearNode(a4);while(a1--){a4.appendChild(this.rows.find(a6[i].rIdx).dom)}$.ku.css.removeClass(aY,a5);$.ku.css.removeClass(aY,a3);$.ku.css.addClass(aY,a7);this.format()},this)},this)}function L(){L.base.call(this)}L.prototype={table:function(l){return this.set("table",l)},createColumn:function(aX,aY,aZ){var l=$.create({col:{}}),a0=$.create({th:{"ku-key":aY},content:$.create({span:{"class":"ku-table-head-content"},content:aZ})});return $.column(a0,l,aX,aY,aZ)},createRow:function(l,aX){var aY=$.create({tr:{"class":"ku-table-row"}});return $.row(aY,l,aX)},createCell:function(a1,a0,aX,aZ,a3){var aY=this._table,a2=$.create({td:{"class":"ku-table-cell"},content:a1}),l=$.cell(a2,a0,aX,aZ,a3,a1).onclick(function(){aY.selectCell(l)},this);return l}};$.Class.extend(L,$.Class);function ax(aY,l,aX){ax.base.call(this,aY);this.id($.uid()).index(l).key(aX);this._cells=$.hash()}ax.prototype={id:function(l){return this.property("id",l)},index:function(l){if($.exists(l)){this.dom().rIdx=l}return this.property("index",l)},key:function(l){if($.exists(l)){this.dom().rKey=l}return this.property("key",l)},findCell:function(l){return this._cells.find(l)},listCells:function(){return $.list(this._cells.values())},addCell:function(l){this._dom.appendChild(l.dom());this._cells.add(l.cKey(),l);return this},removeCell:function(l){this._dom.removeChild(l.dom());this._cells.remove(l.cKey());return this}};$.Class.extend(ax,$.dom.Class);$.row=function(aZ,l,aX,aY){return new ax(aZ,l,aX,aY)};$.row.Class=ax;function ae(aZ){var a3=$.create({table:{"class":"ku-table",cellspacing:0}});ae.base.call(this,a3);var aY=$.create({colgroup:{"class":"ku-table-colgroup"}}),aX=$.create({caption:{"class":"ku-table-caption"}}),a1=$.create({thead:{"class":"ku-table-head"}}),a2=$.create({tr:{"class":"ku-table-head-row"}}),l=$.create({tbody:{"class":"ku-table-body"}}),a0=$.create({tfoot:{"class":"ku-table-foot"}});this._columns=new $.hash();this._rows=new $.hash();this._cells=new $.hash();this._onCellSelect=$.observer();this.appendChild(aY).colgroup(aY).appendChild(aX).caption(aX).appendChild(a1).head(a1).appendChild(a2).headRow(a2).appendChild(l).body(l).appendChild(a0).foot(a0).factory(aZ||new L()).head().appendChild(this.headRow())}ae.prototype={title:function(l){if($.isString(l)){this.caption().innerHTML=l}else{if($.exists(l)){this.caption().appendChild(l)}}return this.property("title",l)},factory:function(l){return this.property("factory",l.table(this))},caption:function(l){return this.property("caption",l)},colgroup:function(l){return this.property("colgroup",l)},head:function(l){return this.property("head",l)},headRow:function(l){return this.property("headRow",l)},body:function(l){return this.property("body",l)},foot:function(l){return this.property("foot",l)},listColumns:function(){return $.list(this._columns.values())},listRows:function(){return $.list(this._rows.values())},listCells:function(){return $.list(this._cells.values())},selectCell:function(l){this._onCellSelect.notify(l);return this},onCellSelect:function(aX,l){this._onCellSelect.add(aX,l);return this},addColumn:function(aX,a0,aZ){var l=this._columns,aY=this._rows;if(l.containsKey(aX)){return this._updateColumn(aX,a0,aZ)}else{return this._addColumn(aX,a0,aZ)}},_addColumn:function(l,aZ,aY){var aX=this._factory.createColumn($.uid(),l,aY);this._columns.add(aX.key(),aX);$.list(this._rows.values()).each(function(a0){this.addCell(a0,aX,aZ[a0.key()])},this);this._colgroup.appendChild(aX.col());this._headRow.appendChild(aX.dom());return this},_updateColumn:function(l,aZ,aY){var aX=this._columns.find(l);$.list(his._rows.values()).each(function(a0){this.findCell(a0.key(),aX.key()).value(aZ[a0.key()])},this);if($.exists(aY)){aX.value(aY)}return this},findColumn:function(l){return this._columns.find(l)},removeColumn:function(l){var aY=this._rows,aX=this.findColumn(l);if(!$.exists(aX)){return this}$.list(aY.values()).each(function(aZ){this.removeCell(aX.findCell(aZ.key()))},this);this._columns.remove(aX.key());return this},addRow:function(aX,aZ){var aY=this._rows,l=this._columns;if(aY.containsKey(aX)){return this._updateRow(aX,aZ)}else{return this._addRow(aX,aZ)}},_addRow:function(l,aX){var aY=this._factory.createRow($.uid(),l);this._rows.add(aY.key(),aY);$.list(this._columns.values()).each(function(aZ){this.addCell(aY,aZ,aX[aZ.key()])},this);this.body().appendChild(aY.dom());return this},_updateRow:function(l,aX){var aY=this._rows.find(l);$.list(this._columns.values()).each(function(aZ){this.findCell(aY.key(),aZ.key()).value(aX[aZ.key()])},this);return this},findRow:function(l){return this._rows.find(l)},removeRow:function(aX){var l=this._columns,aY=this.findRow(aX);if(!$.exists(aY)){return this}$.list(l.values()).each(function(aZ){this.removeCell(aY.findCell(aZ.key()))},this);this._rows.remove(aY.key());return this},addCell:function(aZ,aX,aY){var l=this._factory.createCell(aY,aX.index(),aX.key(),aZ.index(),aZ.key());aX.addCell(l);aZ.addCell(l);this._cells.add(l.id(),l);return this},findCellById:function(l){return this._cells.find(l)},findCell:function(aZ,aX){var l=$.list(this._cells.values()),aY;l.each(function(a0){if((a0.rKey()==aZ)&&(a0.cKey()==aX)){aY=a0;l.quit()}});return aY},removeCell:function(l){this._cells.remove(l.id());this._columns.find(l.cKey()).removeCell(l);this._rows.find(l.rKey()).removeCell(l);return this},format:function(){var l=0,aX="ku-table-row-even",aY="ku-table-row-odd",aZ=function(){(l%2==0)?aX:aY};this._rows.each(function(a0){a0.removeClass(aX).removeClass(aY).addClass(aZ());l++})},toObject:function(){return{title:this.title(),columns:this._columns.toObject(),rows:this._rows.toObject()}}};$.Class.extend(ae,$.dom.Class);$.table=function(l){return new ae(l)};$.table.Class=ae;ae.parseDom=function(a1){var aX=function(a4,a3){return a4.getElementsByTagName(a3)};ae=$.ele(a1),cols=aX(aX((aX(ae,"thead")[0]),"tr")[0],"th"),rows=aX((aX(ae,"tbody")[0]),"tr"),caption=aX(ae,"caption")[0],title=(!caption)?"":caption.innerHTML,t=new $.table(title),S=cols.length,m=rows.length,c=[];while(i--){var a0=cols[i],l=$.ku.getText(a0)||$.uid("table-column");c[c.length]=l;t.addColumn(l,a0.innerHTML)}while(m--){var aY=aX(rows[j],"td"),a2=aY.length,aZ={};while(a2--){aZ[c[l]]=aY[l].innerHTML}t.addRow(aZ)}return t};ae.parseObject=function(aY){var l=new $.table(aY.title),a0=aY.columns,aX=aY.rows;for(var aZ in a0){l.addColumn(aZ,a0[aZ])}for(var aZ in aX){l.addRow(aX[aZ])}return l};var q=function(){q.base.call(this,$.create({div:{"class":"ku-calendar"}}));var l=$.create({div:{"class":"ku-sheet"}});this._sheetContainer=$.dom(l);this._onShowDates=$.observer();this._onShowMonths=$.observer();this._onShowYears=$.observer();this._onSelect=$.observer();this._sheet;this.dayPoint($.dayPoint.today()).localization($.ku.localization.en).sheetFactory($.clickableSheetFactory()).dom().appendChild(l)};q.prototype={dayPoint:function(l){return this.property("dayPoint",l)},localization:function(l){return this.property("localization",l)},sheetFactory:function(l){return this.set("sheetFactory",l)},isShowingDates:function(){return this._isShowingDates},isShowingMonths:function(){return this._isShowingMonths},isShowingYears:function(){return this._isShowingYears},nextDay:function(){this.dayPoint(this.dayPoint().nextDay());return this},prevDay:function(){this.dayPoint(this.dayPoint().prevDay());return this},nextMonth:function(){this.dayPoint(this.dayPoint().nextMonth());return this},prevMonth:function(){this.dayPoint(this.dayPoint().prevMonth());return this},nextYear:function(){this.dayPoint(this.dayPoint().nextYear());return this},prevYear:function(){this.dayPoint(this.dayPoint().prevYear());return this},showDates:function(){return this._showSheet("createDatesheet")._currentView(false,false,true)},showMonths:function(){return this._showSheet("createMonthsheet")._currentView(false,true,false)},showYears:function(){return this._showSheet("createYearsheet")._currentView(true,false,false)},findCell:function(l){return this._sheet.findCell(l)},each:function(aX,l){this._sheet.each(aX,l);return this},select:function(l){this._sheet.select(l);return this},onSelect:function(aX,l){this._onSelect.add(aX,l);return this},onShowDates:function(aX,l){this._onShowDates.add(aX,l);return this},onShowMonths:function(aX,l){this._onShowMonths.add(aX,l);return this},onShowYears:function(aX,l){this._onShowYears.add(aX,l);return this},_currentView:function(aX,l,aY){this._isShowingYears=aX;this._isShowingMonths=l;this._isShowingDates=aY;if(aX){this._onShowYears.notify()}if(l){this._onShowYears.notify()}if(aY){this._onShowDates.notify()}return this},_showSheet:function(aY){var l=this._sheet;if($.exists(l)){l.destroy()}var aX=this._sheetFactory[aY](this.dayPoint(),this._localization).onSelect(this._onSelect.notify,this._onSelect);this._sheetContainer.clear().appendChild(aX.dom());this._sheet=aX;return this}};$.Class.extend(q,$.dom.Class);$.calendar=function(){return new q()};var aS=function(aZ){aS.base.call(this,$.create({div:{"class":"ku-calendar-controls"}}));this._calendar=aZ;var a1=$.dom($.create({div:{"class":"ku-calendar-title"}})),aY=$.dom($.create({button:{"class":"ku-calendar-month"}})).onclick(this.showMonths,this),aX=$.dom($.create({button:{"class":"ku-calendar-year"}})).onclick(this.showYears,this),l=$.dom($.create({button:{"class":"ku-calendar-prevButton"}})).onclick(function(){this._prevAction()},this),a0=$.dom($.create({button:{"class":"ku-calendar-nextButton"}})).onclick(function(){this._nextAction()},this);$.dom(this.dom()).appendChild(a1.appendChild(aY.dom()).appendChild(aX.dom()).dom()).appendChild(l.dom()).appendChild(a0.dom()).appendChild(aZ.dom());this._title=a1;this._month=aY;this._year=aX;this._prevButton=l;this._nextButton=a0;this.onSelect(this._displayDates,this)};aS.prototype={dayPoint:function(l){var aX=this._calendar;if(!$.exists(l)){return aX.dayPoint()}aX.dayPoint(l);return this},localization:function(aX){var l=this._calendar;if(!$.exists(aX)){return l.localization()}l.localization(aX);return this},sheetFactory:function(l){this._calendar.sheetFactory(l);return this},nextDay:function(){this._calendar.nextDay();return this},prevDay:function(){this._calendar.prevDay();return this},nextMonth:function(){this._calendar.nextMonth();return this},prevMonth:function(){this._calendar.prevMonth();return this},nextYear:function(){this._calendar.nextYear();return this},prevYear:function(){this._calendar.prevYear();return this},showDates:function(){var aY=this._calendar,l=aY.localization().month.name,aX=aY.dayPoint();aY.showDates();this._month.html(l[aX.month()]);this._year.html(aX.year());this._prevAction=this._prevMonth;this._nextAction=this._nextMonth;return this},showMonths:function(){this._calendar.showMonths();var l=function(){return};this._prevAction=l;this._nextAction=l;return this},showYears:function(){this._calendar.showYears();this._prevAction=this._prevYears;this._nextAction=this._nextYears;return this},findCell:function(l){return this._calendar.findCell(l)},each:function(aX,l){this._calendar.each(aX,l);return this},select:function(l){this._calendar.select(l);return this},onSelect:function(aX,l){this._calendar.onSelect(aX,l);return this},onShowDates:function(aX,l){this._calendar.onShowDates(aX,l);return this},onShowMonths:function(aX,l){this._calendar.onShowMonths(aX,l);return this},onShowYears:function(aX,l){this._calendar.onShowYears(aX,l);return this},_prevMonth:function(){this.prevMonth().showDates()},_nextMonth:function(){this.nextMonth().showDates()},_prevYears:function(){this.dayPoint(this.dayPoint().add(-12,0,0)).showYears()},_nextYears:function(){this.dayPoint(this.dayPoint().add(12,0,0)).showYears()},_displayDates:function(l){var a3=this._calendar,aX=a3.isShowingDates(),a2=a3.isShowingMonths(),a1=a3.isShowingYears(),aY=a3.dayPoint(),aZ=l.value(),a0;if(a1){a0=$.dayPoint(aZ.year(),aY.month(),aY.date())}if(a2){a0=$.dayPoint(aY.year(),aZ.month(),aY.date())}if(aX){a0=aZ}this.dayPoint(a0);if(a1||a2||(aY.month()!=aZ.month())){this.showDates()}}};$.Class.extend(aS,$.dom.Class);$.calendarControlsDecorator=function(l){return new aS(l)};function aW(){}aW.prototype={createDatesheet:function(l,aX){return $.datesheet(l,aX,$.table($.clickableDateSheetTableFactory(l,aX)))},createMonthsheet:function(l,aX){return $.monthsheet(l,aX,$.table($.clickableMonthSheetTableFactory(l,aX)))},createYearsheet:function(l,aX){return $.yearsheet(l,aX,$.table($.clickableYearSheetTableFactory(l,aX)))}};$.clickableSheetFactory=function(){return new aW()};function R(l,aX){R.base.call(this);this._dayPoint=l;this._localization=aX}R.prototype={$setCellAction:function(l){return l},table:function(l){this.$table=l;return this.set("table",l)},createColumn:function(aX,aY,aZ){var aX=this._table.listColumns().count(),l=$.create({col:{}}),a0=$.create({th:{"ku-key":aY},content:$.create({span:{"class":"ku-table-head-content"},content:aZ})});return $.column(a0,l,aX,aY,aZ)},createRow:function(aX,aY){var aX=this._table.listRows().count(),l=(aX%2==0)?"ku-table-row ku-table-row-even":"ku-table-row ku-table-row-odd",aZ=$.create({tr:{"class":l}});return $.row(aZ,aX,aY)},createCell:function(a2,l,aX,aY,aZ){var a4=this._table,a1=$.dayPoint.today(),a0=$.create({td:{"class":$.str.format("ku-date-day-{0} ku-date-week-{1}",l,aY)},content:$.str.format("<span class='ku-datesheet-cell-date'>{0}</span>",a2.date())}),a3=$.cell(a0,l,aX,aY,aZ,a2).addClass("ku-sheet-date").id(a2.toString());if(a2.isBefore(a1)){a3.addClass("ku-datesheet-past")}if(a2.equals(a1)){a3.addClass("ku-datesheet-present")}if(a2.isAfter(a1)){a3.addClass("ku-datesheet-future")}if(a2.isWeekday()){a3.addClass("ku-datesheet-weekday")}if(a2.isWeekend()){a3.addClass("ku-datesheet-weekend")}if((a2.month()<this._dayPoint.month())||((a2.month()==12)&&(this._dayPoint.month()==1))){a3.addClass("ku-datesheet-lastMonth")}if(a2.month()==this._dayPoint.month()){a3.addClass("ku-datesheet-thisMonth")}if((a2.month()>this._dayPoint.month())||((a2.month()==1)&&(this._dayPoint.month()==12))){a3.addClass("ku-datesheet-nextMonth")}return this.$setCellAction(a3)}};$.Class.extend(R,$.Class);function V(l,aX){V.base.call(this);this._dayPoint=l;this._localization=aX}V.prototype={$setCellAction:function(l){return l},table:function(l){this.$table=l;return this.set("table",l)},createColumn:function(aX,aY,aZ){var aX=this._table.listColumns().count(),l=$.create({col:{}}),a0=$.create({th:{"ku-key":aY},content:$.create({span:{"class":"ku-table-head-content"},content:aZ})});return $.column(a0,l,aX,aY,aZ)},createRow:function(aX,aY){var aX=this._table.listRows().count(),l=(aX%2==0)?"ku-table-row ku-table-row-even":"ku-table-row ku-table-row-odd",aZ=$.create({tr:{"class":l}});return $.row(aZ,aX,aY)},createCell:function(a0,aZ,aX,aY,a2){var a1=$.create({td:{"class":$.str.format("ku-month",aZ,aY)},content:this._localization.month.abbr[a0.month()]}),l=$.cell(a1,aZ,aX,aY,a2,a0).addClass("ku-sheet-month").id(a0.month().toString());return this.$setCellAction(l)}};$.Class.extend(V,$.Class);function d(l,aX){d.base.call(this);this._dayPoint=l;this._localization=aX}d.prototype={$setCellAction:function(l){return l},table:function(l){this.$table=l;return this.set("table",l)},createColumn:function(aX,aY,aZ){var aX=this._table.listColumns().count(),l=$.create({col:{}}),a0=$.create({th:{"ku-key":aY},content:$.create({span:{"class":"ku-table-head-content"},content:aZ})});return $.column(a0,l,aX,aY,aZ)},createRow:function(aX,aY){var aX=this._table.listRows().count(),l=(aX%2==0)?"ku-table-row ku-table-row-even":"ku-table-row ku-table-row-odd",aZ=$.create({tr:{"class":l}});return $.row(aZ,aX,aY)},createCell:function(a0,aZ,aX,aY,a2){var a1=$.create({td:{"class":$.str.format("ku-year",aZ,aY)},content:a0.year()}),l=$.cell(a1,aZ,aX,aY,a2,a0).addClass("ku-sheet-year").id(a0.year().toString());return this.$setCellAction(l)}};$.Class.extend(d,$.Class);function av(l,aX){av.base.call(this,l,aX)}av.prototype={$setCellAction:function(l){return l.onclick(function(){this.$table.selectCell(l)},this)}};$.Class.extend(av,R);$.clickableDateSheetTableFactory=function(l,aX){return new av(l,aX)};function K(l,aX){K.base.call(this,l,aX)}K.prototype={$setCellAction:function(l){return l.onclick(function(){this.$table.selectCell(l)},this)}};$.Class.extend(K,V);$.clickableMonthSheetTableFactory=function(l,aX){return new K(l,aX)};function Q(l,aX){Q.base.call(this,l,aX)}Q.prototype={$setCellAction:function(l){return l.onclick(function(){this.$table.selectCell(l)},this)}};$.Class.extend(Q,d);$.clickableYearSheetTableFactory=function(l,aX){return new Q(l,aX)};var F=function(l,aX){F.base.call(this,l);this.localization(aX);this._onSelect=$.observer()};F.prototype={$findCell:function(l){return null},localization:function(l){return this.property("localization",l)},each:function(aX,l){this.$sheet.listCells().each(aX,l);return this},findCell:function(l){return this.$findCell(l)},selectCell:function(l){if(!$.exists(l)){return this}this._onSelect.notify(l);return this},select:function(l){return this.selectCell(this.findCell(l))},onSelect:function(aX,l){this._onSelect.add(aX,l);return this},destroy:function(){this.$sheet.listCells().each(function(l){if($.exists(l.deallocate)){l.deallocate()}l.clearEvents();return this})}};$.Class.extend(F,$.dom.Class);var h=function(l,aY,aX){this._firstDateOfSheet=x(l);this.$sheet=aX.onCellSelect(this.selectCell,this);h.base.call(this,this.$sheet.dom(),aY);aC(this);aa(this)};h.prototype={$findCell:function(l){return this.$sheet.findCellById(l.toString())}};$.Class.extend(h,F);$.datesheet=function(l,aY,aX){return(new h(l,aY,aX))};function x(l){var aY=l.firstDayOfMonth(),aZ=l.firstDayOfMonth(),aX=false;while(aZ.day()>0||!aX){if(aZ.day()==0){aX=true}aZ=aZ.prevDay()}return aZ}function aC(aY){var a1=aY.localization().day.abbr,a0=aY.$sheet,aZ=7,aX=0;while(aX<aZ){var l=a1[aX];a0.addColumn(l,{},l);aX++}}function aa(aZ){var a0=aZ.$sheet,l=aZ._firstDateOfSheet,aY=0;while(aY<7){var aX=ao(aZ,l);l=l.add(0,0,7);a0.addRow($.uid(),aX);aY++}}function ao(aX,l){var aY=l,aZ={};aX.$sheet.listColumns().each(function(a0){aZ[a0.key()]=aY;aY=aY.nextDay()});return aZ}var M=function(l,aY,aX){this._firstDateOfSheet=aH(l);this.$sheet=aX.onCellSelect(this.selectCell,this);M.base.call(this,this.$sheet.dom(),aY);e(this);U(this)};M.prototype={$findCell:function(l){return this.$sheet.findCellById(l.month())}};$.Class.extend(M,F);$.monthsheet=function(l,aY,aX){return(new M(l,aY,aX))};function aH(l){return $.dayPoint(l.year(),1,l.date())}function e(aZ){var aX=aZ.localization().month.abbr,a0=aZ.$sheet,l=4,aY=1;while(aY<=l){a0.addColumn(aY,null,"");aY++}}function U(aZ){var a0=aZ.$sheet,aX=aZ._firstDateOfSheet,aY=1;while(aY<=3){var l=G(aZ,aX);aX=aX.add(0,4,0);a0.addRow($.uid(),l);aY++}}function G(aX,l){var aY=l,aZ={};aX.$sheet.listColumns().each(function(a0){aZ[a0.key()]=aY;aY=aY.nextMonth()});return aZ}var y=function(l,aY,aX){this._firstDateOfSheet=ah(l);this.$sheet=aX.onCellSelect(this.selectCell,this);y.base.call(this,this.$sheet.dom(),aY);P(this);E(this)};y.prototype={$findCell:function(l){return this.$sheet.findCellById(l.year())}};$.Class.extend(y,F);$.yearsheet=function(l,aY,aX){return(new y(l,aY,aX))};function ah(l){return l.add(-12,0,0)}function P(aZ){var l=aZ.localization().month.abbr,a0=aZ.$sheet,aX=5,aY=0;while(aY<aX){a0.addColumn(aY,null,"");aY++}}function E(aZ){var a0=aZ.$sheet,l=aZ._firstDateOfSheet,aY=0;while(aY<5){var aX=al(aZ,l);l=l.add(5,0,0);a0.addRow($.uid(),aX);aY++}}function al(aX,l){var aY=l,aZ={};aX.$sheet.listColumns().each(function(a0){aZ[a0.key()]=aY;aY=aY.nextYear()});return aZ}function p(l){p.base.call(this,l);this._id=$.uid("dropper");this._handle=this}p.prototype={id:function(l){return this.get("id")},value:function(l){return this.property("value",l)},handle:function(l){var aX;if($.exists(l)){aX=$.dom(l)}return this.property("handle",aX)},mouseEventId:function(l){return this.property("mouseEventId",l)},touchEventId:function(l){return this.property("touchEventId",l)},};$.Class.extend(p,$.dom.Class);$.dndScreenDropper=function(l){return new p(l)};var Y=function(){this._targets=$.hash();this._droppers=$.hash();this._onHit=$.observer();this._lastKnownCoord;this._helper=$.sprite($.create({div:{"class":"ku-dndScreen-helper"}})).onGrab(function(aX){var l=$.touch().canRead(aX)?$.touch():$.mouse();this._lastKnownCoord=l.documentCoord(aX)},this).onDrag(function(aX){var l=$.touch().canRead(aX)?$.touch():$.mouse();this._lastKnownCoord=l.documentCoord(aX)},this).onDrop(function(l){this._drop(l)},this);this._currentDropper};Y.prototype={addTarget:function(l){this._targets.add(l.id(),l);return this},removeTarget:function(l){this._targets.remove(l.id(),l);return this},addDropper:function(aY){var aZ=$.uid("dropperEvent"),l=$.uid("dropperEvent");function aX(a0){this._currentDropper=aY;this.activateHelper(a0,aY)}aY.mouseEventId(aZ).touchEventId(l).handle().onmousedown(aX,this,aZ).ontouchstart(aX,this,l);this._droppers.add(aY.id(),aY)},removeDropper:function(l){l.handle().removeEvent(l.touchEventId()).removeEvent(l.mouseEventId());this._droppers.remove(l.id())},activateHelper:function(aX,l){this._helper.appendTo(document.body).pinTo(l.offset().subtract(l.scrollOffset()).add($.window().scrollOffset())).content(l.cloneNode()).grab(aX)},deactivateHelper:function(){this._helper.html("").detach();this._currentDropper=undefined},clearTargets:function(){this._targets.clear();return this},clearDroppers:function(){var l=this._droppers;$.list(l.values()).each(function(aX){this.removeDropper(aX)},this);return this},clearAll:function(){this.clearTargets().clearDroppers();return this},clearListeners:function(){this._onHit.clear();return this},onHit:function(aX,l){this._onHit.add(aX,l);return this},_drop:function(aY){var l=this._findHitTarget(aY),aX=this._currentDropper;if($.exists(l)&&$.exists(aX)){this._onHit.notify(l,aX)}this.deactivateHelper()},_findHitTarget:function(aZ){var l=$.list(this._targets.values()),aY=$.touch().canRead(aZ)?$.touch():$.mouse(),aX=null,a0;try{a0=aY.documentCoord(aZ)}catch(aZ){a0=this._lastKnownCoord}l.each(function(a1){if(!a1.contains(a0)){return}aX=a1;l.quit()});return aX}};$.dndScreen=function(){return new Y()};function an(l){an.base.call(this,l);this._id=$.uid("target")}an.prototype={id:function(l){return this.get("id")},value:function(l){return this.property("value",l)},contains:function(aY){var aX=this.offset(),l=aX.add(this.outerDims());return $.rectangle(aX,l).contains(aY)}};$.Class.extend(an,$.dom.Class);$.dndScreenTarget=function(l){return new an(l)};function aI(){this._onKeyPressed=$.observer();k.base.call(this,$.create({div:{"class":"ku-keyboard"}}))}aI.prototype={addKey:function(l){$.onScreenKey(l).addClass($.str.format("ku-keyboard-key ku-key-{0}",l)).onPress(this._onKeyPressed.notify,this._onKeyPressed).appendTo(this.dom());return this},onKeyPressed:function(aX,l){this._onKeyPressed.add(aX,l);return this}};$.Class.extend(aI,$.dom.Class);$.onScreenKeyboard=function(){return new aI()};function aN(l){if(!$.isNumber(l)){$.ku4exception("onScreenKey",$.str.format("Invalid argument code:{0}",l))}this._value=$.key(l);this._onPress=$.observer();this._onRelease=$.observer();ai.base.call(this,$.create({button:{"class":"ku-keyboard-key"},content:this._value.toString()}));this.onmousedown(function(){this._onPress.notify(this._value)},this).ontouchstart(function(){this._onPress.notify(this._value)},this).onmouseup(function(){this._onRelease.notify(this._value)},this).ontouchend(function(){this._onRelease.notify(this._value)},this)}aN.prototype={onPress:function(aX,l){this._onPress.add(aX,l);return this},onRelease:function(aX,l){this._onRelease.add(aX,l);return this}};$.Class.extend(ai,$.dom.Class);$.onScreenKey=function(l){return new ai(l)};function u(aX){var l=aX||$.create({div:{"class":"ku-sprite"}});u.base.call(this,l);this.to().dragOn().force(0.4).mu(0.8)}u.prototype={force:function(l){return this.property("force",l)},mu:function(l){return this.property("mu",l)},algorithm:function(l){return this.set("algorithm",l)},to:function(){this._isTo=true;return this.algorithm($.anime.algorithms.jump())},spring:function(){this._isTo=false;return this.algorithm($.anime.algorithms.spring(this._force,this._mu))},ease:function(){this._isTo=false;return this.algorithm($.anime.algorithms.ease.linear(this._force,this._mu))},fitTo:function(aY,aX,l){return this._act("fitter",aY,aX,l)},sizeTo:function(aY,aX,l){return this._act("sizer",aY,aX,l)},pinTo:function(aY,aX,l){return this._act("pinner",aY,aX,l)},scrollTo:function(aY,aX,l){return this._act("scroller",aY,aX,l)},fadeTo:function(l,aY,aX){return this._act("fader",l,aY,aX)},growTo:function(aY,aX,l){return this.sizeTo(aY).pinTo(this.boundedOffset().subtract(aY.subtract(this.outerDims()).half()),aX,l)},_act:function(a2,a1,a0,aZ){var aX=$[a2](this.dom()).algorithm(this._algorithm),l="_"+a2,aY=this[l];if($.exists(aY)){aY.stop()}if($.exists(a0)){aX.onEnd(a0,aZ)}if(this._isTo){this[l]=aX.to(a1)}else{this[l]=aX.moveTo(a1)}return this},tween:function(aX,l){this._styler=$.styler(this.dom(),aX).algorithm(this._algorithm).moveTo(l);return this},clear:function(){if($.exists(this._fader)){this._fader.stop()}if($.exists(this._sizer)){this._sizer.stop()}if($.exists(this._fitter)){this._fitter.stop()}if($.exists(this._pinner)){this._pinner.stop()}if($.exists(this._scroller)){this._scroller.stop()}if($.exists(this._styler)){this._styler.stop()}return this},dragHandle:function(l){return this.property("dragHandle",l)},dragType:function(l){return this.set("dragType",l)},dragOffset:function(l){this._dnd.dragOffset(l);return this},dragger:function(){this._dnd.dragger();return this},sizer:function(){this._dnd.sizer();return this},scroller:function(){this._dnd.scroller();return this},dragOn:function(){this._dnd=$.dnd(this.dom()).onGrab(this.clear,this);return this},dragOff:function(){this._dnd.destroy();return this},onGrab:function(aX,l,aY){this._dnd.onGrab(aX,l,aY);return this},onDrag:function(aX,l,aY){this._dnd.onDrag(aX,l,aY);return this},onDrop:function(aX,l,aY){this._dnd.onDrop(aX,l,aY);return this},bearingUp:function(){return this._dnd.bearingUp()},bearingDown:function(){return this._dnd.bearingDown()},bearingLeft:function(){return this._dnd.bearingLeft()},bearingRight:function(){return this._dnd.bearingRight()},grab:function(l){this._dnd.grab(l);return this},drag:function(l){this._dnd.drag(l);return this},drop:function(l){this._dnd.drop(l);return this},constrainX:function(){this._dnd.constrainX();return this},unconstrainX:function(){this._dnd.unconstrainX();return this},constrainY:function(){this._dnd.constrainY();return this},unconstrainY:function(){this._dnd.unconstrainY();return this}};$.Class.extend(u,$.dom.Class);$.sprite=function(l){return new u(l)};$.sprite.Class=u;var aO=function(l,aX){this.$offset=0;this.$multiplier=aX;this._tooltip=l;this.overlap(0)};aO.prototype={$above:function(l,aY,aX){return},$below:function(l,aY,aX){return},$leftOf:function(l,aY,aX){return},$rightOf:function(l,aY,aX){return},overlap:function(l){return this.set("overlap",l)},above:function(a0){var aY=this._tooltip,l=aY.context(a0).context(),aZ=aY.pointer(),aX=aY.tooltip();this.$offset=this._overlap;this.$above(l,aZ,aX);return this},below:function(a0){var aY=this._tooltip,l=aY.context(a0).context(),aZ=aY.pointer(),aX=aY.tooltip();this.$offset=this._overlap;this.$below(l,aZ,aX);return this},leftOf:function(a0){var aY=this._tooltip,l=aY.context(a0).context(),aZ=aY.pointer(),aX=aY.tooltip();this.$offset=this._overlap;this.$leftOf(l,aZ,aX);return this},rightOf:function(a0){var aY=this._tooltip,l=aY.context(a0).context(),aZ=aY.pointer(),aX=aY.tooltip();this.$offset=this._overlap;this.$rightOf(l,aZ,aX);return this}};$.Class.extend(aO,$.Class);var aV=function(l,aX){aV.base.call(this,l,0.5)};aV.prototype={$above:function(l,aY,aX){aY.pinTo(l.offset().subtract(aY.outerHeight()).add($.coord(l.outerDims().subtract(aY.outerDims()).x()*this.$multiplier,0)));aX.pinTo(aY.offset().subtract(aX.outerHeight()).add($.coord(0,this.$offset)).add($.coord(aY.outerDims().subtract(aX.outerDims()).x()*this.$multiplier,0)));aY.fadeTo(100);aX.fadeTo(100);return this},$below:function(l,aY,aX){aY.pinTo(l.offset().add(l.outerHeight()).add($.coord(l.outerDims().subtract(aY.outerDims()).x()*this.$multiplier,0)));aX.pinTo(aY.offset().add(aY.outerHeight()).subtract($.coord(0,this.$offset)).add($.coord(aY.outerDims().subtract(aX.outerDims()).x()*this.$multiplier,0)));aY.fadeTo(100);aX.fadeTo(100);return this},$leftOf:function(l,aY,aX){aY.pinTo(l.offset().subtract(aY.outerWidth()).add($.coord(0,l.outerDims().subtract(aY.outerDims()).y()*this.$multiplier)));aX.pinTo(aY.offset().subtract(aX.outerWidth()).add($.coord(this.$offset,0)).add($.coord(0,aY.outerDims().subtract(aX.outerDims()).y()*this.$multiplier)));aY.fadeTo(100);aX.fadeTo(100);return this},$rightOf:function(l,aY,aX){aY.pinTo(l.offset().add(l.outerWidth()).add($.coord(0,l.outerDims().subtract(aY.outerDims()).y()*this.$multiplier)));aX.pinTo(aY.offset().add(aY.outerWidth()).subtract($.coord(this.$offset,0)).add($.coord(0,aY.outerDims().subtract(aX.outerDims()).y()*this.$multiplier)));aY.fadeTo(100);aX.fadeTo(100);return this}};$.Class.extend(aV,aO);var ay=function(l,aX){ay.base.call(this,l,0)};ay.prototype={$above:function(l,aY,aX){aY.pinTo(l.offset().subtract(aY.outerHeight()).add($.coord(this.$offset,0)).add($.coord(l.outerDims().subtract(aY.outerDims()).x()*this.$multiplier,0)));aX.pinTo(aY.offset().subtract(aX.outerHeight()).add($.coord(-this.$offset,this.$offset)).add($.coord(aY.outerDims().subtract(aX.outerDims()).x()*this.$multiplier,0)));aY.fadeTo(100);aX.fadeTo(100);return this},$below:function(l,aY,aX){aY.pinTo(l.offset().add(l.outerHeight()).add($.coord(this.$offset,0)).add($.coord(l.outerDims().subtract(aY.outerDims()).x()*this.$multiplier,0)));aX.pinTo(aY.offset().add(aY.outerHeight()).subtract($.coord(this.$offset,this.$offset)).add($.coord(aY.outerDims().subtract(aX.outerDims()).x()*this.$multiplier,0)));aY.fadeTo(100);aX.fadeTo(100);return this},$leftOf:function(l,aY,aX){aY.pinTo(l.offset().subtract(aY.outerWidth()).add($.coord(0,this.$offset)).add($.coord(0,l.outerDims().subtract(aY.outerDims()).y()*this.$multiplier)));aX.pinTo(aY.offset().subtract(aX.outerWidth()).add($.coord(this.$offset,-this.$offset)).add($.coord(0,aY.outerDims().subtract(aX.outerDims()).y()*this.$multiplier)));aY.fadeTo(100);aX.fadeTo(100);return this},$rightOf:function(l,aY,aX){aY.pinTo(l.offset().add(l.outerWidth()).add($.coord(0,this.$offset)).add($.coord(0,l.outerDims().subtract(aY.outerDims()).y()*this.$multiplier)));aX.pinTo(aY.offset().add(aY.outerWidth()).subtract($.coord(this.$offset,this.$offset)).add($.coord(0,aY.outerDims().subtract(aX.outerDims()).y()*this.$multiplier)));aY.fadeTo(100);aX.fadeTo(100);return this}};$.Class.extend(ay,aO);var ak=function(l,aX){ak.base.call(this,l,1)};ak.prototype={$above:function(l,aY,aX){aY.pinTo(l.offset().subtract(aY.outerHeight()).add($.coord(-this.$offset,0)).add($.coord(l.outerDims().subtract(aY.outerDims()).x()*this.$multiplier,0)));aX.pinTo(aY.offset().subtract(aX.outerHeight()).add($.coord(this.$offset,this.$offset)).add($.coord(aY.outerDims().subtract(aX.outerDims()).x()*this.$multiplier,0)));aY.fadeTo(100);aX.fadeTo(100);return this},$below:function(l,aY,aX){aY.pinTo(l.offset().add(l.outerHeight()).add($.coord(-this.$offset,0)).add($.coord(l.outerDims().subtract(aY.outerDims()).x()*this.$multiplier,0)));aX.pinTo(aY.offset().add(aY.outerHeight()).add($.coord(this.$offset,-this.$offset)).add($.coord(aY.outerDims().subtract(aX.outerDims()).x()*this.$multiplier,0)));aY.fadeTo(100);aX.fadeTo(100);return this},$leftOf:function(l,aY,aX){aY.pinTo(l.offset().subtract(aY.outerWidth()).add($.coord(0,-this.$offset)).add($.coord(0,l.outerDims().subtract(aY.outerDims()).y()*this.$multiplier)));aX.pinTo(aY.offset().subtract(aX.outerWidth()).add($.coord(this.$offset,this.$offset)).add($.coord(0,aY.outerDims().subtract(aX.outerDims()).y()*this.$multiplier)));aY.fadeTo(100);aX.fadeTo(100);return this},$rightOf:function(l,aY,aX){aY.pinTo(l.offset().add(l.outerWidth()).add($.coord(0,-this.$offset)).add($.coord(0,l.outerDims().subtract(aY.outerDims()).y()*this.$multiplier)));aX.pinTo(aY.offset().add(aY.outerWidth()).add($.coord(-this.$offset,this.$offset)).add($.coord(0,aY.outerDims().subtract(aX.outerDims()).y()*this.$multiplier)));aY.fadeTo(100);aX.fadeTo(100);return this}};$.Class.extend(ak,aO);var A=function(){A.base.call(this);this.pointer($.sprite($.create({div:{"class":"ku-tooltip-pointer"}})).hide().dragOff().to()).tooltip($.sprite($.create({div:{"class":"ku-tooltip"}})).hide().dragOff().to()).leftJustify();this._id=$.uid("tip");this._onShow=$.observer();this._onHide=$.observer()};A.prototype={calibrate:function(l){return this.property("calibrate",l)},pointer:function(l){return this.property("pointer",l)},tooltip:function(l){return this.property("tooltip",l)},strategy:function(l){return this.property("strategy",l)},message:function(l){return this.property("message",l)},context:function(aX){var l=($.exists(aX))?$.dom(aX):aX;return this.property("context",l)},center:function(){return this.strategy(new aV(this))},leftJustify:function(){return this.strategy(new ay(this))},rightJustify:function(){return this.strategy(new ak(this))},onShow:function(aX,l){this._onShow.add(aX,l);return this},onHide:function(aX,l){this._onHide.add(aX,l);return this},show:function(aY){var l=aY||this._message,aX=l||"";this._pointer.fadeTo(0).appendTo(document.body).show();this._tooltip.fadeTo(0).appendTo(document.body).html("").content(aX).show();this._onShow.notify();return this},hide:function(){this._pointer.hide().detach();this._tooltip.hide().detach();this._onHide.notify();return this},at:function(a2,bb){var a9=$.window(),a4=$.dom(a2),a0=$.point.zero(),aY=a9.dims(),a7=a4.offset(),a6=a7.add(a4.outerDims()),aX=this._tooltip.outerDims(),a3=a6.add(aX),ba=a7.subtract(aX),a1=!a3.isRightOf(aY),a8=!a3.isBelow(aY),l=!ba.isLeftOf(a0),a5=!ba.isAbove(a0),aZ={rightOf:a1,below:a8,leftOf:l,above:a5};if(aZ[bb[0]]){return this[bb[0]](a2)}if(aZ[bb[1]]){return this[bb[1]](a2)}if(aZ[bb[2]]){return this[bb[2]](a2)}if(aZ[bb[3]]){return this[bb[3]](a2)}return this.rightOf(a2)},above:function(l){return this._locate(l,"bottom","above")},below:function(l){return this._locate(l,"top","below")},leftOf:function(l){return this._locate(l,"right","leftOf")},rightOf:function(l){return this._locate(l,"left","rightOf")},_locate:function(aY,aX,l){this.strategy().overlap(aT(this,aX))[l](aY);aQ(this,l);this._pointer.fadeTo(100);this._tooltip.fadeTo(100);return this}};$.Class.extend(A,$.Class);$.tooltip=function(){return new A()};function aT(aY,aX){var l=aY.tooltip().style($.str.format("border-{0}-width",aX));return $.ku.style.toNumber(l)}function aQ(aY,l){var aZ="ku-{0}",aX=["above","below","leftOf","rightOf"],a0=aY.pointer();for(var a1 in aX){a0.removeClass($.str.format(aZ,aX[a1]))}a0.addClass($.str.format(aZ,l))}function z(){var aX=$.create({div:{"class":"ku-responsebox"}}),l=$.uid("responsebox");z.base.call(this,aX);this._contentDom=$.sprite($.create({div:{"class":"ku-responsebox-content"}})).fadeTo(0).dragOff().force(0.4).ease();this._onOpen=$.observer();this._onClose=$.observer();this._onCalibrate=$.observer();this._onWindowResize=$.observer();this._onContentChanged=$.observer();this._closeSize=$.coord.zero();this._isOpen=false;this.force(0.8).mu(0.5).appendChild(this._contentDom.dom()).positionStrategy(function(){return $.window().scrollCenter()}).bounds(document.body).to();$.window().onresize(function(){this._onWindowResize.notify()},this,l)}z.prototype={content:function(l){this._contentDom.content(l);this._onContentChanged.notify();return this},disableWindow:function(){$.window().disable();return this},enableWindow:function(){$.window().enable();return this},positionStrategy:function(l){return this.property("positionStrategy",l)},openSize:function(l){return this.property("openSize",l)},bounds:function(l){return this.property("bounds",l)},onOpen:function(aX,l,aY){this._onOpen.add(aX,l,aY);return this},onClose:function(aX,l,aY){this._onClose.add(aX,l,aY);return this},onCalibrate:function(aX,l,aY){this._onCalibrate.add(aX,l,aY);return this},onWindowResize:function(aX,l,aY){this._onWindowResize.add(aX,l,aY);return this},onContentChanged:function(aX,l,aY){this._onContentChanged.add(aX,l,aY);return this},removeListener:function(l){this._onOpen.remove(l);this._onClose.remove(l);this._onCalibrate.remove(l);this._onContentChanged.remove(l)},calibrate:function(){return this.pinTo(aD(this),function(){this._onCalibrate.notify()},this)},recalibrate:function(){this.clear().ease();var l=this.openSize()||this._contentDom.outerDims();return this.growTo(l,this.calibrate,this)},transition:function(l){this._contentDom.clear().fadeTo(0,function(){this.clear().ease().content(l);var aX=this.openSize()||this._contentDom.outerDims();this.growTo(aX,function(){this.pinTo(aD(this),function(){this._contentDom.fadeTo(100,function(){this.redraw()},this)},this)},this)},this);return this},open:function(aX){this.clear().to().fadeTo(100,function(){this._contentDom.fadeTo(0)},this).appendTo(this.bounds());this._onOpen.notify();var l=this;if(aX){setTimeout(function(){aK(l)},aX)}else{aK(l)}},close:function(){this._contentDom.ease().fadeTo(0,function(){this.ease().growTo(this._closeSize,function(){this.detach();this._onClose.notify()},this)},this);return this}};$.Class.extend(z,$.sprite.Class);$.responsebox=function(){return new z()};function aD(aX){var a0=$.point.parse(aX._positionStrategy().subtract(aX.outerDims().half())),aZ=$.point.parse($.window().scrollOffset()),l=(a0.isLeftOf(aZ))?aZ.x():a0.x(),aY=(a0.isAbove(aZ))?aZ.y():a0.y();return $.point(l,aY)}function aK(aY){var aX=aY._contentDom,l=aY.openSize()||aX.outerDims();aY.growTo(l,function(){this.pinTo(aD(this),function(){aX.fadeTo(100)},aY)},aY)}})(jQuery);