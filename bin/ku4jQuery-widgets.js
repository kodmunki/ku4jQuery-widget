(function(R){$=R;var W=$.hash({1:"MOUSE_LEFT",2:"",3:"MOUSE_RIGHT",4:"",5:"",6:"",7:"",8:"BACKSPACE",9:"TAB",10:"",11:"",12:"",13:"ENTER",14:"",15:"",16:"SHIFT",17:"CTRL",18:"ALT",19:"",20:"CAPS",21:"",22:"",23:"",24:"",25:"",26:"",27:"ESC",28:"",29:"",30:"",31:"",32:"SPACE",33:"PAGEUP",34:"PAGEDOWN",35:"END",36:"HOME",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",41:")",42:"*",43:"+",44:",",45:"-",46:".",47:"/",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:":",59:";",60:"<",61:"=",62:">",63:"?",64:"@",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"[",92:"\\",93:"]",94:"^",95:"_",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"=",108:"l",109:"-",110:"n",111:"o",112:"p",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"|",125:"}",126:"~",127:"",128:"",129:"",130:"",131:"",132:"",133:"",134:"",135:"",136:"",137:"",138:"",139:"",140:"",141:"",142:"",143:"",144:"",145:"",146:"",147:"",148:"",149:"",150:"",151:"",152:"",153:"",154:"",155:"",156:"",157:"",158:"",159:"",160:"",161:"",162:"",163:"",164:"",165:"",166:"",167:"",168:"",169:"",170:"",171:"",172:"",173:"",174:"",175:"",176:"",177:"",178:"",179:"",180:"",181:"",182:"",183:"",184:"",185:"",186:"",187:"",188:",",189:"",190:".",191:"/",192:"`",193:"",194:"",195:"",196:"",197:"",198:"",199:"",200:"",201:"",202:"",203:"",204:"",205:"",206:"",207:"",208:"",209:"",210:"",211:"",212:"",213:"",214:"",215:"",216:"",217:"",218:"",219:"[",220:"\\",221:"]",222:"",223:"",224:"",225:"",226:"",227:"",228:"",229:"",230:"",231:"",232:"",233:"",234:"",235:"",236:"",237:"",238:"",239:"",240:"",241:"",242:"",243:"",244:"",245:"",246:"",247:"",248:"",249:"",250:"",251:"",252:"",253:"",254:"",255:""});function ah(aU,aW,aV,l){if(!$.isNumber(aU)){throw $.ku4exception("$.key",$.str.format("Invalid parameter: code {0}",aU))}this._code=aU;this.alt(aW||false).ctrl(aV||false).shift(l||false)}ah.prototype={code:function(l){return this.property("code",l)},alt:function(l){return this.property("alt",l)},ctrl:function(l){return this.property("ctrl",l)},shift:function(l){return this.property("shift",l)},equals:function(l){return this._code==l.code()&&this._alt==l.alt()&&this._ctrl==l.ctrl()&&this._shift==l.shift()},toString:function(){return $.str.parse(this._code)}};$.Class.extend(ah,$.Class);$.key=function(aU,aW,aV,l){return new ah(aU,aW,aV,l)};$.key.canParse=function(l){return $.isNumber(aq(l))};$.key.parse=function(aU){try{return new ah(aq(aU),aU.altKey,aU.ctrlKey,aU.shiftKey)}catch(l){throw $.ku4exception("$.key",$.str.format("Cannot parse object: {0}",aU))}};$.key.tryParse=function(l){return $.key.canParse(l)?$.key.parse(l):null};function aq(l){try{return($.exists(l.which))?l.which:event.keyCode}catch(l){return null}}function k(){this._hotKeys=$.hash();this._map=$.hash(W)}k.prototype={map:function(l){return this.set("map",l);s},findCode:function(aV){var l=this._map.findKey(aV),aU=parseInt(l);return isNaN(aU)?null:aU},findKey:function(l){return this._map.findValue(l)}};$.Class.extend(k,$.Class);var N=new k();$.keyboard=function(){return N};function V(){}V.prototype={from:function(l){return($.exists(l.relatedTarget))?l.relatedTarget:l.fromElement},target:function(l){return(l.srcElement)?l.srcElement:l.target},clientCoord:function(l){if(!$.exists(l.clientX)){return null}return new $.coord(l.clientX,l.clientY)},documentCoord:function(l){if($.exists(this.pageCoord(l))){return this.pageCoord(l)}var aU=document.documentElement;return new $.coord(l.clientX+aU.scrollLeft,l.clientY+aU.scrollTop)},pageCoord:function(l){if(!$.exists(l.pageX)){return null}return new $.coord(l.pageX,l.pageY)},screenCoord:function(l){return new $.coord(l.screenX,l.screenY)},selection:function(){if($.exists(window.getSelection)){return window.getSelection()}if($.exists(document.getSelection)){return document.getSelection()}if($.exists(document.selection)&&$.exists(document.selection.createRange)){return document.selection.createRange().text}if($.exists(document.activeElement)&&$.exists(document.activeElement.selectionStart)){var aU=document.activeElement.selectionStart,l=document.activeElement.selectionEnd;return document.activeElement.value.substring(aU,l)}return null},clearSelection:function(){var l=this.selection();try{l.removeAllRanges()}catch(aU){l.empty()}return this}};$.Class.extend(V,$.Class);var aC=new V();$.mouse=function(){return aC};function at(){}at.prototype={canRead:function(l){return $.exists(l.touches)},from:function(aU){var l=aU.touches[0];return($.exists(l.relatedTarget))?l.relatedTarget:l.fromElement},target:function(aU){var l=aU.touches[0];return(l.srcElement)?l.srcElement:l.target},clientCoord:function(aU){var l=aU.touches[0];if(!$.exists(l.clientX)){return null}return new $.coord(l.clientX,l.clientY)},documentCoord:function(aU){var l=aU.touches[0];if($.exists(this.pageCoord(aU))){return this.pageCoord(aU)}var aV=document.documentElement;return new $.coord(l.clientX+aV.scrollLeft,l.clientY+aV.scrollTop)},pageCoord:function(aU){var l=aU.touches[0];if(!$.exists(l.pageX)){return null}return new $.coord(l.pageX,l.pageY)},screenCoord:function(aU){var l=aU.touches[0];return new $.coord(l.screenX,l.screenY)},selection:function(){if($.exists(window.getSelection)){return window.getSelection()}if($.exists(document.getSelection)){return document.getSelection()}if($.exists(document.selection)&&$.exists(document.selection.createRange)){return document.selection.createRange().text}if($.exists(document.activeElement)&&$.exists(document.activeElement.selectionStart)){var aU=document.activeElement.selectionStart,l=document.activeElement.selectionEnd;return document.activeElement.value.substring(aU,l)}return null},clearSelection:function(){var l=this.selection();try{l.removeAllRanges()}catch(aU){l.empty()}return this}};$.Class.extend(at,$.Class);var aJ=new at();$.touch=function(){return aJ};$.DomClass=function(l){$.DomClass.base.call(this);if(!$.exists(l)){$.ku4exception("$.dom","$.DomClass requires valid DOM node.")}this.dom(l)};$.DomClass.prototype={dom:function(l){return this.property("dom",l)}};$.Class.extend($.DomClass,$.Class);var aI={css:{addClass:function(aV,l){var aU=$.ele(aV),aW=aU.className;if($.ku.css.hasClass(aV,l)){return}aU.className+=(/^[^\s]/.test(aW))?(" "+l):l},hasClass:function(aU,l){if(!$.exists(l)){return false}return(new RegExp(l)).test(($.ele(aU)).className)},removeClass:function(aV,l){var aU=$.ele(aV),aW=aU.className;if(!$.ku.css.hasClass(aV,l)){return}aU.className=$.str.trim(aW.replace(new RegExp("(^|\\s)"+l+"(?![\\w\\-])"),""))}},getText:function(aU){var l=$.ele(aU);return l.textContent||l.innerText},quirks:{setOpacity:function(aV,aU){var l=aU/100;aV.style.opacity=l;aV.style["-moz-opacity"]=l;aV.style["-webkit-opacity"]=l;aV.style.filter=$.str.format("alpha(opacity={0})",aU)},clearOpacity:function(l){$.ku.style.set(l,{opacity:null,"-moz-opacity":null,"-webkit-opacity":null,filter:null})}},ready:function(aU,l){_funcs[_funcs.length]={f:aU,b:l||false}},redraw:function(aW){var aV=$.ele(aW)||document.documentElement,aU=aV.style.display||"";aV.style.display="none";var l=aV.offsetHeight;aV.style.display=aU},style:{set:function(aZ,aV,aW){var aY=$.ele(aZ);function l(a1){return(/\-/.test(a1))?a1.replace(/\-\w/,a1.charAt(a1.indexOf("-")+1).toUpperCase()):a1}if($.isString(aV)){try{aY.style[l(aV)]=aW}catch(aX){}}for(var a0 in aV){var aU=l(a0);if(/opacity/i.test(aU)){$.ku.quirks.setOpacity(aZ,aV[a0]);continue}try{aY.style[aU]=aV[a0]}catch(aX){continue}}},get:function(aZ,aW){var aY=$.ele(aZ);function l(a3,a1){var a0=(/\-/.test(a1))?a1.replace(/\-\w/,a1.charAt(a1.indexOf("-")+1).toUpperCase()):a1;try{return window.getComputedStyle(a3,null).getPropertyValue(a1)}catch(a2){return($.exists(a3.currentStyle))?a3.currentStyle[a1]:($.exists(a3.style))?a3.style[a0]:""}}if(/opacity/i.test(aW)){var aU=l(aY,aW);if($.exists(aU)){return parseFloat(aU)*100}else{var aV=/alpha\(opacity=\d+(\.\d+)?\)/i.exec(aY.style.filter);if(!$.exists(aV)){return 100}var aX=/\d+(\.\d+)?/i.exec(aV[0]);if(!$.exists(aX)){return 100}return parseFloat(aX[0])}}return l(aY,aW)},toNumber:function(l){return isNaN(l)?0:parseFloat(this.stripUnit(l))},stripUnit:function(l){return($.exists(l)&&$.exists(l.replace))?l.replace(/[^\-\.\d]/g,""):l},getUnit:function(l){return l.match(/[^\-\.\d]{2}/)[0]}},swapDom:function(aV,aU){var l=$.ele(aV);f=$.ele(aU);l.parentNode.replaceChild(f,l)}};$.ku=aI;$.clearNode=function(aU){var l=$.ele(aU);if(!l){return}while(l.hasChildNodes()){l.removeChild(l.firstChild)}};$.create=function(a0){if(!a0){return null}var aU=($.isString(a0))?{x:{}}:a0,a2,aY;for(var aV in aU){if(aV=="content"){continue}a2=document.createElement(aV);attrs=aU[aV]}for(var aV in attrs){var a1=attrs[aV];if(/class/i.test(aV)){$.ku.css.addClass(a2,a1);continue}if(/style/i.test(aV)){$.ku.style.set(a2,a1);continue}a2.setAttribute(aV,a1)}try{var aZ=aU.content;if(!aZ){return a2}var aW=(!aZ)?1:aZ.length;if($.exists(aZ.nodeName)){a2.appendChild(aZ);return a2}if(!$.isArray(aZ)){a2.innerHTML+=aZ;return a2}while(aW--){var l=aZ[aW];if($.isString(l)||!isNaN(l)){a2.innerHTML+=l;continue}var aU=(l.hasOwnProperty("appendChild"))?l:$.create(l);a2.appendChild(aU)}}catch(aX){}finally{return a2}};$.ele=function(l){if(!l){return null}return($.isEvent(l))?$.evt.ele(l):($.isString(l))?document.getElementById(l):($.exists(l.dom))?l.dom:l};var G=function(aX,aU,aW,aV,l){this.dom=aX;this.evt=aU;this.action=aW;this.scope=aV;this.bubbles=l};$.evt={add:function(aU,a0,l,a1,aV){if(!$.ele(aU)){$.ku4exception("$.evt",$.str.format("argument dom == {0} at $.evt.add",aU))}var aX=$.ele(aU),aW=a0,a2=a1||aX,aY=aV||false,aZ=function(){l.apply(a2,arguments)};if($.exists(aX.addEventListener)){aX.addEventListener(aW,aZ,aY)}else{if($.exists(aX.attachEvent)){aX.attachEvent("on"+aW,aZ)}else{aX["on"+aW]=aZ}}return new G(aX,aW,aZ,a2,aY)},remove:function(aW){var aY=aW.dom,aX=aW.evt,aV=aW.scope,l=aW.bubbles,aU=aW.action;if(aY.removeEventListener){aY.removeEventListener(aX,aU,l)}else{if(aY.detachEvent){aY.detachEvent("on"+aX,aU)}else{aY["on"+aX]=null}}return this},ele:function(l){try{return(l.srcElement)?l.srcElement:l.target}catch(l){return null}},mute:function(l){if($.exists(l.preventDefault)){l.preventDefault()}if($.exists(l.stopPropogation)){l.stopPropogation()}l.returnValue=false;l.cancelBubble=true;return this}};$.findOuterDims=function(aU){var l=$.ele(aU);return{width:l.offsetWidth,height:l.offsetHeight}},$.findInnerDims=function(aU){var l=$.ele(aU);return{width:l.clientWidth,height:l.clientHeight}},$.findOffset=function(aV){var aU=$.ele(aV),l=0,aW=0;if(!aU){return null}do{l+=aU.offsetLeft;aW+=aU.offsetTop}while((function(){try{aU=aU.offsetParent}catch(aX){aU=null}return $.exists(aU)})());return{left:l,top:aW}};$.findBoundedOffset=function(aU){var l=$.ele(aU);if(!l){return null}return{left:l.offsetLeft,top:l.offsetTop}},$.findScrollDims=function(aU){var l=$.ele(aU);return{width:l.scrollWidth,height:l.scrollHeight}};$.findScrollOffset=function(aV){var aU=$.ele(aV),l=0,aW=0;if(!aU){return null}do{l+=aU.scrollLeft||0;aW+=aU.scrollTop||0}while((function(){try{aU=aU.parentNode}catch(aX){aU=null}return $.exists(aU)})());return{left:l,top:aW}};var aE=function(aU){this._navigator=aU;agents={_isIE:"MSIE",_isNetscape:"Netscape",_isFirefox:"Firefox",_isOpera:"Opera",_isSafari:"Safari",_isChrome:"Chrome"};this._isIE=false;this._isNetscape=false;this._isFirefox=false;this._isOpera=false;this._isSafari=false;this._isChrome=false;this._isUnknown=true;this._version="";if(!$.isObject(aU)){return}var aU=this._navigator,aW=aU.userAgent;function aY(a0){return !$.isNullOrEmpty(aW)&&(new RegExp(a0,"i")).test(aW)}function aV(a4){try{var a1=(new RegExp("Version\\/(\\d+\\.?){1,}","i")).exec(aW),a2=(new RegExp(a4+"\\/(\\d+\\.?){1,}","i")).exec(aW),a0=$.exists(a1)?a1:a2;return(new RegExp("(\\d+\\.?){1,}")).exec(a0[0])[0]}catch(a3){return""}}var aZ,l,aX;for(aZ in agents){aX=agents[aZ];l=aY(aX);if(!l){continue}this[aZ]=l;this._version=aV(aX);this._isUnknown=false}this._fullVersion=aU.appVersion;this._platform=aU.platform;this._allInfo=this._fullVersion+this._platform};aE.prototype={isIE:function(){return this._isIE},isNetscape:function(){return this._isNetscape},isFirefox:function(){return this._isFirefox},isOpera:function(){return this._isOpera},isSafari:function(){return this._isSafari&&!this._isChrome},isChrome:function(){return this._isChrome},isUnknown:function(){return this._isUnknown},platform:function(){return this._platform},fullVersion:function(){return this._fullVersion},version:function(){return this._version}};var ai;$.ku.browser=function(){if($.exists(ai)){return ai}ai=new aE(navigator);return ai};$.ku.browser.Class=aE;var C=function(l){C.base.call(this,$.ele(l));var aU=this.style("display")||"block";this._display=(/none/i.test(aU))?"block":aU;this._liveEvents=$.hash()};C.prototype={attribute:function(l,aU){var aV=this.dom();if($.isUndefined(aU)){return aV.getAttribute(l)}aV.setAttribute(l,aU);return this},addClass:function(l){$.ku.css.addClass(this.dom(),l);return this},removeClass:function(l){$.ku.css.removeClass(this.dom(),l);return this},hasClass:function(l){$.ku.css.hasClass(this.dom(),l);return this},style:function(aU,l){if($.isString(aU)&&!$.exists(l)){return $.ku.style.get(this.dom(),aU)}$.ku.style.set(this.dom(),aU,l);return this},value:function(l){if(!$.exists(l)){return this.dom().value}this.dom().value=l;return this},content:function(l){if(!$.exists(l)){return this}if($.isNumber(l)||$.isString(l)){return this.html(l)}return this.appendChild(l)},cloneNode:function(l){return this._dom.cloneNode(l||true)},html:function(l){if(!$.exists(l)){return this.dom().innerHTML}this.dom().innerHTML=l;return this},text:function(l){if(!$.exists(l)){return $.ku.getText(this.dom())}$.ku.setText(this.dom(),l);return this},prependChild:function(aU){var aV=this.dom(),l=aV.firstChild;if($.exists(l)){aV.insertBefore(aU,l)}else{aV.appendChild(aU)}return this},appendChild:function(l){this.dom().appendChild(l);return this},removeChild:function(l){this.dom().removeChild(l);return this},insertBefore:function(l){l.parentNode.insertBefore(this.dom(),l);return this},insertAfter:function(l){if($.exists(l.nextSibling)){l.parentNode.insertBefore(this.dom(),l.nextSibling)}else{l.parentNode.appendChild(this.dom())}return this},appendTo:function(l){l.appendChild(this.dom());return this},detach:function(){try{var aU=this.dom();aU.parentNode.removeChild(aU)}catch(l){}finally{return this}},innerDims:function(l){if(!$.exists(l)){return $.coord.parse($.findInnerDims(this.dom()))}var aU=l.toPixel();this.style({width:aU.x(),height:aU.y()});return this},outerDims:function(aU){if(!$.exists(aU)){return $.coord.parse($.findOuterDims(this.dom()))}var l=this.outerDims().subtract(this.innerDims());return this.innerDims(aU.subtract(l))},innerWidth:function(l){var aU=this.innerDims();if(!$.exists(l)){return $.coord(aU.x(),0)}return this.innerDims($.coord(l,aU.y()))},innerHeight:function(l){var aU=this.innerDims();if(!$.exists(l)){return $.coord(0,aU.y())}return this.innerDims($.coord(aU.x(),l))},outerWidth:function(l){var aU=this.outerDims();if(!$.exists(l)){return $.coord(aU.x(),0)}return this.outerDims($.coord(l,aU.y()))},outerHeight:function(l){var aU=this.outerDims();if(!$.exists(l)){return $.coord(0,aU.y())}return this.outerDims($.coord(aU.x(),l))},boundedOffset:function(){return $.coord.parse($.findBoundedOffset(this.dom()))},layoutDims:function(){var l=this.dom().parentNode;if(!$.exists(l)){return $.coord.zero()}var aU=$.dom(l);return aU.outerDims().subtract(aU.innerDims()).half()},offset:function(){return $.coord.parse($.findOffset(this.dom()))},center:function(){return this.offset().add(this.outerDims().half())},scrollDims:function(){return $.coord.parse($.findScrollDims(this.dom()))},scrollOffset:function(){return $.coord.parse($.findScrollOffset(this.dom()))},clear:function(){$.clearNode(this.dom());return this},redraw:function(){$.ku.redraw(this.dom());return this},swap:function(l){$.ku.swapDom(this.dom(),l.dom());return l},show:function(){this.style({display:this._display});return this},hide:function(){this.style({display:"none"});return this},isVisible:function(){var l=this.offset(),aU=this.offset().add(this.innerDims());return $.exists(this.dom().parentNode)&&!/NONE|^$/i.test(this.style("display"))&&$.window().scrollOffset().isLeftOf(aU)&&$.window().scrollOffset().isAbove(aU)&&$.window().scrollDims().isRightOf(l)&&$.window().scrollDims().isBelow(l)},onmouseover:function(l,aV,aU){return this._addEvent("mouseover",l,aV,aU)},onmouseout:function(l,aV,aU){return this._addEvent("mouseout",l,aV,aU)},onmousedown:function(l,aV,aU){return this._addEvent("mousedown",l,aV,aU)},onmouseup:function(l,aV,aU){return this._addEvent("mouseup",l,aV,aU)},onmousemove:function(l,aV,aU){return this._addEvent("mousemove",l,aV,aU)},onclick:function(l,aV,aU){return this._addEvent("click",l,aV,aU)},ondoubleclick:function(l,aV,aU){return this._addEvent("dblclick",l,aV,aU)},onkeydown:function(l,aV,aU){return this._addEvent("keydown",l,aV,aU)},onkeyup:function(l,aV,aU){return this._addEvent("keyup",l,aV,aU)},onkeypress:function(l,aV,aU){return this._addEvent("keypress",l,aV,aU)},onblur:function(l,aV,aU){return this._addEvent("blur",l,aV,aU)},onchange:function(l,aV,aU){return this._addEvent("change",l,aV,aU)},onerror:function(l,aV,aU){return this._addEvent("error",l,aV,aU)},onfocus:function(l,aV,aU){return this._addEvent("focus",l,aV,aU)},onload:function(l,aV,aU){return this._addEvent("load",l,aV,aU)},onresize:function(l,aV,aU){return this._addEvent("resize",l,aV,aU)},onscroll:function(l,aV,aU){return this._addEvent("scroll",l,aV,aU)},onselect:function(l,aV,aU){return this._addEvent("select",l,aV,aU)},onresize:function(l,aV,aU){return this._addEvent("resize",l,aV,aU)},onunload:function(l,aV,aU){return this._addEvent("unload",l,aV,aU)},onorientationchange:function(l,aV,aU){return this._addEvent("orientationchange",l,aV,aU)},ontouchstart:function(l,aV,aU){return this._addEvent("touchstart",l,aV,aU)},ontouchend:function(l,aV,aU){return this._addEvent("touchend",l,aV,aU)},ontouchmove:function(l,aV,aU){return this._addEvent("touchmove",l,aV,aU)},removeEvent:function(aU){var l=this._liveEvents.find(aU);if(!$.exists(l)){return this}return this._removeEvent(l,aU)},clearEvents:function(){$.list(this._liveEvents.values()).each(function(l){this._removeEvent(l)},this);return this},_addEvent:function(aV,aU,aY,aX){var l=aX||$.uid("evt"),aW=this._liveEvents;if(aW.containsKey(l)){return this}aW.add(l,$.evt.add(this.dom(),aV,aU,aY));return this},_removeEvent:function(l,aU){$.evt.remove(l);this._liveEvents.remove(aU);return this}};$.Class.extend(C,$.DomClass);$.dom=function(l){return new C(l)};$.dom.parseHtml=function(l){var aU=$.create({div:{},content:l});if(aU.childNodes.length!=1){return null}return $.dom(aU.firstChild)};$.dom.Class=C;function aM(){aM.base.call(this);this._body=$.dom(document.body)}aM.prototype={isDisabled:function(){return this.get("disabled")},isPortrait:function(){return this.orientation.isLandscape()},isLandscape:function(){return Math.abs(window.orientation)==90},disable:function(){this._disabled=true;document.body.appendChild(af);return this},enable:function(){if(!this.isDisabled()){return this}document.body.removeChild(af);this._disabled=false;return this},dims:function(){var l=window.innerWidth||document.documentElement.clientWidth,aU=window.innerHeight||document.documentElement.clientHeight;return $.coord(l,aU)},center:function(){return this.dims().divide($.coord(2,2))},scrollOffset:function(){var aW=document.documentElement,aU=document.body,l=Math.max(aW.scrollLeft,aU.scrollLeft),aV=Math.max(aW.scrollTop,aU.scrollTop);return $.coord(l,aV)},scrollDims:function(){var aW=document.documentElement,aU=document.body,l=Math.max(aW.scrollWidth,aU.scrollWidth),aV=Math.max(aW.scrollHeight,aU.scrollHeight);return $.coord(l,aV)},scrollCenter:function(){return this.center().add(this.scrollOffset())},contains:function(l){var aV=this.scrollOffset(),aU=this.scrollDims();if(!l instanceof $.point.Class){$.ku4exception("$.window","contains method takes and argument type $.point")}return !(l.isAbove(aV)||l.isLeftOf(aV)||l.isRightOf(aU)||l.isBelow(aU))},redraw:function(){$.ku.redraw(document.body);$.ku.redraw(document.documentElement);return this},onmousedown:function(l,aV,aU){return this._body.onmousedown(l,aV,aU)},onmouseup:function(l,aV,aU){return this._body.onmouseup(l,aV,aU)},ontouchstart:function(l,aV,aU){return this._body.ontouchstart(l,aV,aU)},ontouchend:function(l,aV,aU){return this._body.ontouchend(l,aV,aU)},onclick:function(l,aV,aU){return this._body.onclick(l,aV,aU)},ondoubleclick:function(l,aV,aU){return this._body.ondoubleclick(l,aV,aU)},onkeydown:function(l,aV,aU){return this._body.onkeydown(l,aV,aU)},onkeyup:function(l,aV,aU){return this._body.onkeyup(l,aV,aU)},scrollTo:function(l){window.scrollTo(l.x(),l.y());return this},onresize:function(l,aV,aU){r.add(l,aV,aU);return this},onscroll:function(l,aV,aU){ap.add(l,aV,aU);return this},onspin:function(l,aV,aU){ar.add(l,aV,aU);return this},remove:function(l){r.remove(l);ap.remove(l);ar.remove(l);this._body.removeEvent(l);return this}};$.Class.extend(aM,$.Class);var af=$.create({div:{"class":"ku-window-disabled"}}),r=$.observer(),ap=$.observer(),ar=$.observer(),b=function(){};b.prototype={uri:function(l){return this.property("uri",l)},offset:function(l){return this.property("offset",l)},dims:function(l){return this.property("dims",l)},channelmode:function(l){return this.property("channelmode",l)},directories:function(l){return this.property("directories",l)},fullscreen:function(l){return this.property("fullscreen",l)},location:function(l){return this.property("location",l)},menubar:function(l){return this.property("menubar",l)},scrollbars:function(l){return this.property("scrollbars",l)},titlebar:function(l){return this.property("titlebar",l)},toolbar:function(l){return this.property("toolbar",l)},open:function(){}};$.Class.extend(b,$.Class);var ay;$.window=function(){if($.exists(ay)){return ay}$.evt.add(window,"resize",function(){r.notify()});$.evt.add(window,"scroll",function(){ap.notify()});$.evt.add(window,"orientationchange",function(){ar.notify()});ay=new aM();return ay};$.ku.localization={en:{day:{name:{0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"},abbr:{0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"}},month:{name:{1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},abbr:{1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"}}},sp:{day:{name:{0:"domingo",1:"lunes",2:"martes",3:"mi&#0233;rcoles",4:"jueves",5:"viernes",6:"sï¿½bado"},abbr:{0:"dom",1:"lun",2:"mar",3:"mi&#0233;",4:"jue",5:"vie",6:"s&#0225;b"}},month:{name:{1:"enero",2:"febrero",3:"marzo",4:"abril",5:"mayo",6:"junio",7:"julio",8:"agosto",9:"septiembre",10:"octubre",11:"noviembre",12:"diciembre"},abbr:{1:"ene",2:"feb",3:"mar",4:"abr",5:"may",6:"jun",7:"jul",8:"ago",9:"sep",10:"oct",11:"nov",12:"dic"}}}};$.ku.equations={cycle:function(aV,aX,aW,aU,l){return new $.coord(this.sin(aV.x,aX,aW),this.cos(aV.y,aU,l))},cos:function(aV,aU,l){return aV+Math.cos(aU)*l},cosH:function(aV,aU,l){return new $.coord(this.cos(aV.x,aU,l),aV.y)},cosV:function(aV,aU,l){return new $.coord(aV.x,this.cos(aV.y,aU,l))},sin:function(aV,aU,l){return aV+Math.sin(aU)*l},sinH:function(aV,aU,l){return new $.coord(this.sin(aV.x,aU,l),aV.y)},sinV:function(aV,aU,l){return new $.coord(aV.x,this.sin(aV.y,aU,l))}};$.anime={algorithms:{ease:{}}};var aO=function(l){this._ease=l||0.1};aO.prototype={calculate:function(aU,l){return(l-aU)*this._ease}};$.anime.algorithms.ease.linear=function(l){return new aO(l)};var aD=function(){};aD.prototype={calculate:function(aU,l){return l-aU}};$.anime.algorithms.jump=function(){return new aD()};var o=function(aU,l){this._spring=aU||0.4;this._mu=l||0.6};o.prototype={calculate:function(aZ,aV,aY){var aU=this._spring,aW=aY,l=this._mu,a0=aV-aZ,aX=a0*aU;aW+=aX;aW*=l;return aW}};$.anime.algorithms.spring=function(aU,l){return new o(aU,l)};function aR(l){this._context=l}aR.prototype={findCoord:function(aV){var l=this._context,aU=$.touch().canRead(aV)?$.touch():$.mouse();return aU.documentCoord(aV).subtract(l.hitCoord()).subtract(l.hitOffset()).add(l.hitBoundedOffet())}};function w(l){this._context=l}w.prototype={findCoord:function(aV){var l=this._context,aU=$.touch().canRead(aV)?$.touch():$.mouse();return l.hitSize().add(aU.documentCoord(aV).subtract(l.hitCoord()).subtract(l.hitOffset()))}};function aA(l){this._context=l}aA.prototype={findCoord:function(aV){var l=this._context,aU=$.touch().canRead(aV)?$.touch():$.mouse();return l.hitCoord().add(l.hitOffset()).subtract(aU.documentCoord(aV)).add(l.hitScrollOffset())}};var ao={};function ab(l){ab.base.call(this,l);this._mouseEvt=$.uid("dragger");this._touchEvt=$.uid("toucher");this._documentBody=$.dom(document.body);this._onGrab=$.observer();this._onDrag=$.observer();this._onDrop=$.observer();this._constrainX=false;this._constrainY=false;this._boundX=0;this._boundY=0;this._lastPoint=$.coord.zero();this._bearing=$.vector.zero();this._document=$.dom(document);this.state(new ao.dropped()).dragger().dragOffset($.coord.zero()).ontouchstart(this.grab,this,this._touchEvt).onmousedown(this.grab,this,this._mouseEvt)}ab.prototype={document:function(){return this._document},hitSize:function(l){return this.property("hitSize",l)},hitCoord:function(l){return this.property("hitCoord",l)},hitOffset:function(l){return this.property("hitOffset",l)},dragOffset:function(l){return this.property("dragOffset",l)},hitScrollOffset:function(l){return this.property("hitScrollOffset",l)},hitBoundedOffet:function(l){return this.property("hitBoundedOffet",l)},actor:function(){return this.get("actor")},strategy:function(){return this.get("strategy")},bearing:function(){return this.get("bearing")},bearingUp:function(){return this.bearing().y()<0},bearingDown:function(){return this.bearing().y()>0},bearingLeft:function(){return this.bearing().x()<0},bearingRight:function(){return this.bearing().x()>0},constrainX:function(){if(this._constrainX){return this}this._constrainX=true;this._boundX=this.boundedOffset().x();return this},unconstrainX:function(){this._constrainX=false},constrainY:function(){if(this._constrainY){return this}this._constrainY=true;this._boundY=this.boundedOffset().y();return this},unconstrainY:function(){this._constrainY=false},state:function(l){return this.set("state",l.context(this))},dragCoord:function(aW){var aY=this.strategy().findCoord(aW),aV=this.dragOffset(),aU=(this._constrainX)?this._boundX:aY.x()+aV.x(),aX=(this._constrainY)?this._boundY:aY.y()+aV.y(),l=$.point(aU,aX);this._bearing=l.distanceFrom(this._lastPoint);this._lastPoint=l;return l},dragger:function(){return this.set("actor",$.pinner(this.dom())).set("strategy",new aR(this))._setType("dragger")},sizer:function(){return this.set("actor",$.sizer(this.dom())).set("strategy",new w(this))._setType("sizer")},scroller:function(){return this.set("actor",$.scroller(this.dom())).set("strategy",new aA(this))._setType("scroller")},grab:function(l){this._onGrab.notify(l);this._state.grab(l);return this},drag:function(l){this._onDrag.notify(l);this._state.drag(l);return this},drop:function(l){this._onDrop.notify(l);this._state.drop(l);this._bearing=$.vector.zero();return this},onGrab:function(aU,l,aV){this._onGrab.add(aU,l,aV);return this},onDrag:function(aU,l,aV){this._onDrag.add(aU,l,aV);return this},onDrop:function(aU,l,aV){this._onDrop.add(aU,l,aV);return this},destroy:function(){this._onGrab.clear();this._onDrag.clear();this._onDrop.clear();this.removeEvent(this._mouseEvt).removeEvent(this._touchEvt)},disableSelect:function(aU){document.onselectstart=function(){return false};if(!$.exists(window.getSelection)){return this}this._mouseDisableId=$.uid("disable");this._touchDisableId=$.uid("disable");function l(){window.getSelection().removeAllRanges()}this._documentBody.onmousemove(l,null,this._mouseDisableId).ontouchmove(l,null,this._touchDisableId);return this},enableSelect:function(){document.onselectstart=null;var l=this._mouseDisableId,aU=this._touchDisableId,aV=this._documentBody;if($.exists(l)){aV.removeEvent(l)}if($.exists(aU)){aV.removeEvent(aU)}this._mouseDisableId=null;this._touchDisableId=null;return this},_setType:function(l){this._clearType().addClass($.str.format("ku-dragger-{0}",l));return this},_clearType:function(){this.removeClass("ku-dragger-dragger").removeClass("ku-dragger-sizer").removeClass("ku-dragger-scoller");return this}};$.Class.extend(ab,$.dom.Class);$.dnd=function(l){return new ab(l)};ao.dropped=function(){ao.dropped.base.call(this,ao)};ao.dropped.prototype={grab:function(aW){$.evt.mute(aW);var l=this.context(),aV=$.touch().canRead(aW)?$.touch():$.mouse(),aU=aV.documentCoord(aW).subtract(l.offset());l.document().ontouchmove(l.drag,l,$.uid()).ontouchend(l.drop,l,$.uid()).onmousemove(l.drag,l,$.uid()).onmouseup(l.drop,l,$.uid());l.disableSelect().addClass("ku-dragger-grabbed").hitSize(l.outerDims()).hitCoord(aU).hitOffset(l.offset()).hitScrollOffset(l.scrollOffset()).hitBoundedOffet(l.boundedOffset()).actor().to(l.dragCoord(aW));this.state("grabbed")},drag:function(){return},drop:function(){return}};$.Class.extend(ao.dropped,$.abstractState);ao.grabbed=function(){ao.grabbed.base.call(this,ao)};ao.grabbed.prototype={grab:function(){return},drag:function(aU){$.evt.mute(aU);var l=this.context();l.actor().to(l.dragCoord(aU));this.context().redraw()},drop:function(l){this.context().enableSelect().removeClass("ku-dragger-grabbed").document().clearEvents();this.state("dropped")}};$.Class.extend(ao.grabbed,$.abstractState);function g(l){g.base.call(this,l);this._onEnd=$.observer();this.linear()}g.prototype={$to:function(l){return},$moveTo:function(l){return},$done:function(){this._onEnd.notify();return this},algorithm:function(l){this.$algorithm=l;return this},linear:function(l){return this.algorithm($.anime.algorithms.ease.linear(l))},spring:function(aU,l){this.algorithm($.anime.algorithms.spring(aU,l))},stop:function(){if(!$.exists(this.$tween)){return this}this.$tween.stop();return this},to:function(l){this.stop().$to(l).$done();return this},moveTo:function(l){this.stop().$moveTo(l);return this},onEnd:function(aU,l){if(!$.exists(aU)){return this}this._onEnd.add(aU,l);return this}};$.Class.extend(g,$.dom.Class);function v(l){$.dom(l).addClass("ku-fader");v.base.call(this,l)}v.prototype={$to:function(l){var aV=this.dom(),aU=$.dom(aV);aU.style("opacity",l*0.01);return this},$moveTo:function(l){var aV=this.dom(),aU=$.dom(aV),aW=aU.style("opacity")||1;this.$tween=$.tween(function(aX){aU.style("opacity",aX*0.01)},aW,l,this.$algorithm).onEnd(this.$done,this).start(aV)}};$.Class.extend(v,g);$.fader=function(l){return new v(l)};function Y(l){$.dom(l).addClass("ku-fitter");Y.base.call(this,l)}Y.prototype={$to:function(l){var aV=this.dom(),aU=$.dom(aV);aU.style("width",l.x()+"px");aU.style("height",l.y()+"px");return this},$moveTo:function(aW){var aU=this.dom(),l=$.dom(aU),aV=l.outerDims();this.$tween=$.tween(function(aX){l.style("width",aX.x()+"px");l.style("height",aX.y()+"px")},aV,al(this,aW),this.$algorithm).onEnd(this.$done,this).start(aU)}};$.Class.extend(Y,g);function al(l,aV){var aW=aV.y()/aV.x(),aU=$.dom(l.dom()),a0=aU.outerDims(),aX=a0.y()/a0.x(),a1=isNaN(aX)?1:aX,aZ=a0.x(),aY=a0.y();if((a1<aW)||(a1==aW)){aZ=aV.x();aY=aV.x()*aX}if(a1>aW){aZ=aV.y()/aX;aY=aV.y()}return $.coord(aZ,aY)}$.fitter=function(l){return new Y(l)};function n(l){$.dom(l).addClass("ku-pinner");n.base.call(this,l)}n.prototype={$to:function(l){var aV=this.dom(),aU=$.dom(aV);aU.style("left",l.x()+"px");aU.style("top",l.y()+"px");return this},$moveTo:function(aZ){var aX=this.dom(),aW=$.dom(aX),aV=aW.offset(),aU=$.findOffset(aX.parentNode),l=($.coord.canParse(aU))?$.coord.parse(aU):$.coord.zero(),aY=aV.subtract(l);this.$tween=$.tween(function(a0){aW.style("left",a0.x()+"px");aW.style("top",a0.y()+"px")},aY,aZ,this.$algorithm).onEnd(this.$done,this).start(aX)}};$.Class.extend(n,g);$.pinner=function(l){return new n(l)};function I(l){$.dom(l).addClass("ku-scoller");I.base.call(this,l)}I.prototype={$to:function(l){var aV=this.dom(),aU=$.dom(aV);aU.style("scrollLeft",l.x());aU.style("scrollTop",l.y());return this},$moveTo:function(aZ){var aX=this.dom(),aW=$.dom(aX),aV=aW.scrollOffset(),aU=$.findOffset(aX.parentNode),l=($.coord.canParse(aU))?$.coord.parse(aU):$.coord.zero(),aY=aV.subtract(l);this.$tween=$.tween(function(a0){aW.style("scrollLeft",a0.x());aW.style("scrollTop",a0.y())},aY,aZ,this.$algorithm).onEnd(this.$done,this).start(aX)}};$.Class.extend(I,g);$.scroller=function(l){return new I(l)};function A(l){$.dom(l).addClass("ku-sizer");A.base.call(this,l)}A.prototype={$to:function(l){var aV=this.dom(),aU=$.dom(aV);aU.style("width",l.x()+"px");aU.style("height",l.y()+"px");return this},$moveTo:function(aW){var aU=this.dom(),l=$.dom(aU),aV=l.outerDims();this.$tween=$.tween(function(aX){l.style("width",aX.x()+"px");l.style("height",aX.y()+"px")},aV,aW,this.$algorithm).onEnd(this.$done,this).start(aU)}};$.Class.extend(A,g);$.sizer=function(aV,aU,l){return new A(aV,aU,l)};function aH(l,aU){$.dom(l).addClass("ku-styler");aH.base.call(this,l);this._prop=aU}aH.prototype={$moveTo:function(aV){var aZ=this.dom(),aY=$.dom(aZ),aW=this._prop,aX=aY.style(aW),l=$.ku.style,aU=l.getUnit(aX)||"",a0=l.toNumber(aX);this.$tween=$.tween(function(a1){aY.style(aW,a1+aU)},a0,aV,this.$algorithm).onEnd(this.$done,this).start(aZ)}};$.Class.extend(aH,g);$.styler=function(l,aU){return new aH(l,aU)};function S(aU,l){S.base.call(this,l);this._listeners=$.observer();this._ticks=0;this.fps(aU||30)}S.prototype={fps:function(l){this._interval=1000/l;return this.property("fps",l)},interval:function(){return this.get("interval")},listeners:function(){return this.get("listeners")},ticks:function(){return this.get("ticks")},start:function(){this._state.start();return this},stop:function(){this._state.stop();return this},add:function(aU,a1,l,aV){var aY=this,a0=aV||1,aZ=l||$.uid("timeline"),aX=function(){if(!aY._ticks%a0==0){return}aU();aW=aU},aW=(!aV)?aU:aX;this._listeners.add(aW,a1,aZ);return this},remove:function(l){this._listeners.remove(l);return this},clear:function(){this._listeners.clear();return this},tick:function(){this._ticks++;return this}};$.Class.extend(S,$.abstractContext);$.timeline=function(){return B};S.started=function(){S.started.base.call(this,S)};S.started.prototype={start:function(){return},stop:function(){clearTimeout(ku_timeline);ku_timeline=null;this.state("stopped")}};$.Class.extend(S.started,$.abstractState);S.stopped=function(){S.stopped.base.call(this,S)};S.stopped.prototype={start:function(){var aV=this.context(),aU=aV.interval(),l=function(){aV.tick().listeners().notify();ku_timeline=setTimeout(l,aU)};l();this.state("started")},stop:function(){return}};$.Class.extend(S.stopped,$.abstractState);var B=new S(30,new S.stopped()).start();var aa=function(aW,aV,l,aU){this.$method=aW;this.$current=aV;this.$end=l;this.$algorithm=aU;this.$value=0;this._onEnd=$.observer();this._id=$.uid("tween")};aa.prototype={$exec:function(){return},$done:function(){this._onEnd.notify()},start:function(){$.timeline().add(this.$exec,this,this._id);return this},stop:function(){$.timeline().remove(this._id);return this},onEnd:function(aU,l){this._onEnd.add(aU,l);return this},clear:function(){this._onEnd.clear();return this}};$.Class.extend(aa,$.Class);var ac=function(aW,aV,l,aU){ac.base.call(this,aW,aV,l,aU);this.$value=$.coord.zero()};ac.prototype={$exec:function(){var aZ=this.$method,aY=this.$current,l=this.$end;var aW=this.$algorithm.calculate(aY.x(),l.x(),this.$value.x());var aU=this.$algorithm.calculate(aY.y(),l.y(),this.$value.y()),aV=$.coord(aW,aU),aX=l.abs().subtract(aY.abs());if((Math.abs(aW)<0.1)&&(aX.x()<1)&&(Math.abs(aU)<0.1)&&(aX.y()<1)){aZ(l);this.stop()._onEnd.notify();return}this.$current=aY.add(aV);this.$value=aV;aZ(this.$current)}};$.Class.extend(ac,aa);var a=function(aW,aV,l,aU){a.base.call(this,aW,aV,l,aU)};a.prototype={$exec:function(){var aW=this.$method,aV=this.$current,l=this.$end,aU=this.$algorithm.calculate(aV,l,this.$value);if((Math.abs(aU)<0.1)&&(Math.abs(l-aV)<1)){aW(l);this.stop().$done();return}this.$current=aV+aU;this.$value=aU;aW(this.$current)}};$.Class.extend(a,aa);$.tween=function(aW,aV,l,aU){return($.isNumber(aV)&&$.isNumber(l))?new a(aW,aV,l,aU):new ac(aW,aV,l,aU)};function H(aX,aW,l,aU,aY,aV){H.base.call(this,aX);this.id($.uid("jsx-cell")).cIdx(aW).cKey(l).rIdx(aU).rKey(aY).value(aV)}H.prototype={id:function(l){return this.property("id",l)},value:function(l){return this.property("value",l)},cIdx:function(l){if($.exists(l)){this.dom().cIdx=l}return this.property("cIdx",l)},rIdx:function(l){if($.exists(l)){this.dom().rIdx=l}return this.property("rIdx",l)},cKey:function(l){if($.exists(l)){this.dom().cKey=l}return this.property("cKey",l)},rKey:function(l){if($.exists(l)){this.dom().rKey=l}return this.property("rKey",l)}};$.Class.extend(H,$.dom.Class);$.cell=function(aX,aW,l,aU,aY,aV){return new H(aX,aW,l,aU,aY,aV)};$.cell.Class=H;function M(aX,aU,l,aV,aW){M.base.call(this,aX);this.id($.uid()).col(aU).index(l).key(aV).value(aW);this._cells=$.hash()}M.prototype={id:function(l){return this.property("id",l)},col:function(l){return this.property("col",l)},value:function(l){if($.exists(l)){this.content(l)}return this.property("value",l)},index:function(l){if($.exists(l)){this.dom().cIdx=l}return this.property("index",l)},key:function(l){if($.exists(l)){this.dom().cKey=l}return this.property("key",l)},findCell:function(l){return this._cells.find(l)},listCells:function(){return $.list(this._cells.values())},addCell:function(l){this._cells.add(l.rKey(),l);return this},removeCell:function(l){var aU=this._cells;aU.remove(l.rKey());if(aU.isEmpty()){$.dom(this._col).detach();this.detach()}return this},};$.Class.extend(M,$.dom.Class);$.column=function(aX,aU,l,aV,aW){return new M(aX,aU,l,aV,aW)};$.column.Class=M;function ae(aU){$.cast(this,aU);this._dri=new $.iterator(this.rows.values());this.helper=$.create({tr:{"class":"ku-table-dragRow-helper"}});$.slider(this.helper,null,null,null,null,null,"dragger","vertical");this._isMoving=false;this._hitPoint;this._moveDom;function l(aV){return $.cast($.coord.parse($.findOffset(this.dom)),$.point)}this._dri.foreach(function(aV){$.evt.add(aV.dom,"mouseover",function(){if(!this._isMoving){return}var a0=aV.dom,aW=this.body,aX=this.helper,aY=this._hitPoint,aZ=l(a0);if(!a0.nextSibling){aW.appendChild(aX)}else{if(aZ.isAbove(aY)){aW.insertBefore(aX,a0)}else{aW.insertBefore(aX,a0.nextSibling)}}this._hitPoint=aZ},this);$.dnd(aV.dom,function(){this.helper=aV.dom;this._isMoving=true;this._hitPoint=l(aV.dom);this._moveDom=aV.dom;this.body.insertBefore(this.helper,aV.dom);$.ku.css.addClass(this.body,"ku-table-draggableRow-dragging");$.ku.css.addClass(this._moveDom,"ku-table-draggableRow-moveDom")},null,function(){$.ku.css.removeClass(this.body,"ku-table-draggableRow-dragging");$.ku.css.removeClass(this._moveDom,"ku-table-draggableRow-moveDom");$.ku.swapDom(this.helper,this._moveDom);this._isMoving=false;this._moveDom=null;this.format()},this)},this)}$.draggableRowDecorator=function(l){return new ae(l)};function av(l){$.cast(this,l);this._sci=new $.iterator(this.columns.values());this._sci.foreach(function(aW){var aV=aW.dom,aU=$.create({a:{"class":"ku-table-col-sizer"}});new $.slider(aV,aU,null,null,null,null,"sizer","horizontal");aV.appendChild(aU)})}function az(l){$.cast(this,l);this._isAsc=false;this._asc=new $.sorter(sorter.strategy.asc);this._des=new $.sorter(sorter.strategy.des);this._sortci=new $.iterator(this.columns.values());this._sortci.foreach(function(aW){var aU=new $.iterator(aW.cells.values()),aV=$.create({a:{"class":"ku-table-col-sorter"}});aW.dom.appendChild(aV);$.evt.add(aV,"click",function(){var a5=[],aX=this._isAsc,a6=(aX)?this._asc:this._des,aZ="ku-table-col-sorter-{0}",a2=$.str.format(aZ,"asc"),a0=$.str.format(aZ,"dec"),a4=(aX)?a2:a0;aU.foreach(function(a7){a5[a5.length]=a7.dom});this._isAsc=!this._isAsc;var a3=a6.sort(a5),aY=a3.length,a1=this.body;$.clearNode(a1);while(aY--){a1.appendChild(this.rows.find(a3[i].rIdx).dom)}$.ku.css.removeClass(aV,a2);$.ku.css.removeClass(aV,a0);$.ku.css.addClass(aV,a4);this.format()},this)},this)}function K(){K.base.call(this)}K.prototype={table:function(l){return this.set("table",l)},createColumn:function(aU,aV,aW){var l=$.create({col:{}}),aX=$.create({th:{"ku-key":aV},content:$.create({span:{"class":"ku-table-head-content"},content:aW})});return $.column(aX,l,aU,aV,aW)},createRow:function(l,aU){var aV=$.create({tr:{"class":"ku-table-row"}});return $.row(aV,l,aU)},createCell:function(aY,aX,aU,aW,a0){var aV=this._table,aZ=$.create({td:{"class":"ku-table-cell"},content:aY}),l=$.cell(aZ,aX,aU,aW,a0,aY).onclick(function(){aV.selectCell(l)},this);return l}};$.Class.extend(K,$.Class);function aw(aV,l,aU){aw.base.call(this,aV);this.id($.uid()).index(l).key(aU);this._cells=$.hash()}aw.prototype={id:function(l){return this.property("id",l)},index:function(l){if($.exists(l)){this.dom().rIdx=l}return this.property("index",l)},key:function(l){if($.exists(l)){this.dom().rKey=l}return this.property("key",l)},findCell:function(l){return this._cells.find(l)},listCells:function(){return $.list(this._cells.values())},addCell:function(l){this._dom.appendChild(l.dom());this._cells.add(l.cKey(),l);return this},removeCell:function(l){this._dom.removeChild(l.dom());this._cells.remove(l.cKey());return this}};$.Class.extend(aw,$.dom.Class);$.row=function(aW,l,aU,aV){return new aw(aW,l,aU,aV)};$.row.Class=aw;function ad(aW){var a0=$.create({table:{"class":"ku-table",cellspacing:0}});ad.base.call(this,a0);var aV=$.create({colgroup:{"class":"ku-table-colgroup"}}),aU=$.create({caption:{"class":"ku-table-caption"}}),aY=$.create({thead:{"class":"ku-table-head"}}),aZ=$.create({tr:{"class":"ku-table-head-row"}}),l=$.create({tbody:{"class":"ku-table-body"}}),aX=$.create({tfoot:{"class":"ku-table-foot"}});this._columns=new $.hash();this._rows=new $.hash();this._cells=new $.hash();this._onCellSelect=$.observer();this.appendChild(aV).colgroup(aV).appendChild(aU).caption(aU).appendChild(aY).head(aY).appendChild(aZ).headRow(aZ).appendChild(l).body(l).appendChild(aX).foot(aX).factory(aW||new K()).head().appendChild(this.headRow())}ad.prototype={title:function(l){if($.isString(l)){this.caption().innerHTML=l}else{if($.exists(l)){this.caption().appendChild(l)}}return this.property("title",l)},factory:function(l){return this.property("factory",l.table(this))},caption:function(l){return this.property("caption",l)},colgroup:function(l){return this.property("colgroup",l)},head:function(l){return this.property("head",l)},headRow:function(l){return this.property("headRow",l)},body:function(l){return this.property("body",l)},foot:function(l){return this.property("foot",l)},listColumns:function(){return $.list(this._columns.values())},listRows:function(){return $.list(this._rows.values())},listCells:function(){return $.list(this._cells.values())},selectCell:function(l){this._onCellSelect.notify(l);return this},onCellSelect:function(aU,l){this._onCellSelect.add(aU,l);return this},addColumn:function(aU,aX,aW){var l=this._columns,aV=this._rows;if(l.containsKey(aU)){return this._updateColumn(aU,aX,aW)}else{return this._addColumn(aU,aX,aW)}},_addColumn:function(l,aW,aV){var aU=this._factory.createColumn($.uid(),l,aV);this._columns.add(aU.key(),aU);$.list(this._rows.values()).each(function(aX){this.addCell(aX,aU,aW[aX.key()])},this);this._colgroup.appendChild(aU.col());this._headRow.appendChild(aU.dom());return this},_updateColumn:function(l,aW,aV){var aU=this._columns.find(l);$.list(his._rows.values()).each(function(aX){this.findCell(aX.key(),aU.key()).value(aW[aX.key()])},this);if($.exists(aV)){aU.value(aV)}return this},findColumn:function(l){return this._columns.find(l)},removeColumn:function(l){var aV=this._rows,aU=this.findColumn(l);if(!$.exists(aU)){return this}$.list(aV.values()).each(function(aW){this.removeCell(aU.findCell(aW.key()))},this);this._columns.remove(aU.key());return this},addRow:function(aU,aW){var aV=this._rows,l=this._columns;if(aV.containsKey(aU)){return this._updateRow(aU,aW)}else{return this._addRow(aU,aW)}},_addRow:function(l,aU){var aV=this._factory.createRow($.uid(),l);this._rows.add(aV.key(),aV);$.list(this._columns.values()).each(function(aW){this.addCell(aV,aW,aU[aW.key()])},this);this.body().appendChild(aV.dom());return this},_updateRow:function(l,aU){var aV=this._rows.find(l);$.list(this._columns.values()).each(function(aW){this.findCell(aV.key(),aW.key()).value(aU[aW.key()])},this);return this},findRow:function(l){return this._rows.find(l)},removeRow:function(aU){var l=this._columns,aV=this.findRow(aU);if(!$.exists(aV)){return this}$.list(l.values()).each(function(aW){this.removeCell(aV.findCell(aW.key()))},this);this._rows.remove(aV.key());return this},addCell:function(aW,aU,aV){var l=this._factory.createCell(aV,aU.index(),aU.key(),aW.index(),aW.key());aU.addCell(l);aW.addCell(l);this._cells.add(l.id(),l);return this},findCellById:function(l){return this._cells.find(l)},findCell:function(aW,aU){var l=$.list(this._cells.values()),aV;l.each(function(aX){if((aX.rKey()==aW)&&(aX.cKey()==aU)){aV=aX;l.quit()}});return aV},removeCell:function(l){this._cells.remove(l.id());this._columns.find(l.cKey()).removeCell(l);this._rows.find(l.rKey()).removeCell(l);return this},format:function(){var l=0,aU="ku-table-row-even",aV="ku-table-row-odd",aW=function(){(l%2==0)?aU:aV};this._rows.each(function(aX){aX.removeClass(aU).removeClass(aV).addClass(aW());l++})},toObject:function(){return{title:this.title(),columns:this._columns.toObject(),rows:this._rows.toObject()}}};$.Class.extend(ad,$.dom.Class);$.table=function(l){return new ad(l)};$.table.Class=ad;ad.parseDom=function(aY){var aU=function(a1,a0){return a1.getElementsByTagName(a0)};ad=$.ele(aY),cols=aU(aU((aU(ad,"thead")[0]),"tr")[0],"th"),rows=aU((aU(ad,"tbody")[0]),"tr"),caption=aU(ad,"caption")[0],title=(!caption)?"":caption.innerHTML,t=new $.table(title),R=cols.length,m=rows.length,c=[];while(i--){var aX=cols[i],l=$.ku.getText(aX)||$.uid("table-column");c[c.length]=l;t.addColumn(l,aX.innerHTML)}while(m--){var aV=aU(rows[j],"td"),aZ=aV.length,aW={};while(aZ--){aW[c[l]]=aV[l].innerHTML}t.addRow(aW)}return t};ad.parseObject=function(aV){var l=new $.table(aV.title),aX=aV.columns,aU=aV.rows;for(var aW in aX){l.addColumn(aW,aX[aW])}for(var aW in aU){l.addRow(aU[aW])}return l};var q=function(){q.base.call(this,$.create({div:{"class":"ku-calendar"}}));var l=$.create({div:{"class":"ku-sheet"}});this._sheetContainer=$.dom(l);this._onShowDates=$.observer();this._onShowMonths=$.observer();this._onShowYears=$.observer();this._onSelect=$.observer();this._sheet;this.dayPoint($.dayPoint.today()).localization($.ku.localization.en).sheetFactory($.clickableSheetFactory()).dom().appendChild(l)};q.prototype={dayPoint:function(l){return this.property("dayPoint",l)},localization:function(l){return this.property("localization",l)},sheetFactory:function(l){return this.set("sheetFactory",l)},isShowingDates:function(){return this._isShowingDates},isShowingMonths:function(){return this._isShowingMonths},isShowingYears:function(){return this._isShowingYears},nextDay:function(){this.dayPoint(this.dayPoint().nextDay());return this},prevDay:function(){this.dayPoint(this.dayPoint().prevDay());return this},nextMonth:function(){this.dayPoint(this.dayPoint().nextMonth());return this},prevMonth:function(){this.dayPoint(this.dayPoint().prevMonth());return this},nextYear:function(){this.dayPoint(this.dayPoint().nextYear());return this},prevYear:function(){this.dayPoint(this.dayPoint().prevYear());return this},showDates:function(){return this._showSheet("createDatesheet")._currentView(false,false,true)},showMonths:function(){return this._showSheet("createMonthsheet")._currentView(false,true,false)},showYears:function(){return this._showSheet("createYearsheet")._currentView(true,false,false)},findCell:function(l){return this._sheet.findCell(l)},each:function(aU,l){this._sheet.each(aU,l);return this},select:function(l){this._sheet.select(l);return this},onSelect:function(aU,l){this._onSelect.add(aU,l);return this},onShowDates:function(aU,l){this._onShowDates.add(aU,l);return this},onShowMonths:function(aU,l){this._onShowMonths.add(aU,l);return this},onShowYears:function(aU,l){this._onShowYears.add(aU,l);return this},_currentView:function(aU,l,aV){this._isShowingYears=aU;this._isShowingMonths=l;this._isShowingDates=aV;if(aU){this._onShowYears.notify()}if(l){this._onShowYears.notify()}if(aV){this._onShowDates.notify()}return this},_showSheet:function(aV){var l=this._sheet;if($.exists(l)){l.destroy()}var aU=this._sheetFactory[aV](this.dayPoint(),this._localization).onSelect(this._onSelect.notify,this._onSelect);this._sheetContainer.clear().appendChild(aU.dom());this._sheet=aU;return this}};$.Class.extend(q,$.dom.Class);$.calendar=function(){return new q()};var aP=function(aW){aP.base.call(this,$.create({div:{"class":"ku-calendar-controls"}}));this._calendar=aW;var aY=$.dom($.create({div:{"class":"ku-calendar-title"}})),aV=$.dom($.create({button:{"class":"ku-calendar-month"}})).onclick(this.showMonths,this),aU=$.dom($.create({button:{"class":"ku-calendar-year"}})).onclick(this.showYears,this),l=$.dom($.create({button:{"class":"ku-calendar-prevButton"}})).onclick(function(){this._prevAction()},this),aX=$.dom($.create({button:{"class":"ku-calendar-nextButton"}})).onclick(function(){this._nextAction()},this);$.dom(this.dom()).appendChild(aY.appendChild(aV.dom()).appendChild(aU.dom()).dom()).appendChild(l.dom()).appendChild(aX.dom()).appendChild(aW.dom());this._title=aY;this._month=aV;this._year=aU;this._prevButton=l;this._nextButton=aX;this.onSelect(this._displayDates,this)};aP.prototype={dayPoint:function(l){var aU=this._calendar;if(!$.exists(l)){return aU.dayPoint()}aU.dayPoint(l);return this},localization:function(aU){var l=this._calendar;if(!$.exists(aU)){return l.localization()}l.localization(aU);return this},sheetFactory:function(l){this._calendar.sheetFactory(l);return this},nextDay:function(){this._calendar.nextDay();return this},prevDay:function(){this._calendar.prevDay();return this},nextMonth:function(){this._calendar.nextMonth();return this},prevMonth:function(){this._calendar.prevMonth();return this},nextYear:function(){this._calendar.nextYear();return this},prevYear:function(){this._calendar.prevYear();return this},showDates:function(){var aV=this._calendar,l=aV.localization().month.name,aU=aV.dayPoint();aV.showDates();this._month.html(l[aU.month()]);this._year.html(aU.year());this._prevAction=this._prevMonth;this._nextAction=this._nextMonth;return this},showMonths:function(){this._calendar.showMonths();var l=function(){return};this._prevAction=l;this._nextAction=l;return this},showYears:function(){this._calendar.showYears();this._prevAction=this._prevYears;this._nextAction=this._nextYears;return this},findCell:function(l){return this._calendar.findCell(l)},each:function(aU,l){this._calendar.each(aU,l);return this},select:function(l){this._calendar.select(l);return this},onSelect:function(aU,l){this._calendar.onSelect(aU,l);return this},onShowDates:function(aU,l){this._calendar.onShowDates(aU,l);return this},onShowMonths:function(aU,l){this._calendar.onShowMonths(aU,l);return this},onShowYears:function(aU,l){this._calendar.onShowYears(aU,l);return this},_prevMonth:function(){this.prevMonth().showDates()},_nextMonth:function(){this.nextMonth().showDates()},_prevYears:function(){this.dayPoint(this.dayPoint().add(-12,0,0)).showYears()},_nextYears:function(){this.dayPoint(this.dayPoint().add(12,0,0)).showYears()},_displayDates:function(l){var a0=this._calendar,aU=a0.isShowingDates(),aZ=a0.isShowingMonths(),aY=a0.isShowingYears(),aV=a0.dayPoint(),aW=l.value(),aX;if(aY){aX=$.dayPoint(aW.year(),aV.month(),aV.date())}if(aZ){aX=$.dayPoint(aV.year(),aW.month(),aV.date())}if(aU){aX=aW}this.dayPoint(aX);if(aY||aZ||(aV.month()!=aW.month())){this.showDates()}}};$.Class.extend(aP,$.dom.Class);$.calendarControlsDecorator=function(l){return new aP(l)};function aT(){}aT.prototype={createDatesheet:function(l,aU){return $.datesheet(l,aU,$.table($.clickableDateSheetTableFactory(l,aU)))},createMonthsheet:function(l,aU){return $.monthsheet(l,aU,$.table($.clickableMonthSheetTableFactory(l,aU)))},createYearsheet:function(l,aU){return $.yearsheet(l,aU,$.table($.clickableYearSheetTableFactory(l,aU)))}};$.clickableSheetFactory=function(){return new aT()};function Q(l,aU){Q.base.call(this);this._dayPoint=l;this._localization=aU}Q.prototype={$setCellAction:function(l){return l},table:function(l){this.$table=l;return this.set("table",l)},createColumn:function(aU,aV,aW){var aU=this._table.listColumns().count(),l=$.create({col:{}}),aX=$.create({th:{"ku-key":aV},content:$.create({span:{"class":"ku-table-head-content"},content:aW})});return $.column(aX,l,aU,aV,aW)},createRow:function(aU,aV){var aU=this._table.listRows().count(),l=(aU%2==0)?"ku-table-row ku-table-row-even":"ku-table-row ku-table-row-odd",aW=$.create({tr:{"class":l}});return $.row(aW,aU,aV)},createCell:function(aZ,l,aU,aV,aW){var a1=this._table,aY=$.dayPoint.today(),aX=$.create({td:{"class":$.str.format("ku-date-day-{0} ku-date-week-{1}",l,aV)},content:$.str.format("<span class='ku-datesheet-cell-date'>{0}</span>",aZ.date())}),a0=$.cell(aX,l,aU,aV,aW,aZ).addClass("ku-sheet-date").id(aZ.toString());if(aZ.isBefore(aY)){a0.addClass("ku-datesheet-past")}if(aZ.equals(aY)){a0.addClass("ku-datesheet-present")}if(aZ.isAfter(aY)){a0.addClass("ku-datesheet-future")}if(aZ.isWeekday()){a0.addClass("ku-datesheet-weekday")}if(aZ.isWeekend()){a0.addClass("ku-datesheet-weekend")}if((aZ.month()<this._dayPoint.month())||((aZ.month()==12)&&(this._dayPoint.month()==1))){a0.addClass("ku-datesheet-lastMonth")}if(aZ.month()==this._dayPoint.month()){a0.addClass("ku-datesheet-thisMonth")}if((aZ.month()>this._dayPoint.month())||((aZ.month()==1)&&(this._dayPoint.month()==12))){a0.addClass("ku-datesheet-nextMonth")}return this.$setCellAction(a0)}};$.Class.extend(Q,$.Class);function U(l,aU){U.base.call(this);this._dayPoint=l;this._localization=aU}U.prototype={$setCellAction:function(l){return l},table:function(l){this.$table=l;return this.set("table",l)},createColumn:function(aU,aV,aW){var aU=this._table.listColumns().count(),l=$.create({col:{}}),aX=$.create({th:{"ku-key":aV},content:$.create({span:{"class":"ku-table-head-content"},content:aW})});return $.column(aX,l,aU,aV,aW)},createRow:function(aU,aV){var aU=this._table.listRows().count(),l=(aU%2==0)?"ku-table-row ku-table-row-even":"ku-table-row ku-table-row-odd",aW=$.create({tr:{"class":l}});return $.row(aW,aU,aV)},createCell:function(aX,aW,aU,aV,aZ){var aY=$.create({td:{"class":$.str.format("ku-month",aW,aV)},content:this._localization.month.abbr[aX.month()]}),l=$.cell(aY,aW,aU,aV,aZ,aX).addClass("ku-sheet-month").id(aX.month().toString());return this.$setCellAction(l)}};$.Class.extend(U,$.Class);function d(l,aU){d.base.call(this);this._dayPoint=l;this._localization=aU}d.prototype={$setCellAction:function(l){return l},table:function(l){this.$table=l;return this.set("table",l)},createColumn:function(aU,aV,aW){var aU=this._table.listColumns().count(),l=$.create({col:{}}),aX=$.create({th:{"ku-key":aV},content:$.create({span:{"class":"ku-table-head-content"},content:aW})});return $.column(aX,l,aU,aV,aW)},createRow:function(aU,aV){var aU=this._table.listRows().count(),l=(aU%2==0)?"ku-table-row ku-table-row-even":"ku-table-row ku-table-row-odd",aW=$.create({tr:{"class":l}});return $.row(aW,aU,aV)},createCell:function(aX,aW,aU,aV,aZ){var aY=$.create({td:{"class":$.str.format("ku-year",aW,aV)},content:aX.year()}),l=$.cell(aY,aW,aU,aV,aZ,aX).addClass("ku-sheet-year").id(aX.year().toString());return this.$setCellAction(l)}};$.Class.extend(d,$.Class);function au(l,aU){au.base.call(this,l,aU)}au.prototype={$setCellAction:function(l){return l.onclick(function(){this.$table.selectCell(l)},this)}};$.Class.extend(au,Q);$.clickableDateSheetTableFactory=function(l,aU){return new au(l,aU)};function J(l,aU){J.base.call(this,l,aU)}J.prototype={$setCellAction:function(l){return l.onclick(function(){this.$table.selectCell(l)},this)}};$.Class.extend(J,U);$.clickableMonthSheetTableFactory=function(l,aU){return new J(l,aU)};function P(l,aU){P.base.call(this,l,aU)}P.prototype={$setCellAction:function(l){return l.onclick(function(){this.$table.selectCell(l)},this)}};$.Class.extend(P,d);$.clickableYearSheetTableFactory=function(l,aU){return new P(l,aU)};var E=function(l,aU){E.base.call(this,l);this.localization(aU);this._onSelect=$.observer()};E.prototype={$findCell:function(l){return null},localization:function(l){return this.property("localization",l)},each:function(aU,l){this.$sheet.listCells().each(aU,l);return this},findCell:function(l){return this.$findCell(l)},selectCell:function(l){if(!$.exists(l)){return this}this._onSelect.notify(l);return this},select:function(l){return this.selectCell(this.findCell(l))},onSelect:function(aU,l){this._onSelect.add(aU,l);return this},destroy:function(){this.$sheet.listCells().each(function(l){if($.exists(l.deallocate)){l.deallocate()}l.clearEvents();return this})}};$.Class.extend(E,$.dom.Class);var h=function(l,aV,aU){this._firstDateOfSheet=x(l);this.$sheet=aU.onCellSelect(this.selectCell,this);h.base.call(this,this.$sheet.dom(),aV);aB(this);Z(this)};h.prototype={$findCell:function(l){return this.$sheet.findCellById(l.toString())}};$.Class.extend(h,E);$.datesheet=function(l,aV,aU){return(new h(l,aV,aU))};function x(l){var aV=l.firstDayOfMonth(),aW=l.firstDayOfMonth(),aU=false;while(aW.day()>0||!aU){if(aW.day()==0){aU=true}aW=aW.prevDay()}return aW}function aB(aV){var aY=aV.localization().day.abbr,aX=aV.$sheet,aW=7,aU=0;while(aU<aW){var l=aY[aU];aX.addColumn(l,{},l);aU++}}function Z(aW){var aX=aW.$sheet,l=aW._firstDateOfSheet,aV=0;while(aV<7){var aU=an(aW,l);l=l.add(0,0,7);aX.addRow($.uid(),aU);aV++}}function an(aU,l){var aV=l,aW={};aU.$sheet.listColumns().each(function(aX){aW[aX.key()]=aV;aV=aV.nextDay()});return aW}var L=function(l,aV,aU){this._firstDateOfSheet=aF(l);this.$sheet=aU.onCellSelect(this.selectCell,this);L.base.call(this,this.$sheet.dom(),aV);e(this);T(this)};L.prototype={$findCell:function(l){return this.$sheet.findCellById(l.month())}};$.Class.extend(L,E);$.monthsheet=function(l,aV,aU){return(new L(l,aV,aU))};function aF(l){return $.dayPoint(l.year(),1,l.date())}function e(aW){var aU=aW.localization().month.abbr,aX=aW.$sheet,l=4,aV=1;while(aV<=l){aX.addColumn(aV,null,"");aV++}}function T(aW){var aX=aW.$sheet,aU=aW._firstDateOfSheet,aV=1;while(aV<=3){var l=F(aW,aU);aU=aU.add(0,4,0);aX.addRow($.uid(),l);aV++}}function F(aU,l){var aV=l,aW={};aU.$sheet.listColumns().each(function(aX){aW[aX.key()]=aV;aV=aV.nextMonth()});return aW}var y=function(l,aV,aU){this._firstDateOfSheet=ag(l);this.$sheet=aU.onCellSelect(this.selectCell,this);y.base.call(this,this.$sheet.dom(),aV);O(this);D(this)};y.prototype={$findCell:function(l){return this.$sheet.findCellById(l.year())}};$.Class.extend(y,E);$.yearsheet=function(l,aV,aU){return(new y(l,aV,aU))};function ag(l){return l.add(-12,0,0)}function O(aW){var l=aW.localization().month.abbr,aX=aW.$sheet,aU=5,aV=0;while(aV<aU){aX.addColumn(aV,null,"");aV++}}function D(aW){var aX=aW.$sheet,l=aW._firstDateOfSheet,aV=0;while(aV<5){var aU=ak(aW,l);l=l.add(5,0,0);aX.addRow($.uid(),aU);aV++}}function ak(aU,l){var aV=l,aW={};aU.$sheet.listColumns().each(function(aX){aW[aX.key()]=aV;aV=aV.nextYear()});return aW}function p(l){p.base.call(this,l);this._id=$.uid("dropper");this._handle=this}p.prototype={id:function(l){return this.get("id")},value:function(l){return this.property("value",l)},handle:function(l){var aU;if($.exists(l)){aU=$.dom(l)}return this.property("handle",aU)},mouseEventId:function(l){return this.property("mouseEventId",l)},touchEventId:function(l){return this.property("touchEventId",l)},};$.Class.extend(p,$.dom.Class);$.dndScreenDropper=function(l){return new p(l)};var X=function(){this._targets=$.hash();this._droppers=$.hash();this._onHit=$.observer();this._lastKnownCoord;this._helper=$.sprite($.create({div:{"class":"ku-dndScreen-helper"}})).onGrab(function(aU){var l=$.touch().canRead(aU)?$.touch():$.mouse();this._lastKnownCoord=l.documentCoord(aU)},this).onDrag(function(aU){var l=$.touch().canRead(aU)?$.touch():$.mouse();this._lastKnownCoord=l.documentCoord(aU)},this).onDrop(function(l){this._drop(l)},this);this._currentDropper};X.prototype={addTarget:function(l){this._targets.add(l.id(),l);return this},removeTarget:function(l){this._targets.remove(l.id(),l);return this},addDropper:function(aV){var aW=$.uid("dropperEvent"),l=$.uid("dropperEvent");function aU(aX){this._currentDropper=aV;this.activateHelper(aX,aV)}aV.mouseEventId(aW).touchEventId(l).handle().onmousedown(aU,this,aW).ontouchstart(aU,this,l);this._droppers.add(aV.id(),aV)},removeDropper:function(l){l.handle().removeEvent(l.touchEventId()).removeEvent(l.mouseEventId());this._droppers.remove(l.id())},activateHelper:function(aU,l){this._helper.appendTo(document.body).pinTo(l.offset().subtract(l.scrollOffset()).add($.window().scrollOffset())).content(l.cloneNode()).grab(aU)},deactivateHelper:function(){this._helper.html("").detach();this._currentDropper=undefined},clearTargets:function(){this._targets.clear();return this},clearDroppers:function(){var l=this._droppers;$.list(l.values()).each(function(aU){this.removeDropper(aU)},this);return this},clearAll:function(){this.clearTargets().clearDroppers();return this},clearListeners:function(){this._onHit.clear();return this},onHit:function(aU,l){this._onHit.add(aU,l);return this},_drop:function(aV){var l=this._findHitTarget(aV),aU=this._currentDropper;if($.exists(l)&&$.exists(aU)){this._onHit.notify(l,aU)}this.deactivateHelper()},_findHitTarget:function(aW){var l=$.list(this._targets.values()),aV=$.touch().canRead(aW)?$.touch():$.mouse(),aU=null,aX;try{aX=aV.documentCoord(aW)}catch(aW){aX=this._lastKnownCoord}l.each(function(aY){if(!aY.contains(aX)){return}aU=aY;l.quit()});return aU}};$.dndScreen=function(){return new X()};function am(l){am.base.call(this,l);this._id=$.uid("target")}am.prototype={id:function(l){return this.get("id")},value:function(l){return this.property("value",l)},contains:function(aV){var aU=this.offset(),l=aU.add(this.outerDims());return $.rectangle(aU,l).contains(aV)}};$.Class.extend(am,$.dom.Class);$.dndScreenTarget=function(l){return new am(l)};function aG(){this._onKeyPressed=$.observer();k.base.call(this,$.create({div:{"class":"ku-keyboard"}}))}aG.prototype={addKey:function(l){$.onScreenKey(l).addClass($.str.format("ku-keyboard-key ku-key-{0}",l)).onPress(this._onKeyPressed.notify,this._onKeyPressed).appendTo(this.dom());return this},onKeyPressed:function(aU,l){this._onKeyPressed.add(aU,l);return this}};$.Class.extend(aG,$.dom.Class);$.onScreenKeyboard=function(){return new aG()};function aK(l){if(!$.isNumber(l)){$.ku4exception("onScreenKey",$.str.format("Invalid argument code:{0}",l))}this._value=$.key(l);this._onPress=$.observer();this._onRelease=$.observer();ah.base.call(this,$.create({button:{"class":"ku-keyboard-key"},content:this._value.toString()}));this.onmousedown(function(){this._onPress.notify(this._value)},this).ontouchstart(function(){this._onPress.notify(this._value)},this).onmouseup(function(){this._onRelease.notify(this._value)},this).ontouchend(function(){this._onRelease.notify(this._value)},this)}aK.prototype={onPress:function(aU,l){this._onPress.add(aU,l);return this},onRelease:function(aU,l){this._onRelease.add(aU,l);return this}};$.Class.extend(ah,$.dom.Class);$.onScreenKey=function(l){return new ah(l)};function u(aU){var l=aU||$.create({div:{"class":"ku-sprite"}});u.base.call(this,l);this.to().dragOn().force(0.4).mu(0.8)}u.prototype={force:function(l){return this.property("force",l)},mu:function(l){return this.property("mu",l)},algorithm:function(l){return this.set("algorithm",l)},to:function(){this._isTo=true;return this.algorithm($.anime.algorithms.jump())},spring:function(){this._isTo=false;return this.algorithm($.anime.algorithms.spring(this._force,this._mu))},ease:function(){this._isTo=false;return this.algorithm($.anime.algorithms.ease.linear(this._force,this._mu))},fitTo:function(aV,aU,l){return this._act("fitter",aV,aU,l)},sizeTo:function(aV,aU,l){return this._act("sizer",aV,aU,l)},pinTo:function(aV,aU,l){return this._act("pinner",aV,aU,l)},scrollTo:function(aV,aU,l){return this._act("scroller",aV,aU,l)},fadeTo:function(l,aV,aU){return this._act("fader",l,aV,aU)},growTo:function(aV,aU,l){return this.sizeTo(aV).pinTo(this.boundedOffset().subtract(aV.subtract(this.outerDims()).half()),aU,l)},_act:function(aZ,aY,aX,aW){var aU=$[aZ](this.dom()).algorithm(this._algorithm),l="_"+aZ,aV=this[l];if($.exists(aV)){aV.stop()}if($.exists(aX)){aU.onEnd(aX,aW)}if(this._isTo){this[l]=aU.to(aY)}else{this[l]=aU.moveTo(aY)}return this},tween:function(aU,l){this._styler=$.styler(this.dom(),aU).algorithm(this._algorithm).moveTo(l);return this},clear:function(){if($.exists(this._fader)){this._fader.stop()}if($.exists(this._sizer)){this._sizer.stop()}if($.exists(this._fitter)){this._fitter.stop()}if($.exists(this._pinner)){this._pinner.stop()}if($.exists(this._scroller)){this._scroller.stop()}if($.exists(this._styler)){this._styler.stop()}return this},dragHandle:function(l){return this.property("dragHandle",l)},dragType:function(l){return this.set("dragType",l)},dragOffset:function(l){this._dnd.dragOffset(l);return this},dragger:function(){this._dnd.dragger();return this},sizer:function(){this._dnd.sizer();return this},scroller:function(){this._dnd.scroller();return this},dragOn:function(){this._dnd=$.dnd(this.dom()).onGrab(this.clear,this);return this},dragOff:function(){this._dnd.destroy();return this},onGrab:function(aU,l,aV){this._dnd.onGrab(aU,l,aV);return this},onDrag:function(aU,l,aV){this._dnd.onDrag(aU,l,aV);return this},onDrop:function(aU,l,aV){this._dnd.onDrop(aU,l,aV);return this},bearingUp:function(){return this._dnd.bearingUp()},bearingDown:function(){return this._dnd.bearingDown()},bearingLeft:function(){return this._dnd.bearingLeft()},bearingRight:function(){return this._dnd.bearingRight()},grab:function(l){this._dnd.grab(l);return this},drag:function(l){this._dnd.drag(l);return this},drop:function(l){this._dnd.drop(l);return this},constrainX:function(){this._dnd.constrainX();return this},unconstrainX:function(){this._dnd.unconstrainX();return this},constrainY:function(){this._dnd.constrainY();return this},unconstrainY:function(){this._dnd.unconstrainY();return this}};$.Class.extend(u,$.dom.Class);$.sprite=function(l){return new u(l)};$.sprite.Class=u;var aL=function(l,aU){this.$offset=0;this.$multiplier=aU;this._tooltip=l;this.overlap(0)};aL.prototype={$above:function(l,aV,aU){return},$below:function(l,aV,aU){return},$leftOf:function(l,aV,aU){return},$rightOf:function(l,aV,aU){return},overlap:function(l){return this.set("overlap",l)},above:function(aX){var aV=this._tooltip,l=aV.context(aX).context(),aW=aV.pointer(),aU=aV.tooltip();this.$offset=this._overlap;this.$above(l,aW,aU);return this},below:function(aX){var aV=this._tooltip,l=aV.context(aX).context(),aW=aV.pointer(),aU=aV.tooltip();this.$offset=this._overlap;this.$below(l,aW,aU);return this},leftOf:function(aX){var aV=this._tooltip,l=aV.context(aX).context(),aW=aV.pointer(),aU=aV.tooltip();this.$offset=this._overlap;this.$leftOf(l,aW,aU);return this},rightOf:function(aX){var aV=this._tooltip,l=aV.context(aX).context(),aW=aV.pointer(),aU=aV.tooltip();this.$offset=this._overlap;this.$rightOf(l,aW,aU);return this}};$.Class.extend(aL,$.Class);var aS=function(l,aU){aS.base.call(this,l,0.5)};aS.prototype={$above:function(l,aV,aU){aV.pinTo(l.offset().subtract(aV.outerHeight()).add($.coord(l.outerDims().subtract(aV.outerDims()).x()*this.$multiplier,0)));aU.pinTo(aV.offset().subtract(aU.outerHeight()).add($.coord(0,this.$offset)).add($.coord(aV.outerDims().subtract(aU.outerDims()).x()*this.$multiplier,0)));aV.fadeTo(100);aU.fadeTo(100);return this},$below:function(l,aV,aU){aV.pinTo(l.offset().add(l.outerHeight()).add($.coord(l.outerDims().subtract(aV.outerDims()).x()*this.$multiplier,0)));aU.pinTo(aV.offset().add(aV.outerHeight()).subtract($.coord(0,this.$offset)).add($.coord(aV.outerDims().subtract(aU.outerDims()).x()*this.$multiplier,0)));aV.fadeTo(100);aU.fadeTo(100);return this},$leftOf:function(l,aV,aU){aV.pinTo(l.offset().subtract(aV.outerWidth()).add($.coord(0,l.outerDims().subtract(aV.outerDims()).y()*this.$multiplier)));aU.pinTo(aV.offset().subtract(aU.outerWidth()).add($.coord(this.$offset,0)).add($.coord(0,aV.outerDims().subtract(aU.outerDims()).y()*this.$multiplier)));aV.fadeTo(100);aU.fadeTo(100);return this},$rightOf:function(l,aV,aU){aV.pinTo(l.offset().add(l.outerWidth()).add($.coord(0,l.outerDims().subtract(aV.outerDims()).y()*this.$multiplier)));aU.pinTo(aV.offset().add(aV.outerWidth()).subtract($.coord(this.$offset,0)).add($.coord(0,aV.outerDims().subtract(aU.outerDims()).y()*this.$multiplier)));aV.fadeTo(100);aU.fadeTo(100);return this}};$.Class.extend(aS,aL);var ax=function(l,aU){ax.base.call(this,l,0)};ax.prototype={$above:function(l,aV,aU){aV.pinTo(l.offset().subtract(aV.outerHeight()).add($.coord(this.$offset,0)).add($.coord(l.outerDims().subtract(aV.outerDims()).x()*this.$multiplier,0)));aU.pinTo(aV.offset().subtract(aU.outerHeight()).add($.coord(-this.$offset,this.$offset)).add($.coord(aV.outerDims().subtract(aU.outerDims()).x()*this.$multiplier,0)));aV.fadeTo(100);aU.fadeTo(100);return this},$below:function(l,aV,aU){aV.pinTo(l.offset().add(l.outerHeight()).add($.coord(this.$offset,0)).add($.coord(l.outerDims().subtract(aV.outerDims()).x()*this.$multiplier,0)));aU.pinTo(aV.offset().add(aV.outerHeight()).subtract($.coord(this.$offset,this.$offset)).add($.coord(aV.outerDims().subtract(aU.outerDims()).x()*this.$multiplier,0)));aV.fadeTo(100);aU.fadeTo(100);return this},$leftOf:function(l,aV,aU){aV.pinTo(l.offset().subtract(aV.outerWidth()).add($.coord(0,this.$offset)).add($.coord(0,l.outerDims().subtract(aV.outerDims()).y()*this.$multiplier)));aU.pinTo(aV.offset().subtract(aU.outerWidth()).add($.coord(this.$offset,-this.$offset)).add($.coord(0,aV.outerDims().subtract(aU.outerDims()).y()*this.$multiplier)));aV.fadeTo(100);aU.fadeTo(100);return this},$rightOf:function(l,aV,aU){aV.pinTo(l.offset().add(l.outerWidth()).add($.coord(0,this.$offset)).add($.coord(0,l.outerDims().subtract(aV.outerDims()).y()*this.$multiplier)));aU.pinTo(aV.offset().add(aV.outerWidth()).subtract($.coord(this.$offset,this.$offset)).add($.coord(0,aV.outerDims().subtract(aU.outerDims()).y()*this.$multiplier)));aV.fadeTo(100);aU.fadeTo(100);return this}};$.Class.extend(ax,aL);var aj=function(l,aU){aj.base.call(this,l,1)};aj.prototype={$above:function(l,aV,aU){aV.pinTo(l.offset().subtract(aV.outerHeight()).add($.coord(-this.$offset,0)).add($.coord(l.outerDims().subtract(aV.outerDims()).x()*this.$multiplier,0)));aU.pinTo(aV.offset().subtract(aU.outerHeight()).add($.coord(this.$offset,this.$offset)).add($.coord(aV.outerDims().subtract(aU.outerDims()).x()*this.$multiplier,0)));aV.fadeTo(100);aU.fadeTo(100);return this},$below:function(l,aV,aU){aV.pinTo(l.offset().add(l.outerHeight()).add($.coord(-this.$offset,0)).add($.coord(l.outerDims().subtract(aV.outerDims()).x()*this.$multiplier,0)));aU.pinTo(aV.offset().add(aV.outerHeight()).add($.coord(this.$offset,-this.$offset)).add($.coord(aV.outerDims().subtract(aU.outerDims()).x()*this.$multiplier,0)));aV.fadeTo(100);aU.fadeTo(100);return this},$leftOf:function(l,aV,aU){aV.pinTo(l.offset().subtract(aV.outerWidth()).add($.coord(0,-this.$offset)).add($.coord(0,l.outerDims().subtract(aV.outerDims()).y()*this.$multiplier)));aU.pinTo(aV.offset().subtract(aU.outerWidth()).add($.coord(this.$offset,this.$offset)).add($.coord(0,aV.outerDims().subtract(aU.outerDims()).y()*this.$multiplier)));aV.fadeTo(100);aU.fadeTo(100);return this},$rightOf:function(l,aV,aU){aV.pinTo(l.offset().add(l.outerWidth()).add($.coord(0,-this.$offset)).add($.coord(0,l.outerDims().subtract(aV.outerDims()).y()*this.$multiplier)));aU.pinTo(aV.offset().add(aV.outerWidth()).add($.coord(-this.$offset,this.$offset)).add($.coord(0,aV.outerDims().subtract(aU.outerDims()).y()*this.$multiplier)));aV.fadeTo(100);aU.fadeTo(100);return this}};$.Class.extend(aj,aL);var z=function(){z.base.call(this);this.pointer($.sprite($.create({div:{"class":"ku-tooltip-pointer"}})).hide().dragOff().to()).tooltip($.sprite($.create({div:{"class":"ku-tooltip"}})).hide().dragOff().to()).leftJustify();this._id=$.uid("tip");this._onShow=$.observer();this._onHide=$.observer()};z.prototype={calibrate:function(l){return this.property("calibrate",l)},pointer:function(l){return this.property("pointer",l)},tooltip:function(l){return this.property("tooltip",l)},strategy:function(l){return this.property("strategy",l)},message:function(l){return this.property("message",l)},context:function(aU){var l=($.exists(aU))?$.dom(aU):aU;return this.property("context",l)},center:function(){return this.strategy(new aS(this))},leftJustify:function(){return this.strategy(new ax(this))},rightJustify:function(){return this.strategy(new aj(this))},onShow:function(aU,l){this._onShow.add(aU,l);return this},onHide:function(aU,l){this._onHide.add(aU,l);return this},show:function(aV){var l=aV||this._message,aU=l||"";this._pointer.fadeTo(0).appendTo(document.body).show();this._tooltip.fadeTo(0).appendTo(document.body).html("").content(aU).show();this._onShow.notify();return this},hide:function(){this._pointer.hide().detach();this._tooltip.hide().detach();this._onHide.notify();return this},at:function(aZ,a8){var a6=$.window(),a1=$.dom(aZ),aX=$.point.zero(),aV=a6.dims(),a4=a1.offset(),a3=a4.add(a1.outerDims()),aU=this._tooltip.outerDims(),a0=a3.add(aU),a7=a4.subtract(aU),aY=!a0.isRightOf(aV),a5=!a0.isBelow(aV),l=!a7.isLeftOf(aX),a2=!a7.isAbove(aX),aW={rightOf:aY,below:a5,leftOf:l,above:a2};if(aW[a8[0]]){return this[a8[0]](aZ)}if(aW[a8[1]]){return this[a8[1]](aZ)}if(aW[a8[2]]){return this[a8[2]](aZ)}if(aW[a8[3]]){return this[a8[3]](aZ)}return this.rightOf(aZ)},above:function(l){return this._locate(l,"bottom","above")},below:function(l){return this._locate(l,"top","below")},leftOf:function(l){return this._locate(l,"right","leftOf")},rightOf:function(l){return this._locate(l,"left","rightOf")},_locate:function(aV,aU,l){this.strategy().overlap(aQ(this,aU))[l](aV);aN(this,l);this._pointer.fadeTo(100);this._tooltip.fadeTo(100);return this}};$.Class.extend(z,$.Class);$.tooltip=function(){return new z()};function aQ(aV,aU){var l=aV.tooltip().style($.str.format("border-{0}-width",aU));return $.ku.style.toNumber(l)}function aN(aV,l){var aW="ku-{0}",aU=["above","below","leftOf","rightOf"],aX=aV.pointer();for(var aY in aU){aX.removeClass($.str.format(aW,aU[aY]))}aX.addClass($.str.format(aW,l))}})(jQuery);