(function(L){$=L;$.isArray=function(l){return l instanceof Array};$.isBool=function(l){return(/boolean/i.test(typeof(l)))};$.isDate=function(l){return l instanceof Date};$.isEvent=function(l){try{return l instanceof Event}catch(U){return l===window.event}};$.isNumber=function(l){return((/number/i.test(typeof(l)))||l instanceof Number)&&!isNaN(l)};$.isObject=function(l){return $.exists(l)&&(/object/i.test(typeof(l)))&&!($.isBool(l)||$.isNumber(l)||$.isDate(l)||$.isArray(l)||$.isString(l)||$.isFunction(l))};$.isFunction=function(l){return(l instanceof Function)};$.isString=function(l){return(/string/i.test(typeof(l)))||l instanceof String};$.isZero=function(l){return l===0};$.isEven=function(l){return($.isNullOrEmpty(l)||$.isDate(l))?false:(isNaN(l)?false:($.isZero(l)?false:l%2===0))};$.isOdd=function(l){return($.isNullOrEmpty(l)||$.isDate(l))?false:(isNaN(l)?false:($.isZero(l)?false:!$.isEven(l)))};$.isNull=function(l){return l===null};$.isUndefined=function(l){return(/undefined/i.test(typeof(l)))};$.isEmpty=function(l){return $.isString(l)&&$.isZero(l.split(/\B/).length)};$.isNullOrEmpty=function(l){return !$.exists(l)||$.isEmpty(l)};$.exists=function(l){return(l!==null)&&(!$.isUndefined(l))};$.areEqual=function(U,l){if(this.exists(U)&&this.exists(l)){if(this.exists(U.equals)&&value.equals(l)){return true}if(this.exists(U.getTime)&&this.exists(l.getTime)&&U.getTime()==l.getTime()){return true}if(U===l){return true}else{return U===l}}else{return U===l}};$.xor=function(U,l){return !U!=!l};function p(U,V,l,X){var W="ku4EXCEPTION @ {0}: {1}\n\nBrowser Stack Trace:\n{2}\n\nku4Trace:\n{3}";return new Error($.str.format(W,U.toUpperCase(),V,l,X))}$.ku4exception=function(V,W){var U=arguments.callee.caller,X="",l="";(function(){try{generate.exeception}catch(aa){l=($.exists(aa.stack))?aa.stack.replace(/generate is.+/,""):"[Unavailable]";var Z=0,ab,Y;while(U&&(Z<10)){ab=U.toString().replace(/[\n\t\r\s]+/g," ").substring(0,100);Y=ab.replace(/\W/g,"a").replace(/\s/g,"").replace(/.*base\.js:216/,"").split(/\B/).length>99?ab+"...":ab;X+=$.str.format("<ku4Idx[{0}]>:{1}\n",Z,Y);U=U.caller;Z++}}})();return p(V,W,l,X)};$.ku4Log=function(){try{console.log.apply(console,arguments)}catch(l){alert(Array.prototype.slice.call(arguments).join("\n"))}};$.replicate=function(V){var l=($.isDate(V))?new Date(V):($.isArray(V))?[]:($.isObject(V))?{}:V,U;for(n in V){U=V[n];l[n]=(($.isArray(U))||($.isObject(U)))?$.replicate(U):U}return l};if(!$.exists($.obj)){$.obj={}}$.obj.keys=function(U){var l=[];for(n in U){l[l.length]=n}return l};$.obj.values=function(U){var l=[];for(n in U){l[l.length]=U[n]}return l};$.obj.count=function(l){var U=0;for(n in l){U++}return U};$.obj.hasProp=function(l,U){return($.exists(l.hasOwnProperty))?l.hasOwnProperty(U):false};$.obj.merge=function(U,l){var V=$.replicate(l);for(n in U){V[n]=U[n]}return V};$.obj.meld=function(V,U){var l=$.replicate(U);for(n in V){if($.exists(l[n])){continue}l[n]=V[n]}return l};$.obj.filter=function(){var l=Array.prototype.slice.call(arguments),W={},X=l[0],V=l.slice(1);for(var Y in V){var U=V[Y];W[U]=X[U]}return W};$.Class=function(){};$.Class.prototype={get:function(l){return this["_"+l]},set:function(U,l){this["_"+U]=l;return this},property:function(U,l){return($.isUndefined(l))?this.get(U):this.set(U,l)},isTypeOf:function(l){return this instanceof l}};$.Class.extend=function(U,l){if(!U||!l){return null}var V=function(){};V.prototype=l.prototype;U.base=l;U.prototype=$.obj.merge(U.prototype,new V());U.prototype.constructor=U;return U};function d(l){d.base.call(this);this._isLocked=l||false}d.prototype={isLocked:function(){return this.get("isLocked")},lock:function(){this._isLocked=true;return this},unlock:function(){this._isLocked=false;return this}};$.Class.extend(d,$.Class);$.lock=function(l){return new d(l)};if(!$.exists($.math)){$.math={}}$.math.round=function(W,V){var U=V||0,l=Math.pow(10,-U);return Math.round(parseFloat((W*l).toFixed(Math.abs(U))))/l};$.math.roundUp=function(W,V){var U=V||0,l=5*(Math.pow(10,U-1));return $.math.round(W+l,V)};$.math.roundDown=function(W,V){var U=V||0,l=5*(Math.pow(10,U-1));return $.math.round(W-l,V)};$.math.factorial=function(V){var l=V,U=V;while(U--){if(!!U){l*=U}}return l};$.math.divide=function(U,l){var V=$.isNumber(U)&&$.isNumber(l)&&!$.isZero(l);if(!V){throw $.ku4exception("$.math",$.str.format("Invalid division. value: {0}/{1} | type: {2}/{3}",U,l,typeof U,typeof l))}return U/l};if(!$.exists($.str)){$.str={}}var P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";$.str.build=function(){return"".concat.apply(new String(),arguments)};$.str.format=function(){var W=arguments,Y=W[0],V=W.length,U,X;for(i=1;i<V;i++){U=W[i];X=($.isNull(U))?"null":($.isUndefined(U))?"undefined":U.toString();Y=Y.replace(RegExp("\\{"+(i-1)+"\\}","g"),X)}return Y};$.str.render=function(U,W,V){var l=""+U;for(var X in W){l=l.replace(RegExp("\\{{"+X+"\\}}","g"),W[X])}return $.exists(V)?l.replace(/\{\{.*\}\}/g,V):l};$.str.parse=function(){return String.fromCharCode.apply(String,arguments)};$.str.trim=function(l){return $.str.trimStart($.str.trimEnd(l))};$.str.trimStart=function(l){if(!$.isString(l)){throw new Error("Cannot trim non-string values")}return($.exists(l.replace))?l.replace(/^\s*\b/,""):l};$.str.trimEnd=function(l){if(!$.isString(l)){throw new Error("Cannot trim non-string values")}return($.exists(l.replace))?l.replace(/\b\s*$/,""):l};$.str.encodeBase64=function(W){var X="",V=0,ae=$.str.encodeUtf8(W),af,ac,aa,ad,ab,Z,Y,l=function(ag){return ae.charCodeAt(ag)},U=function(ag){return P.charAt(ag)};while(V<ae.length){af=l(V++);ac=l(V++);aa=l(V++);ad=af>>2;ab=((af&3)<<4)|(ac>>4);Z=((ac&15)<<2)|(aa>>6);Y=aa&63;if(isNaN(ac)){Z=Y=64}else{if(isNaN(aa)){Y=64}}X+=(U(ad)+U(ab)+U(Z)+U(Y))}return X};$.str.decodeBase64=function(W){var X="",V=0,ae=W.replace(/[^A-Za-z0-9\+\/\=]/g,""),af,ac,aa,ad,ab,Z,Y,U=function(ag){return P.indexOf(ae.charAt(ag))},l=function(ag){return String.fromCharCode(ag)};while(V<ae.length){ad=U(V++);ab=U(V++);Z=U(V++);Y=U(V++);af=(ad<<2)|(ab>>4);ac=((ab&15)<<4)|(Z>>2);aa=((Z&3)<<6)|Y;X+=l(af);if(Z!=64){X+=l(ac)}if(Y!=64){X+=l(aa)}}return $.str.decodeUtf8(X)};$.str.encodeUtf8=function(l){var Y="",W=l.replace(/\r\n/g,"\n"),X=function(aa){return W.charCodeAt(aa)},V=function(aa){return String.fromCharCode(aa)};for(var U=0;U<W.length;U++){var Z=X(U);if(Z<128){Y+=V(Z)}else{if((Z>127)&&(Z<2048)){Y+=(V((Z>>6)|192)+V((Z&63)|128))}else{Y+=V((Z>>12)|224)+V(((Z>>6)&63)|128)+V((Z&63)|128)}}}return Y};$.str.decodeUtf8=function(Z){var aa="",X=0,Y=0,W=0,V=0,ab=Z,l=function(ac){return ab.charCodeAt(ac)},U=function(ac){return String.fromCharCode(ac)};while(X<ab.length){Y=l(X);if(Y<128){aa+=U(Y);X++}else{if((Y>191)&&(Y<224)){W=l(X+1);aa+=U(((Y&31)<<6)|(W&63));X+=2}else{W=l(X+1);V=l(X+2);aa+=U(((Y&15)<<12)|((W&63)<<6)|(V&63));X+=3}}}return aa};$.uid=function(){var U=Math.random().toString().replace(/\b\.\b/,""),l=Math.random().toString().replace(/\b\.\b/,"");return $.str.encodeBase64($.str.format("{0}x{1}",U,l)).replace(/=+/g,"0").substr(3,32)};function e(V,l,U){e.base.call(this);this._username=V;this._domain=l;this._topLevelDomain=U}e.prototype={username:function(){return this._username},domain:function(){return this._domain},topLevelDomain:function(){return this._topLevelDomain},equals:function(l){if(!$.exists(l)){return false}return l.username()==this._username&&l.domain()==this._domain&&l.topLevelDomain()==this._topLevelDomain},toString:function(){return $.str.format("{0}@{1}.{2}",this._username,this._domain,this._topLevelDomain)}};$.Class.extend(e,$.Class);$.emailAddress=function(V,l,U){return new e(V,l,U)};$.emailAddress.Class=e;$.emailAddress.parse=function(W){if(!($.exists(W))&&/@{1}/.test(W)){return null}var V=W.split("@"),l=V[1],U=l.split("."),X=V[0];topLevelDomain=U.splice(U.length-1,1),domain=U.join(".");return new e(X,domain,topLevelDomain)};function f(l){f.base.call(this);this._value=l}f.prototype={value:function(){return this._value},equals:function(l){if(!$.exists(l)){return false}return l.value()==this._value},toStringWithFormat:function(U){var l=U;$.list((this._value.toString().split(""))).each(function(V){l.replace("#",V)});return l.replace(/#/g,"")}};$.Class.extend(f,$.Class);$.phoneNumber=function(l){return new f(l)};$.phoneNumber.Class=f;$.phoneNumber.parse=function(l){return new f(parseInt(l.replace(/[^0-9]/gi,"")))};function M(V,l,U){M.base.call(this);this._first=V;this._middle=l||"";this._last=U}M.prototype={first:function(){return this._first},middle:function(){return this._middle},last:function(){return this._last},full:function(){var l=($.isNullOrEmpty(this._middle))?"{F} {L}":"{F} {M} {L}";return this.toStringWithFormat(l)},initials:function(){var l=($.isNullOrEmpty(this._middle))?"{f}.{l}.":"{f}.{m}.{l}.";return this.toStringWithFormat(l)},equals:function(l){if(!$.exists(l)){return false}return l.first()==this._first&&l.middle()==this._middle&&l.last()==this._last},toStringWithFormat:function(V){var l=this._first.charAt(0),U=this._middle.charAt(0),W=this._last.charAt(0);return V.replace("{F}",this._first).replace("{M}",this._middle).replace("{L}",this._last).replace("{f}",l).replace("{m}",U).replace("{l}",W)}};$.Class.extend(M,$.Class);$.properName=function(V,l,U){return new M(V,l,U)};$.properName.Class=M;function K(l){K.base.call(this);this.$h={};this._count=0;var U=($.exists(l)&&$.exists(l.toObject))?l.toObject():l;for(var V in U){this.add(V,U[V])}}K.prototype={count:function(){return this.get("count")},keys:function(){return $.obj.keys(this.$h)},values:function(){return $.obj.values(this.$h)},add:function(U,l){if((!($.isString(U)||$.isNumber(U)))||/(^null$)|(^undefined$)/.test(U)||this.containsKey(U)){throw $.ku4exception("$.hash",$.str.format("Invalid key: {0}. Must be unique number or string.",U))}if($.isUndefined(l)){return}this.$h[U]=l;this._count++;return this},clear:function(){var l=this.$h;for(n in l){delete l[n]}this._count=0;return this},find:function(l){if(!$.exists(l)){return null}return this.$h[l]},findKey:function(l){var U=this.$h;for(n in U){if($.areEqual(U[n],l)){return n}}return null},findValue:function(l){return this.find(l)},quit:function(){this._iterator.quit();return this},each:function(U,l){var V=l||this;this._iterator=$.iterator(this.toObject());this._iterator.each(U,V);return this},isEmpty:function(){return this._count<1},contains:function(l){if(!$.exists(l)||$.isNullOrEmpty(l)||$.hash(l).isEmpty()){return false}var V=$.exists(l.toObject)?l:$.hash(l),U=true;V.each(function(X){if(!$.exists(X)){U=false;V.quit()}else{var W=X.key;U=this.containsKey(W)&&$.areEqual(this.findValue(W),X.value);if(!U){V.quit()}}},this);return U},containsKey:function(l){if(!$.exists(l)){return false}return !$.isUndefined(this.$h[l])},containsValue:function(U){var l=$.obj.values(this.$h),V=l.length;while(V--){if($.areEqual(l[V],U)){return true}}return false},merge:function(l){return J(this,l,"merge")},meld:function(l){return J(this,l,"meld")},filter:function(){var l=[this.$h].concat(Array.prototype.slice.call(arguments));return $.hash($.obj.filter.apply($.obj,l))},remove:function(l){if(!this.containsKey(l)){return this}var U=this.$h;U[l]="value";delete U[l];this._count--;return this},replicate:function(){return $.hash($.replicate(this.$h))},toObject:function(){return this.$h},update:function(U,l){if(!$.exists(U)){return this}if(!this.containsKey(U)){this._count++}this.$h[U]=l;return this}};$.Class.extend(K,$.Class);function J(V,U,l){var W=(!U.toObject)?U:U.toObject();V.$h=$.obj[l](W,V.$h);V._count=$.obj.count(V.$h);return V}$.hash=function(l){return new K(l)};$.hash.Class=K;function v(V){v.base.call(this);this._keys=[];this._hash=$.hash();this._count=this._keys.length;if(!$.exists(V)){return}var X=0,U=V.length;while(X<U){var W=V[X];if(!$.isUndefined(W)){this.add(W)}X++}}v.prototype={count:function(){return this.get("count")},add:function(U){var l=this._keys,V=$.uid();l[l.length]=V;this._hash.add(V,U);this._count=this._keys.length;return this},clear:function(){this._hash.clear();this._keys=[];this._count=this._keys.length;return this},contains:function(l){return this._hash.containsValue(l)},find:function(U){var l=this._keys;return($.exists(l[U]))?this._hash.find(l[U]):null},quit:function(){this._iterator.quit();return this},each:function(U,l){var V=l||this;this._iterator=$.iterator(this.toArray());this._iterator.each(U,V);return this},isEmpty:function(){return this._count<1},remove:function(V){var U=this._hash;if(!this.contains(V)){return this}var l=U.findKey(V);this._keys.splice(l,1);U.remove(l);this._count=U.count();return this},toArray:function(){var l=[];this._hash.each(function(U){l.push(U.value)});return l}};$.Class.extend(v,$.Class);$.list=function(l){return new v(l)};$.list.Class=v;$.list.parseArguments=function(l){return new v(Array.prototype.slice.call(l))};function O(Y,W,l,Z,V,aa,U){O.base.call(this);if((W<1)||(W>12)){throw $.ku4exception("$.dayPoint",$.str.format("Invalid month= {0}",W))}if((l<1)||(l>S(W,Y))){throw $.ku4exception("$.dayPoint",$.str.format("Invalid date= {0}",l))}this._value=(arguments.length>=3)?new Date(Y,W-1,l,Z||0,V||0,aa||0,U||0):new Date();var ab=this._value;function ac(ad){return ad<10?"0"+ad:""+ad}this._day=ab.getDay();this._date=l;this._month=W;this._year=Y;this._hour=ac(ab.getHours());this._minute=ac(ab.getMinutes());this._second=ac(ab.getSeconds());this._millisecond=ac(ab.getMilliseconds());var X=this._day;this._isWeekday=X>0&&X<6;this._isWeekend=!this._isWeekday}O.prototype={value:function(){return this._value},day:function(){return this._day},date:function(){return this._date},month:function(){return this._month},year:function(){return this._year},hour:function(){return this._hour},minute:function(){return this._minute},second:function(){return this._second},millisecond:function(){return this._millisecond},isWeekday:function(){return this._isWeekday},isWeekend:function(){return this._isWeekend},nextDay:function(){return T(this,1,0,0)},prevDay:function(){return T(this,-1,0,0)},nextMonth:function(){return T(this,0,1,0)},prevMonth:function(){return T(this,0,-1,0)},nextYear:function(){return T(this,0,0,1)},prevYear:function(){return T(this,0,0,-1)},add:function(Y,l,ad){function ac(af,aj,ai){var ag=af,ah=aj;while(ah--){ag=ag[ai]()}return ag}var ab=Y<0,ae=Math.abs,aa=ae(Y),Z=ae(ad),V=ae(l),U=ab?"prevYear":"nextYear",X=ab?"prevDay":"nextDay",W=ab?"prevMonth":"nextMonth";return ac(ac(ac(this,aa,U),V,W),Z,X)},firstDayOfMonth:function(){return new O(this._year,this._month,1)},lastDayOfMonth:function(){return new O(this._year,this._month,S(this._month,this._year))},isBefore:function(l){return !(this.isAfter(l)||this.equals(l))},isAfter:function(U){var l=this._year,W=U.year(),V=this._month,X=U.month();if(l>W){return true}if((l==W)&&(V>X)){return true}return((l==W)&&(V==X)&&(this._date>U.date()))},equals:function(l){return(this._year==l.year())&&(this._month==l.month())&&(this._date==l.date())},toString:function(){var W=this._year,l=this._month,V=this._date,U=(l<10&&V<10)?"0{1}/0{2}/{0}":(l<10)?"0{1}/{2}/{0}":(V<10)?"{1}/0{2}/{0}":"{1}/{2}/{0}";return $.str.format(U,W,l,V)},toDate:function(){return this.value()},toJson:function(){return this.value().toJSON()}};$.Class.extend(O,$.Class);$.dayPoint=function(X,Y,V,l,W,Z,U){if(!($.isDate(X)||($.isNumber(X)&&$.isNumber(Y)&&$.isNumber(V)))){return null}return new O(X,Y,V,l,W,Z,U)};$.dayPoint.Class=O;$.dayPoint.canParse=function(l){return($.isString(l)||$.isNumber(l)||$.isDate(l))?!isNaN(new Date(l).valueOf()):false};$.dayPoint.parse=function(aa){if(aa instanceof O){return aa}if(!($.isDate(aa)||this.canParse(aa))){return null}var l=new Date(aa),Z=l.getFullYear(),V=l.getMonth()+1,Y=l.getDate(),W=l.getHours(),X=l.getMinutes(),ab=l.getSeconds(),U=l.getMilliseconds();return $.dayPoint(Z,V,Y,W,X,ab,U)};$.dayPoint.tryParse=function(l){return $.dayPoint.canParse(l)?$.dayPoint.parse(l):null};var I;$.dayPoint.assumeNow=function(l){I=$.dayPoint.parse(l)};$.dayPoint.today=function(){return I||$.dayPoint.parse(new Date())};function S(V,U){var l=V,W=U;if(l==2){return(t(W))?29:28}return(((l<8)&&($.isEven(l)))||((l>7)&&($.isOdd(l))))?30:31}function t(l){var V=l.toString().split(/\B/),U=parseFloat($.str.build(V[V.length-2],V[V.length-1]));return(U%4==0)}function T(Z,ae,V,ag){var ai=Z.month(),aa=Z.year(),X=Z.date(),l=S(ai,aa),ah=ae,Y=V,ad=ag,U=X+ah,ac=ai+Y,af=aa+ad;if((X+ah)>l){U=1;ac=(ai+(Y+1))}if((X+ah)<1){var W=Z.prevMonth(),U=S(W.month(),W.year());(ac=ai+(Y-1))}if((ac)>12){ac=1;af=(aa+(ad+1))}if((ac)<1){ac=12;af=(aa+(ad-1))}var ab=S(ac,af);U=(U>ab)?ab:U;return new O(af,ac,U)}function G(V,U){if(!$.exists(V)||isNaN(V)){throw $.ku4exception("$.money",$.str.format("Invalid amount= {0}. Amount must be a number.",V))}G.base.call(this);var l=$.math.roundDown(V);this._cents=V-l;this._dollars=l;this._type=U||"$";this._value=V}G.prototype={cents:function(){return this._cents},dollars:function(){return this._dollars},type:function(){return this._type},value:function(){return this._value},add:function(l){money_checkType(this,l);return new G(this._value+l.value(),this._type)},divide:function(l){if(!$.isNumber(l)){throw $.ku4exception("$.money",$.str.format("Invalid divisor value= {0}",l))}return new G(this._value/l,this._type)},equals:function(l){return(this.isOfType(l))&&(this._value==l.value())},isOfType:function(l){return this._type==l.type()},isGreaterThan:function(l){money_checkType(this,l);return this._value>l.value()},isLessThan:function(l){money_checkType(this,l);return this._value<l.value()},multiply:function(l){if(!$.isNumber(l)){throw $.ku4exception("$.money",$.str.format("Invalid multiplier value= {0}",l))}return new G(this._value*l,this._type)},round:function(){return new G($.math.round(this.value(),-2),this._type)},roundDown:function(){return new G($.math.roundDown(this.value(),-2),this._type)},roundUp:function(){return new G($.math.roundUp(this.value(),-2),this._type)},subtract:function(l){money_checkType(this,l);return new G(this._value-l.value(),this._type)},toString:function(){var l=(this.value<0)?"({0}{1}.{2})":"{0}{1}.{2}";return $.str.format(l,this._type,money_formatDollars(this),money_formatCents(this))}};$.Class.extend(G,$.Class);$.money=function(U,l){return new G(U,l)};$.money.Class=G;$.money.zero=function(l){return $.money(0,l)};$.money.isMoney=function(l){return l instanceof G};$.money.canParse=function(l){try{$.money.parse(l);return true}catch(U){return false}};$.money.parse=function(Z){if($.isNumber(Z)){return $.money(Z)}var l=/(\(.*\))|(\-)/.test(Z),Y=(l)?1:0,X=Z.match(/[^\d\.\,\-]/g)||[],W=$.exists(X[Y])?X[Y]:"$",aa=parseFloat(Z.replace(/[^\d\.]/g,"")),V=(l)?-aa:aa;return $.money(V,W)};$.money.tryParse=function(l){return $.money.canParse(l)?$.money.parse(l):null};money_checkType=function(U,l){if(!U.isOfType(l)){throw $.ku4exception("$.money",$.str.format("Invalid operation on non-conforming currencies. type: {0} != type: {1}",U._type,l._type))}};money_formatDollars=function(U){var V=U.dollars(),X=(U.cents()>=0.995)?(V+1):V,ac=X.toString(),Z=ac.replace(/\-/,"").split(/\B/).reverse(),W=Z.length,aa=W>3,Y=0,ab=[];while(Y<W){ab[ab.length]=Z[Y];Y++;if(!$.exists(Z[Y])){break}if((Y%3==0)&&aa){ab[ab.length]=","}}return $.str.build.apply(this,ab.reverse())};money_formatCents=function(W){var X=$.math.round(W.cents(),-3),V=X.toString(),Y=V.replace(/\-|(0\.)/g,"").concat("0").split(/\B/),U=Y.length;if($.isZero(U)||X>=0.995){return"00"}if(U<2){return"0"+Y[0]}return(parseInt(Y[2])>4)?Y[0]+(parseInt(Y[1])+1):Y[0]+Y[1]};function s(l,U){if(!$.isNumber(l)||!$.isNumber(U)){throw $.ku4exception("$.coord",$.str.format("Invalid arguments x= {0}, y= {1} ",l,U))}s.base.call(this);this.x(l).y(U)}s.prototype={x:function(l){return this.property("x",l)},y:function(l){return this.property("y",l)},abs:function(){return new s(Math.abs(this._x),Math.abs(this._y))},add:function(U){var l=this._x+U.x(),V=this._y+U.y();return new s(l,V)},divide:function(U){var l=this._x/U.x(),V=this._y/U.y();return new s(l,V)},equals:function(l){return(this._x===l.x())&&(this._y===l.y())},multiply:function(U){var l=this._x*U.x(),V=this._y*U.y();return new s(l,V)},subtract:function(U){var l=this._x-U.x(),V=this._y-U.y();return new s(l,V)},round:function(l){var U=l||0;return new s($.math.round(this.x(),U),$.math.round(this.y(),U))},half:function(){return this.divide(new s(2,2))},value:function(){return{x:this._x,y:this._y}},toEm:function(){return C(this,"em")},toPixel:function(){return C(this,"px")},toString:function(){return $.str.format("({0},{1})",this._x,this._y)}};$.Class.extend(s,$.Class);$.coord=function(l,U){return new s(l,U)};$.coord.Class=s;function C(U,l){return{x:function(){return U.x()+l},y:function(){return U.y()+l}}}function E(l){try{if(("left" in l)&&("top" in l)){return !isNaN(l.left)&&!isNaN(l.top)}if(("width" in l)&&("height" in l)){return !isNaN(l.width)&&!isNaN(l.height)}return false}catch(U){return false}}function h(l){if(!$.exists(l)){return null}if($.exists(l.left)&&$.exists(l.top)){return new s(l.left,l.top)}if($.exists(l.width)&&$.exists(l.height)){return new s(l.width,l.height)}return null}$.coord.zero=function(){return new s(0,0)};$.coord.random=function(V,U){var l=V*Math.random(),W=U*Math.random(U);return new s(l,W)};$.coord.canParse=h;$.coord.parse=h;$.coord.tryParse=function(l){return E(l)?h(l):null};function B(l,U){B.base.call(this,l,U)}B.prototype={isAbove:function(l){return this.y()<l.y()},isBelow:function(l){return this.y()>l.y()},isLeftOf:function(l){return this.x()<l.x()},isRightOf:function(l){return this.x()>l.x()},distanceFrom:function(l){return $.vector(this.x()-l.x(),this.y()-l.y())},distanceTo:function(l){return this.distanceFrom(l).invert()}};$.Class.extend(B,$.coord.Class);$.point=function(l,U){return new B(l,U)};$.point.Class=B;$.point.zero=function(){return new B(0,0)};$.point.canParse=y;$.point.parse=a;$.point.tryParse=function(l){return y(l)?a(l):null};function y(l){try{return !isNaN(l.x())&&!isNaN(l.y())}catch(U){return false}}function a(l){return new B(l.x(),l.y())}function Q(l,U){Q.base.call(this);this._topLeft=$.point.parse(l);this._dims=$.point.parse(U);this._bottomRight=$.point.parse(l.add(U))}Q.prototype={dims:function(){return this.get("dims")},topLeft:function(){return this.get("topLeft")},bottomRight:function(){return this.get("bottomRight")},center:function(){return this._topLeft.add(this._bottomRight.subtract(this._topLeft)).half()},contains:function(V){var U=this._topLeft,l=this._bottomRight;return U.isAbove(V)&&U.isLeftOf(V)&&l.isRightOf(V)&&l.isBelow(V)}};$.Class.extend(Q,$.Class);$.rectangle=function(U,l){return new Q(U,l)};$.rectangle.Class=Q;function b(l,U){if(!$.isNumber(l)||!$.isNumber(U)){throw $.ku4exception("$.vector",$.str.format("Invalid arguments x= {0}, y= {1} ",l,U))}b.base.call(this,l,U);this._lengthSquared=c(this,l,U);this._length=r(this,this._lengthSquared);this._unitNormalX=D(this,l);this._unitNormalY=D(this,U)}b.prototype={magnitude:function(){return this.get("length")},equals:function(l){return(l instanceof b)&&((this._x===l.x())&&(this._y===l.y()))},normal:function(){return $.vector(this._unitNormalX,this._unitNormalY)},invert:function(){return $.vector(this.x()*-1,this.y()*-1)},norm:function(){return $.vector(Math.abs(this.x()),Math.abs(this.y()))},perpendicular:function(){return $.vector(this.y()*-1,this.x())},isZero:function(){return this.x()==0&&this.y()==0},add:function(l){return $.vector(this.x()+l.x(),this.y()+l.y())},dot:function(l){return(this.x()*l.x())+(this.y()*l.y())},perpendicularAtTo:function(l){var U=l.add(this.projectionOfOnto(l).invert());return $.vector(U.x(),U.y())},projectionOfOnto:function(l){var U=l.normal().scale(this.dot(l.normal()));return $.vector(U.x(),U.y())},scale:function(l){return $.vector((this.x()*l),(this.y()*l))},unitNormalDot:function(l){return(this.normal().x()*l.normal().x())+(this.normal().y()*l.normal().y())},reflect:function(l){if(l.isZero()){return this}var U=l.normal();return this.add(U.scale(2*(U.dot(this))).invert())},round:function(l){var U=l||0;return $.vector($.math.round(this.x(),U),$.math.round(this.y(),U))}};$.Class.extend(b,$.coord.Class);$.vector=function(l,U){return new b(l,U)};$.vector.Class=b;$.vector.zero=function(){return $.vector(0,0)};$.vector.random=function(V,U){var l=V*Math.random(),W=U*Math.random();return $.vector(l,W)};function r(l,U){if(l.isZero()){return 0}return Math.sqrt(U)}function c(U,l,V){if(U.isZero()){return 0}return Math.pow(l,2)+Math.pow(V,2)}function D(U,l){if(U.isZero()){return 0}return l/U.magnitude()}$.abstractContext=function(l){$.abstractContext.base.call(this);this.state(l)};$.abstractContext.prototype={state:function(l){if(!$.exists(l)){return this._state}return this.set("state",l.context(this))}};$.Class.extend($.abstractContext,$.Class);$.abstractState=function(l){$.abstractState.base.call(this);this.states(l)};$.abstractState.prototype={context:function(l){return this.property("context",l)},states:function(l){return this.set("states",l)},state:function(l){var U=this._context;U.state(new this._states[l](U));return this}};$.Class.extend($.abstractState,$.Class);$.abstractVisitor=function(){};$.abstractVisitor.prototype={$visit:function(){throw new Error("visit method is abstract an must be defined.")},subject:function(l){return this.property("subject",$.replicate(l))},visit:function(){return this.$visit()}};function u(l){u.base.call(this);this.$current=0;this._quit=false;this.subject(l)}u.prototype={$hasNext:function(){return $.exists(this._subject[this.$current+1])},$hasPrev:function(){return $.exists(this._subject[this.$current-1])},$each:function(U,V){var l=V||this;this.reset();do{U.call(l,this.current())}while(this.next()&&(!this._quit));this._end=false;this.reset()},$exec:function(V){var l=this._subject,U=l[V];if(!$.exists(U)){return null}this.$current=V;return U},subject:function(U){var l=($.isArray(U))?U:($.isObject(U))?j(U):U;if(!$.isUndefined(U)){this.reset()}this.$subject=l;return this.property("subject",l)},current:function(){return this.$exec(this.$current)},next:function(){return this.$exec(this.$current+1)},prev:function(){return this.$exec(this.$current-1)},hasNext:function(){return this.$hasNext()},hasPrev:function(){return this.$hasPrev()},reset:function(){this.$current=0;return this},quit:function(){return this.set("quit",true)},each:function(l,U){if(this._subject.length<1){return this}this.$each(l,U);return this}};function j(l){var U=[];for(n in l){U.push({key:n,value:l[n]})}return U}$.Class.extend(u,$.Class);$.iterator=function(l){return new u(l)};$.iterator.Class=u;function z(){z.base.call(this);this._observers=$.hash();this._throwErrors=0}z.prototype={throwErrors:function(){this._throwErrors=2;return this},logErrors:function(){this._throwErrors=1;return this},catchErrors:function(){this._throwErrors=0;return this},isEmpty:function(){return this._observers.isEmpty()},count:function(){return this._observers.count()},activeSubscriptionKeys:function(){return this._observers.keys()},subscribe:function(l,X,U,W){var V=this._observers;if(V.containsKey(l)){V.find(l).add(X,U,W)}else{V.add(l,$.observer().add(X,U,W))}return this},unsubscribe:function(l,V){var U=this._observers;if(U.containsKey(l)){U.find(l).remove(V)}return this},notify:function(){var l=$.list.parseArguments(arguments),U=$.list(),V=$.list();l.each(function(W){if(this._observers.containsKey(W)){V.add(W)}else{U.add(W)}},this);return(V.isEmpty())?this._notifyAll(U.toArray()):this._notify(U.toArray(),V)},clear:function(){this._observers.each(function(l){l.value.clear()}).clear();return this},_notifyAll:function(l){$.list(this._observers.values()).each(function(U){U.notify.apply(U,l)});return this},_notify:function(V,U){var W=this._observers,l=this._throwErrors;U.each(function(Y){try{var X=W.find(Y);X.notify.apply(X,V)}catch(aa){var Z=$.ku4exception("$.mediator",$.str.format("{0}. Subscriber key= {1}",aa.message,Y));if(l==2){throw Z}if(l==1){$.ku4Log(Z.message)}}});return this}};$.Class.extend(z,$.Class);$.mediator=function(){return new z()};$.mediator.Class=z;function A(){A.base.call(this);this._methods=new $.hash()}A.prototype={add:function(X,U,W){var l=W||$.uid("observerMethod"),V=U||this;this._methods.add(l,{m:X,s:V});return this},remove:function(l){this._methods.remove(l);return this},clear:function(){this._methods.clear();return this},notify:function(){var U=new $.iterator(this._methods.values()),l=arguments;U.each(function(V){if(!$.exists(V.m)){throw $.ku4exception("$.observer",$.str.format("Invalid or null method"))}V.m.apply(V.s,l)});return this},isEmpty:function(){return this._methods.isEmpty()}};$.Class.extend(A,$.Class);$.observer=function(){return new A()};$.observer.Class=A;function k(){this._q=[]}k.prototype={isEmpty:function(){return this._q.length==0},enqueue:function(l){var U=this._q;U[U.length]=l;return this},dequeue:function(){var U=this._q,l=U[0];U.splice(0,1);return l},clear:function(){this._q=[]}};$.fifo=function(){return new k()};$.fifo.Class=k;function H(l){H.base.call(this,l)}H.prototype={$hasNext:function(){var W=this.$subject,U=W.length-1,Y=this.$current,X=Y+1,V=(X>U)?0:X;return $.exists(W[V])},$hasPrev:function(){var W=this.$subject,U=W.length-1,Y=this.$current,X=Y+1,V=(X<0)?U:X;return $.exists(W[V])},$each:function(U,V){var l=V||this;this.reset();do{U.call(V,this.current())}while(this.next()&&(this.$current>0));this.reset()},$exec:function(W){var V=this.$subject,U=(V.length-1);this.$current=(W>U)?0:((W<0)?U:W);return V[this.$current]}};$.Class.extend(H,$.iterator.Class);$.rolodex=function(l){return new H(l)};$.rolodex.Class=H;function R(){}R.prototype={$isSatisfiedBy:function(l){return},isSatisfiedBy:function(l){return this.$isSatisfiedBy(l)},and:function(l){return new F(this,l)},or:function(l){return new m(this,l)},xor:function(l){return new x(this,l)},not:function(){return new N(this)}};function F(U,l){F.base.call(this);this.$1=U;this.$2=l}F.prototype.$isSatisfiedBy=function(l){return this.$1.isSatisfiedBy(l)&&this.$2.isSatisfiedBy(l)};$.Class.extend(F,R);function m(U,l){m.base.call(this);this.$1=U;this.$2=l}m.prototype.$isSatisfiedBy=function(l){return this.$1.isSatisfiedBy(l)||this.$2.isSatisfiedBy(l)};$.Class.extend(m,R);function x(U,l){x.base.call(this);this.$1=U;this.$2=l}x.prototype.$isSatisfiedBy=function(l){return $.xor(this.$1.isSatisfiedBy(l),this.$2.isSatisfiedBy(l))};$.Class.extend(x,R);function o(){o.base.call(this)}o.prototype.$isSatisfiedBy=function(l){return true};$.Class.extend(o,R);function g(){g.base.call(this)}g.prototype.$isSatisfiedBy=function(l){return false};$.Class.extend(g,R);function N(l){N.base.call(this);this._s=l}N.prototype.$isSatisfiedBy=function(l){return !this._s.isSatisfiedBy(l)};$.Class.extend(N,R);function q(l){q.base.call(this);this.$isSatisfiedBy=l}$.Class.extend(q,R);$.spec=function(l){return new q(l)};function w(){this._q=[]}w.prototype={isEmpty:function(){return this._q.length==0},push:function(l){var U=this._q;U[U.length]=l;return this},pop:function(){return this._q.pop()},clear:function(){this._q=[]}};$.lifo=function(){return new w()};$.lifo.Class=w})(jQuery);